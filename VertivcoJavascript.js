jQuery.extend({stringify:function(b){if("JSON"in window)return JSON.stringify(b);var g=typeof b;if("object"!==g||null===b)return"string"===g&&(b='"'+b+'"'),String(b);var n,l,k=[],q=b&&b.constructor===Array;for(n in b)b.hasOwnProperty(n)&&(l=b[n],g=typeof l,b.hasOwnProperty(n)&&("string"===g?l='"'+l+'"':"object"===g&&null!==l&&(l=jQuery.stringify(l)),k.push((q?"":'"'+n+'":')+String(l))));return(q?"[":"{")+String(k)+(q?"]":"}")}});
var Q=function(){var b={DEBUG:!0,UPDATE_INTERVAL:10,SYS_TIME:0,LOCAL_TIME:"",LANG_SYS_DEFAULT:"en",LOCALIZATION_DEFERRED:!1,UNITS:"imperial",GUEST_USER_ENABLED:!1,ADMIN:!1,ONEVIEW:!1,ONEVIEW_ENABLED:!1,SUPPORTED_ENV_TYPES:"afht3 t3hd thd remotetemp snt snh".split(" "),MAX:{ALARMS:50,ALARM_ACTIONS:32,ALARM_TIMES:8,DNS_SERVERS:2,EMAIL_TARGETS:10,NETWORK_IPS:8,NETWORK_ROUTES:8,REPORTS:5,SNMP_TRAPS:2,USERS:4},SYSTEM_ALARM:{state:"none",severity:""},DIALOG_COMM_OK:"comm-ok",DIALOG_COMM_ERR:"comm-err",
DIALOG_ERROR:"error",DIALOG_WARNING:"warning",DIALOG_INFO:"info",DIALOG_SUCCESS:"success",DIALOG_STATUS:null,USER:{name:"",access:{enabled:!1,control:!1,admin:!1},authToken:"",lang:""},APP_INITIALIZED:!1,RETCODE:{SUCCESS:0,NO_ADMIN:1E3,NOT_AUTHORIZED:1001,SESSION_EXPIRED:1002,PERMISSIONS:1003,INVALID_PASSWORD:1004},PAGES:{BLANK:"blank",OVERVIEW:"overview",ALARMS:"alarms",LOGGING:"logging",LOGCHART:"logchart",DISPLAY:"display",USERS:"users",NETWORK:"network",WEBSERVER:"webserver",REMOTE_AUTH:"remoteAuth",
EMAIL:"email",REPORTS:"reports",SNMP:"snmp",TIME:"time",SYSLOG:"syslog",ADMIN:"admin",LOCALE:"locale",UTILITIES:"utilities",INFO:"info",SSH:"ssh",USB:"usb",SERIAL:"serial",ONEVIEW_SUMMARY:"oneviewSummary",ONEVIEW_GROUPS:"oneviewGroups",ONEVIEW_DEVICES:"oneviewDevices",ONEVIEW_GROUP_CONFIG:"oneviewGroupConfig"}};b.ONEVIEWPAGES=[b.PAGES.ONEVIEW_SUMMARY,b.PAGES.ONEVIEW_GROUPS,b.PAGES.ONEVIEW_DEVICES,b.PAGES.ONEVIEW_GROUP_CONFIG];b.SENSORPAGES=[b.PAGES.OVERVIEW,b.PAGES.ALARMS];b.SYSTEMPAGES=[b.PAGES.USERS,
b.PAGES.NETWORK,b.PAGES.WEBSERVER,b.PAGES.EMAIL,b.PAGES.SNMP,b.PAGES.SYSLOG,b.PAGES.ADMIN,b.PAGES.LOCALE,b.PAGES.UTILITIES];b.HELPPAGES=[b.PAGES.INFO];b.LONELYPAGES=[b.PAGES.BLANK];b.ACTIVEPAGES=[];b.PAGE=b.PAGES.BLANK;b.CACHE={sys:null,dev:null,users:null,alarm:null,conf:null,datalog:null,meastypes:null,timezones:null,capability:null,analogModes:{},opId:null,opBuf:null,alarmOpId:null,languages:null,oneview:null};b.MEASUREMENT_ORDER="energy realPower apparentPower powerFactor voltage voltageMin voltageMax voltagePeak voltageCrestFactor current currentMin currentMax currentPeak currentCrestFactor power balance temperature airflow humidity dewpoint analog ccatSmoke ccatMilliVolt ccatCurrent ccatDigital ccatDoor ccatNeg48V ccatPos30V ccatPos60V ccatCityPower ccatWater ccatAnalog ccatAlarm".split(" ");
b.STATE_ICON={none:"icon-none",on:"icon-on",off:"icon-off",pending:"icon-pending",latchedOn:"icon-latchedOn",latchedOff:"icon-latchedOff",error:"icon-error"};b.log=function(g){try{b.DEBUG&&console&&console.log(new Date+" "+g)}catch(n){}};b.getTemplate=function(g){try{var n=null;if(g){"#"!==g.charAt(0)&&(g="#"+g);if(n=b.CACHE.templates.find(g))return $(n.html());throw"template not found";}return n}catch(l){b.log("error. getTemplate: "+l)}};b.createDialog=function(b,n){if("string"===typeof b&&"object"===
typeof n){var l=$(b);if(1===l.length&&l.is("div")){var k=l.prop("id");0!==$("#"+k).length&&($("#"+k).dialog&&$("#"+k).dialog("destroy"),$("#"+k).remove());l.dialog(n)}}};b.localize=function(g,n){try{!0===n&&($.localize.data={}),g||(g="en"),$("[data-localize]").localize("misc/msgCatalog",{language:g,callback:function(b,g){b=b||{};b.msgStatic=Q.CACHE.msgStatic||{};g(b)}})}catch(l){b.log("error. localize: "+l)}};b.getLocalStr=function(g){var n=g?"["+g+"]":"[localizationError]";try{var l="",k=$.localize.data["misc/msgCatalog"];
if(g&&k){if(Q.util)if("string"===typeof g&&k&&"object"===typeof k){if(g){var q=g.split(".");g=0;for(var c=q.length;g<c&&k;g++)k=k[q[g]]}l=k}else l=void 0;else"loading"===g&&(l=k[g]);return"string"===typeof l?l:n}b.log("getLocalStr: key or msgCatalog missing: "+n);return n}catch(e){return b.log("error. getLocalStr: "+e),n}finally{}};b.dialogAlert=function(g,n){try{if(Q.APP_INITIALIZED||g!==Q.DIALOG_COMM_ERR){var l=$("#alertDialog"),k="";g===Q.DIALOG_COMM_OK?Q.DIALOG_STATUS===Q.DIALOG_COMM_ERR&&(Q.DIALOG_STATUS=
null,l.dialog("close")):g===Q.DIALOG_COMM_ERR?(k=b.getLocalStr("error"),Q.DIALOG_STATUS=Q.DIALOG_COMM_ERR,b.dialogAlertOpen(k,n,!1)):g!==Q.DIALOG_ERROR&&g!==Q.DIALOG_WARNING&&g!==Q.DIALOG_INFO&&g!==Q.DIALOG_SUCCESS||(Q.DIALOG_STATUS===Q.DIALOG_COMM_ERR||!n&&(n||g!==Q.DIALOG_SUCCESS))||(k=g===Q.DIALOG_INFO?b.getLocalStr("menu.info"):b.getLocalStr(g),Q.DIALOG_STATUS=g,b.dialogAlertOpen(k,n,!0))}}catch(q){b.log("error. dialogAlert: "+q)}};b.dialogAlertOpen=function(g,n,l){g={title:g,buttons:[]};l?g.buttons=
[{id:"dlg-btn-alert-ok",text:b.getLocalStr("diagAndTable.ok"),click:function(){$(this).dialog("close")}}]:g.closeOnEscape=!1;b.createDialog("<div id='alertDialog'></div>",{autoOpen:!1,modal:!0,resizable:!1,buttons:[]});l=$("#alertDialog");l.html("<br><p><b><i>"+n+"</i></b></p>");l.dialog(g);l.dialog("open")};b.dialogAlertClose=function(){b.log("dialogAlertClose...");Q.DIALOG_STATUS=null};b.rowActionStyleUpdate=function(b,n,l){b=$("#"+b);n="boolean"===typeof n?n:!1;l="boolean"===typeof l?l:!0;n?b.removeClass("action").addClass("action-selected"):
b.removeClass("action-selected").addClass("action");l&&b.parent().parent().toggleClass("highlight",n)};return b}();
Q.gotoPage=function(b){try{if(Q.GUEST_USER_ENABLED||""!==Q.USER.name)if(-1===$.inArray(b,Q.ACTIVEPAGES))Q.log("gotoPage: invalid page = "+b),document.location.hash="#"+Q.PAGE;else{$(".ui-dialog").not("#dialog-admin-init").each(function(){$(this).hasOwnProperty("dialog")&&"function"===typeof $(this).dialog&&$(this).dialog("destroy").remove()});Q.JQO.showPleaseWait();Q.PAGE=b;Q.ADMIN&&$("div.ui-dialog").empty();switch(b){case Q.PAGES.BLANK:$("#content-pane").empty();break;case Q.PAGES.OVERVIEW:Q.overview.getPageOverview();
break;case Q.PAGES.ALARMS:Q.alarms.getPageAlarms();break;case Q.PAGES.LOGGING:Q.logging.getPageLogging();break;case Q.PAGES.LOGCHART:Q.logging.getPageLogChart();break;case Q.PAGES.USERS:Q.users.getPageUsers();break;case Q.PAGES.NETWORK:Q.network.getPageNetwork();break;case Q.PAGES.WEBSERVER:Q.webserver.getPageWebserver();break;case Q.PAGES.REMOTE_AUTH:Q.remoteAuth.getPageRemoteAuth();break;case Q.PAGES.DISPLAY:Q.display.getPageDisplay();break;case Q.PAGES.EMAIL:Q.email.getPageEmail();break;case Q.PAGES.REPORTS:Q.reports.getPageReports();
break;case Q.PAGES.SNMP:Q.snmp.getPageSnmp();break;case Q.PAGES.TIME:Q.time.getPageTime();break;case Q.PAGES.SYSLOG:Q.syslog.getPageSyslog();break;case Q.PAGES.ADMIN:Q.admin.getPageAdmin();break;case Q.PAGES.LOCALE:Q.locale.getPageLocale();break;case Q.PAGES.UTILITIES:Q.utilities.getPageUtilities();break;case Q.PAGES.INFO:Q.info.getPageInfo();break;case Q.PAGES.SSH:Q.ssh.getPageSSH();break;case Q.PAGES.USB:Q.usb.getPageUSB();break;case Q.PAGES.SERIAL:Q.serial.getPageSerial();break;case Q.PAGES.ONEVIEW_SUMMARY:Q.oneviewSummary.getPageOneviewSummary();
break;case Q.PAGES.ONEVIEW_GROUPS:Q.oneviewGroups.getPageOneviewGroups();break;case Q.PAGES.ONEVIEW_DEVICES:Q.oneviewDevices.getPageOneviewDevices();break;case Q.PAGES.ONEVIEW_GROUP_CONFIG:Q.oneviewGroupConfig.getPageOneviewGroupConfig()}Q.util.checkClockSet();-1===(""+document.location).search("#"+b)&&(window.history&&history.replaceState?history.replaceState("","","#"+b):document.location.replace("#"+b));$("ul.navbar-top li").removeClass("subhover").find("ul.navbar-sub").hide();Q.util.menuUpdate(b)}else $("#content-pane").empty()}catch(g){Q.log("error. gotoPage: "+
g)}};
Q.apiCall=function(b,g,n,l,k,q,c,e,t){try{if(b)-1!==b.search(/^\/.*$/)&&(b=b.substr(1));else return Q.log("error. apiCall: URL required"),null;if(!n&&!e||n&&"function"!==typeof n)return Q.log("error. apiCall: success callback"),null;if(!k)return Q.log("error. apiCall: cmd required"),null;"get"===k&&q&&(q=$.stringify(q));if("put"===k||"login"===k)if(!c||"string"!==typeof c)return Q.log("error. apiCall: invalid data; must be stringified JSON"),null;var s=Q.util.getApiDataStr(k,q,c,t);k=null;return k=e?
$.ajax({url:b,type:-1!==b.search("misc")?"GET":"POST",data:s,dataType:"json",contentType:"application/json",async:!0===g}):$.ajax({url:b,type:-1!==b.search("misc")?"GET":"POST",data:s,dataType:"json",contentType:"application/json",async:!0===g,success:n,error:l&&"function"===typeof l?l:function(b){Q.log("AJAX Error: "+$.stringify(b))}})}catch(a){return Q.log("error. apiCall: "+a),null}};
Q.apiCallDelete=function(b,g,n){Q.log("Q.apiCallDelete...");b={path:b,cmd:"delete",access:Q.auth.accessControlNormal()};(n||Q.validate.test(b))&&Q.apiCall(b.path,!0,g,null,b.cmd,null,null)};Q.cacheDeviceData=function(){try{Q.CACHE.dev&&0!==Object.keys(Q.CACHE.dev).length||Q.apiCall("/api/dev",!1,function(b,n,l){b&&0===b.retCode?Q.CACHE.dev=b.data:Q.log("error. Q.cacheDeviceData: "+n)},null,"get",null,null)}catch(b){Q.log("error. Q.cacheDeviceData: "+b)}};
Q.dialogLogin=function(b,g,n,l){Q.log("dialogLogin...");try{var k=$("#dialog-login");if(n&&("header"!==n||"guest"!==Q.USER.name&&""!==Q.USER.name)){n=function(b,c,k){b&&0===b.retCode?(!1===Q.GUEST_USER_ENABLED&&(Q.ping.stopUpdatePing(),Q.overview.stopDevUpdatePing(),Q.alarms.stopAlarmUpdatePing(),Q.network.stopNetworkUpdatePing(),Q.email.stopEmailTestPing(),Q.usb.stopUsbUpdatePing()),Q.auth.userLogout()):(Q.log("Unexpected response. response="+$.stringify(b)+", textStatus="+c+", jqXHR="+$.stringify(k)),
Q.dialogAlert(Q.DIALOG_ERROR,Q.util.getRetCodeMsg(b.retCode)))};var q="/api/auth/"+Q.USER.name;Q.auth.accessTest(q,"logout")&&Q.apiCall(q,!0,n,null,"logout",null,null);$("#header-logout").blur()}else k.is(":visible")||(q="",q=g?Q.getLocalStr("err.notAuthorized")+"..  "+Q.getLocalStr("loginout.login"):Q.getLocalStr("loginout.login"),Q.createDialog(Q.JQO.getDialogLogin().html(),{title:q,autoOpen:!0,resizable:!1,width:500,modal:!0,close:function(){$(this).dialog("destroy").remove()},buttons:[{id:"dlg-btn-login-login",
text:Q.getLocalStr("loginout.login"),click:function(){$("[id^=status-]").html("&nbsp;");var c=$("#userid").val(),t=$("#password").val();Q.validate.test({path:"/api/auth",cmd:"add",data:{username:{value:c,error:Q.util.fieldErrorText,reset:Q.util.fieldErrorTextReset,data:"userid"},password:{value:t,error:Q.util.fieldErrorText,reset:Q.util.fieldErrorTextReset,data:"password"}}})&&(Q.auth.userLogin(c,t,this,g),"function"===typeof b&&b())}},{id:"dlg-btn-login-cancel",text:Q.getLocalStr("diagAndTable.cancel"),
click:function(){$.isFunction(l)&&l();$(this).dialog("close")}}]}),Q.util.fieldErrorTextResetAll("dialog-login"),$("#userid").focus(),document.body.style.cursor="default",b&&!g?$("#dlg-btn-login-cancel").hide():$("#dlg-btn-login-cancel").show(),Q.localize(Q.USER.lang))}catch(c){Q.log("error. dialogLogin: "+c)}};$(document).on("keypress",".ui-dialog",function(b){b.keyCode===$.ui.keyCode.ENTER&&(b.preventDefault(),$(".ui-dialog-buttonpane button",$(this)).eq(0).click())});
$(document).on("keypress",".fm-group :input",function(b){b.keyCode===$.ui.keyCode.ENTER&&(b.preventDefault(),$(this).closest(".fm-group").find("button").eq(0).click())});Q.VERSION="1.5.7";Q.util=function(b,g,n,l,k){var q={getTimeStyle:function(){var b="quetzal",B=Q.CACHE.capability.time&&Q.CACHE.capability.time.style;B&&"string"===typeof B&&(b=B);return b},checkClockSet:function(){"(clock not set)"===Q.LOCAL_TIME?0===$("#content-pane").has("#clockNotSetMsg").length&&$("#content-pane").prepend($("<h6></h6>").prop("id","clockNotSetMsg").css("color","red").addClass("help-text ui-corner-all").append($("<a></a>").prop("href","/#time").append(g("logging.clockNotSet")))):$("#clockNotSetMsg").replaceWith("")},
checkSlaveBoardUpdate:function(b){"ok"!==b?0===$("#content-pane").has("#slaveBoardUpdateMsg").length&&$("#content-pane").prepend($("<h6></h6>").prop("id","slaveBoardUpdateMsg").css("color","red").addClass("help-text ui-corner-all").append(g("sysState.slaveBoardUpdate"))):$("#slaveBoardUpdateMsg").replaceWith("")},firmwareCanUpdate:function(){var b=!0,B=Q.CACHE.capability,B=B&&B.upload&&B.upload.sslSupport;"https:"!==document.location.protocol||("boolean"===typeof B?B:1)||(b=!1);return b},ipOnly:function(){try{var b=
!1,B=null,d=null;Q.CACHE.commands&&(Q.CACHE.commands.api&&Q.CACHE.commands.api.conf&&Q.CACHE.commands.api.conf.snmp&&Q.CACHE.commands.api.conf.snmp.target)&&((B=Q.CACHE.commands.api.conf.snmp.target)&&B._add?d=B._add.data.name:B&&B["%default%"]._set&&(d=B["%default%"]._set.name),"ipAddress"===d||"ipAddressOptional"===d)&&(b=!0);return b}catch(c){Q.log("error util.ipOnly: "+c)}},getApiDataStr:function(m,B,d,c){try{var a='{"token":"'+("string"===typeof c?c:Q.USER.authToken)+'","cmd":"'+m+'"';"get"===
m&&B&&(a+=',"filter":'+B);if("set"===m||"add"===m||"login"===m||"control"===m||"reset"===m||"reboot"===m)a+=',"data":'+(d?d:"{}");return a+"}"}catch(e){return b("error. util.getApiDataStr: "+e),""}},menuGetTabByPage:function(b){return-1<$.inArray(b,Q.SENSORPAGES)?"sensors":-1<$.inArray(b,Q.ONEVIEWPAGES)?"oneview":-1<$.inArray(b,Q.SYSTEMPAGES)?"system":-1<$.inArray(b,Q.HELPPAGES)?"help":-1<$.inArray(b,Q.LONELYPAGES)?"":null}},c=function(m,B,d,c){var a=$("<li></li>");if(void 0===m)return b("error. util.getMenuPageLink: missing key parameter"),
null;var e="";"top"===B?e="ui-corner-top":"bottom"===B&&(e="ui-corner-bottom");B=void 0!==d?d:"#"+m;a.append($("<a></a>").prop("href",B).prop("target",c?"_blank":"").prop("id","nav-page-"+m).addClass(e).append($("<span></span>").addClass("navbar-tri").append("&#x25ba;")).append($("<span></span>").attr("data-localize",d?m:"menu."+m)));return a},e=function(b){var B=$("<ul></ul>").addClass("navbar-sub");if(b&&b instanceof Array)for(var d=b.length,a=0;a<d;a++){var e=b[a];0===a?B.append(c(e,"top")):a===
d-1?B.append(c(e,"bottom")):B.append(c(e))}return B},t=function(){try{var m="http://"+g("msgStatic.info.supportSite"),B=$("<ul></ul>");B.addClass("navbar-top");B.addClass("ui-corner-all");Q.ONEVIEW&&Q.ONEVIEW_ENABLED&&B.append($("<li></li>").append($("<a></a>").prop("id","nav-tab-oneview").addClass("ui-corner-left").append(g("menu.oneview"))).append(e(Q.ONEVIEWPAGES)));var d=Q.ONEVIEW&&Q.ONEVIEW_ENABLED?"menu-middle":"ui-corner-left";B.append($("<li></li>").append($("<a></a>").prop("id","nav-tab-sensors").addClass(d).attr("data-localize",
"menu.sensors").append("&nbsp;")).append(e(Q.SENSORPAGES)));B.append($("<li></li>").append($("<a></a>").prop("id","nav-tab-system").addClass("menu-middle").attr("data-localize","menu.system").append("&nbsp;")).append(e(Q.SYSTEMPAGES)));B.append($("<li></li>").append($("<a></a>").prop("id","nav-tab-help").addClass("ui-corner-right").attr("data-localize","menu.help").append("&nbsp;")).append($("<ul></ul>").addClass("navbar-sub").append(c(Q.PAGES.INFO,"top")).append(c("info.supportSite","bottom",m,!0))));
return B}catch(a){b("error. util.getMenuContents: "+a)}},s=null,a=function(){try{$("ul.navbar-sub").parent().append("<span></span>"),function(){var b=/(iphone|ipod|ipad|andriod|iemobile|blackberry|bada)/.test(window.navigator.userAgent.toLowerCase()),m;try{document.createEvent("TouchEvent"),m=!0}catch(d){m=!1}return m||b}()?($("ul.navbar-top > li").on("click",function(b){b.stopPropagation();b=$(this).find("ul.navbar-sub").is(":visible");$("li.subhover").removeClass("subhover").find("ul.navbar-sub").hide();
b||$(this).addClass("subhover").find("ul.navbar-sub").show()}),$("#container").on("click",function(){$("li.subhover").removeClass("subhover").find("ul.navbar-sub").hide()})):$("ul.navbar-top > li").hover(function(){clearTimeout(s);$("li.subhover").removeClass("subhover").find("ul.navbar-sub").hide();$(this).addClass("subhover").find("ul.navbar-sub").show()},function(){s=setTimeout(function(){$("ul.navbar-top > li").removeClass("subhover").find("ul.navbar-sub").hide()},350)})}catch(m){b("error. util.addMenuEventHandlers: "+
m)}};q.getMenu=function(){try{$("#menu").empty().append(t()),Q.ONEVIEW&&Q.ONEVIEW_ENABLED?$('a[id^="nav-tab-"]').css("width","90px"):$('a[id^="nav-tab-"]').css("width","130px"),k(),a(),q.menuUpdate(Q.PAGE)}catch(m){b("error. util.getMenu: "+m)}};q.menuUpdate=function(b){var d=q.menuGetTabByPage(b);$("ul.navbar-sub a").removeClass("selected");$("ul.navbar-top > li > a").removeClass("selected");null!==d&&($("#nav-page-"+b).addClass("selected"),$("#nav-tab-"+d).addClass("selected"))};q.statusBarColorUpdate=
function(m,d){"tripped"===d.state||"latched"===d.state?"alarm"===d.severity?$("#"+m).removeClass("warning").addClass("alarm"):"warning"===d.severity?$("#"+m).removeClass("alarm").addClass("warning"):b("error. util.statusBarColorUpdate: bad severity - "+d.severity):"acked"===d.state||"clear"===d.state||"none"===d.state?$("#"+m).removeClass("alarm warning"):b("error. util.statusBarColorUpdate: bad state - "+d.state)};q.stateStatusText=function(b){var d="";"unavailable"===b?d=g("state.unavailable"):
"degraded"===b&&(d=g("state.degraded"));return d};q.strToBool=function(b,d,c){var a=null;if("boolean"===typeof b)return b;b===(d&&"string"===typeof d?d:"true")?a=!0:b===(c&&"string"===typeof c?c:"false")&&(a=!1);return a};q.sanitizeBool=function(m,d){var c=d;"boolean"===typeof m?c=m:m&&"string"===typeof m?(m=m.toLowerCase(),"true"===m?c=!0:"false"===m&&(c=!1)):b("error. util.sanitizeBool: could NOT fix - "+$.stringify(m));return c};var h=function(b){var d="";if($.isPlainObject(b)){var c=b.key;if("string"===
typeof c){var a=g(c);$.each(b,function(b,m){"key"!==b&&(a=a.replace(b,m))});d=a}}return d};q.fieldErrorText=function(b,d,c){var a=h(d);$("#"+c).addClass("inputErr").prop("title",a);$("#"+c+"-icon").removeClass("ui-icon-none").addClass("ui-icon-alert").prop("title",a).on("click",function(){n(Q.DIALOG_ERROR,a)})};q.fieldErrorTextReset=function(b,d){d&&($("#"+d).removeClass("inputErr").prop("title",""),$("#"+d+"-icon").addClass("ui-icon-none").removeClass("ui-icon-alert").prop("title",""))};q.fieldErrorTextResetAll=
function(b){$("#"+b).find("span.ui-icon-alert").siblings().each(function(){q.fieldErrorTextReset(null,$(this).prop("id"))})};q.fieldInputState=function(b,d){"false"===d||!1===d?($("#"+b).addClass("disabled").prop("disabled",!0),q.fieldErrorTextReset(null,b)):"true"!==d&&!0!==d||$("#"+b).removeClass("disabled").prop("disabled",!1)};var v=function(m,d){try{if(Q.CACHE.dev){var c=999,a=999,e=Q.CACHE.dev[m],h=Q.CACHE.dev[d];e&&"number"===typeof e.order&&(c=e.order);h&&"number"===typeof h.order&&(a=h.order);
null!==c&&void 0!==c&&null!==a&&void 0!==a||b("error. util.devIdCompare: invalid device order ("+c+"|"+a+")");if(c<a)return-1;if(c>a)return 1;b("error. util.devIdCompare: two devices with the same device order");return 0}}catch(w){return b("error. util.devIdCompare: "+w),0}};q.devGetSortedDevIds=function(){try{var m=null;if(Q.CACHE.dev&&Q.CACHE.dev){var d=[],c;for(c in Q.CACHE.dev)Q.CACHE.dev.hasOwnProperty(c)&&d.push(c);m=d.sort(v)}return m}catch(a){return b("error. util.devGetSortedDevIds: "+a),
null}};q.fixTableRows=function(b){b=$("table#"+b+" tr");for(var d=0,c,a,e=0;e<b.length;e++)0<$(b[e]).find("td").length&&(c=d%2?"dark-row":"light-row",a=d%2?"light-row":"dark-row",$(b[e]).addClass(c).removeClass(a),d++)};q.getRetCodeMsg=function(m){if(5E3===m||5001===m)return null;var d=g("retCode."+m);d||(b("error. util.getRetCodeMsg: message not found for retCode "+m),d=g("error"));return d};q.getValueByPath=function(b,d){if("string"===typeof d&&b&&"object"===typeof b){var c=b;if(d)for(var a=d.split("."),
e=0,h=a.length;e<h&&c;e++)c=c[a[e]];return c}};q.setValueByPath=function(b,d,c){if(d&&"string"===typeof d){var a=d.split(".");d=a.pop();if((b=q.getValueByPath(b,a.join(".")))&&"object"===typeof b&&d)return b[d]=c}};q.getCacheValueByPath=function(m){try{var d=null;if("string"===typeof m){var c=Q.CACHE,a=m.split("/");if(1<=a.length){m=0;for(var e=a.length;m<e&&c;m++)c=c[a[m]];d=c?c:null;c=Q.CACHE;m=0;for(e=a.length;m<e&&c;m++)c=c[a[m]];d&&c&&(d.name=c&&c.name?c.name:"",d.label=c&&c.label?c.label:"")}}return d}catch(h){b("error. util.getCacheValueByPath: "+
h)}};q.setCacheValueByPath=function(m,d){try{if(m&&d){var c=!1,a=Q.CACHE,e=m.split("/");if(1<=e.length){for(var h=0;h<e.length-1;h++)if(a[e[h]])a=a[e[h]];else{b("error. util.setCacheValueByPath: missing node at index "+h);c=!0;break}!c&&a&&(a[e[h]]=d)}}}catch(w){b("error. util.setCacheValueByPath: "+w)}};q.getTempUnits=function(){var b="imperial",d;d=Q.CACHE.conf&&Q.CACHE.conf.locale&&Q.CACHE.conf.locale.units;if("imperial"===d||"metric"===d)b=d;else if("imperial"===Q.UNITS||"metric"===Q.UNITS)b=
Q.UNITS;return b};q.getMeasAttrByType=function(m,d){var c=null;"string"===typeof m&&"string"===typeof d?(c=q.getCacheValueByPath("meastypes/"+m+"/"+d),"string"===typeof c?".none"===c.slice(-5)?c="":(c=g(c),"C"===c&&("units"===d&&"imperial"===q.getTempUnits())&&(c="F")):(b("error. util.getMeasAttrByType: no key found for "+m+", "+d),c="["+m+":"+d+"]")):(b("error. util.getMeasAttrByType: type and attr must be strings"),c="[error]");return c};q.strToInt=function(b){return!1===/^-?\d+$/.test(b)?NaN:parseInt(b,
10)};q.strToFloat=function(b){return $.isNumeric(b)?parseFloat(b):NaN};var w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},d={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#x2F;":"/"};q.escapeHtml=function(b){return"string"!==typeof b?b:String(b).replace(/[&<>"'\/]/g,function(b){return w[b]})};q.restoreHtml=function(b){return"string"!==typeof b?b:String(b).replace(/&amp;|&lt;|&gt;|&quot;|&#39;|&#x2F;/g,function(b){return d[b]})};q.getSubnetMaskFromCidr=function(b){var d=
"";if(0<=b&&32>=b)for(var c=0;4>c;c++)8<=b?(d+="255",b-=8):0<b?(b=256-Math.pow(2,8-b),d+=b.toString(),b=0):d+="0",3>c&&(d+=".");return d};q.getCidrFromSubnetMask=function(d){var c="";if(d&&-1!==d.search(/^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/)){var a=0;d=d.split(".");for(var e in d)if(d.hasOwnProperty(e)){var h=d[e];if("255"===h)a+=8;else if("254"===h)a+=7;else if("252"===h)a+=6;else if("248"===h)a+=5;else if("240"===h)a+=4;else if("224"===h)a+=3;else if("192"===h)a+=2;else if("128"===h)a+=1;else if("0"!==
h)return b("error. util.getCidrFromSubnetMask: bad value "+h+" at "+e),c}c=a.toString()}else b("error. util.getCidrFromSubnetMask: bad subnet mask");return c};q.getOrderZeroInterfaceKey=function(){var b="";if(Q.CACHE.conf.network)for(var d in Q.CACHE.conf.network)if(Q.CACHE.conf.network.hasOwnProperty(d)&&0===Q.CACHE.conf.network[d].order){b=d;break}return b};q.getCountMutableRoutes=function(){var b=0,d=q.getOrderZeroInterfaceKey();if(Q.CACHE.conf.network&&Q.CACHE.conf.network[d]&&Q.CACHE.conf.network[d].route)for(var c in Q.CACHE.conf.network[d].route)Q.CACHE.conf.network[d].route.hasOwnProperty(c)&&
!0===Q.CACHE.conf.network[d].route[c].mutable&&b++;return b};q.getDeviceNameLabel=function(b){var d="",c=b&&b.name||"";(b=b&&b.label||"")&&"string"===typeof b?d=b:c&&"string"===typeof c&&(d=c);return d};return q}(Q.log,Q.getLocalStr,Q.dialogAlert,Q.gotoPage,Q.localize);Q.validate=function(b){var g={},n={},l={},k={},q={rules:{},extValues:{}};k.isLocalized=function(b,e,t){var k={localized:!0,type:b,metric:{},imperial:{}};"string"===b&&(k.regex="");t&&(k.error=t);"number"===typeof e.metric.min&&"number"===typeof e.metric.max&&(k.metric=e.metric);"number"===typeof e.imperial.min&&"number"===typeof e.imperial.max&&(k.imperial=e.imperial);return k};k.stringCreate=function(b){var e={type:"string",min:0,max:Infinity,regex:""};b.localized?e=k.isLocalized("string",b,null):
("number"===typeof b.min&&(e.min=b.min),"number"===typeof b.max&&(e.max=b.max),"string"===typeof b.regex&&(e.regex=b.regex));k.addErrorMsgs(b.error,e);return e};k.stringTest=function(b,e,t){var g=!1,a=e.localized?e[Q.UNITS].min:e.min,h=e.localized?e[Q.UNITS].max:e.max;"string"!==typeof b?k.generateError("type",e,t):b.length<a?k.generateError("min",e,t):b.length>h?k.generateError("max",e,t):e.regex&&!1===RegExp(e.regex).test(b)?k.generateError("regex",e,t):(k.generateSuccess(null,t),g=!0);return g};
k.integerCreate=function(b){var e={type:"integer",min:0,max:Infinity,error:{min:"err.override.minVal",max:"err.override.maxVal",regex:"err.override.integerFormat"}};b.localized?e=k.isLocalized("integer",b,e.error):("number"===typeof b.min&&(e.min=b.min),"number"===typeof b.max&&(e.max=b.max));k.addErrorMsgs(b.error,e);return e};k.integerTest=function(b,e,t){var g=!1,a=e.localized?e[Q.UNITS].min:e.min,h=e.localized?e[Q.UNITS].max:e.max;"number"!==typeof b?k.generateError("type",e,t):!1===/^-?\d+$/.test(""+
b)?k.generateError("regex",e,t):b<a?k.generateError("min",e,t):b>h?k.generateError("max",e,t):(k.generateSuccess(null,t),g=!0);return g};k.floatCreate=function(b){var e={type:"float",min:-Infinity,max:Infinity,error:{min:"err.override.minVal",max:"err.override.maxVal",regex:"err.override.floatFormat"}};b.localized?e=k.isLocalized("float",b,e.error):("number"===typeof b.min&&(e.min=b.min),"number"===typeof b.max&&(e.max=b.max));k.addErrorMsgs(b.error,e);return e};k.floatTest=function(b,e,t){var g=
!1,a=e.localized?e[Q.UNITS].min:e.min,h=e.localized?e[Q.UNITS].max:e.max;"number"!==typeof b?k.generateError("type",e,t):b<a?k.generateError("min",e,t):b>h?k.generateError("max",e,t):!1===/^-?\d*\.?\d+$/.test(""+b)?k.generateError("regex",e,t):(k.generateSuccess(null,t),g=!0);return g};k.arrayCreate=function(b){var e={type:"array",min:0,max:Infinity,subtype:""};"number"===typeof b.min&&(e.min=b.min);"number"===typeof b.max&&(e.max=b.max);"string"===typeof b.subtype&&(e.subtype=b.subtype);k.addErrorMsgs(b.error,
e);return e};k.getArraySubtype=function(b){var e=null,k="string integer float enum boolean group".split(" ");(b=q.rules[b])&&"object"===typeof b&&0<=$.inArray(b.type,k)&&(e=b);return e};k.arrayTest=function(c,e,t){var g=!1,a;if($.isArray(c))if(c.length<e.min)k.generateError("min",e,t);else if(c.length>e.max)k.generateError("max",e,t);else if(a=k.getArraySubtype(e.subtype)){for(var h=!0,l=0,w=c.length;l<w&&h;l++)k.test(c[l],a)||(h=!1);h?(k.generateSuccess(null,t),g=!0):k.generateError("subtype",e,
t)}else b("error. validate.Rule.arrayTest: missing/bad subtype - "+e.subtype),k.generateError("sys",e,t);else k.generateError("type",e,t);return g};k.enumCreate=function(c){var e=null,t=!0,g={type:"enum",value:[]},a=c.value;if("string"===typeof a){var h=a.charAt(0),a=a.substr(1);"@"===h?g.value=a:(t=!1,b("error. validate.Rule.enumCreate: bad value string"))}else if($.isArray(a))for(0===c.value.length&&(t=!1,b("error. validate.Rule.enumCreate: value array must contain one or more strings")),h=0,a=
a.length;h<a&&t;h++)"string"===typeof c.value[h]?g.value[h]=c.value[h]:(t=!1,b("error. validate.Rule.enumCreate: value array must contain only strings"));else t=!1,b("error. validate.Rule.enumCreate: value must be string or array");t&&(k.addErrorMsgs(c.error,g),e=g);return e};k.getExtEnumValue=function(c){var e=null;c in q.extValues?e=q.extValues[c]:b("error. validate.Rule.getExtEnumValue: missing ext value - "+c);return e};k.enumGetValues=function(b){var e=null;b=b.value;"string"===typeof b&&(b=
k.getExtEnumValue(b));$.isArray(b)&&(e=b);return e};k.enumTest=function(c,e,g){var l=!1,a=e.value;"string"!==typeof c?k.generateError("type",e,g):("string"===typeof a&&(a=k.getExtEnumValue(a)),$.isArray(a)?0>$.inArray(c,a)?k.generateError("value",e,g):(k.generateSuccess(null,g),l=!0):(b("error. validate.Rule.enumTest: value must be array"),k.generateError("sys",e,g)));return l};k.booleanCreate=function(b){var e={type:"boolean"};k.addErrorMsgs(b&&b.error,e);return e};k.booleanTest=function(b,e,g){var l=
!1;"boolean"!==typeof b?k.generateError("type",e,g):(k.generateSuccess(null,g),l=!0);return l};k.groupCreate=function(c){var e=null,g=!0,l={type:"group",contains:[]},a=c.contains;if($.isArray(a)){0===a.length&&(g=!1,b("error. validate.Rule.groupCreate: contains must have one or more rule names"));for(var h=0,q=a.length;h<q&&g;h++)"string"===typeof a[h]?l.contains[h]=a[h]:(g=!1,b("error. validate.Rule.groupCreate: contains array must only have strings"))}else g=!1,b("error. validate.Rule.groupCreate: contains must be array");
g&&(k.addErrorMsgs(c.error,l),e=l);return e};k.groupTest=function(b,e,g){for(var l=!1,a=e.contains,h=0,n=a.length;h<n;h++)q.test(b,a[h])&&(k.generateSuccess(a[h],g),l=!0);l||k.generateError("contains",e,g);return l};k.test=function(c,e,g){var l=!1;try{if($.isPlainObject(e))switch(e.type){case "string":l=k.stringTest(c,e,g);break;case "integer":l=k.integerTest(c,e,g);break;case "float":l=k.floatTest(c,e,g);break;case "enum":l=k.enumTest(c,e,g);break;case "array":l=k.arrayTest(c,e,g);break;case "boolean":l=
k.booleanTest(c,e,g);break;case "group":l=k.groupTest(c,e,g);break;default:b("error. validate.Rule.test: bad type - "+e.type),k.generateError("sys",null,g)}else b("error. validate.Rule.test: bad data"),k.generateError("sys",null,g)}catch(a){b("error. validate.Rule.test: "+a),k.generateError("sys",null,g)}return l};k.create=function(c){var e=null;if($.isPlainObject(c))switch(c.type){case "string":e=k.stringCreate(c);break;case "integer":e=k.integerCreate(c);break;case "float":e=k.floatCreate(c);break;
case "enum":e=k.enumCreate(c);break;case "array":e=k.arrayCreate(c);break;case "boolean":e=k.booleanCreate(c);break;case "group":e=k.groupCreate(c);break;default:b("error. validate.Rule.create: bad type - "+c.type)}else b("error. validate.Rule.create: bad data");return e};k.generateError=function(c,e,g){var k={type:"err.default.type",min:"err.default.min",max:"err.default.max",regex:"err.default.regex",subtype:"err.default.subtype",value:"err.default.value",contains:"err.default.contains",sys:"err.default.sys"};
$.isPlainObject(g)||(g={});if(c in k){if(g.key=k[c],$.isPlainObject(e)&&($.isPlainObject(e.error)&&c in e.error&&(g.key=e.error[c]),"min"===c||"max"===c))e.localized?c in e[Q.UNITS]&&(g.$1=e[Q.UNITS][c]):c in e&&(g.$1=e[c])}else b("error. validate.Rule.generateError: invalid type - "+c);return g};k.generateSuccess=function(b,e){$.isPlainObject(e)||(e={});b&&"string"===typeof b&&(e[b]=!0);return e};k.addErrorMsgs=function(b,e){if($.isPlainObject(b)&&$.isPlainObject(e)){var g={};$.each(b,function(b,
a){b in e&&"error"!==b&&a&&"string"===typeof a&&(g[b]=a)});e.error=e.error||{};$.extend(e.error,g)}};q.createRules=function(b){var e=null;b&&$.each(b,function(b,c){e=k.create(c);null!==e&&(q.rules[b]=e)})};q.extractValues=function(c){var e=null,g=[],k=!0;if($.isArray(c))for(var a=0,h=c.length;a<h&&k;a++)"string"===typeof c[a]?g[a]=c[a]:(k=!1,b("error. validate.RuleGroup.extractValues: non-string entry at "+a));else if($.isPlainObject(c))for(a in c)c.hasOwnProperty(a)&&g.push(a);else b("error. validate.RuleGroup.extractValues: data must be object or array");
k&&(e=g);return e};q.createExtValues=function(c){$.each(c,function(c,g){var k=q.extractValues(g);k?q.extValues[c]=k:b("error. validate.RuleGroup.createExtValues: extract failed - "+c)})};q.init=function(b){var e=b.rules;e&&"object"===typeof e&&q.createRules(e);(b=b.files)&&"object"===typeof b&&q.createExtValues(b)};q.getRule=function(c){var e=null;if("string"===typeof c){var g=q.rules[c];$.isPlainObject(g)?e=g:b("error. validate.RuleGroup.getRule: unknown ruleName - "+c)}else b("error. validate.RuleGroup.getRule: ruleName must be string");
return e};q.getEnumValues=function(c){var e=null,g=q.getRule(c);g&&("enum"===g.type?e=k.enumGetValues(g):b("error. validate.RuleGroup.getEnumValues: non-enum rule - "+c));return e};q.test=function(b,e,g){var l=!1,a=q.getRule(e);a?(l=k.test(b,a,g))&&k.generateSuccess(e,g):k.generateError("sys",null,g);return l};l.init=function(b){(b=b.commands)&&"object"===typeof b&&(n=b)};l.getAction=function(c,e,g){var k=null,a=$.extend({},n),h=null,h=c;g=g||{};"/"===h.charAt(0)&&(h=h.substr(1));var l=h.split("/");
if(0<l.length){for(var k=0,w=l.length;k<w&&a;k++)h=l[k],h in a?a=a[h]:"%default%"in a?a=a["%default%"]:(b("error. validate.Command.getAction: pathNotFound - "+c),g.error="pathNotFound",a=null);a&&(c="_"+e,c in a?a=a[c]:(b("error. validate.Command.getAction: cmdNotFound - "+e),g.error="cmdNotFound",a=null));k=a}return k};l.resetFields=function(b){$.each(b,function(b,c){var g=c.reset;if(g&&"function"===typeof g){var a=c.hasOwnProperty("data")?c.data:null;g(b,a)}})};l.testFields=function(c,e,g){var k=
0;$.each(c,function(a,c){var l=!1,w={},d=e[a]||null;if(d&&"string"===typeof d)if(q.test(c.value,d,w))l=!0,g.data[a]=w;else{if(b('validate.Command:testFields: field "'+a+'" invalid'),(d=c.error)&&"function"===typeof d){var m=c.hasOwnProperty("data")?c.data:null;d(a,w,m)}}else b("error. validate.Command.testFields: dataFieldUnknown - "+a),g.error="dataFieldUnknown";l||k++});return 0===k};l.testAccess=function(b,e,g){var k=!0,a=b.access.test;a&&"function"===typeof a&&!a(e,b)&&(k=!1,g.error="accessDenied",
(b=b.access.error)&&"function"===typeof b&&b(e));return k};l.checkParams=function(b,e){var g=!1;$.isPlainObject(b)?"string"!==typeof b.path?e.error="pathInvalid":"string"!==typeof b.cmd?e.error="cmdInvalid":(b.data=b.data||{},$.isPlainObject(b.data)?(b.access=b.access||{},$.isPlainObject(b.access)?g=!0:e.error="accessInvalid"):e.error="dataInvalid"):e.error="paramsInvalid";return g};l.test=function(c,e){var g=!1;try{$.isPlainObject(e)||(e={});e.error="";e.data={};if(l.checkParams(c,e)){l.resetFields(c.data);
var k=l.getAction(c.path,c.cmd,e);if(k){var a=k.data||{};l.testAccess(c,k.access||"any",e)&&l.testFields(c.data,a,e)&&(g=!0)}}g||""===e.error||b("error. validate.Command.test: "+e.error);e.isValid=g}catch(h){b("error. validate.Command.test: "+h)}return g};l.getEnumValues=function(c,e,g){var k=null;try{if("string"!==typeof c||"string"!==typeof e||"string"!==typeof g)b("error. validate.Command.getEnumValues: path, cmd, and field must be strings");else{var a=l.getAction(c,e);if($.isPlainObject(a)&&$.isPlainObject(a.data)){var h=
a.data[g];if("string"!==typeof h)b("error. validate.Command.getEnumValues: no rule for field - "+g);else{var n=q.getEnumValues(h);n&&(k=$.extend([],n))}}else b("error. validate.Command.getEnumValues: bad action - path="+c+", cmd="+e)}}catch(w){b("error. validate.Command.getEnumValues: "+w)}return k};g.getApiData=function(b){var e={};$.isPlainObject(b)&&(b=b.data,$.isPlainObject(b)&&$.each(b,function(b,c){c.hasOwnProperty("value")&&(e[b]=c.value)}));return e};g.init=function(c){b("validate.init...");
try{q.init(c),l.init(c)}catch(e){b("error. validate.init: "+e)}};g.test=l.test;g.getEnumValues=l.getEnumValues;return g}(Q.log);Q.JQO=function(b,g,n,l,k,q,c,e,t,s){var a={},h=function(a){b("JQO.passwordSave...");var d=function(d,m){b("JQO.passwordSave.errCallback");c(d,m,"edit-password-entry1")},m=$("#dialog-edit-password"),g=$("#edit-password-entry1").val(),h=$("#edit-password-entry2").val(),k=!0;e(null,"edit-password-entry1");e(null,"edit-password-entry2");if(g!==h)return c(null,{key:"useroptions.error.verifyNomatch"},"edit-password-entry2"),!1;(h=m.data("validationCallback"))&&"function"===typeof h&&!h(g,d)&&(b("JQO.passwordSave: validation failed... "),
k=!1);k&&((d=m.data("successCallback"))&&"function"===typeof d&&d(g),$(a).dialog("close"))},v=function(b,d,m){var a=$("#dialog-edit-password");a.data("successCallback",d);a.data("validationCallback",m);"boolean"===typeof b?a.dialog("option","title",g("useroptions.passwordNew")):a.dialog("option","title",g("useroptions.changePassword"));$("#edit-password-entry1").val("");$("#edit-password-entry2").val("");$("#status-editPassword").html("&nbsp;")};a.passwordDialog=function(c,d,m){b("JQO.passwordDialog...");
"boolean"!==typeof c&&"string"!==typeof c?b("error. JQO.passwordDialog: invalid password"):d&&"function"===typeof d?m&&"function"!==typeof m?b("error. JQO.passwordDialog: validationCallback must be function"):(t(a.getDialogEditPassword().html(),{autoOpen:!1,resizable:!1,width:500,modal:!0,close:function(){var b=$("#dialog-edit-password");b.data("successCallback",null);b.data("validationCallback",null);b.find(":input").val("");e(null,"edit-password-entry1");e(null,"edit-password-entry2")},buttons:[{id:"dlg-btn-password-ok",
text:g("diagAndTable.ok"),click:function(){$("[id^=status-]").html("&nbsp;");h(this)}},{id:"dlg-btn-password-cancel",text:g("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]}),v(c,d,m||null),s(Q.USER.lang),$("#dialog-edit-password").dialog("open"),$("#edit-password-entry1").focus()):b("error. JQO.passwordDialog: missing successCallback")};a.getSelectAllOrNone=function(b){var d=$("<div></div>");d.addClass("ui-corner-all").css("margin-bottom","5px").append($("<select></select>").prop("id",
"allOrNoneOption-"+b).addClass("ui-corner-all").css("width","auto").append($("<option></option>").prop("value","all").append(g("common.selectAll"))).append($("<option></option>").prop("value","none").append(g("common.selectNone")))).append("&nbsp;").append($("<span></span>").prop("id","allOrNone-"+b).css("background-color","silver").addClass("ui-icon ui-icon-check ui-corner-all action").prop("title",g("common.select")));return d};a.eventHandler_selectAllOrNone=function(a){a=a.target.id.split("-")[1];
var d=$("#allOrNoneOption-"+a).val(),m="";switch(Q.PAGE){case Q.PAGES.DISPLAY:m="lcd";break;case Q.PAGES.LOGGING:m="logging";break;case Q.PAGES.LOGCHART:m="logchart";break;default:b("error. jqo.eventHandler_selectAllOrNone: invalid page");return}"all"===d?($("#devBody-"+a).find('[id*="-measurement-"]').each(function(b,d){$(d).addClass("lcdSelected");Q.CACHE[m][d.id]=!0}),$("#devBody-"+a).find('[id*="-analog-"]').each(function(b,d){-1===d.id.search(/^r-.*$/)&&-1!==d.id.search(/^.*\d+$/)&&($(d).addClass("lcdSelected"),
Q.CACHE[m][d.id]=!0)})):"none"===d&&($("#devBody-"+a).find('[id*="-measurement-"]').each(function(b,d){$(d).removeClass("lcdSelected");Q.CACHE[m][d.id]=!1}),$("#devBody-"+a).find('[id*="-analog-"]').each(function(b,d){-1===d.id.search(/^r-.*$/)&&-1!==d.id.search(/^.*\d+$/)&&($(d).removeClass("lcdSelected"),Q.CACHE[m][d.id]=!1)}))};a.getIconSpan=function(a){var d=$("<span></span>"),m=a.split("-");d.addClass("ui-icon statusspan");if(2!==m.length)return b("error. JQO.getIconSpan: invalid id ("+a+")"),
"";"none"!==m[1]&&d.attr("title","$1");switch(m[1]){case "none":d.addClass("ui-icon-none");break;case "on":case "clear":d.addClass("ui-icon-check");break;case "off":d.addClass("ui-icon-close");break;case "pending":d.addClass("ui-icon-transferthick-e-w");break;case "latchedOn":d.addClass("ui-icon-circle-check");break;case "latchedOff":d.addClass("ui-icon-circle-close");break;case "error":d.addClass("ui-icon-cancel");break;case "warning":d.addClass("ui-icon-notice");break;case "alarm":d.addClass("ui-icon-alert")}return d};
a.getSectionWrapperPlain=function(b,d){var m=$("<div></div>");m.append(a.getSectionHeaderPlain(b));m.append($("<div></div>").addClass("section-body ui-corner-bottom").append($("<blockquote></blockquote>").append(d)));return m};a.getSectionBodyWrapper=function(b,d){var a=$("<div></div>");d&&(b&&"string"===typeof b)&&a.prop("id",b).addClass("section-body ui-corner-bottom").append($("<blockquote></blockquote>").append(d));return a};a.getSectionHeaderPlain=function(b,d){var a=n("T-sectionHeaderPlain");
a&&(d?a.find(".section-header-title").append(b):a.find(".section-header-title").attr("data-localize",b));return a};a.getFormHelpText=function(b,d){var a=null;b&&d&&(a=$("<h6></h6>").addClass("help-text ui-corner-all").attr("style","display:block;").attr("data-localize",d).append("&nbsp;"));return a};a.getFormOptionText=function(b,d,a,c){var e=n("T-formOption");e&&(e.find("input").prop("type","text").prop("id",b),d&&""!==d&&e.find("label").attr("data-localize",d).prop("for",b),a?e.find("input").attr("readonly",
"readonly"):e.find("span").prop("id",b+"-icon"),c&&e.append($("<input>").prop("type","checkbox").prop("id",b+"-delete")).append(g("diagAndTable.delete")));return e};a.getFormOptionLabel=function(b,d,a){var c=n("T-formOptionLabel");c&&(c.find("label.formLabel").attr("data-localize",d).prop("for",b),c.find("label.formLabelVal").prop("id",b).empty().append(void 0!==a?a:"&nbsp;"));return c};a.getFormOptionList=function(a,d,m,c,e){if(m instanceof Array&&c instanceof Array){if(m.length!==c.length)return b("error. JQO.getFormOptionList: values and names length."),
$("<div>!</div>")}else return b("error. JQO.getFormOptionList: invalid array param."),$("<div>!</div>");var h=n("T-formOption");if(h){h.find("input").replaceWith($("<select></select>").addClass("ui-corner-all"));h.find("label").attr("data-localize",d).prop("for",a);d=[];for(var k=0;k<m.length;k++)e?d.push($("<option></option>").prop("value",m[k]).append(c[k])):d.push($("<option></option>").prop("value",m[k]).append(g(c[k])));h.find("select").prop("id",a).append(d);h.find("span").prop("id",a+"-icon")}return h};
a.getFormOptionListNoNames=function(a,d,m){if(!(m instanceof Array)||1>m.length)return b("error. JQO.getFormOptionListNoNames: no values"),$("<div>!</div>");var c=n("T-formOption");if(c){c.find("input").replaceWith($("<select></select>").addClass("ui-corner-all"));c.find("label").attr("data-localize",d).prop("for",a);d=[];for(var e=0;e<m.length;e++)d.push($("<option></option>").append(m[e]));c.find("select").prop("id",a).append(d);c.find("span").prop("id",a+"-icon")}return c};a.getFormOptionListLanguages=
function(a,d,m,c){c=!0===c;if("object"!==typeof m)return b("error. JQO.getFormOptionListLanguages: invalid langObj"),$("<div>!</div>");var e=c?n("T-dialogFormOptionList"):n("T-formOption");if(e){c||e.find("input").replaceWith($("<select></select>").addClass("ui-corner-all"));e.find(".formLabel").attr("data-localize",d);d=[];for(var g in m)m.hasOwnProperty(g)&&d.push($("<option></option>").prop("value",g).append(m[g]));e.find("select").prop("id",a).append(d);e.find("span").prop("id",a+"-icon")}return c?
e.is("tbody")?e.find("tr"):e:e};a.getFormOptionTimezoneList=function(b,d,m){return a.getFormOptionListNoNames(b,d,m)};a.getFormOptionFile=function(b,d,a){var c=n("T-formOption");c&&(c.find("div").addClass("fm-file"),c.find("label").attr("data-localize",d).prop("for",b),c.find("input").prop("type","file").prop("id",b).prop("name",a));return c};a.getFormOptionPassword=function(b,d){var a=n("T-formOption");a&&(a.find("label").attr("data-localize",d).prop("for",b),a.find("input").prop("type","password").prop("id",
b),a.find("span").prop("id",b+"-icon"));return a};a.getFormOptionLink=function(b,d,a){var c=n("T-formOption");c&&(c.find("input").replaceWith($("<a></a>").addClass("dl-link").prop("target","_blank")),c.find("label").attr("data-localize",b),c.find("a").prop("href",d).append(a));return c};a.getFormSubmit=function(b,d,a){var c=n("T-formSubmit");c&&(c.find(".submit").prop("id","submit-"+b),c.find("button").prop("id",b).attr("data-localize",d),c.find(".status").prop("id","status-"+a));return c};a.getDialogOptionInput=
function(b,d,m,c,e,g){var h=n("T-dialogOptionInput");h&&(m&&"string"===typeof m&&(!1!==g?h.find(".formLabel").attr("data-localize",m):h.find(".formLabel").append(m)),h.find(".formControl").prepend(a.getDialogInputField(b,d,c,e)),h.find("span").prop("id",d+"-icon"));return h.is("tbody")?h.find("tr"):h};a.getDialogOptionTextArea=function(b,d,m,c,e,g,h){var k=n("T-dialogOptionInput");k&&(c&&"string"===typeof c&&(!1!==h?k.find(".formLabel").attr("data-localize",c):k.find(".formLabel").append(c)),k.find(".formControl").prepend(a.getDialogTextAreaField(m,
b,d,e,g)),k.find("span").prop("id",m+"-icon"));return k.is("tbody")?k.find("tr"):k};a.getDialogTextAreaField=function(b,d,a,c,e){d="number"===typeof d?d:1;a="number"===typeof a?a:30;var g=$("<textarea></textarea>").addClass("ui-corner-all");"string"!==typeof e&&"number"!==typeof e?e="":"string"===typeof e&&(e=l(e));!0!==c&&"true"!==c||g.attr("disabled","disabled").attr("readonly","readonly");g.prop("style","resize:none;font-size:smaller;").prop("rows",d).prop("cols",a).prop("id",b).attr("value",e);
return g};a.getDialogInputField=function(b,d,a,c){var e=$("<input>").addClass("ui-corner-all");"string"!==typeof c&&"number"!==typeof c?c="":"string"===typeof c&&(c=l(c));"text"!==b||!0!==a&&"true"!==a?"checkbox"===b&&e.addClass("dialogCheck"):e.attr("disabled","disabled").attr("readonly","readonly");e.prop("type",b).prop("id",d).attr("value",c);return e};a.getDialogOptionText=function(b,d,c,e,g){return a.getDialogOptionInput("text",b,d,c,e,g)};a.getDialogOptionText=function(b,d,c,e,g){return a.getDialogOptionInput("text",
b,d,c,e,g)};a.getDialogOptionPass=function(b,d){return a.getDialogOptionInput("password",b,d)};a.getDialogOptionPass=function(b,d){return a.getDialogOptionInput("password",b,d)};a.getDialogOptionCheckbox=function(b,d){return a.getDialogOptionInput("checkbox",b,d)};a.getDialogOptionCheckbox=function(b,d){return a.getDialogOptionInput("checkbox",b,d)};a.getDialogOptionLabel=function(b,d,a){var c=n("T-dialogOptionInput");c&&(c.find(".formLabel").attr("data-localize",d).append("&nbsp;"),!0===a?c.find(".formControl").empty().append($("<div></div>").addClass("dialogTextValue").attr("data-localize",
b).append("&nbsp;")):c.find(".formControl").empty().append($("<div></div>").addClass("dialogTextValue").append(l(b))));return c.is("tbody")?c.find("tr"):c};a.getDialogOptionHtml=function(b,d){var a=n("T-dialogOptionInput");a&&(a.find(".formLabel").attr("data-localize",d),a.find(".formControl").prepend(b));return a.is("tbody")?a.find("tr"):a};a.getDialogOptionHR=function(){var b=n("T-dialogOptionHR");return b.is("tbody")?b.find("tr"):b};a.getDialogOptionList=function(c,d,m,e,g,h){if(!(m instanceof
Array&&e instanceof Array&&m.length===e.length))return b("error. JQO.getDialogOptionList: values and keys length."),$();var k=n("T-dialogOptionInput");k&&(k.find(".formLabel").attr("data-localize",d),k.find(".formControl").prepend(a.getDialogSelectField(c,m,e,g,h)),k.find("span").prop("id",c+"-icon"));return k.is("tbody")?k.find("tr"):k};a.getDialogSelectField=function(a,d,c,e,g){if(!(d instanceof Array&&c instanceof Array&&d.length===c.length))return b("error. JQO.getDialogSelectField: values and labels length."),
$();var h=$("<select></select>").addClass("ui-corner-all");h.prop("id",a);for(a=0;a<d.length;a++){var k=$("<option></option>");k.prop("value",d[a]);d[a]===e&&k.attr("selected",!0);!0===g?k.attr("data-localize",c[a]).append("&nbsp;"):k.append(c[a]);h.append(k)}return h};a.getHiddenInput=function(b,d){return $("<input>").prop("id",b).prop("type","hidden").attr("data-localize",d)};a.getNameValue=function(b,d,a,c){var e=n("T-formOptionLabel");e&&(e.find(".formLabel").attr("data-localize",b),null===d&&
a?e.find(".formLabelVal").addClass(c).attr("data-localize",a):e.find(".formLabelVal").empty().append(d));return e};a.getNameFormattedValue=function(a,d){var c=null,e=!0,h=null,k=null,l=null,q=null,t=null,v=null,s=$("<div></div>");try{if(d&&"object"===typeof d)for(c in d)if(d.hasOwnProperty(c))if(h=n("T-formOptionLabel"),e&&(h.find(".formLabel").attr("data-localize",a),e=!1),h.find(".formLabelVal").empty().append(g(c)),s.append(h),"string"===typeof d[c])h=n("T-formOptionLabel"),h.find(".formLabelVal").empty().append("&nbsp;&nbsp;&bull;&nbsp;&nbsp;&nbsp;"+
d[c]),s.append(h);else if("object"===typeof d[c])for(l in k=d[c],k)if(k.hasOwnProperty(l)&&k[l]instanceof Array){q=k[l];v="";for(t=0;t<q.length;t++)v=-1!==q[t].search(/^info\./)?v+(g(q[t])+" "):v+(q[t]+" ");h=n("T-formOptionLabel");h.find(".formLabelVal").empty().append("&nbsp;&nbsp;&bull;&nbsp;&nbsp;&nbsp;"+v);s.append(h)}return s.unwrap()}catch(y){b("error. JQO.getNameFormattedValue: "+y)}};a.getAlarmDeviceList=function(b){var d="",a="",c=Q.CACHE.dev,e=k(),h=$("<select></select>").prop("id",b).addClass("ui-corner-all");
if(c&&e)for(var q in e)if(e.hasOwnProperty(q)){var n=e[q],d=n,a=c[n].name;c[n].label&&c[n].label!==a&&(a+=" ("+l(c[n].label)+")");var t=$("<optgroup></optgroup>");t.prop("label",a);"dataLog"!==b.substring(0,7)&&"lcdDisplay"!==b.substring(0,10)&&t.append($("<option></option>").prop("value",d).append(g("common.device")));var v={},s=[],y;for(y in c[n])if(c[n].hasOwnProperty(y))if(-1<$.inArray(y,["entity","outlet","relay"]))for(var G in c[n][y])c[n][y].hasOwnProperty(G)&&(d=c[n][y][G],a=!1,-1!==y.search("analog")?
a=!0:d.measurement&&!$.isEmptyObject(d.measurement)&&(a=!0),a&&(d=n+"/"+y+"/"+G,a=c[n][y][G].name,c[n][y][G].label&&c[n][y][G].label!==a&&(a+=" ("+l(c[n][y][G].label)+")"),a&&(v[a]=d,s.push(a))));else"analog"===y&&!$.isEmptyObject(c[n][y])&&(d=n+"/"+y,a=g("meas.name.analog"))&&(v[a]=d,s.push(a));for(n=0;n<s.length;n++)-1!==s[n].search(/ \d$/)?s[n]=s[n].replace(/ (\d$)/," 0$1"):-1!==s[n].search(/ \d \(.*\)$/)&&(s[n]=s[n].replace(/ (\d) (\(.*\)$)/," 0$1 $2"));s=s.sort();for(n=0;n<s.length;n++)-1!==
s[n].search(/ 0\d$/)?s[n]=s[n].replace(/ 0(\d$)/," $1"):-1!==s[n].search(/ 0\d \(.*\)$/)&&(s[n]=s[n].replace(/ 0(\d) (\(.*\)$)/," $1 $2"));for(n=0;n<s.length;n++)t.append($("<option></option>").prop("value",v[s[n]]).append(s[n]));h.append(t)}return h};a.getAlarmTriggerSelect=function(b){var d=$("<select></select>").addClass("ui-corner-all");d.prop("id",b);return d=a.getAlarmTriggerOptions(b,d)};a.getAlarmTriggerOptions=function(a,d){var c=$("#"+a.replace("trigger","name"));if(c.length&&d){var e=c.val();
d.empty();if(e){if(-1===e.search("/")&&d.append($("<option></option>").prop("value","").append(g("alarms.state"))),Q.CACHE.dev){for(var c=Q.CACHE.dev,h=e.split("/"),k=0;k<h.length;k++)c[h[k]]&&(c=c[h[k]]);if(c&&c.measurement)for(var l in c.measurement)c.measurement.hasOwnProperty(l)&&(e=q(c.measurement[l].type,"name"),d.append($("<option></option>").prop("value","measurement/"+l).append(e)));else if(c&&-1!==e.search("analog"))for(var n in c)c.hasOwnProperty(n)&&(l=c[n])&&(e=l.label||l.name||"",d.append($("<option></option>").prop("value",
n).append(e)))}}else b("error. JQO.getAlarmTriggerOptions: bad nameVal")}return d};a.resetAlarmTriggerOptions=function(c){try{var d=$("#"+c),d=a.getAlarmTriggerOptions(c,d);d.trigger("change")}catch(e){b("error. JQO.resetAlarmTriggerOptions: "+e)}};a.getPageWrapper=function(b){var a=$("<blockquote></blockquote>");a.append(b);return a};a.getFormGroup=function(b,a){var c=a?a:"",e=$("<div></div>").prop("id",b||"").addClass("fm-group");e.append($("<fieldset></fieldset>").addClass("ui-corner-all").append(c));
return e};a.getFormTable=function(b,a){var c=n("T-formTable");c&&(c.prop("id",b+"-group"),c.find("table").prop("id",b).append(a));return c};a.getSection=function(b){b=b?b:"";var a=$("<div></div>");a&&(a.addClass("section-body ui-corner-bottom"),a.append($("<blockquote></blockquote>").append(b)));return a};a.getDialogEditPassword=function(){var b=n("T-dialogEditPassword");b&&(b.find("._pw1").replaceWith(a.getDialogOptionPass("edit-password-entry1","useroptions.passwordNew")),b.find("._pw2").replaceWith(a.getDialogOptionPass("edit-password-entry2",
"useroptions.passwordVerify")));return b};a.showPleaseWait=function(){$("#content-pane").empty().append($("<div></div>").prop("id","loading").append($("<br>")).append("&nbsp;&nbsp;&nbsp;").append($("<i></i>").append(g("loading"))))};a.getDialogAdminInit=function(){var b=n("T-dialogAdminInit");b&&(b.find("._name").replaceWith(a.getDialogOptionText("userName","common.username")),b.find("._pw1").replaceWith(a.getDialogOptionPass("password1","common.password")),b.find("._pw2").replaceWith(a.getDialogOptionPass("password2",
"dialog.admin.pwVerify")));return b};a.getDialogLogin=function(){var b=n("T-dialogLogin");b&&(b.find("._id").replaceWith(a.getDialogOptionText("userid","common.username")),b.find("._pw").replaceWith(a.getDialogOptionPass("password","common.password")));return b};return a}(Q.log,Q.getLocalStr,Q.getTemplate,Q.util.escapeHtml,Q.util.devGetSortedDevIds,Q.util.getMeasAttrByType,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.createDialog,Q.localize);Q.auth=function(b,g,n,l,k,q,c,e,t,s,a,h,v){var w={passwordInputGet:function(b){var a=null;b=$("#"+b);var c=b.prop("type");"text"===c?(b=b.data("passwordSet"),"boolean"===typeof b&&(a=b)):"password"===c&&(a=b.val());return a},passwordInputSet:function(b,a){var c;"string"===typeof a?$("#"+b).prop("type","password").removeClass("passwordText").val(a):"boolean"===typeof a&&(c=g(a?"xxx.passwordSet":"xxx.passwordNone"),$("#"+b).val(c).addClass("passwordText").data("passwordSet",a).prop("type","text"))},
passwordInputInit:function(b,a){var c=!1;"string"===typeof a?"true"===a?c=!0:"false"===a&&(c=!1):"boolean"===typeof a&&(c=a);w.passwordInputSet(b,c)},accessControlNormal:function(){return{test:w.userHasPermission,error:function(){n(Q.DIALOG_ERROR,g("err.notAuthorized"))}}},accessTest:function(b,a,c){var e=!1;t({path:b,cmd:a,access:{test:w.userHasPermission,error:function(){c||n(Q.DIALOG_ERROR,g("err.notAuthorized"))}}})&&(e=!0);return e},initialCookieCheck:function(){if($.cookies.test()){var b=$.cookies.get("r-token"),
a=$.cookies.get("r-name"),c=$.cookies.get("r-level"),e=$.cookies.get("r-lang");b&&(a&&c&&e)&&(Q.USER.authToken=b,Q.USER.name=a,Q.USER.name&&"guest"!==Q.USER.name||(Q.USER.authToken="",$.cookies.del("r-token",null)),w.setAuthFromStr(c),Q.USER.lang=e)}},handleInvalidSession:function(){try{b("auth.handleInvalidSession..."),w.userLogout()}catch(a){b("error. auth.handleInvalidSession: "+a)}},updateLoginout:function(){"guest"===Q.USER.name||""===Q.USER.name?($("#header-loginout").html(g("loginout.login")),
$("#header-userprefs").empty().hide()):($("#header-loginout").html(g("loginout.logout")),$("#header-userprefs").html(Q.USER.name).show())},getAuthStr:function(){try{var a="en"+(!0===Q.USER.access.enabled?"1":"0"),a=a+("ou"+(!0===Q.USER.access.control?"1":"0"));return a+="ad"+(!0===Q.USER.access.admin?"1":"0")}catch(c){return b("error. auth.getAuthStr: "+c),""}},setAuthFromStr:function(a){try{a&&"string"===typeof a&&(Q.USER.access.enabled=-1!==a.search("en1"),Q.USER.access.control=-1!==a.search("ou1"),
Q.USER.access.admin=-1!==a.search("ad1"))}catch(c){b("error. auth.setAuthFromStr: "+c)}},hasSetPermission:function(b,a){var c=!1,e=function(b){var a="",c=b&&b.name,d=b&&b.access&&b.access.enabled;b&&b.access&&b.access.admin?a="admin":c&&("string"===typeof c&&"guest"!==c)&&d&&(a="user");return a}(b),h=function(b){var a="";b=b&&b.data;$.isPlainObject(b)&&($.each(b,function(b){if("password"!==b&&"language"!==b)return a="admin",!1}),""===a&&(a="user"));return a}(a);"admin"===e?c=!0:"user"===e&&"user"===
h&&"/api/auth/"+(b&&b.name)===(a&&a.path)&&(c=!0);return c},hasLogoutPermission:function(b,a){var c=!1,e;e=null;var h=b&&b.name;h&&("string"===typeof h&&"guest"!==h)&&(e=h);e&&(a&&a.path)==="/api/auth/"+e&&(c=!0);return c},userHasPermission:function(a,c){var e=!1;switch(a){case "admin":Q.USER.access.admin&&(e=!0);break;case "control":if(Q.USER.access.admin||Q.USER.access.control)e=!0;break;case "user":"guest"!==Q.USER.name&&(""!==Q.USER.name&&Q.USER.access.enabled)&&(e=!0);break;case "any":e=!0;break;
case "userAdd":Q.USER.access.admin?e=!0:Q.ADMIN||(e=!0);break;case "userSet":w.hasSetPermission(Q.USER,c)&&(e=!0);break;case "login":if("guest"===Q.USER.name||""===Q.USER.name)e=!0;break;case "logout":w.hasLogoutPermission(Q.USER,c)&&(e=!0);break;default:b("error. auth.userHasPermission: invalid access - "+a)}return e},userLogout:function(){b("auth.usersLogout...");Q.USER.authToken="";$.cookies.test()&&($.cookies.del("r-token",null),$.cookies.del("r-name",null),$.cookies.del("r-level",null),$.cookies.del("r-lang",
null));Q.GUEST_USER_ENABLED?(Q.USER.name="guest",w.setAuthFromStr("en1"),$("#header-userprefs").empty(),$("#menu").show(),$("#status").show()):(Q.USER.name="",w.setAuthFromStr("en0"),$("#header-userprefs").empty().hide(),$("#menu").hide(),$("#status").hide());Q.USER.lang=Q.LANG_SYS_DEFAULT;w.updateLoginout();Q.auth.loginoutCleanup()},userLogin:function(a,c,e,h){b("auth.userLogin...");try{var q={name:a,token:null},t=encodeURI("/api/auth/"+a);a={password:c};s(t,!1,function(a,c,d){a&&0===a.retCode?a.data&&
a.data.token&&q?(Q.USER.name=q.name,Q.USER.authToken=a.data.token,Q.USER.access.enabled=!0,Q.USER.access.control=l(a.data.control,!1),Q.USER.access.admin=l(a.data.admin,!1),Q.USER.lang!==a.data.language&&(Q.LOCALIZATION_DEFERRED=!0),Q.USER.lang=a.data.language||Q.LANG_SYS_DEFAULT,$.cookies.test()&&($.cookies.set("r-token",'"'+Q.USER.authToken+'"'),$.cookies.set("r-name",Q.USER.name),$.cookies.set("r-level",w.getAuthStr()),$.cookies.set("r-lang",Q.USER.lang)),Q.auth.loginoutCleanup(h),e&&$(e).dialog().dialog("close")):
(h||(Q.USER.authToken="",w.setAuthFromStr("en0")),b("/api/auth login: Unexpected response: "+$.stringify(a)),n(Q.DIALOG_ERROR,k(a.retCode))):(h||(Q.USER.authToken="",w.setAuthFromStr("en0")),b("auth.userLogin:loginCallback: Login failure.\ntextStatus="+c+", jqXHR="+$.stringify(d)),n(Q.DIALOG_ERROR,g("loginout.error.authFail")))},null,"login",null,$.stringify(a));a=null}catch(v){b("error. auth.userLogin: "+v)}},dialogInitializeAdminUser:function(a){if(!$("#dialog-admin-init").is(":visible")){b("auth.dialogInitializeAdminUser...");
try{var h=q(),g=$("<div></div>");g.prop("id","dialog-admin-init");g.append(h.find("#adminInit"));g.append(h.find("#status-adminInit"));$("#container").append(g);var l=$("#dialog-admin-init");l.dialog({autoOpen:!0,closeOnEscape:!1,resizable:!1,width:600,modal:!0,buttons:[{id:"dlg-btn-initialAdmin-submit","data-localize":"diagAndTable.submit",click:function(){$("[id^=status-]").html("&nbsp;");var h=this,g=function(c,e,g){c?0===c.retCode?setTimeout(function(){Q.ADMIN=!0;w.userLogout();w.userLogin(Q.CACHE.opId,
Q.CACHE.opBuf.password);Q.CACHE.opId=null;Q.CACHE.opBuf=null;"function"===typeof a&&a();$(h).dialog("close");$.cookies.test()&&($.cookies.set("r-token",'"'+Q.USER.authToken+'"'),$.cookies.set("r-name",Q.USER.name),$.cookies.set("r-level",w.getAuthStr()),$.cookies.set("r-lang",Q.USER.lang));Q.ping.initUpdatePing()},6E3):n(Q.DIALOG_ERROR,k(c.retCode)):b("error. auth.dialogInitializeAdminUser: "+$.stringify(g))},m=!0,l=$("#userName").val(),q=$("#password1").val(),y=$("#password2").val(),B={path:"/api/auth",
cmd:"add",access:w.accessControlNormal(),data:{username:{value:l,error:c,reset:e,data:"userName"},password:{value:q,error:c,reset:function(){e(null,"password1");e(null,"password2")},data:"password1"}}};t(B)||(m=!1);q!==y&&(c(null,{key:"useroptions.error.verifyNomatch"},"password2"),m=!1);m&&(m=v(B),$.extend(m,{enabled:!0,control:!0,admin:!0,language:Q.LANG_SYS_DEFAULT}),Q.CACHE.opBuf=m,Q.CACHE.opId=l,w.userLogout(),s(B.path,!1,g,null,B.cmd,null,$.stringify(m)))}}]});l.dialog("widget").find(".ui-dialog-title").attr("data-localize",
"dialog.admin.title")}catch(E){b("error. auth.dialogInitializeAdminUser: "+E)}}}};return w}(Q.log,Q.getLocalStr,Q.dialogAlert,Q.util.sanitizeBool,Q.util.getRetCodeMsg,Q.JQO.getDialogAdminInit,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.validate.test,Q.apiCall,Q.localize,Q.gotoPage,Q.validate.getApiData);
Q.auth.loginoutCleanup=function(b){Q.log("auth.loginoutCleanup...");try{var g=$("#menu"),n=$("#status");b||(Q.ping.stopUpdatePing(),Q.overview.stopDevUpdatePing(),Q.alarms.stopAlarmUpdatePing(),Q.email.stopEmailTestPing(),Q.network.stopNetworkUpdatePing(),Q.usb.stopUsbUpdatePing());Q.GUEST_USER_ENABLED&&"guest"===Q.USER.name||""!==Q.USER.name?(g.show(),n.show(),b||Q.ping.initUpdatePing()):(g.hide(),n.hide(),$("#content-pane").empty());Q.localize(Q.USER.lang,!0);Q.auth.updateLoginout();b||$("div.ui-dialog").empty();
if(""===window.location.hash||Q.PAGE===Q.PAGES.BLANK)if(Q.GUEST_USER_ENABLED||""!==Q.USER.name)Q.PAGE=Q.PAGES.OVERVIEW,g.show();b||Q.gotoPage(Q.PAGE)}catch(l){Q.log("auth.loginoutCleanup: "+l)}};Q.cacheHelper=function(b){var g={formatEnergyString:function(g){try{var l="";if(g&&"string"===typeof g)if(-1!==g.search(/\./))if(4<g.indexOf("."))l=g.substr(0,g.indexOf("."));else if(5<g.length)l=g.substr(0,5),"."===l.charAt(4)&&(l=l.substr(0,4));else return g;else return g;return l}catch(k){b("error. cacheHelper.formatEnergyString: "+k)}},formatEnergyMeasurements:function(){try{var n,l,k,q,c;for(n in Q.CACHE.dev)if(Q.CACHE.dev.hasOwnProperty(n))for(l in Q.CACHE.dev[n])if(Q.CACHE.dev[n].hasOwnProperty(l))for(k in Q.CACHE.dev[n][l])if(Q.CACHE.dev[n][l].hasOwnProperty(k))for(q in Q.CACHE.dev[n][l][k])if(Q.CACHE.dev[n][l][k].hasOwnProperty(q)&&
"measurement"===q)for(c in Q.CACHE.dev[n][l][k][q])Q.CACHE.dev[n][l][k][q].hasOwnProperty(c)&&"energy"===Q.CACHE.dev[n][l][k][q][c].type&&(Q.CACHE.dev[n][l][k][q][c].value=g.formatEnergyString(Q.CACHE.dev[n][l][k][q][c].value))}catch(e){b("error. cacheHelper.formatEnergyMeasurements: "+e)}}};return g}(Q.log);
Q.cacheHelper.analog=function(b,g,n){var l={},k=function(b){var c={};l.isAnalogPath(b)&&(b=l.getObj(b));$.isPlainObject(b)&&(c=b);return c};l.getDigitalLabel=function(b,c){var e="",n,s;b=k(b);!(s=l.getMode(b))||"lowLabel"!==c&&"highLabel"!==c||(s.preset?(n=s[c],(n=g(n))&&"string"===typeof n&&(e=n)):(n=b[c])&&"string"===typeof n?e=n:(n=s[c])&&"string"===typeof n&&(e=n));return e};l.getLabel=function(b){var c="";if(b=k(b))b.label&&"string"===typeof b.label?c=b.label:b.name&&"string"===typeof b.name&&
(c=b.name);return c};l.getUnits=function(b){var c="",e;b=k(b);(e=l.getMode(b))&&"analog"===e.type&&(e.preset?(b=g(e.units))&&"string"===typeof b&&(c=b):"string"===typeof b.units?c=b.units:"string"===typeof e.units&&(c=e.units));return c};l.getValue=function(g,c){var e="",n=null,s;g=k(g);n=void 0!==c?c:g.value;s=(s=l.getMode(g))&&s.type;if("analog"===s){if("number"===typeof n||"string"===typeof n)e=n}else if("digital"===s){e=parseInt(n);if(isNaN(e))return b("cacheHelper.getValue:parseInt: NaN: "+n),
n;n=1===e?"highLabel":"lowLabel";e=l.getDigitalLabel(g,n)}else b("cacheHelper:getValue: unexpected value: "+n),e=n;return e};l.getMode=function(b){var c=null,e=null;b=(b=k(b))&&b.mode;"string"===typeof b&&(e=Q.CACHE.analogModes&&Q.CACHE.analogModes[b])&&"object"===typeof e&&(c=e);return c};l.getObj=function(b){return n("dev/"+b)};l.isAnalogPath=function(b){var c=!1;"string"===typeof b&&-1!==b.search("analog")&&(c=!0);return c};return l}(Q.log,Q.getLocalStr,Q.util.getCacheValueByPath);Q.admin=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u){var K={},D=function(){var b=g(""),a=n(""),c=n("");a.find("fieldset").append(l("info-description","configsys.adminInfo.description")).append(l("info-location","configsys.adminInfo.location")).append(l("info-contactName","configsys.adminInfo.adminName")).append(l("info-contactEmail","configsys.adminInfo.adminEmail")).append(l("info-contactPhone","configsys.adminInfo.adminPhone")).append(k("setAdminInfo","diagAndTable.save","adminInfo"));c.find("fieldset").append(l("info-sysLabel",
"xxx.sysLabel")).append(k("setSysInfo","diagAndTable.save","sysInfo"));b.find("blockquote").append(a).append(c);return b},N=function(){b("admin.initInfo");var a=e("conf/contact");a?($("#info-description").val(a.description),$("#info-location").val(a.location),$("#info-contactName").val(a.contactName),$("#info-contactEmail").val(a.contactEmail),$("#info-contactPhone").val(a.contactPhone)):b("admin.initInfo: no data")},y=function(){b("admin.initSysInfo");var a=e("conf/system");a?$("#info-sysLabel").val(a.label):
b("admin.initSysInfo: no data")},G=function(){b("admin.setInfo");var c=function(b,c,d){b?0===b.retCode?(Q.CACHE.sys.contact=Q.CACHE.opBuf,Q.CACHE.conf.contact=Q.CACHE.opBuf,$("[id^=status-]").html("&nbsp;"),$("#status-adminInfo").removeClass("status-error").addClass("status-success").html(t("success"))):b.retCode===Q.RETCODE.NOT_AUTHORIZED?s(Q.DIALOG_ERROR,t("err.notAuthorized")):s(Q.DIALOG_ERROR,a(b.retCode)):Q.log("jqXHR = "+$.stringify(d));Q.CACHE.opBuf=null},e={path:"/api/conf/contact",cmd:"set",
access:E(),data:{description:{value:$("#info-description").val(),error:h,reset:v,data:"info-description"},location:{value:$("#info-location").val(),error:h,reset:v,data:"info-location"},contactName:{value:$("#info-contactName").val(),error:h,reset:v,data:"info-contactName"},contactEmail:{value:$("#info-contactEmail").val(),error:h,reset:v,data:"info-contactEmail"},contactPhone:{value:$("#info-contactPhone").val(),error:h,reset:v,data:"info-contactPhone"}}},g=function(){if(!F(e.path,e.cmd,!0))u(g,
!0);else if(!e||w(e)){var b=d(e);Q.CACHE.opBuf=b;m(e.path,!0,c,null,e.cmd,null,$.stringify(b))}};g()},H=function(){b("admin.setSysInfo");var c=function(c,d,e){c?0===c.retCode?(c=Q.CACHE.opBuf.label,B("conf/system/label",c),B("sys/label",c),document.title=c,$("[id^=status-]").html("&nbsp;"),$("#status-sysInfo").removeClass("status-error").addClass("status-success").html(t("success"))):c.retCode===Q.RETCODE.NOT_AUTHORIZED?s(Q.DIALOG_ERROR,t("err.notAuthorized")):s(Q.DIALOG_ERROR,a(c.retCode)):b("jqXHR = "+
$.stringify(e));Q.CACHE.opBuf=null},e={path:"/api/conf/system",cmd:"set",access:E(),data:{label:{value:$("#info-sysLabel").val(),error:h,reset:v,data:"info-sysLabel"}}},g=function(){if(!F(e.path,e.cmd,!0))u(g,!0);else if(!e||w(e)){var b=d(e);Q.CACHE.opBuf=b;m(e.path,!0,c,null,e.cmd,null,$.stringify(b))}};g()};K.getPageAdmin=function(){b("admin.getPageAdmin...");try{var d=function(d,e,g){d&&0===d.retCode?(Q.CACHE.conf.contact=d.data?d.data:null,d=q(""),d.append(c("menu.admin")).append(D()),$("#loading").replaceWith(""),
$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),$("#content-pane").append(d),M(Q.USER.lang),N(),y(),$("#setAdminInfo").on("click",function(){$("[id^=status-]").html("&nbsp;");Q.log("submit adminInfo");G();$(this).blur()}),$("#setSysInfo").on("click",function(){$("[id^=status-]").html("&nbsp;");Q.log("submit sysInfo");H();$(this).blur()})):(b("/api/conf/contact get: textStatus="+e+", jqXHR="+$.stringify(g)),s(Q.DIALOG_ERROR,a(d.retCode)))};m("/api/conf/system",!0,function(c,
e,g){c&&0===c.retCode?(null===Q.CACHE.conf&&(Q.CACHE.conf={}),Q.CACHE.conf.system=c.data?c.data:null,m("/api/conf/contact",!0,d,null,"get",null,null)):(b("/api/conf/system get: textStatus="+e+", jqXHR="+$.stringify(g)),s(Q.DIALOG_ERROR,a(c.retCode)))},null,"get",null,null)}catch(e){b("error. admin.getPageAdmin: "+e)}};return K}(Q.log,Q.JQO.getSection,Q.JQO.getFormGroup,Q.JQO.getFormOptionText,Q.JQO.getFormSubmit,Q.JQO.getPageWrapper,Q.JQO.getSectionHeaderPlain,Q.util.getCacheValueByPath,Q.getLocalStr,
Q.dialogAlert,Q.util.getRetCodeMsg,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.validate.test,Q.validate.getApiData,Q.apiCall,Q.util.setCacheValueByPath,Q.localize,Q.auth.accessControlNormal,Q.auth.accessTest,Q.dialogLogin);Q.info=function(b,g,n,l,k,q,c,e,t,s,a,h){return{getPageInfo:function(){b("info.getPageInfo...");try{var v=function(d,h,v){if(d&&0===d.retCode){Q.CACHE.conf=d.data?d.data:null;d=Q.CACHE.sys||{};h="&mdash;";d.serialNumber&&"string"===typeof d.serialNumber&&"unset"!==d.serialNumber&&(h=d.serialNumber);v="&mdash;";d.modelNumber&&"string"===typeof d.modelNumber&&"unset"!==d.modelNumber&&(v=d.modelNumber);var w="&mdash;";d.partNumber&&"string"===typeof d.partNumber&&"unset"!==d.partNumber&&(w=d.partNumber);
var E="&mdash;";d.model&&"string"===typeof d.model&&"unset"!==d.model&&(E=d.model);var F="&mdash;";d.version&&"string"===typeof d.version&&"unset"!==d.version&&(F=d.version);var u="&mdash;";Q.CACHE.conf.system&&Q.CACHE.conf.system.hostname&&(u=Q.CACHE.conf.system.hostname);var K=(d=Q.CACHE.conf.network[g()])&&"string"===typeof d.macAddr?d.macAddr:"&mdash;";d=n("");var D=l(""),N=l("");D.find("fieldset").append(k("info.serialNumber",h,"")).append(k("info.modelNumber",v,"")).append(k("info.partNumber",
w,"")).append(k("info.deviceType",E,"")).append(k("info.version",F,"")).append(k("common.macAddress",K,"")).append(k("info.hostname",u,""));h=null;for(var y in Q.CACHE.dev)if(Q.CACHE.dev.hasOwnProperty(y)&&void 0!==Q.CACHE.dev[y].lifetimeEnergy){h=Q.CACHE.dev[y].lifetimeEnergy;try{h=parseInt(h)}catch(G){h=null}break}null!==h&&"number"===typeof h&&(y=h/1E3,D.find("fieldset").append(k("info.lifetimeEnergy",y.toFixed(3))));N.find("fieldset").append(k("info.manufacturer",null,"msgStatic.info.manufacturer",
"")).append(k("info.manufacturerSite",null,"msgStatic.info.manufacturerSite","httpHref")).append(k("info.supportSite",null,"msgStatic.info.supportSite","httpHref")).append(k("info.supportEmail",null,"msgStatic.info.supportEmail","mailtoHref"));Q.CACHE.msgStatic&&Q.CACHE.msgStatic.info&&Q.CACHE.msgStatic.info.supportTelephone&&"string"===typeof Q.CACHE.msgStatic.info.supportTelephone?N.find("fieldset").append(k("info.supportTelephone",null,"msgStatic.info.supportTelephone","")):N.find("fieldset").append(e("info.supportTelephone",
Q.CACHE.msgStatic.info.supportTelephone));d.find("blockquote").append(D).append(N);y=q("");y.append(c("menu.info")).append(d);$("#loading").replaceWith("");$(".section-header").replaceWith("");$(".section-body").replaceWith("");$("#content-pane").append(y);t(Q.USER.lang);$.each($("#content-pane .httpHref"),function(b,a){var c=a.innerHTML,d=$(a);$(d).html("").append($("<a>").html(c).attr({href:"http://"+c,target:"_new","class":"ext-link"}))});$.each($("#content-pane .mailtoHref"),function(b,a){var c=
a.innerHTML,d=$(a);$(d).html("").append($("<a>").html(c).attr({href:"mailto:"+c,"class":"ext-link"}))});$("#content-pane").find("label.formLabel").each(function(){var b=$(this).attr("data-localize");if(b){var a=b.split(".");2===a.length&&(b="info-"+a[1],$(this).siblings("label.formLabelVal").each(function(){$(this).prop("id",b)}))}})}else b("/api/conf get: textStatus="+h+", jqXHR="+$.stringify(v)),s(Q.DIALOG_ERROR,a(d.retCode))};h("/api/dev",!0,function(b,a,c){b&&(0===b.retCode&&b.data)&&(Q.CACHE.dev=
b.data,h("/api/conf",!0,v,null,"get",null,null))},null,"get",null,null)}catch(w){b("error. info.getPageInfo: "+w)}}}}(Q.log,Q.util.getOrderZeroInterfaceKey,Q.JQO.getSection,Q.JQO.getFormGroup,Q.JQO.getNameValue,Q.JQO.getPageWrapper,Q.JQO.getSectionHeaderPlain,Q.JQO.getNameFormattedValue,Q.localize,Q.dialogAlert,Q.util.getRetCodeMsg,Q.apiCall);Q.remoteAuth=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u,K,D,N,y,G,H){a={};var P=function(){var b=g(""),a=n("");a.find("fieldset").append(k("ldap-host","configsys.ldap.server")).append(k("ldap-port","configsys.ldap.port")).append(l("ldap-mode","configsys.ldap.mode",["openLdap","activeDirectory"],["configsys.ldap.modeOpenLdap","configsys.ldap.modeActiveDirectory"])).append(l("ldap-securityType","configsys.ldap.securityType",["none","ssl","startTls"],["configsys.ldap.securityNone","configsys.ldap.securitySsl",
"configsys.ldap.securityStartTls"])).append(k("ldap-bindDn","configsys.ldap.bindDn")).append(k("ldap-password","configsys.ldap.password")).append(k("ldap-baseDn","configsys.ldap.baseDn")).append(k("ldap-userFilter","configsys.ldap.userFilter")).append(k("ldap-userId","configsys.ldap.userId")).append(k("ldap-userIdNum","configsys.ldap.userIdNum")).append(k("ldap-groupFilter","configsys.ldap.groupFilter")).append(k("ldap-groupId","configsys.ldap.groupId")).append(k("ldap-groupMemberUid","configsys.ldap.groupMemberUid")).append(k("ldap-enabledGroup",
"configsys.ldap.enabledGroup")).append(k("ldap-controlGroup","configsys.ldap.controlGroup")).append(k("ldap-adminGroup","configsys.ldap.adminGroup")).append(q("setLDAP","diagAndTable.save","ldap"));b.find("blockquote").append(a);return b},O=function(){b("remoteAuth.setLDAP");var a=function(a,d,p){a?a.retCode===Q.RETCODE.SUCCESS?(Q.CACHE.opBuf&&Q.CACHE.opBuf.password&&delete Q.CACHE.opBuf.password,Q.CACHE.conf.remoteAuth.ldap=$.extend(Q.CACHE.conf.remoteAuth.ldap,Q.CACHE.opBuf),$("[id^=status-]").html("&nbsp;"),
$("#status-ldap").removeClass("status-error").addClass("status-success").html(c("success")),e("/api/conf/remoteAuth/ldap",!0,function(a,c,f){a?0===a.retCode&&a.data&&(a=a.data.passwordSet,"boolean"===typeof a?(Q.CACHE.conf.remoteAuth.ldap.passwordSet=a,K("ldap-password",a)):b("error. remoteAuth.setLDAP.inner_cb: bad passwordSet")):b("error. remoteAuth.setLDAP-innerCB: "+$.stringify(f))},null,"get",["passwordSet"],null)):a.retCode===Q.RETCODE.NOT_AUTHORIZED?t(Q.DIALOG_ERROR,c("err.notAuthorized")):
((d=s(a.retCode))||b("remoteAuth.setLDAP: "+a.retCode+": "+a.retMsg),t(Q.DIALOG_ERROR,d)):b("jqXHR = "+$.stringify(p));Q.CACHE.opBuf=null},g={path:"/api/conf/remoteAuth/ldap",cmd:"set",access:D(),data:{host:{value:$("#ldap-host").val(),error:h,reset:v,data:"ldap-host"},port:{value:w($("#ldap-port").val()),error:h,reset:v,data:"ldap-port"},mode:{value:$("#ldap-mode").val(),error:h,reset:v,data:"ldap-mode"},securityType:{value:$("#ldap-securityType").val(),error:h,reset:v,data:"ldap-securityType"},
bindDn:{value:$("#ldap-bindDn").val(),error:h,reset:v,data:"ldap-bindDn"},baseDn:{value:$("#ldap-baseDn").val(),error:h,reset:v,data:"ldap-baseDn"},userFilter:{value:$("#ldap-userFilter").val(),error:h,reset:v,data:"ldap-userFilter"},userId:{value:$("#ldap-userId").val(),error:h,reset:v,data:"ldap-userId"},userIdNum:{value:$("#ldap-userIdNum").val(),error:h,reset:v,data:"ldap-userIdNum"},groupFilter:{value:$("#ldap-groupFilter").val(),error:h,reset:v,data:"ldap-groupFilter"},groupId:{value:$("#ldap-groupId").val(),
error:h,reset:v,data:"ldap-groupId"},groupMemberUid:{value:$("#ldap-groupMemberUid").val(),error:h,reset:v,data:"ldap-groupMemberUid"},enabledGroup:{value:$("#ldap-enabledGroup").val(),error:h,reset:v,data:"ldap-enabledGroup"},controlGroup:{value:$("#ldap-controlGroup").val(),error:h,reset:v,data:"ldap-controlGroup"},adminGroup:{value:$("#ldap-adminGroup").val(),error:h,reset:v,data:"ldap-adminGroup"}}},k=N("ldap-password"),A={data:{password:{value:k,error:h,reset:v,data:"ldap-password"}}};"string"===
typeof k&&$.extend(!0,g,A);var L=function(){if(!G(g.path,g.cmd,!0))H(L,!0);else if(!g||d(g)){var b=m(g);Q.CACHE.opBuf=b;e(g.path,!0,a,null,g.cmd,null,$.stringify(b))}};L()},I=function(b,a){var c=!0;d({path:"/api/conf/remoteAuth/ldap",cmd:"set",data:{password:{value:b,error:a}}})||(c=!1);return c},J=function(){var b=g(""),a=n("");a.find("fieldset").append(k("tacacs-authenticationServer1","configsys.remoteAuth.authenticationPri")).append(k("tacacs-authenticationServer2","configsys.remoteAuth.authenticationAlt")).append(k("tacacs-accountingServer1",
"configsys.remoteAuth.accountingPri")).append(k("tacacs-accountingServer2","configsys.remoteAuth.accountingAlt")).append(k("tacacs-sharedSecret","configsys.remoteAuth.sharedSecret")).append(l("tacacs-service","configsys.remoteAuth.service",["ppp","raccess"],["PPP","raccess"],!0)).append(k("tacacs-adminAttribute","configsys.remoteAuth.adminAttr")).append(k("tacacs-controlAttribute","configsys.remoteAuth.controlAttr")).append(k("tacacs-enabledAttribute","configsys.remoteAuth.enabledAttr")).append(q("setTACACS",
"diagAndTable.save","tacacs"));b.find("blockquote").append(a);return b},x=function(a){b("remoteAuth.setTACACSorRadius: "+a);if("tacacs"!==a&&"radius"!=a)b("error. remoteAuth.setTACACSorRadius: invalid protocol - "+a);else{var g=function(f,d,p){f?0===f.retCode?(Q.CACHE.opBuf&&Q.CACHE.opBuf.password&&delete Q.CACHE.opBuf.password,Q.CACHE.conf.remoteAuth[a]=$.extend(Q.CACHE.conf.remoteAuth[a],Q.CACHE.opBuf),$("[id^=status-]").html("&nbsp;"),$("#status-"+a).removeClass("status-error").addClass("status-success").html(c("success")),
e("/api/conf/remoteAuth/"+a,!0,function(c,f,d){c?0===c.retCode&&c.data&&(c=c.data.sharedSecretSet,"boolean"===typeof c?(Q.CACHE.conf.remoteAuth[a].sharedSecretSet=c,K(a+"-sharedSecret",c)):b("error. remoteAuth.setTACACSorRadius.inner_cb: invalid sharedSecretSet value")):b("error. remoteAuth.setTACACSorRadius-innerCB: "+$.stringify(d))},null,"get",["sharedSecretSet"],null)):f.retCode===Q.RETCODE.NOT_AUTHORIZED?t(Q.DIALOG_ERROR,c("err.notAuthorized")):t(Q.DIALOG_ERROR,s(f.retCode)):b("jqXHR = "+$.stringify(p));
Q.CACHE.opBuf=null},k={path:"/api/conf/remoteAuth/"+a,cmd:"set",access:D(),data:{authenticationServer1:{value:$("#"+a+"-authenticationServer1").val(),error:h,reset:v,data:a+"-authenticationServer1"},authenticationServer2:{value:$("#"+a+"-authenticationServer2").val(),error:h,reset:v,data:a+"-authenticationServer2"}}};"tacacs"===a?(k.data.accountingServer1={value:$("#tacacs-accountingServer1").val(),error:h,reset:v,data:"tacacs-accountingServer1"},k.data.accountingServer2={value:$("#tacacs-accountingServer2").val(),
error:h,reset:v,data:"tacacs-accountingServer2"},k.data.service={value:$("#tacacs-service").val(),error:h,reset:v,data:"tacacs-service"},k.data.adminAttribute={value:$("#tacacs-adminAttribute").val(),error:h,reset:v,data:"tacacs-adminAttribute"},k.data.controlAttribute={value:$("#tacacs-controlAttribute").val(),error:h,reset:v,data:"tacacs-controlAttribute"},k.data.enabledAttribute={value:$("#tacacs-enabledAttribute").val(),error:h,reset:v,data:"tacacs-enabledAttribute"}):"radius"===a&&(k.data.groupAttribute=
{value:$("#radius-groupAttribute").val(),error:h,reset:v,data:"radius-groupAttribute"},k.data.adminGroup={value:$("#radius-adminGroup").val(),error:h,reset:v,data:"radius-adminGroup"},k.data.controlGroup={value:$("#radius-controlGroup").val(),error:h,reset:v,data:"radius-controlGroup"},k.data.enabledGroup={value:$("#radius-enabledGroup").val(),error:h,reset:v,data:"radius-enabledGroup"});var A=N(a+"-sharedSecret");"string"===typeof A&&$.extend(!0,k,{data:{sharedSecret:{value:A,error:h,reset:v,data:a+
"-sharedSecret"}}});var L=function(){if(!G(k.path,k.cmd,!0))H(L,!0);else if(!k||d(k)){var b=m(k);Q.CACHE.opBuf=b;e(k.path,!0,g,null,k.cmd,null,$.stringify(b))}};L()}},T=function(){var b=g(""),a=n("");a.find("fieldset").append(k("radius-authenticationServer1","configsys.remoteAuth.authenticationPri")).append(k("radius-authenticationServer2","configsys.remoteAuth.authenticationAlt")).append(k("radius-sharedSecret","configsys.remoteAuth.sharedSecret")).append(k("radius-groupAttribute","configsys.remoteAuth.groupAttribute")).append(k("radius-adminGroup",
"configsys.ldap.adminGroup")).append(k("radius-controlGroup","configsys.ldap.controlGroup")).append(k("radius-enabledGroup","configsys.ldap.enabledGroup")).append(q("setRadius","diagAndTable.save","radius"));b.find("blockquote").append(a);return b},U=function(){var b=g(""),a=n("");a.find("fieldset").append(l("remoteAuth-mode","status.cfg.mode",["none","ldap","tacacs","radius"],["diagAndTable.disabled","configsys.remoteAuth.ldap","configsys.remoteAuth.tacacs","configsys.remoteAuth.radius"])).append(q("setAuthMode",
"diagAndTable.save","authMode"));b.find("blockquote").append(a);return b},R=function(){b("remoteAuth.setMode...");var a=function(a,d,f){a?0===a.retCode?(Q.CACHE.conf.remoteAuth.mode=Q.CACHE.opBuf.mode,$("[id^=status-]").html("&nbsp;"),$("#status-authMode").removeClass("status-error").addClass("status-success").html(c("success"))):a.retCode===Q.RETCODE.NOT_AUTHORIZED?t(Q.DIALOG_ERROR,c("err.notAuthorized")):t(Q.DIALOG_ERROR,s(a.retCode)):b("jqXHR = "+$.stringify(f));Q.CACHE.opBuf=null},g={path:"/api/conf/remoteAuth",
cmd:"set",access:D(),data:{mode:{value:$("#remoteAuth-mode").val(),error:h,reset:v,data:"remoteAuth-mode"}}},k=function(){if(!G(g.path,g.cmd,!0))H(k,!0);else if(!g||d(g)){var b=m(g);Q.CACHE.opBuf=b;e(g.path,!0,a,null,g.cmd,null,$.stringify(b))}};k()},z=function(){$("#setAuthMode").on("click",function(){$("[id^=status-]").html("&nbsp;");R();$(this).blur()});$("#setLDAP").on("click",function(){$("[id^=status-]").html("&nbsp;");O();$(this).blur()});$("#setTACACS").on("click",function(){$("[id^=status-]").html("&nbsp;");
x("tacacs");$(this).blur()});$("#setRadius").on("click",function(){$("[id^=status-]").html("&nbsp;");x("radius");$(this).blur()});$("#ldap-password").on("focus",function(){$(this).blur();M(N("ldap-password"),function(b){y("ldap-password",b)},I)});$("#tacacs-sharedSecret").on("focus",function(){$(this).blur();M(N("tacacs-sharedSecret"),function(b){y("tacacs-sharedSecret",b)},I)});$("#radius-sharedSecret").on("focus",function(){$(this).blur();M(N("radius-sharedSecret"),function(b){y("radius-sharedSecret",
b)},I)})};a.getPageRemoteAuth=function(){b("remoteAuth.getPageRemoteAuth...");try{e("/api/conf/remoteAuth",!0,function(a,c,d){a&&0===a.retCode?(null===Q.CACHE.conf&&(Q.CACHE.conf={}),Q.CACHE.conf.remoteAuth=a.data?a.data:null,a=E(""),a.append(F("menu.remoteAuth")).append(U()).append(F("configsys.remoteAuth.ldap")).append(P()).append(F("configsys.remoteAuth.tacacs")).append(J()).append(F("configsys.remoteAuth.radius")).append(T()),$("#loading").replaceWith(""),$(".section-header").replaceWith(""),
$(".section-body").replaceWith(""),$("#content-pane").append(a),b("remoteAuth.initMode..."),(a=Q.CACHE.conf&&Q.CACHE.conf.remoteAuth&&Q.CACHE.conf.remoteAuth.mode?Q.CACHE.conf.remoteAuth.mode:null)?$("#remoteAuth-mode").val(a):b("remoteAuth.initMode: no data"),b("remoteAuth.initLDAP"),(a=Q.CACHE.conf&&Q.CACHE.conf.remoteAuth&&Q.CACHE.conf.remoteAuth.ldap?Q.CACHE.conf.remoteAuth.ldap:null)?($("#ldap-host").val(a.host),$("#ldap-port").val(a.port),$("#ldap-mode").val(a.mode),$("#ldap-securityType").val(a.securityType),
$("#ldap-bindDn").val(a.bindDn),K("ldap-password",a.passwordSet),$("#ldap-baseDn").val(a.baseDn),$("#ldap-userFilter").val(a.userFilter),$("#ldap-userId").val(a.userId),$("#ldap-userIdNum").val(a.userIdNum),$("#ldap-groupFilter").val(a.groupFilter),$("#ldap-groupId").val(a.groupId),$("#ldap-groupMemberUid").val(a.groupMemberUid),$("#ldap-enabledGroup").val(a.enabledGroup),$("#ldap-controlGroup").val(a.controlGroup),$("#ldap-adminGroup").val(a.adminGroup)):b("remoteAuth.initLDAP: no data"),b("remoteAuth.initTACACS..."),
(a=Q.CACHE.conf&&Q.CACHE.conf.remoteAuth&&Q.CACHE.conf.remoteAuth.tacacs?Q.CACHE.conf.remoteAuth.tacacs:null)?($("#tacacs-authenticationServer1").val(a.authenticationServer1),$("#tacacs-authenticationServer2").val(a.authenticationServer2),$("#tacacs-accountingServer1").val(a.accountingServer1),$("#tacacs-accountingServer2").val(a.accountingServer2),K("tacacs-sharedSecret",a.sharedSecretSet),$("#tacacs-service").val(a.service),$("#tacacs-adminAttribute").val(a.adminAttribute),$("#tacacs-controlAttribute").val(a.controlAttribute),
$("#tacacs-enabledAttribute").val(a.enabledAttribute)):b("remoteAuth.initTACACS: no data"),b("remoteAuth.initRadius..."),(a=Q.CACHE.conf&&Q.CACHE.conf.remoteAuth&&Q.CACHE.conf.remoteAuth.radius?Q.CACHE.conf.remoteAuth.radius:null)?($("#radius-authenticationServer1").val(a.authenticationServer1),$("#radius-authenticationServer2").val(a.authenticationServer2),K("radius-sharedSecret",a.sharedSecretSet),$("#radius-groupAttribute").val(a.groupAttribute),$("#radius-adminGroup").val(a.adminGroup),$("#radius-controlGroup").val(a.controlGroup),
$("#radius-enabledGroup").val(a.enabledGroup)):(K("radius-sharedSecret",!1),b("remoteAuth.initTACACS: no data")),u(Q.USER.lang),z()):(b("/api/conf/remoteAuth get: textStatus="+c+", jqXHR="+$.stringify(d)),t(Q.DIALOG_ERROR,s(a.retCode)))},null,"get",null,null)}catch(a){b("error. remoteAuth.getPageRemoteAuth: "+a)}};return a}(Q.log,Q.JQO.getSection,Q.JQO.getFormGroup,Q.JQO.getFormOptionList,Q.JQO.getFormOptionText,Q.JQO.getFormSubmit,Q.getLocalStr,Q.apiCall,Q.dialogAlert,Q.util.getRetCodeMsg,Q.util.strToBool,
Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.util.strToInt,Q.validate.test,Q.validate.getApiData,Q.util.fieldInputState,Q.JQO.passwordDialog,Q.JQO.getPageWrapper,Q.JQO.getSectionHeaderPlain,Q.localize,Q.auth.passwordInputInit,Q.auth.accessControlNormal,Q.auth.passwordInputGet,Q.auth.passwordInputSet,Q.auth.accessTest,Q.dialogLogin);Q.locale=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u){var K={},D=function(){var b=g(""),a=n(""),d=l("/api/conf/locale","set","units")||[],e=$.map(d,function(b){return"configsys.units."+b});a.find("fieldset").append(k("language-default","configsys.language.default",Q.CACHE.languages)).append(q("temperature-units","configsys.units.temperature",d,e)).append(c("setLocale","diagAndTable.save","locale"));b.find("blockquote").append(a);return b},N=function(){b("locale.initLocale");var a=Q.CACHE.conf&&
Q.CACHE.conf.locale?Q.CACHE.conf.locale:null;a?($("#language-default").val(a.defaultLang),$("#temperature-units").val(a.units)):b("locale.initLocale: no data")},y=function(){b("locale.setLocale");$("[id^=status-]").html("&nbsp;");var c=function(a,c,d){a?0===a.retCode?($("[id^=status-]").html("&nbsp;"),$("#status-locale").removeClass("status-error").addClass("status-success").html(e("success")),Q.UNITS=Q.CACHE.opBuf.units,Q.CACHE.sys.locale=Q.CACHE.opBuf,Q.CACHE.conf.locale=Q.CACHE.opBuf,Q.LANG_SYS_DEFAULT=
Q.CACHE.conf.locale.defaultLang,N()):a.retCode===Q.RETCODE.NOT_AUTHORIZED?t(Q.DIALOG_ERROR,e("err.notAuthorized")):t(Q.DIALOG_ERROR,s(a.retCode)):b("jqXHR = "+$.stringify(d));Q.CACHE.opBuf=null},g={path:"/api/conf/locale",cmd:"set",access:E(),data:{defaultLang:{value:$("#language-default").val(),error:a,reset:h,data:"language-default"},units:{value:$("#temperature-units").val(),error:a,reset:h,data:"temperature-units"}}},k=function(){if(!F(g.path,g.cmd,!0))u(k,!0);else if(!g||v(g)){var b=w(g);Q.CACHE.opBuf=
b;d(g.path,!0,c,null,g.cmd,null,$.stringify(b))}};k()};K.getPageLocale=function(){b("locale.getPageLocale...");try{d("/api/conf/locale",!0,function(a,c,d){a&&0===a.retCode?(null===Q.CACHE.conf&&(Q.CACHE.conf={}),Q.CACHE.conf.locale=a.data?a.data:null,a=m(""),a.append(B("menu.locale")).append(D()),$("#loading").replaceWith(""),$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),$("#content-pane").append(a),M(Q.USER.lang),N(),$("#setLocale").on("click",function(){$("[id^=status-]").html("&nbsp;");
b("submit locale");y();$(this).blur()})):(b("/api/conf/locale get: textStatus="+c+", jqXHR="+$.stringify(d)),t(Q.DIALOG_ERROR,s(a.retCode)))},null,"get",null,null)}catch(a){b("error. locale.getPageLocale: "+a)}};return K}(Q.log,Q.JQO.getSection,Q.JQO.getFormGroup,Q.validate.getEnumValues,Q.JQO.getFormOptionListLanguages,Q.JQO.getFormOptionList,Q.JQO.getFormSubmit,Q.getLocalStr,Q.dialogAlert,Q.util.getRetCodeMsg,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.validate.test,Q.validate.getApiData,
Q.apiCall,Q.JQO.getPageWrapper,Q.JQO.getSectionHeaderPlain,Q.localize,Q.auth.accessControlNormal,Q.auth.accessTest,Q.dialogLogin);Q.syslog=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u,K,D,N,y){var G={},H=function(){var b=l()?"common.ipAddress":"common.host",a=g(""),d=n(""),h=n("");if(Q.CACHE.capability&&Q.CACHE.capability.eventLog&&Q.CACHE.capability.eventLog.show&&Q.USER.authToken){var m=Q.CACHE.capability.eventLog.url;m&&(m+="?token="+Q.USER.authToken,d.find("fieldset").append(k("configsys.syslog.downloadEvents",m,"CSV")),a.find("blockquote").append(d))}h.find("fieldset").append(q("syslog-enabled","configsys.syslog.enabled",
["true","false"],["diagAndTable.enabled","diagAndTable.disabled"])).append(c("syslog-target",b)).append(c("syslog-port","common.port")).append(e("setSyslog","diagAndTable.save","syslog"));a.find("blockquote").append(h);return a},P=function(){Q.log("syslog.initSyslog");var a=Q.CACHE.conf&&Q.CACHE.conf.syslog?Q.CACHE.conf.syslog:null;a?($("#syslog-enabled").val(a.enabled?"true":"false").change(),$("#syslog-port").val(a.port),$("#syslog-target").val(a.target)):b("syslog.initSyslog: no data")},O=function(){b("syslog.setSyslog");
var c=function(c,d,e){if(c)if(0===c.retCode){if($("[id^=status-]").html("&nbsp;"),$("#status-syslog").removeClass("status-error").addClass("status-success").html(t("success")),c=Q.CACHE.opBuf)"boolean"!==typeof c.enabled||c.enabled?Q.CACHE.conf.syslog=c:Q.CACHE.conf.syslog.enabled=c.enabled}else c.retCode===Q.RETCODE.NOT_AUTHORIZED?s(Q.DIALOG_ERROR,t("err.notAuthorized")):s(Q.DIALOG_ERROR,a(c.retCode));else b("jqXHR = "+$.stringify(e));Q.CACHE.opBuf=null},e=h($("#syslog-enabled").val()),g={path:"/api/conf/syslog",
cmd:"set",access:D(),data:{enabled:{value:e,error:v,reset:w,data:"syslog-enabled"}}},k={data:{port:{value:d($("#syslog-port").val()),error:v,reset:w,data:"syslog-port"},target:{value:$("#syslog-target").val(),error:v,reset:w,data:"syslog-target"}}};e&&$.extend(!0,g,k);var l=function(){if(!N(g.path,g.cmd,!0))y(l,!0);else if(!g||m(g)){var b=B(g);Q.CACHE.opBuf=b;M(g.path,!0,c,null,g.cmd,null,$.stringify(b))}};l()};G.getPageSyslog=function(){b("syslog.getPageSyslog...");try{M("/api/conf/syslog",!0,function(c,
d,e){c&&0===c.retCode?(null===Q.CACHE.conf&&(Q.CACHE.conf={}),Q.CACHE.conf.syslog=c.data?c.data:null,c=E(""),c.append(F("menu.syslog")).append(H()),$("#loading").replaceWith(""),$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),$("#content-pane").append(c),u(Q.USER.lang),P(),$("#setSyslog").on("click",function(){$("[id^=status-]").html("&nbsp;");Q.log("submit syslog");O();$(this).blur()}),$("#syslog-enabled").on("change",function(){var b=$(this).val();K("syslog-port",b);K("syslog-target",
b)}).change()):(b("/api/conf/syslog get: textStatus="+d+", jqXHR="+$.stringify(e)),s(Q.DIALOG_ERROR,a(c.retCode)))},null,"get",null,null)}catch(c){Q.log("error. getPageSyslog: "+c)}};return G}(Q.log,Q.JQO.getSection,Q.JQO.getFormGroup,Q.util.ipOnly,Q.JQO.getFormOptionLink,Q.JQO.getFormOptionList,Q.JQO.getFormOptionText,Q.JQO.getFormSubmit,Q.getLocalStr,Q.dialogAlert,Q.util.getRetCodeMsg,Q.util.strToBool,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.util.strToInt,Q.validate.test,Q.validate.getApiData,
Q.apiCall,Q.JQO.getPageWrapper,Q.JQO.getSectionHeaderPlain,Q.localize,Q.util.fieldInputState,Q.auth.accessControlNormal,Q.auth.accessTest,Q.dialogLogin);Q.utilities=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u,K,D,N,y,G,H,P,O,I,J,x,T,U){var R={},z=function(){var b=t(""),f=c("");f.find("fieldset").append(v("aggregation-enabled","configsys.aggregation",["true","false"],["diagAndTable.enabled","diagAndTable.disabled"])).append(T("aggregation-username","configsys.aggregationUsername")).append(T("aggregation-password","configsys.aggregationPassword")).append(a("setOneviewEnabled","diagAndTable.submit","oneview"));b.find("blockquote").append(f);return b},
V=function(){var a=function(a,c,f){a?0===a.retCode?(Q.ONEVIEW_ENABLED=Q.CACHE.opBuf.enabled,P(),$("status-oneview").html("&nbsp;"),$("#status-oneview").removeClass("status-error").addClass("status-success").html(h("success")),A()):a.retCode===Q.RETCODE.NOT_AUTHORIZED?n(Q.DIALOG_ERROR,h("err.notAuthorized")):n(Q.DIALOG_ERROR,l(a.retCode)):b("jqXHR = "+$.stringify(f));Q.CACHE.opBuf=null},c={path:"/api/conf/oneview",cmd:"set",access:y(),data:{enabled:{value:D($("#aggregation-enabled").val()),error:w,
reset:d,data:"aggregation-enabled"},username:{value:$("#aggregation-username").val(),error:w,reset:d,data:"aggregation-username"}}},f=J("aggregation-password"),e={data:{password:{value:f,error:w,reset:d,data:"aggregation-password"}}};"string"===typeof f&&$.extend(!0,c,e);var g=function(){if(!H(c.path,c.cmd,!0))U(g,!0);else if(!c||m(c)){var b=B(c);Q.CACHE.opBuf=b;k(c.path,!0,a,null,c.cmd,null,$.stringify(b))}};g()},Y=function(b,a){var c=!0;m({path:"/api/conf/oneview",cmd:"set",data:{password:{value:b,
error:a}}})||(c=!1);return c},X=function(){$("#aggregation-password").on("focus",function(){$(this).blur();O(J("aggregation-password"),function(b){x("aggregation-password",b)},Y)});$("#setOneviewEnabled").on("click",function(){$("[id^=status-]").html("&nbsp;");var b=Q.CACHE.conf.oneview.passwordSet||!1;"true"!==$("#aggregation-enabled").val()||""!==$("#aggregation-username").val()&&(b||"string"===typeof J("aggregation-password"))?(V(),$(this).blur()):n(Q.DIALOG_ERROR,h("retCode.6006"))})},A=function(){k("/api/conf/oneview",
!0,function(a,c,f){a?0===a.retCode?(Q.CACHE.conf.oneview=a.data,Q.ONEVIEW_ENABLED=Q.CACHE.conf.oneview.enabled,$("#aggregation-enabled").val(""+Q.ONEVIEW_ENABLED),$("#aggregation-username").val(Q.CACHE.conf.oneview.username),I("aggregation-password",Q.CACHE.conf.oneview.passwordSet||!1)):n(Q.DIALOG_ERROR,l(a.retCode)):b("jqXHR = "+$.stringify(f))},null,"get",null,null)},L=function(){var b="transfer/backup?token="+(Q.USER&&Q.USER.authToken?Q.USER.authToken:""),a=c("");a.find("fieldset").append(K("configsys.backuprestore.download",
b,"BIN"));return a},f=function(){var b=Q.USER&&Q.USER.authToken?Q.USER.authToken:"",f=t(""),d=c(""),g=e("T-fileUploadForm");g.prop("id","restoreForm");g.prop("action","transfer/backup?token="+b);d.find("fieldset").append(s("backupfile","configsys.backuprestore.file","file")).append(a("setRestore","configsys.backuprestore.restore","restore"));g.append(d);f.find("blockquote").append(L()).append(g);return f},r=function(){$("#restoreForm").on("submit",function(a){var c=new FormData($(this)[0]);a.preventDefault();
$("#status-restore").removeClass("status-success").removeClass("status-error").html("&nbsp;");$.ajax({url:$(this).attr("action"),type:$(this).attr("method"),data:c,processData:!1,contentType:!1,success:function(a,c,f){b("utilities.restoreUploadSuccess...");try{c=null;if("string"===typeof a)try{c=$.parseJSON(a)}catch(d){b("error. utilities.restoreUploadSuccess::parseJSON: "+d)}else c=a;if(c&&0===c.retCode)$("#status-restore").removeClass("status-error").addClass("status-success").html(h("success"));
else if(c&&c.retCode){var e=h("retCode."+c.retCode);e||(e=h("error"));$("#status-restore").removeClass("status-success").addClass("status-error").html(e)}else $("#status-restore").removeClass("status-success").addClass("status-error").html(h("error"))}catch(g){b("error. utilities.restoreUploadSuccess: "+g)}$("#setRestore").removeAttr("disabled")},error:function(b,a,c){b=h("configsys.firmware.transferError")||"";$("#setRestore").removeAttr("disabled");b&&(b=a&&c?b.replace("$1",a+" - "+c):h("error"));
$("#status-restore").removeClass("status-success").addClass("status-error").html(b)}});return!1});$("#setRestore").on("click",function(){$("[id^=status-]").html("&nbsp;").removeClass("status-error");var a=$("#backupfile").val();if(""===a)b("no file selected"),$("#status-restore").removeClass("status-success").addClass("status-error").html(h("configsys.backuprestore.nofile"));else if($(this).blur(),a){var c=function(){H("/api/sys","reset",!0)?($("#setRestore").attr("disabled","disabled"),$("#restoreForm").prop("action",
"transfer/backup?token="+Q.USER.authToken).submit()):U(c,!0)};c()}})},p=function(){var b=t(""),f=c("");f.find("fieldset").append(v("reset-settings","configsys.default.restore",["defaults","partialDefaults"],["configsys.default.all","configsys.default.nonNet"])).append(a("setReset","diagAndTable.submit","reset"));b.find("blockquote").append(f);return b},W=function(){b("utilities.setRestoreDefaults");var a=function(a,c,f){a?0===a.retCode?($("[id^=status-]").html("&nbsp;"),$("#status-reset").removeClass("status-error").addClass("status-success").html(h("success")),
"partialDefaults"!==Q.CACHE.opBuf.target&&($.cookies.test()&&($.cookies.del("r-token",null),$.cookies.del("r-name",null),$.cookies.del("r-level",null),$.cookies.del("r-lang",null)),Q.USER.authToken="",Q.USER.name="",Q.USER.access={},Q.USER.lang=""),setInterval(function(){location.reload(!0)},6E3)):a.retCode===Q.RETCODE.NOT_AUTHORIZED?n(Q.DIALOG_ERROR,h("err.notAuthorized")):n(Q.DIALOG_ERROR,l(a.retCode)):b("jqXHR = "+$.stringify(f));Q.CACHE.opBuf=null},c={path:"/api/sys",cmd:"reset",access:y(),data:{target:{value:$("#reset-settings").val(),
error:w,reset:d,data:"reset-settings"}}},f=function(){if(!H(c.path,c.cmd,!0))U(f,!0);else if(!c||m(c)){var b=B(c);Q.CACHE.opBuf=b;k(c.path,!0,a,null,c.cmd,null,$.stringify(b))}};f()},S=function(){var b=t(""),f=c("");f.find("fieldset").append(a("setReboot","diagAndTable.action.reboot","reboot"));b.find("blockquote").append(f);return b},Z=function(){b("utilities.setReboot...");var a=function(a,c,f){a?0===a.retCode?($("[id^=status-]").html("&nbsp;"),$("#status-reboot").removeClass("status-error").addClass("status-success").html(h("success")),
Q.ping.stopUpdatePing(),setTimeout(function(){G();location.reload(!0)},8E3)):a.retCode===Q.RETCODE.NOT_AUTHORIZED?n(Q.DIALOG_ERROR,h("err.notAuthorized")):n(Q.DIALOG_ERROR,l(a.retCode)):b("jqXHR = "+$.stringify(f));Q.CACHE.opBuf=null},c={path:"/api/sys",cmd:"reboot",access:y(),data:{}},f=function(){if(!H(c.path,c.cmd,!0))U(f,!0);else if(!c||m(c)){var b=B(c);Q.CACHE.opBuf=b;k(c.path,!0,a,null,c.cmd,null,$.stringify(b))}};f()},aa=function(){var b=t(""),f=c("");f.find("fieldset").append(a("setRebootIOBoards",
"diagAndTable.action.rebootBoards","rebootIOBoards"));b.find("blockquote").append(f);return b},ja=function(){b("utilities.setRebootIOBoards...");var a=function(a,c,f){a?0===a.retCode?($("[id^=status-]").html("&nbsp;"),$("#status-rebootIOBoards").removeClass("status-error").addClass("status-success").html(h("success"))):a.retCode===Q.RETCODE.NOT_AUTHORIZED?n(Q.DIALOG_ERROR,h("err.notAuthorized")):n(Q.DIALOG_ERROR,l(a.retCode)):b("jqXHR = "+$.stringify(f));Q.CACHE.opBuf=null},c={path:"/api/sys",cmd:"reboot",
access:y(),data:{target:{value:"slaves",error:w,reset:d,data:"rebootIOBoards"}}},f=function(){if(!H(c.path,c.cmd,!0))U(f,!0);else if(!c||m(c)){var b=B(c);Q.CACHE.opBuf=b;k(c.path,!0,a,null,c.cmd,null,$.stringify(b))}};f()},da=null,ba=0,ca=60,ka=function(){var b=Q.USER&&Q.USER.authToken?Q.USER.authToken:"",f=t(""),d=c(""),g=e("T-fileUploadForm");g.prop("id","firmwareForm");g.prop("action","transfer/firmware?token="+b);M()||f.find("blockquote").append(E("fileNote","configsys.firmware.sslDisabled"));
d.find("fieldset").append(s("file","configsys.firmware.file","file")).append(a("setFirmware","diagAndTable.submit","firmware"));g.append(d);f.find("blockquote").append(g);b=!1;Q.CACHE.capability&&(Q.CACHE.capability.firmware&&Q.CACHE.capability.firmware.switchable&&!0===Q.CACHE.capability.firmware.switchable)&&(b=!0);b&&(b=c(""),b.find("fieldset").append(a("setFirmwareRevert","configsys.firmware.revert","firmwareRevert")),f.find("blockquote").append(b));return f},ga=function(){ba--;0>=ba&&(ba=0,clearInterval(da),
da=null,Q.ping.initUpdatePing());var b="",a=!1;n(Q.DIALOG_COMM_OK);0===ba&&null===da?(b=h("configsys.firmware.updateSuccess"),a=!0):b=(b=h("configsys.firmware.updating"))?b.replace("$1",ba):ba;$("#status-firmware").removeClass("status-error").addClass("status-success").html(b);a&&setTimeout(function(){location.reload(!0)},3E3)},ea=function(){$("#firmwareForm").submit(function(a){var c=new FormData($(this)[0]);a.preventDefault();$.ajax({url:$(this).attr("action"),type:$(this).attr("method"),data:c,
processData:!1,contentType:!1,success:function(a,c,f){try{b("utilities.firmwareUploadSuccess...");c=null;if("string"===typeof a)try{c=$.parseJSON(a)}catch(d){b("error. utilities.firmwareUploadSuccess::parseJSON: "+d)}else c=a;if(c&&0===c.retCode)$("#status-firmware").removeClass("status-error").addClass("status-success").html(h("configsys.firmware.transferComplete")),null===da&&(b("utilities.initFirmwareUpdateCountdown"),Q.ping.stopUpdatePing(),"quetzal"===F()&&(ca=180),ba=ca+1,da=setInterval(ga,
1E3),ga());else if(c&&c.retCode){var e=h("retCode."+c.retCode);e||(e=h("error"));$("#status-firmware").removeClass("status-success").addClass("status-error").html(e)}else $("#status-firmware").removeClass("status-success").addClass("status-error").html(h("error"))}catch(g){b("error. utilities.firmwareUploadSuccess: "+g)}},error:function(b,a,c){(b=h("configsys.firmware.transferError")||"")&&(b=a&&c?b.replace("$1",a+" - "+c):h("error"));$("#status-firmware").removeClass("status-success").addClass("status-error").html(b)}});
return!1});$("#setFirmware").on("click",function(){$("#status-firmware").html("&nbsp;").removeClass("status-error");if(M())if(""===$("#file").val())b("no file selected"),$("#status-firmware").removeClass("status-success").addClass("status-error").html(h("retCode.7000"));else if(null===da){var a=function(){if(H("/transfer/firmware","upload",!0)){var b="quetzal"===F();b&&Q.ping.stopUpdatePing();$("#setFirmware").blur();$("#firmwareForm").attr("action","transfer/firmware?token="+Q.USER.authToken).submit();
$("#status-firmware").addClass("status-success").html(h("loading"));b&&n(Q.DIALOG_COMM_OK)}else U(a,!0)};a()}});$("#setFirmwareRevert").on("click",function(){$("[id^=status-]").html("&nbsp;").removeClass("status-error");$(this).blur();var a=function(a,c,f){a?0===a.retCode?($("[id^=status-]").html("&nbsp;"),$("#status-firmwareRevert").removeClass("status-error").addClass("status-success").html(h("success")),Q.ping.stopUpdatePing(),setTimeout(function(){G();location.reload(!0)},8E3)):a.retCode===Q.RETCODE.NOT_AUTHORIZED?
n(Q.DIALOG_ERROR,h("err.notAuthorized")):n(Q.DIALOG_ERROR,l(a.retCode)):b("jqXHR = "+$.stringify(f));Q.CACHE.opBuf=null},c={path:"/api/sys",cmd:"switchFirmware",access:y(),data:{}},f=function(){if(!H(c.path,c.cmd,!0))U(f,!0);else if(!c||m(c)){var b=B(c);Q.CACHE.opBuf=b;k(c.path,!0,a,null,c.cmd,null,$.stringify(b))}};f()})},la=function(){var b="transfer/logs.enc?token="+(Q.USER&&Q.USER.authToken?Q.USER.authToken:""),a=c("");a.prop("id","factorySupportPackageDownload");a.find("fieldset").append(K("configsys.factorysupportpackage.download",
b,"ENC"));return a},ha=function(){var b=t(""),f=c("");f.find("fieldset").append(v("factoryAccessEnabled","configsys.factoryaccess.factoryaccess",["true","false"],["diagAndTable.enabled","diagAndTable.disabled"])).append(a("setFactoryAccess","diagAndTable.submit","factoryAccess"));b.find("blockquote").append(la()).append(f);return b},ia=function(){b("utilities.setFactoryEnabled");var a=function(a,c,f){a?0===a.retCode?(Q.CACHE.conf.system.factoryAccessEnabled=Q.CACHE.opBuf.factoryAccessEnabled,$("status-factoryaccess").html("&nbsp;"),
$("#status-factoryAccess").removeClass("status-error").addClass("status-success").html(h("success"))):a.retCode===Q.RETCODE.NOT_AUTHORIZED?n(Q.DIALOG_ERROR,h("err.notAuthorized")):n(Q.DIALOG_ERROR,l(a.retCode)):b("jqXHR = "+$.stringify(f));Q.CACHE.opBuf=null},c=D($("#factoryAccessEnabled").val()),f={path:"/api/conf/system",cmd:"set",access:y(),data:{factoryAccessEnabled:{value:c,error:w,reset:d,data:"factoryAccessEnabled"}}},e=function(){if(!H(f.path,f.cmd,!0))U(e,!0);else if(!f||m(f)){var b=B(f);
Q.CACHE.opBuf=b;k(f.path,!0,a,null,f.cmd,null,$.stringify(b))}};e()},pa=function(){$("#setFactoryAccess").on("click",function(){$("[id^=status-]").html("&nbsp;");ia();$(this).blur()})},C=function(){var b=N("");Q.ONEVIEW&&b.append(q("configsys.aggregation")).append(z());Q.CACHE.capability.backupRestore&&Q.CACHE.capability.backupRestore.show&&b.append(q("configsys.backuprestore.panelTitle")).append(f());b.append(q("menu.reset")).append(p()).append(q("diagAndTable.action.reboot")).append(S()).append("gmmb"===
Q.CACHE.sys.platform?q("diagAndTable.action.rebootBoards"):"").append("gmmb"===Q.CACHE.sys.platform?aa():"").append(q("menu.firmware")).append(ka());Q.CACHE.capability.factoryAccess&&Q.CACHE.capability.factoryAccess.show&&b.append(q("configsys.factoryaccess.factoryaccess")).append(ha());return b};R.getPageUtilities=function(){b("utilities.getPageUtilities...");try{k("/api/conf/system",!0,function(a,c,f){a&&0===a.retCode?(null===Q.CACHE.conf&&(Q.CACHE.conf={}),Q.CACHE.conf.system=a.data?a.data:null,
c=(a=Q.CACHE.capability)&&a.backupRestore&&a.backupRestore.show,f=a&&a.factoryAccess&&a.factoryAccess.show,a=null,$("#loading").replaceWith(""),$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),$("#content-pane").append(C()),g(Q.USER.lang),Q.ONEVIEW&&(X(),A()),c&&r(),$("#reset-settings").attr("style","width:auto"),$("#setReset").on("click",function(){$("[id^=status-]").html("&nbsp;");b("submit reset...");W();$(this).blur()}),$("#setReboot").on("click",function(){$("[id^=status-]").html("&nbsp;");
b("submit reboot...");Z();$(this).blur()}),$("#setRebootIOBoards").on("click",function(){$("[id^=status-]").html("&nbsp;");b("submit I/O board reboot...");ja();$(this).blur()}),M()||(u("file",!1),u("setFirmware",!1)),ea(),f&&(Q.CACHE.conf.system&&void 0!==Q.CACHE.conf.system.factoryAccessEnabled?$("#factoryAccessEnabled").val(""+Q.CACHE.conf.system.factoryAccessEnabled):b("utilities.initFactoryAccess: could not initialize factoryAccessEnabled"),pa())):(b("/api/conf/system get: textStatus="+c+", jqXHR="+
$.stringify(f)),n(Q.DIALOG_ERROR,l(a.retCode)))},null,"get",null,null)}catch(a){b("error. utilities.getPageUtilities: "+a)}};return R}(Q.log,Q.localize,Q.dialogAlert,Q.util.getRetCodeMsg,Q.apiCall,Q.JQO.getSectionHeaderPlain,Q.JQO.getFormGroup,Q.getTemplate,Q.JQO.getSection,Q.JQO.getFormOptionFile,Q.JQO.getFormSubmit,Q.getLocalStr,Q.JQO.getFormOptionList,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.validate.test,Q.validate.getApiData,Q.util.firmwareCanUpdate,Q.JQO.getFormHelpText,Q.util.getTimeStyle,
Q.util.fieldInputState,Q.JQO.getFormOptionLink,Q.util.strToBool,Q.JQO.getPageWrapper,Q.auth.accessControlNormal,Q.auth.userLogout,Q.auth.accessTest,Q.util.getMenu,Q.JQO.passwordDialog,Q.auth.passwordInputInit,Q.auth.passwordInputGet,Q.auth.passwordInputSet,Q.JQO.getFormOptionText,Q.dialogLogin);Q.alarms=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u,K,D,N,y,G,H,P,O,I,J,x,T,U,R,z,V,Y,X,A,L,f,r,p,W){var S={},Z=!1,aa=!1,ja=0,da=0,ba=0,ca=function(b){var a="";if(b){b=b.split("/");for(var c=Q.CACHE.dev,f=0;f<b.length&&c;f++)c=c[b[f]];c&&(f=b[1],"analog"===f||"relay"===f?3===b.length&&(a=g(c)):("entity"===f||"outlet"===f)&&5===b.length&&c.type&&(a=n(c.type,"name")))}return a},ka=function(b){var a={};b&&"object"===typeof b&&$.each(b,function(b,c){var f=c.path.substring(0,16);f in a||(a[f]=
{});a[f][b]=c});return a},ga=function(b){var a="";if(b){b=b.split("/");for(var c=Q.CACHE.dev,f=0;f<b.length&&!(0<=$.inArray(b[f],["measurement","analog","relay"]));f++)c[b[f]]&&(c=c[b[f]]);"analog"===b[f]?a=l("meas.name.analog"):"relay"===b[f]?a=l("status.cfg.relay"):c&&(a=g(c))}return a},ea=function(){var a=!1;Q.CACHE.capability&&(Q.CACHE.capability.time&&Q.CACHE.capability.time.show)&&(a=!0);b("alarms.showValidTime = "+a);return a},la=function(){var a=!1;Q.CACHE.capability&&(Q.CACHE.capability.alarms&&
Q.CACHE.capability.alarms.showLatching)&&(a=!0);b("alarms.showLatching = "+a);return a},ha=function(){var b=k("T-alarmTableHeader");Z||(b.find("th:nth-child(9)").removeClass("w115").prop("style","width:*"),b.find("th:nth-child(8)").replaceWith(""));return b.find("tr")},ia=function(b){var a="&mdash;";Q.CACHE.alarm.validTime&&Q.CACHE.alarm.validTime[b]&&(b=Q.CACHE.alarm.validTime[b])&&(a=Da(b.days)+","+b.start+"-"+b.stop);return a},pa=function(a,c){var f=$("<span></span>"),d=null,e=null;switch(a){case "tripped":e=
"alarms.tripped";"alarm"===c?d="ui-icon-alert":"warning"===c?d="ui-icon-notice":b("error. alarms.getTriggerIcon: bad severity - "+c);break;case "latched":e="alarms.triggerState.latched";d="ui-icon-locked";break;case "acked":e="alarms.triggerState.acked";d="ui-icon-check";break;case "clear":e="alarms.clear";d="ui-icon-radio-on";break;case "inactive":e="alarms.triggerState.inactive";d="ui-icon-cancel";break;default:b("error. alarms.getTriggerIcon: bad statusStr - "+a)}d&&(f.addClass("ui-icon statusspan "+
d),f.prop("title",l(e)));return f},C=function(b){var a=!1;!aa||"tripped"!==b&&"latched"!==b||(a=!0);return a},fa=function(a,f){var d=$("<tr></tr>");try{d.prop("id","trigger-"+a).addClass("light-row triggerEntry");d.append($("<td></td>").prop("id","triggerState-"+a).append(pa(f.state,f.severity)));d.append($("<td></td>").append($("<span></span>").prop("id","m-"+a).addClass("triggerIcon ui-icon ui-icon-wrench action ui-corner-all")).append($("<span></span>").prop("id","d-"+a).addClass("triggerIcon ui-icon ui-icon-trash action ui-corner-all")).append($("<span></span>").prop("id",
"k-"+a).prop("style",C(f.state)?"":"display:none;").addClass("triggerIcon ui-icon ui-icon-check action ui-corner-all")));d.append($("<td></td>").addClass("alignLeft").append("&nbsp;&nbsp;&nbsp;"+q(ga(f.path))));if("status"===f.type)d.append($("<td></td>").addClass("alignLeft").append("&mdash;")),d.append($("<td></td>").addClass("alignLeft").attr("data-localize","alarm"===f.severity?"alarms.alarm":"alarms.warning").append("&nbsp;")),d.append($("<td></td>").attr("data-localize","menu.status")),d.append($("<td></td>").append("&mdash;"));
else{d.append($("<td></td>").addClass("alignLeft").append(ca(f.path)));d.append($("<td></td>").addClass("alignLeft").attr("data-localize","alarm"===f.severity?"alarms.alarm":"alarms.warning").append("&nbsp;"));d.append($("<td></td>").attr("data-localize","high"===f.type?"alarms.high":"low"===f.type?"alarms.low":"").append("&nbsp;"));var g=f.threshold;c(f.path)&&(g=e(f.path,g));d.append($("<td></td>").append(g))}if(Z){var p=ia(f.validTime);d.append($("<td></td>").addClass("vtCell").append(p))}for(var r=
f.selectedActions.length,g="",p=0;p<f.selectedActions.length;p++){var h=ua(f.selectedActions[p]);h&&(""!==g&&(g+=", "),g+=h)}d.append($("<td></td>").addClass("pointer").prop("title",g).append("["+r+"]"));return d}catch(k){b("error. alarms.getAlarmRow: "+k)}},Aa=function(c){var f=t(),d=s(""),e=a("alarms");e.find("thead").append(ha());if(c&&c.trigger&&c.action){var g=ka(c.trigger);ja=0;$.each(g,function(b,a){$.each(a,function(b,a){e.find("tbody").append(fa(b,a,c.action));ja++})})}else b("error. alarms.getAlarmContents: no triggers");
d.find("blockquote").append(e);f.append(h("alarms.alarmsWarnings")).append(d);return f},Da=function(b){var a="";$.each("monday tuesday wednesday thursday friday saturday sunday".split(" "),function(c,f){a="-"===b.charAt(c)?a+"-":a+l("alarms."+f)});return a},ua=function(b){var a="";if(Q.CACHE.alarm&&Q.CACHE.alarm.action&&Q.CACHE.alarm.action[b]){var a=Q.CACHE.alarm.action[b].delay,c=Q.CACHE.alarm.action[b].repeat;b=Q.CACHE.alarm.action[b].target;var f="";Q.CACHE.alarm.target&&Q.CACHE.alarm.target[b]&&
(f=Q.CACHE.alarm.target[b].name||"--");a=f+","+a+","+c}return a},Ia=function(a){var c=v("alarm/trigger/"+a);if(c){var f=c.state,c=c.severity;if(f&&c){var d=pa(f,c);$("#triggerState-"+a).html(d);d=null;switch(f){case "tripped":case "latched":"alarm"===c?d="alarm":"warning"===c?d="warning":b("error. alarms.alarmRowStyleUpdate: bad severity - "+c);break;case "acked":d="strong";break;case "inactive":d="inactive";break;case "clear":d="";break;default:b("error. alarms.alarmRowStyleUpdate: bad state - "+
f)}null!==d&&$("#trigger-"+a).removeClass("alarm warning strong inactive").addClass(d);C(f)?$("#k-"+a).show():$("#k-"+a).hide()}}},Ma=function(){b("alarms.initAlarmTable...");var a=v("alarm/trigger");if(a)for(var c in a)a.hasOwnProperty(c)&&Ia(c)},xa=function(){Ma();Ba(Q.UPDATE_INTERVAL);$("#alarmAdd").attr("title",l("diagAndTable.add"));$("[id^=m-]").attr("title",l("diagAndTable.mod"));$("[id^=d-]").attr("title",l("diagAndTable.delete"));$("[id^=k-]").attr("title",l("diagAndTable.ack"));w("alarms");
w("alarmAdd-notify");w("alarmModify-notify");d(Ea().html(),{autoOpen:!1,resizable:!1,width:300,height:150,modal:!0,close:function(){m("d-"+Q.CACHE.alarmOpId,!1);Q.CACHE.alarmOpId=null},buttons:[{id:"dlg-btn-alarm-del-delete",text:l("diagAndTable.delete"),click:function(){$("[id^=status-]").html("&nbsp;");0<$("#d-"+Q.CACHE.alarmOpId).length&&(m("d-"+Q.CACHE.alarmOpId,!1),ma(Q.CACHE.alarmOpId,this));Q.CACHE.alarmOpId=null;$(this).dialog("close")}},{id:"dlg-btn-alarm-del-cancel",text:l("diagAndTable.cancel"),
click:function(){$(this).dialog("close")}}]});d(qa().html(),{autoOpen:!1,resizable:!1,width:550,modal:!0,close:function(){m("m-"+Q.CACHE.alarmOpId,!1);Q.CACHE.alarmOpId=null},buttons:[{id:"dlg-btn-alarm-mod-save",text:l("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");0<$("#m-"+Q.CACHE.alarmOpId).length&&Ja("alarmModify",Q.CACHE.alarmOpId,this)}},{id:"dlg-btn-alarm-mod-cancel",text:l("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]});d(sa().html(),{autoOpen:!1,
resizable:!1,width:550,modal:!0,close:function(){$("#alarmAdd").removeClass("action-selected").addClass("action")},buttons:[{id:"dlg-btn-alarm-add-save",text:l("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");0<$("#alarmAdd").length&&(m("alarmAdd",!1),Ja("alarmAdd",null,this))}},{id:"dlg-btn-alarm-add-cancel",text:l("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]});d(Ua().html(),{autoOpen:!1,resizable:!1,width:500,modal:!0,buttons:[{id:"dlg-btn-alarm-validTime-mod-save",
text:l("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");sb(this)}},{id:"dlg-btn-alarm-validTime-mod-cancel",text:l("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]});d(Na().html(),{autoOpen:!1,resizable:!1,width:300,height:150,modal:!0,buttons:[{id:"dlg-btn-alarm-validTime-del-delete",text:l("diagAndTable.delete"),click:function(){$("[id^=status-]").html("&nbsp;");ya(this)}},{id:"dlg-btn-alarm-validTime-del-cancel",text:l("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]});
d(Va().html(),{autoOpen:!1,resizable:!1,width:500,modal:!0,buttons:[{id:"dlg-btn-alarm-actions-mod-save",text:l("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");b("alarms.alarmsActionsEdit...");$("#status-editActions").removeClass("status-error").addClass("status-success").html("&nbsp;");var a=$(this).data("actionOp");"add"===a?hb(this):"mod"===a?Fa(this):b("error. alarms.alarmsActionsEdit: bad actionOp")}},{id:"dlg-btn-alarm-actions-mod-cancel",text:l("diagAndTable.cancel"),
click:function(){$(this).dialog("close")}}]});d(ib().html(),{autoOpen:!1,resizable:!1,width:300,height:150,modal:!0,buttons:[{id:"dlg-btn-alarm-actions-del-delete",text:l("diagAndTable.delete"),click:function(){$("[id^=status-]").html("&nbsp;");jb(this)}},{id:"dlg-btn-alarm-actions-del-cancel",text:l("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]});B(Q.USER.lang)},ra=function(){var b=$("#table#alarms");$("table#alarms").on("click","span.action",function(){kb(this)});b.on("validTimesUpdate.Q",
function(){if(Q.CACHE.alarm&&Q.CACHE.alarm.trigger)for(var b in Q.CACHE.alarm.trigger)if(Q.CACHE.alarm.trigger.hasOwnProperty(b)){var a=ia(Q.CACHE.alarm.trigger[b].validTime);$("tr#trigger-"+b+" td.vtCell").html(a)}});b.on("actionsUpdate.Q",function(){if(Q.CACHE.alarm&&Q.CACHE.alarm.trigger)for(var b in Q.CACHE.alarm.trigger)if(Q.CACHE.alarm.trigger.hasOwnProperty(b)){var a;a=Q.CACHE.alarm.trigger[b].selectedActions;var c=$("<td></td>").addClass("pointer").append("&mdash;");if(a){var f="",d=0,e=void 0;
for(e in a)if(a.hasOwnProperty(e)){var g=ua(a[e]);""!==g&&(""!==f&&(f+=", "),f+=g,d++)}c.prop("title",f);c.empty().append("["+d+"]")}a=c;c=$("tr#trigger-"+b+" td.pointer");c.length&&c.replaceWith(a)}})};S.getPageAlarms=function(){b("alarms.getPageAlarms...");Z=ea();aa=la();try{F(),u("/api/alarm",!0,function(a,c,f){a&&0===a.retCode?(Q.CACHE.alarm=a.data,$("#loading").replaceWith(""),$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),$("#content-pane").append(Aa(a.data)),xa(),ra(),
lb(),tb(),Wa()):(b("/api/alarm get: textStatus="+c+", jqXHR="+$.stringify(f)),M(Q.DIALOG_ERROR,E(a.retCode)))},null,"get",null,null)}catch(a){b("error. alarms.getPageAlarms: "+a)}};var Ca=null,va=null;S.stopAlarmUpdatePing=function(){try{Ca&&(clearInterval(Ca),Ca=null,va&&(va.abort(),va=null))}catch(a){b("error. stopAlarmUpdatePing: "+a)}};var Ga=function(a,c,f){try{if(Q.PAGE!==Q.PAGES.ALARMS)S.stopAlarmUpdatePing();else if(a&&0===a.retCode){var d=a.data;if(d)for(var e in d)if(d.hasOwnProperty(e)){var g=
d[e];g&&g.state&&(K("alarm/trigger/"+e+"/state",g.state),Ia(e))}}else a?b("error /api/alarm/trigger: retCode="+a.data.retCode+", retMsg="+a.data.retMsg):b("error /api/alarm/trigger: "+$.stringify(f))}catch(p){b("error alarms.updatePingCallback: "+p)}},Ba=function(a){a=a&&"number"===typeof a&&5<a?a:Q.UPDATE_INTERVAL;b("alarms.initAlarmUpdatePing: "+a+" seconds");try{S.stopAlarmUpdatePing(),Ca=setInterval(function(){Q.PAGE!==Q.PAGES.ALARMS?S.stopAlarmUpdatePing():va&&"resolved"!==va.state()?b("alarms.initAlarmUpdatePing: update overlap..."):
va=u("/api/alarm/trigger",!0,Ga,null,"get",["state"],null)},1E3*a)}catch(c){b("error. alarms.initAlarmUpdatePing: "+c)}},sa=function(){var b=D("/api/alarm/trigger","add","severity")||[],a=$.map(b,function(b){return"alarms."+b}),c=k("T-dialogTableSpacerRow").find("tr"),f=k("T-dialogTablePadRow").find("tr"),d=k("T-dialogTable"),e=$("<div></div>");d.prop("id","tbl-alarmAdd").addClass("form-table");d.find("tbody").append(f.clone()).append($("<tr></tr>").addClass("form-row").append($("<td></td>").addClass("formLabel").attr("data-localize",
"common.name").append("&nbsp;")).append($("<td></td>").addClass("formControl").append(N("alarmAdd-name")).append($("<span></span>").addClass("ui-icon ui-icon-none inputErr").prop("id","alarmAdd-name-icon")))).append($("<tr></tr>").addClass("form-row").append($("<td></td>").addClass("formLabel").attr("data-localize","alarms.meas").append("&nbsp;")).append($("<td></td>").addClass("formControl").append(y("alarmAdd-trigger")).append($("<span></span>").addClass("ui-icon ui-icon-none inputErr").prop("id",
"alarmAdd-trigger-icon")))).append(c.clone());d.find("tbody").append($("<tr></tr>").addClass("form-row").append($("<td></td>").prop("colspan",2).append($("<h6></h6>").prop("id","dialog-alarm-add-delayUnits").addClass("help-text ui-corner-all").attr("data-localize","delayUnits.help").prop("style","display:block;width:90%")))).append(G("alarmAdd-severity","alarms.severity",b,a,null,!0)).append($("<tr></tr>").addClass("form-row").append($("<td></td>").addClass("formLabel").attr("data-localize","alarms.type").append("&nbsp;")).append($("<td></td>").addClass("formControl").append(za("alarmAdd-type")).append($("<span></span>").addClass("ui-icon ui-icon-none inputErr").prop("id",
"alarmAdd-type-icon")))).append(H("alarmAdd-value","alarms.value")).append(H("alarmAdd-clearDelay","alarms.clearDelay")).append(H("alarmAdd-tripDelay","alarms.tripDelay"));aa&&d.find("tbody").append(P("alarmAdd-latching","alarms.latching"));d.find("tbody").append(c.clone());Z&&d.find("tbody").append($("<tr></tr>").addClass("form-row").append($("<td></td>").prop("colspan",2).append(Xa("alarmAdd")))).append(P("alarmAdd-invertValidTime","alarms.invertValidTime")).append(c.clone());d.find("tbody:first").append($("<tr></tr>").addClass("form-row").append($("<td></td>").prop("colspan",
2).append(Ya("alarmAdd")))).append(f.clone());e.prop("id","dialog-alarm-add").prop("title",l("diagAndTable.add")).append(d).append($("<div></div>").prop("id","status-alarmAdd").append("&nbsp;"));return $("<div></div>").append(e)},Ea=function(){var b=l("diagAndTable.youSure")+"<br>"+l("alarms.alarmDeleted"),a=$("<div></div>");a.append($("<div></div>").prop("id","dialog-alarm-delete").prop("title",l("diagAndTable.delete")).append($("<p></p>").append($("<span></span>").addClass("ui-icon ui-icon-alert").prop("style",
"float:left;margin:0 7px 20px 0;")).append($("<span></span>").prop("id","rusure").append(b))));return a},ma=function(a,c){b("alarms.alarmDelete...");var f=function(a,f,d){a?0===a.retCode?u("/api/alarm/trigger",!0,function(a,f,e){a?0===a.retCode?($(c).dialog("close"),Q.CACHE.alarm.trigger=a.data,S.getPageAlarms()):(b("alarms.alarmDelete error: "+f+", "+$.stringify(e)),M(Q.DIALOG_ERROR,E(a.retCode))):b("error. alarms.alarmDelete inner_cb: "+$.stringify(d))},null,"get",null,null):M(Q.DIALOG_ERROR,E(a.retCode)):
b("error. alarms.alarmDelete: "+$.stringify(d))},d=function(){r("/api/alarm/trigger/"+a,"delete",!0)?I("/api/alarm/trigger/"+a,f):W(d,!0)};d()},qa=function(){var b=D("/api/alarm/trigger/0","set","severity")||[],a=$.map(b,function(b){return"alarms."+b}),c=k("T-dialogTableSpacerRow").find("tr"),f=k("T-dialogTablePadRow").find("tr"),d=k("T-dialogTable"),e=$("<div></div>");d.prop("id","tbl-alarmModify").addClass("form-table");d.find("tbody").append(f.clone()).append($("<tr></tr>").addClass("form-row").append($("<td></td>").addClass("formLabel").attr("data-localize",
"common.name").append("&nbsp;")).append($("<td></td>").addClass("formControl").append(N("alarmModify-name")).append($("<span></span>").addClass("ui-icon ui-icon-none inputErr").prop("id","alarmModify-name-icon")))).append($("<tr></tr>").addClass("form-row").append($("<td></td>").addClass("formLabel").attr("data-localize","alarms.meas").append("&nbsp;")).append($("<td></td>").addClass("formControl").append(y("alarmModify-trigger")).append($("<span></span>").addClass("ui-icon ui-icon-none inputErr").prop("id",
"alarmModify-trigger-icon")))).append(c.clone());d.find("tbody").append($("<tr></tr>").addClass("form-row").append($("<td></td>").prop("colspan",2).append($("<h6></h6>").prop("id","dialog-alarm-modify-delayUnits").addClass("help-text ui-corner-all").attr("data-localize","delayUnits.help").prop("style","display:block;width:90%")))).append(G("alarmModify-severity","alarms.severity",b,a,null,!0)).append($("<tr></tr>").addClass("form-row").append($("<td></td>").addClass("formLabel").attr("data-localize",
"alarms.type").append("&nbsp;")).append($("<td></td>").addClass("formControl").append(za("alarmModify-type")).append($("<span></span>").addClass("ui-icon ui-icon-none inputErr").prop("id","alarmModify-type-icon")))).append(H("alarmModify-value","alarms.value")).append(H("alarmModify-clearDelay","alarms.clearDelay")).append(H("alarmModify-tripDelay","alarms.tripDelay"));aa&&d.find("tbody").append(P("alarmModify-latching","alarms.latching"));d.find("tbody").append(c.clone());Z&&d.find("tbody").append($("<tr></tr>").addClass("form-row").append($("<td></td>").prop("colspan",
2).append(Xa("alarmModify")))).append(P("alarmModify-invertValidTime","alarms.invertValidTime")).append(c.clone());d.find("tbody:first").append($("<tr></tr>").addClass("form-row").append($("<td></td>").prop("colspan",2).append(Ya("alarmModify")))).append(f.clone());e.prop("id","dialog-alarm-modify").prop("title",l("diagAndTable.mod")).append(d).append($("<div></div>").prop("id","status-alarmModify").append("&nbsp;"));return $("<div></div>").append(e)},oa=function(a){try{var c=Q.CACHE.alarm.trigger[a];
if(c){var f=c.path.search("measurement"),d="";a="";if(-1!==f)d=c.path.substr(0,f-1),a=c.path.substr(f);else if(-1===c.path.search("/"))d=c.path,a="";else{for(var e=c.path.split("/"),g=f="",p=0;p<e.length;p++)p!==e.length-1?f+=""===f?e[p]:"/"+e[p]:g=e[p];d=f;a=g}e=d;try{$("#alarmModify-name").val(e).trigger("change")}catch(r){b("error. alarms.alarmNameSetSelection: "+r)}try{$("#alarmModify-trigger").val(a).trigger("change")}catch(h){b("error. alarms.alarmTriggerSetSelection: "+h)}$("#alarmModify-name").attr("disabled",
"disabled");$("#alarmModify-trigger").attr("disabled","disabled");$("#alarmModify-type").val(c.type);$("#alarmModify-severity").val(c.severity);na.canSetSelValue("alarmModify")?na.setSelValue("alarmModify",c.threshold):$("#alarmModify-value").val(c.threshold);$("#alarmModify-clearDelay").val(c.clearDelay);$("#alarmModify-tripDelay").val(c.tripDelay);"true"===c.latching||!0===c.latching?$("#alarmModify-latching").prop("checked",!0):$("#alarmModify-latching").prop("checked",!1);if(Z){var k=c.validTime||
"always";$("#alarmModify-validTimeEnabled-"+k).prop("checked",!0).trigger("click");var C=c.invertValidTime;!1===C||"false"===C||"always"===k?$("#alarmModify-invertValidTime").prop("checked",!1):!0!==C&&"true"!==C||$("#alarmModify-invertValidTime").prop("checked",!0)}$("[id^=alarmModify-actionEnabled-]").prop("checked",!1);for(k=0;k<c.selectedActions.length;k++)$("#alarmModify-actionEnabled-"+c.selectedActions[k]).prop("checked",!0);O("dialog-alarm-modify")}}catch(A){b("error. alarms.initAlarmModifyDialog: "+
A)}},ta=function(b){var a=k("T-validTimeTableHeader").find("tr");a&&a.find("span").prop("id",b+"-validTimeAdd").prop("title",l("diagAndTable.add"));return a},wa=function(b,a,c){var f=null;if(b&&a){var d=a.days,e=a.start,g=a.stop;d&&(e&&g)&&(f=l("diagAndTable.mod")||"",a=l("diagAndTable.delete")||"",e=e+"-"+g,d=Da(d),f=$("<tr></tr>").addClass("light-row").append($("<td></td>").prop("style","position:relative;").append($("<span></span>").addClass("ui-icon ui-icon-none inputErr dialogPosAbs").prop("id",
c+"-validTimeEnabled-"+b+"-icon")).append($("<input>").prop("type","radio").prop("id",c+"-validTimeEnabled-"+b).prop("name",c+"-validTimes-radio").prop("value",b))).append($("<td></td>").append($("<span></span>").addClass("ui-icon ui-icon-wrench action triggerIcon ui-corner-all ").prop("id",c+"-validTimeMod-"+b).prop("title",f)).append($("<span></span>").addClass("ui-icon ui-icon-trash action triggerIcon ui-corner-all").prop("id",c+"-validTimeDel-"+b).prop("title",a))).append($("<td></td>").prop("id",
c+"-validTimeDays-"+b).addClass("alignLeft").append(d)).append($("<td></td>").prop("id",c+"-validTimeHours-"+b).addClass("alignLeft").append(e)))}return f},Za=function(b){var a=$("<tr></tr>");a.addClass("light-row").append($("<td></td>").prop("style","position:relative;").append($("<span></span>").addClass("ui-icon ui-icon-none inputErr dialogPosAbs").prop("id",b+"-validTimeEnabled-always-icon")).append($("<input>").prop("type","radio").prop("id",b+"-validTimeEnabled-always").prop("name",b+"-validTimes-radio").prop("checked",
"checked").prop("value","always"))).append($("<td></td>").append("&nbsp;")).append($("<td></td>").prop("colspan",2).addClass("alignLeft").append(l("alarms.alwaysValid")));return a},$a=function(b){var a=$("<tbody></tbody>"),c=v("alarm/validTime");a.append(Za(b));da=0;if(c)for(var f in c)c.hasOwnProperty(f)&&(a.append(wa(f,c[f],b)),da++);return a},Xa=function(b){var a=$("<table></table>"),c=$("<div></div>").prop("id",b+"=validTime-group").addClass("fm-table ui-corner-all nowsp");a.prop("id",b+"-validTime").addClass("form-table").append("<thead></thead>").append("<tbody></tbody>");
a.find("thead").append(ta(b));a.find("tbody").prop("id",b+"-validTime-body").append($a(b).find("tr"));c.append(a);return c},mb=function(b){var a=k("T-actionTableHeader").find("tr");a&&a.find("span").prop("id",b+"-actionAdd").prop("title",l("diagAndTable.add"));return a},Oa=function(b,a,c){var f="&nbsp;("+l("diagAndTable.disabled")+")",d=$("<tr></tr>");if(b&&a){var e="",g=a.target||"",p=a.delay||0;a=a.repeat||0;var r=l("diagAndTable.mod")||"",h=l("diagAndTable.delete")||"";Q.CACHE.alarm.target&&Q.CACHE.alarm.target[g]&&
(e=q(Q.CACHE.alarm.target[g].name)||"--",!1===Q.CACHE.alarm.target[g].enabled&&(e+=f));d.prop("id","action-"+b).addClass("light-row").append($("<td></td>").prop("style","position:relative;").append($("<span></span>").addClass("ui-icon ui-icon-none inputErr dialogPosAbs").prop("id",c+"-actionEnabled-"+b+"-icon")).append($("<input>").prop("type","checkbox").prop("id",c+"-actionEnabled-"+b))).append($("<td></td>").append($("<span></span>").addClass("ui-icon ui-icon-wrench action triggerIcon ui-corner-all ").prop("id",
c+"-actionMod-"+b).prop("title",r)).append($("<span></span>").addClass("ui-icon ui-icon-trash action triggerIcon ui-corner-all").prop("id",c+"-actionDel-"+b).prop("title",h))).append($("<td></td>").prop("id",c+"-actionTarget-"+b).addClass("alignLeft").append(e)).append($("<td></td>").prop("id",c+"-actionDelay-"+b).append(p)).append($("<td></td>").prop("id",c+"-actionRepeat-"+b).append(a))}return d},ab=function(b){var a=$("<tbody></tbody>");a.prop("id",b+"-notify-body");var c=v("alarm/action");ba=
0;if(c)for(var f in c)c.hasOwnProperty(f)&&(a.append(Oa(f,c[f],b)),ba++);return a},Ya=function(b){var a=$("<table></table>"),c=$("<div></div>").prop("id",b+"=notify-group").addClass("fm-table ui-corner-all");a.prop("id",b+"-notify").addClass("form-table").append("<thead></thead>").append("<tbody></tbody>");a.find("thead:first").append(mb(b));a.find("tbody").prop("id",b+"-notify-body").append(ab(b).find("tr"));c.append(a);return c},za=function(b){var a=$("<select></select>");a.prop("id",b);b=b.replace("type",
"trigger");""===$("#"+b).val()?a.append($("<option></option>").prop("value","status").append(l("menu.status"))):a.append($("<option></option>").prop("value","high").append(l("alarms.high"))).append($("<option></option>").prop("value","low").append(l("alarms.low")));return a},Pa=function(b){var a=$("#"+b+"-name").val();b=$("#"+b+"-trigger").val();return a+"/"+b},Ja=function(a,c,f){b("alarms.alarmAddModify...");var d=Pa(a),e=bb(a),g=$("#"+a+"-type").val(),p=$("[id^="+a+"-validTimeEnabled-]").filter(":checked").val(),
h=$("#"+a+"-invertValidTime").first().prop("checked"),k="",C="";"alarmAdd"===a?(k="/api/alarm/trigger",C="add"):"alarmModify"===a&&(k="/api/alarm/trigger/"+c,C="set");var A=function(a,c,d){a?0===a.retCode?u("/api/alarm/trigger",!0,function(a,c,d){a?0===a.retCode?(Q.CACHE.alarmOpId=null,$(f).dialog("close"),Q.CACHE.alarm.trigger=a.data,S.getPageAlarms()):M(Q.DIALOG_ERROR,E(a.retCode)):b("error. addModifyAlarm inner_cb: "+c+", "+$.stringify(a)+", "+$.stringify(d))},null,"get",null,null):M(Q.DIALOG_ERROR,
E(a.retCode)):b("error. addModifyAlarm: "+$.stringify(d))},L={path:k,cmd:C,data:{path:{value:d,error:function(b,a,c){J(null,a,c+"-name");J(null,a,c+"-trigger")},reset:function(b,a){x(null,a+"-name");x(null,a+"-trigger")},data:a},type:{value:g,error:J,reset:x,data:a+"-type"},severity:{value:$("#"+a+"-severity").val(),error:J,reset:x,data:a+"-severity"},clearDelay:{value:T($("#"+a+"-clearDelay").val()),error:J,reset:x,data:a+"-clearDelay"},tripDelay:{value:T($("#"+a+"-tripDelay").val()),error:J,reset:x,
data:a+"-tripDelay"},selectedActions:{value:e,error:function(b,a,c){$("[id^="+c+"-actionEnabled-]:checkbox").each(function(){J(null,a,this.id)})},reset:function(b,a){$("[id^="+a+"-actionEnabled-]:checkbox").each(function(){x(null,this.id)})},data:a}}};c={data:{threshold:{value:U($("#"+a+"-value").val()),error:J,reset:x,data:a+"-value"}}};"always"===p&&(p="",h=!1);p={data:{validTime:{value:p,error:function(b,a,c){$("[id^="+c+"-validTimeEnabled-]:radio").each(function(){J(null,a,this.id)})},reset:function(b,
a){$("[id^="+a+"-validTimeEnabled-]:radio").each(function(){x(null,this.id)})},data:a},invertValidTime:{value:h,error:J,reset:x,data:a+"-invertValidTime"}}};a={data:{latching:{value:$("#"+a+"-latching").first().prop("checked"),error:J,reset:x,data:a+"-latching"}}};"status"!==g&&$.extend(!0,L,c);Z&&$.extend(!0,L,p);aa&&$.extend(!0,L,a);var m=function(){if(!r(L.path,L.cmd,!0))W(m,!0);else if(!L||R(L)){var b=z(L);Q.CACHE.opBuf=b;u(L.path,!0,A,null,L.cmd,null,$.stringify(b))}};m()},kb=function(a){b("alarms.eventHandlerAlarmAddModDel...");
try{var c=$(a).attr("id"),f=c?c.charAt(0):"",d=c?c.substr(2):"";if(f&&d)switch(f){case "a":if(ja>=Q.MAX.ALARMS){var e=l("common.maxAllowed"),e=e.replace("$1",Q.MAX.ALARMS);M(Q.DIALOG_INFO,e);break}m(c,!0,!1);$("#dialog-alarm-add").dialog("open");$("#status-alarmAdd").html("&nbsp;");$("#alarmAdd-name").find("option:first").prop("selected",!0).trigger("change");$("#alarmAdd-severity").find("option:first").prop("selected",!0);$("#alarmAdd-type").find("option:first").prop("selected",!0);$("#alarmAdd-value").val("");
$("#alarmAdd-clearDelay").val("0");$("#alarmAdd-tripDelay").val("0");$("#alarmAdd-latching").prop("checked",!1);Z&&($("#alarmAdd-validTimeEnabled-always").prop("checked",!0).trigger("click"),$("#alarmAdd-invertValidTime").prop("checked",!1));$("[id^=alarmAdd-actionEnabled-]").prop("checked",!1);O("dialog-alarm-add");$("#tbl-alarmAdd").show();break;case "m":m(c,!0);Q.CACHE.alarmOpId=d;$("#dialog-alarm-modify").dialog("open");$("#status-alarmModify").html("&nbsp;");oa(d);$("#tbl-alarmMod").show();$("#dlg-btn-alarm-mod-cancel").focus();
break;case "d":m(c,!0);Q.CACHE.alarmOpId=d;$("#dialog-alarm-delete").dialog("open");break;case "k":m(c,!0);Q.CACHE.alarmOpId=d;Q.CACHE.alarm.trigger[d].acked=!0;var g=function(a,c,f){a?0===a.retCode?S.getPageAlarms():M(Q.DIALOG_ERROR,E(a.retCode)):b("error. alarmSetLatching inner_cb: "+$.stringify(f))},p=function(){m(c,!1)},h=function(){r("/api/alarm/trigger/"+d,"ack",!0)?u("/api/alarm/trigger/"+d,!0,g,null,"ack",null,null):W(h,!0,null,p)};h();break;default:b('error. alarms.eventHandlerAlarmAddModDel: invalid action "'+
f+'"')}}catch(k){b("error. alarms.eventHandlerAlarmAddModDel: "+k)}},bb=function(b){var a=[];$("[id^="+b+"-actionEnabled-]:checkbox").each(function(){if(this.checked){var b=this.id.split("-");3===b.length&&a.push(b[2])}});return a},cb=function(){b("events.eventHandlerAlarmActionsUpdate");var a=[];$(this).find(":checked").each(function(){var b=$(this).prop("id");a.push(b)});var c=this.id.split("-")[0],f=c+"-notify";$("#"+(c+"-notify-body")).replaceWith(ab(c));w(f);for(var d in a)a.hasOwnProperty(d)&&
$("#"+a[d]).prop("checked",!0)},Ka=function(){b("alarms.eventHandlerAlarmValidTimesUpdate");var a=$(this).find("input:checked").attr("id"),c=this.id.split("-")[0],f=c+"-validTime";$("#"+(c+"-validTime-body")).empty().append($a(c).find("tr"));w(f);$("#"+a).prop("checked",!0);$(this).find("input:checked").length||$("#"+c+"-validTimeEnabled-always").prop("checked",!0)},Qa=function(b){var a=b+"-type";na.canUpdateType(b)?na.updateType(b):($("#"+a).replaceWith(za(a)),$("#"+a).removeAttr("disabled"))},Ra=
function(b){var a,c;na.canUpdateValue(b)?na.updateValue(b):(a=$("#"+b+"-trigger").val(),c=b+"-value",b=!1,""===a&&(b=!0),$("#"+c).replaceWith(V("text",c,!1)),$("#"+c).prop("disabled",b).trigger("change"))},lb=function(){$("#alarmAdd-name").on("change",function(){Y("alarmAdd-trigger")});$("#alarmAdd-trigger").on("change",function(){Qa("alarmAdd");Ra("alarmAdd")});$("#dialog-alarm-add").on("change","select#alarmAdd-value",function(){na.updateTypeSelection("alarmAdd")});$("#alarmModify-name").on("change",
function(){Y("alarmModify-trigger")});$("#alarmModify-trigger").on("change",function(){Qa("alarmModify");Ra("alarmModify")});$("#dialog-alarm-modify").on("change","select#alarmModify-value",function(){na.updateTypeSelection("alarmModify")});$("#alarmAdd-notify").off("actionsUpdate.Q").on("actionsUpdate.Q",cb);$("#alarmModify-notify").off("actionsUpdate.Q").on("actionsUpdate.Q",cb);$("#alarmAdd-validTime").off("validTimesUpdate.Q").on("validTimesUpdate.Q",Ka);$("#alarmModify-validTime").off("validTimesUpdate.Q").on("validTimesUpdate.Q",
Ka);var a=$("#alarmAdd-validTime, #alarmModify-validTime");a.on("click","span.action",function(){$("[id^=status-]").html("&nbsp;");a:{var a=$(this).attr("id").match(/alarm(?:Add|Modify)-validTime(Add|Mod|Del)(?:-([0-9]+))?/);if(a){var c=a[1].toLowerCase(),a=a[2],f=$("#dialog-edit-validTimes");switch(c){case "add":if(da>=Q.MAX.ALARM_TIMES){c=l("common.maxAllowed");c=c.replace("$1",Q.MAX.ALARM_TIMES);M(Q.DIALOG_INFO,c);break a}db(c,a);f.data("validTimeOp",c).data("validTimeId",a).dialog("option","title",
l("diagAndTable.add")).dialog("open");O("dialog-edit-validTimes");break;case "mod":db(c,a);f.data("validTimeOp",c).data("validTimeId",a).dialog("option","title",l("diagAndTable.mod")).dialog("open");O("dialog-edit-validTimes");break;case "del":$("#dialog-delete-validTimes").data("validTimeId",a).dialog("open");break;default:b("error. alarms.eventHandlerValidTimeAddModDel: bad oper - "+c)}}else b("alarms.eventHandlerValidTimeAddModDel: bad id")}});a.on("click","input",function(){$("[id^=status-]").html("&nbsp;");
var a=$(this).val(),c=$(this).attr("id").match(/^alarm(Add|Modify)/);c?(c=c[0],"always"===a?$("#"+c+"-invertValidTime").val("false").attr("disabled","disabled"):$("#"+c+"-invertValidTime").removeAttr("disabled")):b("error. alarms.eventHandlerValidTimeRadioClick: bad id")});$("#alarmAdd-notify, #alarmModify-notify").on("click","span.action",function(){$("[id^=status-]").html("&nbsp;");a:{var a=$(this).attr("id").match(/alarm(?:Add|Modify)-action(Add|Mod|Del)(?:-([0-9]+))?/);if(a){var c=a[1].toLowerCase(),
a=a[2],f=$("#dialog-edit-actions"),d=$("#edit-actions-target"),e=$("#edit-actions-delay"),g=$("#edit-actions-repeat");switch(c){case "add":if(ba>=Q.MAX.ALARM_ACTIONS){c=l("common.maxAllowed");c=c.replace("$1",Q.MAX.ALARM_ACTIONS);M(Q.DIALOG_INFO,c);break a}d.find("optgroup").show();e.val("0");g.val("0");f.data("actionOp",c).data("actionId",a).dialog("option","title",l("diagAndTable.add")).dialog("open");break;case "mod":var p=v("alarm/action/"+a);p&&(d.val(p.target),d.find(":selected").parent().show().siblings().hide(),
e.val(p.delay),g.val(p.repeat),f.data("actionOp",c).data("actionId",a).dialog("option","title",l("diagAndTable.mod")).dialog("open"));break;case "del":$("#dialog-delete-actions").data("actionId",a).dialog("open");break;default:b("error. alerts.eventHandlerActionAddModDel: bad oper - "+c)}}else b("alerts.eventHandlerActionAddModDel: bad id")}})},ib=function(){var b=l("diagAndTable.youSure"),a=$("<div></div>");a.append($("<div></div>").prop("id","dialog-delete-actions").prop("title",l("diagAndTable.delete")).append($("<p></p>").append($("<span></span>").addClass("ui-icon ui-icon-alert").prop("style",
"float:left;margin:0 7px 20px 0;")).append($("<span></span>").prop("id","rusure").append(b))));return a},jb=function(a){var c=function(a,c,f){if(a){if(0===a.retCode){a={};for(var d in Q.CACHE.alarm.action)Q.CACHE.alarm.action.hasOwnProperty(d)&&d!==Q.CACHE.opId&&(a[d]=Q.CACHE.alarm.action[d]);Q.CACHE.alarm.action=a;Ha()}}else b("error. alarms.alarmsActionDelete: "+$.stringify(f));Q.CACHE.opId=null},f=$(a).data("actionId")||null;if(null!==f){var d={path:"/api/alarm/action/"+f,cmd:"delete",access:p()},
e=function(){if(!r(d.path,d.cmd,!0))W(e,!0);else if(!d||R(d))z(d),Q.CACHE.opId=f,u(d.path,!0,c,null,d.cmd,null,null)};e()}$(a).dialog("close")},pb=function(b){var a=nb(Q.CACHE.alarm&&Q.CACHE.alarm.target||{}),c="&nbsp;("+l("diagAndTable.disabled")+")",f=$("<select></select>").prop("id",b).addClass("ui-corner-all"),d=null;ob(a);$.each(a,function(b,a){var e=a.id,g=a.members;"email"===e?e=l("menu.email"):"trap"===e&&(e=l("configsys.snmp.traps"));d=$("<optgroup></optgroup>").prop("label",e);$.each(g,
function(b,a){var f=!1===a.enabled?a.name+c:a.name;d.append($("<option></option>").prop("value",a.value).append(f))});f.append(d)});return f},Va=function(){var b=k("T-dialogTablePadRow").find("tr"),a=k("T-dialogTable"),c=$("<div></div>");a.prop("id","actionsMod");a.find("tbody").append(b.clone()).append($("<tr></tr>").prop("id","r-targets").addClass("form-row").append($("<td></td>").addClass("formLabel").attr("data-localize","alarms.targets").append("&nbsp;")).append($("<td></td>").addClass("formControl").append(pb("edit-actions-target")).append($("<span></span>").addClass("ui-icon ui-icon-none inputErr").prop("id",
"edit-actions-target-icon")))).append(H("edit-actions-delay","alarms.delay")).append(H("edit-actions-repeat","alarms.repeat")).append(b.clone());c.prop("id","dialog-edit-actions").prop("title",l("diagAndTable.mod")).append(a).append($("<div></div>").prop("id","status-editActions").append("&nbsp;"));return $("<div></div>").append(c)},hb=function(a){b("alarms.alarmsActionsAdd...");var c=function(a,c,f){a?0===a.retCode&&u("/api/alarm/action",!0,function(a,c,f){a?0===a.retCode&&a.data&&(Q.CACHE.alarm.action=
a.data,Ha()):b("error. alarms.alarmsActionsAdd-innerCB: "+$.stringify(f))},null,"get",null,null):b("error. alarms.alarmsActionsAdd: "+$.stringify(f))},f=$(a).data("actionId"),d={path:"/api/alarm/action",cmd:"add",data:{target:{value:$("#edit-actions-target").val(),error:J,reset:x,data:"edit-actions-target"},delay:{value:T($("#edit-actions-delay").val()),error:J,reset:x,data:"edit-actions-delay"},repeat:{value:T($("#edit-actions-repeat").val()),error:J,reset:x,data:"edit-actions-repeat"}}},e=function(){if(!r(d.path,
d.cmd,!0))W(e,!0);else if(!d||R(d)){var b=z(d);Q.CACHE.opId=f;Q.CACHE.opBuf=b;u(d.path,!0,c,null,d.cmd,null,$.stringify(b));$(a).dialog("close")}};e()},Fa=function(a){var c=function(a,c,f){a?0===a.retCode&&(Q.CACHE.alarm.action[Q.CACHE.opId]=Q.CACHE.opBuf,Ha()):b("error. actionModify: "+$.stringify(f));Q.CACHE.opId=null;Q.CACHE.opBuf=null},f=$(a).data("actionId");if(f){var d={path:"/api/alarm/action/"+f,cmd:"set",data:{target:{value:$("#edit-actions-target").val(),error:J,reset:x,data:"edit-actions-target"},
delay:{value:T($("#edit-actions-delay").val()),error:J,reset:x,data:"edit-actions-delay"},repeat:{value:T($("#edit-actions-repeat").val()),error:J,reset:x,data:"edit-actions-repeat"}}},e=function(){if(!r(d.path,d.cmd,!0))W(e,!0);else if(!d||R(d)){var b=z(d);Q.CACHE.opId=f;Q.CACHE.opBuf=b;u(d.path,!0,c,null,d.cmd,null,$.stringify(b));$(a).dialog("close")}};e()}},qb=function(b,a){var c=null;$.each(a,function(a,f){if(b===f.id)return c=f,!1});null===c&&(c={id:b,members:[]},a.push(c));return c},nb=function(b){var a=
[],c,f;$.each(b,function(b,d){c=qb(d.group,a);f={name:d.name||"--",value:b,type:d.type,enabled:d.enabled};c.members.push(f)});return a},La=function(b,a){var c=$.inArray(b,a);0>c&&(c=a.length+1);return c},ob=function(b){var a=["email","trap","buzzer","outlet","relay"],c,f;$.each(b,function(b,d){d.members.sort(function(b,d){c=La(b.type,a);f=La(d.type,a);return c!==f?c-f:b.name>d.name?1:b.name<d.name?-1:0})});var d=["email","trap"];b.sort(function(b,a){b=La(b.id,d);a=La(a.id,d);return b-a})},Ha=function(){$("#alarmAdd-notify").trigger("actionsUpdate.Q");
$("#alarmModify-notify").trigger("actionsUpdate.Q");$("table#alarms").trigger("actionsUpdate.Q")},Wa=function(){$("#dialog-edit-actions").on("dialogopen",function(){$("#status-editActions").removeClass("status-error").addClass("status-success").html("&nbsp;");O("dialog-edit-actions")})},Na=function(){var b=l("diagAndTable.youSure"),a=$("<div></div>");a.append($("<div></div>").prop("id","dialog-delete-validTimes").prop("title",l("diagAndTable.delete")).append($("<p></p>").append($("<span></span>").addClass("ui-icon ui-icon-alert").prop("style",
"float:left;margin:0 7px 20px 0;")).append($("<span></span>").prop("id","rusure").append(b))));return a},ya=function(a){var c=function(a,c,f){if(a){if(0===a.retCode){a={};for(var d in Q.CACHE.alarm.validTime)Q.CACHE.alarm.validTime.hasOwnProperty(d)&&d!==Q.CACHE.opId&&(a[d]=Q.CACHE.alarm.validTime[d]);Q.CACHE.alarm.validTime=a;eb()}}else b("error. alarms.alarmsValidTimesDelete: "+$.stringify(f));Q.CACHE.opId=null},f=$(a).data("validTimeId")||null;if(null!==f){var d={path:"/api/alarm/validTime/"+f,
cmd:"delete",access:p()},e=function(){if(!r(d.path,d.cmd,!0))W(e,!0);else if(!d||R(d))Q.CACHE.opId=f,u(d.path,!0,c,null,d.cmd,null,null)};e()}$(a).dialog("close")},Ua=function(){var b,a=$("<tr></tr>").addClass("pad-row").append($("<td></td>")),c="00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24".split(" "),f=["00","15","30","45"],d=[l("alarms.monday"),l("alarms.tuesday"),l("alarms.wednesday"),l("alarms.thursday"),l("alarms.friday"),l("alarms.saturday"),l("alarms.sunday")],
e=$("<div></div>");e.prop("id","dialog-edit-validTimes").prop("title",l("diagAndTable.mod")).append($("<table></table>").addClass("form-table").append("<thead></thead>").append("<tbody></tbody>"));var g=$("<td></td>").addClass("formControl validTimeDay");$.each("mo tu we th fr sa su".split(" "),function(b,a){g.append($("<div></div>").append($("<input>").prop("type","checkbox").prop("id","day-"+a).prop("value",a)).append($("<span></span>").addClass("dayName").append(d[b])).append($("<span></span>").addClass("ui-icon ui-icon-none inputErr").prop("id",
"day-"+a+"-icon")))});e.find("tbody").append(a.clone()).append($("<tr></tr>").prop("id","r-days").addClass("form-row").append($("<td></td>").addClass("formLabel").attr("data-localize","alarms.days").append("&nbsp;")).append(g));var p=$("<select></select>").addClass("ui-corner-all");for(b=0;b<c.length;b++)p.append($("<option></option>").append(c[b]));c=$("<select></select>").addClass("ui-corner-all");for(b=0;b<f.length;b++)c.append($("<option></option>").append(f[b]));e.find("tbody").append($("<tr></tr>").prop("id",
"r-fromHour").addClass("form-row").append($("<td></td>").addClass("formLabel").attr("data-localize","alarms.fromHour").append("&nbsp;")).append($("<td></td>").addClass("formControl").append(p.clone().prop("id","edit-validTimes-fromHour")).append($("<span></span>").addClass("ui-icon ui-icon-none inputErr").prop("id","edit-validTimes-fromHour-icon")))).append($("<tr></tr>").prop("id","r-fromMinutes").addClass("form-row").append($("<td></td>").addClass("formLabel").attr("data-localize","alarms.fromMinutes").append("&nbsp;")).append($("<td></td>").addClass("formControl").append(c.clone().prop("id",
"edit-validTimes-fromMinutes")).append($("<span></span>").addClass("ui-icon ui-icon-none inputErr").prop("id","edit-validTimes-fromMinutes-icon"))));e.find("tbody").append($("<tr></tr>").prop("id","r-toHour").addClass("form-row").append($("<td></td>").addClass("formLabel").attr("data-localize","alarms.toHour").append("&nbsp;")).append($("<td></td>").addClass("formControl").append(p.clone().prop("id","edit-validTimes-toHour")).append($("<span></span>").addClass("ui-icon ui-icon-none inputErr").prop("id",
"edit-validTimes-toHour-icon")))).append($("<tr></tr>").prop("id","r-toMinutes").addClass("form-row").append($("<td></td>").addClass("formLabel").attr("data-localize","alarms.toMinutes").append("&nbsp;")).append($("<td></td>").addClass("formControl").append(c.clone().prop("id","edit-validTimes-toMinutes")).append($("<span></span>").addClass("ui-icon ui-icon-none inputErr").prop("id","edit-validTimes-toMinutes-icon")))).append(a.clone());e.append($("<div></div>").prop("id","status-editValidTimes").append("&nbsp;"));
return $("<div></div>").append(e)},db=function(b,a){if("add"===b){var c=$("#dialog-edit-validTimes");c.find("input").prop("checked",!1);c.find("select").val("00")}else if("mod"===b){var f=v("alarm/validTime/"+a);if(f){var d=f.stop,c=f.days,f=f.start.split(":");2===f.length&&($("#edit-validTimes-fromHour").val(f[0]),$("#edit-validTimes-fromMinutes").val(f[1]));f=d.split(":");2===f.length&&($("#edit-validTimes-toHour").val(f[0]),$("#edit-validTimes-toMinutes").val(f[1]));d="mo tu we th fr sa su".split(" ");
for(f=0;f<d.length;f++)"-"!==c.charAt(f)?$("#day-"+d[f]).prop("checked",!0):$("#day-"+d[f]).prop("checked",!1)}}},fb=function(b,a,c,f){var d=!0;b=parseInt(b,10);a=parseInt(a,10);c=parseInt(c,10);f=parseInt(f,10);if(b>c||b===c&&f<=a)d=!1;return d},rb=function(){var b="",a="MTWTFSS".split(""),c="mo tu we th fr sa su".split(" "),f;for(f in c)if(c.hasOwnProperty(f))var d=$("#day-"+c[f]).is(":checked"),b=b+(d?a[f]:"-");return b},sb=function(a){var c=function(a,c,f){a?0===a.retCode?u("/api/alarm/validTime",
!0,function(a,c,f){a?0===a.retCode&&a.data&&(Q.CACHE.alarm.validTime=a.data,eb()):b("error. alarms.alarmsvalidTimeSave:innerCB: "+$.stringify(f))},null,"get",null,null):M(Q.DIALOG_ERROR,E(a.retCode)):b("error. alarms.alarmsValidTimesSave: "+$.stringify(f))},f=function(a,c,f){a?0===a.retCode?(Q.CACHE.alarm.validTime[Q.CACHE.opId]=Q.CACHE.opBuf,eb()):M(Q.DIALOG_ERROR,E(a.retCode)):b("error. alarms.alarmsValidTimeSave: "+$.stringify(f));Q.CACHE.opId=null;Q.CACHE.opBuf=null},d=$(a).data("validTimeOp")||
"",e="",g="",p=null,h="";if("add"===d)e="/api/alarm/validTime",g="add",p=c;else if("mod"===d){h=$(a).data("validTimeId");if(!h)return;e="/api/alarm/validTime/"+h;g="set";p=f}else{b("error. alarms.alarmsValidTimesSave: bad op - "+d);return}var c=$("#edit-validTimes-fromHour").val()||"",f=$("#edit-validTimes-fromMinutes").val()||"",d=$("#edit-validTimes-toHour").val()||"",k=$("#edit-validTimes-toMinutes").val()||"",C={path:e,cmd:g,data:{days:{value:rb(),error:function(b,a){$("[id^=day-]:checkbox").each(function(){J(null,
a,this.id)})},reset:function(){$("[id^=day-]:checkbox").each(function(){x(null,this.id)})}},start:{value:c+":"+f,error:function(b,a){J(null,a,"edit-validTimes-fromHour");J(null,a,"edit-validTimes-fromMinutes")},reset:function(){x(null,"edit-validTimes-fromHour");x(null,"edit-validTimes-fromMinutes")}},stop:{value:d+":"+("24"===d?"00":k),error:function(b,a){J(null,a,"edit-validTimes-toHour");J(null,a,"edit-validTimes-toMinutes")},reset:function(){x(null,"edit-validTimes-toHour");x(null,"edit-validTimes-toMinutes")}}}};
"-------"===C.data.days.value&&(e=C.data.days.error,g={key:"alarms.invalidDays"},e&&"function"===typeof e&&e(null,g));fb(c,f,d,k)||(e={key:"alarms.invalidTimes"},J(null,e,"edit-validTimes-toHour"),J(null,e,"edit-validTimes-toMinutes"));var A=function(){if(!r(C.path,C.cmd,!0))W(A,!0);else if(!C||R(C)){var b=z(C);Q.CACHE.opId=h;Q.CACHE.opBuf=b;u(C.path,!0,p,null,C.cmd,null,$.stringify(b));$(a).dialog("close")}};A()},eb=function(){$("#alarmAdd-validTime").trigger("validTimesUpdate.Q");$("#alarmModify-validTime").trigger("validTimesUpdate.Q");
$("table#alarms").trigger("validTimesUpdate.Q")},tb=function(){$("#dialog-edit-validTimes").on("dialogopen",function(){$("#status-editValidTimes").removeClass("status-error").addClass("status-success").html("&nbsp;");O("dialog-edit-validTimes")})},na={getAnalogData:function(b){return X(Pa(b))},getType:function(b){b=na.getAnalogData(b);return(b=A(b))&&b.type||""},isAnalogInput:function(b){return c(Pa(b))},isDigital:function(b){return na.isAnalogInput(b)&&"digital"===na.getType(b)},updateTypeSelection:function(b){var a=
b+"-type";b=$("#"+(b+"-value")).val();"1"===b?$("#"+a).val("high"):"0"===b&&$("#"+a).val("low")},updateType:function(b){b+="-type";$("#"+b).replaceWith(za(b));$("#"+b).prop("disabled",!0)},canUpdateType:function(b){return na.isDigital(b)},updateValue:function(b){var a=b+"-value";b=na.getAnalogData(b);b=[L(b,"highLabel"),L(b,"lowLabel")];$("#"+a).replaceWith(f(a,[1,0],b,null,!1)).prop("disabled",!0).trigger("change")},canUpdateValue:function(b){return na.isDigital(b)},setSelValue:function(a,c){var f=
parseInt(c);isNaN(f)&&(b("error. analog.setSelValue: value is NaN"),f=0);f=""+f;$("#"+a+"-value").val(f).trigger("change")},canSetSelValue:function(b){return na.isDigital(b)}};return S}(Q.log,Q.util.getDeviceNameLabel,Q.util.getMeasAttrByType,Q.getLocalStr,Q.getTemplate,Q.util.escapeHtml,Q.cacheHelper.analog.isAnalogPath,Q.cacheHelper.analog.getValue,Q.JQO.getPageWrapper,Q.JQO.getSection,Q.JQO.getFormTable,Q.JQO.getSectionHeaderPlain,Q.util.getCacheValueByPath,Q.util.fixTableRows,Q.createDialog,Q.rowActionStyleUpdate,
Q.localize,Q.dialogAlert,Q.util.getRetCodeMsg,Q.cacheDeviceData,Q.apiCall,Q.util.setCacheValueByPath,Q.validate.getEnumValues,Q.JQO.getAlarmDeviceList,Q.JQO.getAlarmTriggerSelect,Q.JQO.getDialogOptionList,Q.JQO.getDialogOptionText,Q.JQO.getDialogOptionCheckbox,Q.util.fieldErrorTextResetAll,Q.apiCallDelete,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.util.strToInt,Q.util.strToFloat,Q.validate.test,Q.validate.getApiData,Q.JQO.getDialogInputField,Q.JQO.resetAlarmTriggerOptions,Q.cacheHelper.analog.getObj,
Q.cacheHelper.analog.getMode,Q.cacheHelper.analog.getDigitalLabel,Q.JQO.getDialogSelectField,Q.auth.accessTest,Q.auth.accessControlNormal,Q.dialogLogin);Q.email=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u,K,D,N,y,G,H,P,O,I,J,x,T,U,R,z){var V={},Y=0,X=!1,A=function(){X?$('span[id^="t-email-"]').removeClass("action-disabled").addClass("action-enabled"):$('span[id^="t-email-"]').removeClass("action-enabled").addClass("action-disabled")},L=function(){var b=g(),a=n(""),f=l("");f.find("fieldset").append(k("email-server","configsys.email.server")).append(k("email-port","common.port"));Q.CACHE.capability&&(Q.CACHE.capability.email&&Q.CACHE.capability.email.showSSLEnable)&&
f.find("fieldset").append(e("email-sslEnabled","configsys.email.sslEnable",["true","false"],["diagAndTable.enabled","diagAndTable.disabled"]));f.find("fieldset").append(k("email-sender","configsys.email.from")).append(k("email-username","common.username")).append(k("email-password","common.password")).append(q("setEmail","diagAndTable.save","email"));a.find("blockquote").append(c("emailHelp","configsys.email.note")).append(f).append(S());b.append(t("menu.email")).append(a);return b},f=function(){b("email.setEmail");
var c=function(c,f,d){c?0===c.retCode?(delete Q.CACHE.opBuf.password,Q.CACHE.conf.email=$.extend(Q.CACHE.conf.email,Q.CACHE.opBuf),X=Q.CACHE.conf.email.server&&Q.CACHE.conf.email.port,A(),$("[id^=status-]").html("&nbsp;"),$("#status-email").removeClass("status-error").addClass("status-success").html(s("success")),a("/api/conf/email",!0,function(a,c,f){a?0===a.retCode&&a.data&&(a=a.data.passwordSet,"boolean"===typeof a?(Q.CACHE.conf.email.passwordSet=a,J("email-password",a)):b("error. email.setEmail.inner_cb: bad passwordSet")):
b("error. email.setEmail-innerCB: "+$.stringify(f))},null,"get",["passwordSet"],null)):c.retCode===Q.RETCODE.NOT_AUTHORIZED?h(Q.DIALOG_ERROR,s("err.notAuthorized")):h(Q.DIALOG_ERROR,v(c.retCode)):b("jqXHR = "+$.stringify(d));Q.CACHE.opBuf=null},f={path:"/api/conf/email",cmd:"set",access:x(),data:{server:{value:$("#email-server").val(),error:w,reset:d,data:"email-server"},port:{value:B($("#email-port").val()),error:w,reset:d,data:"email-port"},sender:{value:$("#email-sender").val(),error:w,reset:d,
data:"email-sender"},username:{value:$("#email-username").val(),error:w,reset:d,data:"email-username"}}},e=T("email-password"),g={data:{password:{value:e,error:w,reset:d,data:"email-password"}}},p={data:{sslEnabled:{value:M($("#email-sslEnabled").val()),error:w,reset:d,data:"email-sslEnabled"}}};"string"===typeof e&&$.extend(!0,f,g);Q.CACHE.capability&&(Q.CACHE.capability.email&&Q.CACHE.capability.email.showSSLEnable)&&$.extend(!0,f,p);var r=function(){if(!R(f.path,f.cmd,!0))z(r,!0);else if(!f||E(f)){var b=
F(f);Q.CACHE.opBuf=b;a(f.path,!0,c,null,f.cmd,null,$.stringify(b))}};r()},r=function(b,a){var c=!0;E({path:"/api/conf/email",cmd:"set",data:{password:{value:b,error:a}}})||(c=!1);return c},p=function(){$("#setEmail").on("click",function(){$("[id^=status-]").html("&nbsp;");b("submit email");f();$(this).blur()});$("#email-password").on("focus",function(){$(this).blur();u(T("email-password"),function(b){U("email-password",b)},r)})};V.getPageEmail=function(){b("email.getPageEmail...");try{a("/api/conf/email",
!0,function(a,c,f){a&&0===a.retCode?(null===Q.CACHE.conf&&(Q.CACHE.conf={}),Q.CACHE.conf.email=a.data?a.data:null,X=a.data.server&&a.data.port,$("#loading").replaceWith(""),$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),$("#content-pane").append(L()),b("email.initEmail"),(a=Q.CACHE.conf&&Q.CACHE.conf.email?Q.CACHE.conf.email:null)?(X=a.server&&a.port,$("#email-server").val(a.server),$("#email-port").val(a.port),$("#email-sender").val(a.sender),$("#email-username").val(a.username),
J("email-password",a.passwordSet),a=a.sslEnabled?"true":"false",$("#email-sslEnabled").val(a)):b("email.initEmail: no data"),Z(),p()):(b("/api/conf/email get: textStatus="+c+", jqXHR="+$.stringify(f)),h(Q.DIALOG_ERROR,v(a.retCode)))},null,"get",null,null)}catch(c){b("error. email.getPageEmail: "+c)}};var W=function(a,c){if(!a||"string"!==typeof a||!c||"object"!==typeof c)return b("error. email.getTargetRow: invalid param(s)."),"";var f=K(c.name),d=$("<tr></tr>");d.prop("id","r-email-"+a).addClass("light-row").append($("<td></td>").append($("<span></span>").prop("id",
"m-email-"+a).addClass("ui-icon ui-icon-wrench action triggerIcon actionEmail ui-corner-all")).append($("<span></span>").prop("id","d-email-"+a).addClass("ui-icon ui-icon-trash action triggerIcon actionEmail ui-corner-all")).append($("<span></span>").prop("id","t-email-"+a).addClass("ui-icon ui-icon-mail-closed action actionEmail triggerIcon ui-corner-all"))).append($("<td></td>").addClass("alignLeft").append("&nbsp;")).append($("<td></td>").addClass("alignLeft").append(f?f:"&nbsp;")).append($("<td></td>").addClass("alignLeft").append("&nbsp;"));
return d},S=function(){var b=N("emailsTbl");if(b){b.find("thead").append(D("T-emailTargetTableHeader").find("tr"));var a=Q.CACHE.conf.email.target;if(a){Y=0;for(var c in a)a.hasOwnProperty(c)&&"new"!==c&&(b.find("tbody").append(W(c,a[c])),Y++)}}return b},Z=function(){b("email.initTargets");$("#a-newEmail").attr("title",s("diagAndTable.add"));$("[id^=m-email-]").attr("title",s("diagAndTable.mod"));$("[id^=d-email-]").attr("title",s("diagAndTable.delete"));$("[id^=t-email-]").attr("title",s("configsys.email.test"));
y("emailsTbl");ca();da();ga();Aa();$("#emailsTbl").on("click","span.actionEmail",function(){$("[id^=status-]").html("&nbsp;");la(this)});G(Q.USER.lang);A()},aa=function(){a("/api/conf/email/target",!1,function(a,c,f){a?0===a.retCode&&(Q.CACHE.conf.email.target=a.data,$("#emailsTbl-group").replaceWith(S()),G(Q.USER.lang),y("emailsTbl"),A(),$("#emailsTbl").on("click","span.actionEmail",function(){$("[id^=status-]").html("&nbsp;");la(this)}),$("#a-newEmail").attr("title",s("diagAndTable.add")),$("[id^=m-email-]").attr("title",
s("diagAndTable.mod")),$("[id^=d-email-]").attr("title",s("diagAndTable.delete")),$("[id^=t-email-]").attr("title",s("configsys.email.test"))):b("error. email.refreshTargetsTable: "+$.stringify(f))},null,"get",null,null)},ja=function(c){var f=function(a,f,d){a?0===a.retCode&&aa():b("error. email.targetAdd: "+$.stringify(d));H("a-newEmail",!1);$(c).dialog("close")},e={path:"/api/conf/email/target",cmd:"add",data:{name:{value:$("#emailAdd-address").val(),error:w,reset:d,data:"emailAdd-address"}}},g=
function(){if(!R(e.path,e.cmd,!0))z(g,!0);else if(!e||E(e)){var b=F(e);Q.CACHE.opBuf=b;a(e.path,!0,f,null,e.cmd,null,$.stringify(b))}};g()},da=function(){P(ea("Add").html(),{autoOpen:!1,resizable:!1,width:600,modal:!0,buttons:[{id:"dlg-btn-email-add-save",text:s("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");ja(this)}},{id:"dlg-btn-email-add-cancel",text:s("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]})},ba=function(a){var c=function(c,f,d){c?0===c.retCode&&
aa():b("error. email.targetDelete: "+$.stringify(d));H("d-email-"+Q.CACHE.opId,!1);Q.CACHE.opId=null;$(a).dialog("close")},f=function(){R("/api/conf/email/target/"+Q.CACHE.opId,"delete",!0)?O("/api/conf/email/target/"+Q.CACHE.opId,c):z(f,!0)};f()},ca=function(){var b=s("diagAndTable.youSure"),a=$("<div></div>");a.append($("<div></div>").prop("id","dialog-email-delete").prop("title",s("diagAndTable.delete")).append($("<p></p>").append($("<span></span>").addClass("ui-icon ui-icon-alert").prop("style",
"float:left;margin:0 7px 20px 0;")).append($("<span></span>").prop("id","rusure").append(b))));P(a.html(),{autoOpen:!1,resizable:!1,width:300,height:150,modal:!0,close:function(){H("d-email-"+Q.CACHE.opId,!1);Q.CACHE.opId=null},buttons:[{id:"dlg-btn-email-del-delete",text:s("diagAndTable.delete"),click:function(){$("[id^=status-]").html("&nbsp;");ba(this)}},{id:"dlg-btn-email-del-cancel",text:s("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]})},ka=function(c){var f=function(a,f,
d){a?0===a.retCode&&aa():b("error. email.targetModify: "+$.stringify(d));H("m-email-"+Q.CACHE.opId,!1);Q.CACHE.opId=null;$(c).dialog("close")},e={path:"/api/conf/email/target/"+Q.CACHE.opId,cmd:"set",data:{name:{value:$("#emailMod-address").val(),error:w,reset:d,data:"emailMod-address"}}},g=function(){if(!R(e.path,e.cmd,!0))z(g,!0);else if(!e||E(e)){var b=F(e);a(e.path,!0,f,null,e.cmd,null,$.stringify(b))}};g()},ga=function(){P(ea("Mod").html(),{autoOpen:!1,resizable:!1,width:600,modal:!0,close:function(){H("m-email-"+
Q.CACHE.opId,!1);Q.CACHE.opId=null},buttons:[{id:"dlg-btn-email-mod-save",text:s("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");ka(this)}},{id:"dlg-btn-email-mod-cancel",text:s("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]})},ea=function(a){if("Add"!==a&&"Mod"!==a)return b("error. email.getDialogTargetAddMod: invalid param "+a),"";var c=$("<tr></tr>").addClass("padrow").append($("<td></td>")),f=$("<div></div>"),d="Add"===a?s("diagAndTable.add"):s("diagAndTable.mod");
f.prop("id","Mod"===a?"dialog-email-modify":"dialog-email-add").prop("title",d).append($("<table></table>").prop("id","email"+a).addClass("form-table center").prop("cellspacing",1).prop("cellpadding",1).append($("<thead></thead>")).append($("<tbody></tbody>")));f.find("tbody").append(c.clone()).append(I("email"+a+"-address","configsys.email.to")).append(c.clone());f.append($("<div></div>").prop("id","status-"+a+"Email").append("&nbsp;"));return $("<div></div>").append(f)},la=function(a){try{var c=
$(a).attr("id"),f=c?c.charAt(0):"",d=c?c.replace(f+"-email-",""):"";if(f&&d)switch(f){case "a":if(Y>=Q.MAX.EMAIL_TARGETS){var e=s("common.maxAllowed"),e=e.replace("$1",Q.MAX.EMAIL_TARGETS);h(Q.DIALOG_INFO,e);break}H(c,!0,!1);$("#emailAdd-address").val("");m("dialog-email-add");$("#dialog-email-add").dialog("open");$("table#emailAdd").show();break;case "m":H(c,!0);Q.CACHE.opId=d;Q.CACHE.conf.email.target[d]?$("#emailMod-address").val(Q.CACHE.conf.email.target[d].name):$("#emailMod-address").val("");
m("dialog-email-modify");$("#dialog-email-modify").dialog("open");$("table#emailMod").show();break;case "d":H(c,!0);Q.CACHE.opId=d;$("#dialog-email-delete").dialog("open");break;case "t":H(c,!0);fa(d);H(c,!1);break;default:b('error. email.eventHandlerTargetAddModDel: invalid action "'+f+'"')}}catch(g){b("error. email.eventHandlerTargetAddModDel: "+g)}},ha=null,ia=null;V.stopEmailTestPing=function(){try{ha&&(clearInterval(ha),ha=null,ia&&(ia.abort(),ia=null))}catch(a){b("error. email.stopEmailTestPing: "+
a)}};var pa=function(a,c,f){b("email.testPingCallback...");try{var d="";!1===$("#dialog-email-test").dialog("isOpen")||Q.PAGE!==Q.PAGES.EMAIL?V.stopEmailTestPing():(a&&(0===a.retCode?(d=a&&a.data&&a.data.msg,b("email.testPingCallback: msg = "+d),"Email OK"===d&&(d=v(a.retCode),V.stopEmailTestPing())):(b("email.testPingCallback error: "+c+", "+$.stringify(a)+$.stringify(f)),d=v(a.retCode),V.stopEmailTestPing())),d=d.replace(/\\n/g,"<br>").replace(/>/g,"&gt;").replace(/</g,"&lt;"),$("#dialog-email-test").find("p").html(d))}catch(e){b("error. email.testPingCallback: "+
e)}},C=function(c,f){b("email.initEmailTestPing - interval: "+f+", statusId: "+c);try{V.stopEmailTestPing();var d=function(){!1===$("#dialog-email-test").dialog("isOpen")||Q.PAGE!==Q.PAGES.EMAIL?V.stopEmailTestPing():ia&&"resolved"!==ia.state()?b("sendEmailStatusPing: update overlap..."):ia=a("/api/conf/email/status/"+c,!0,pa,null,"get",null,null)};d();ha=setInterval(d,1E3*f)}catch(e){b("error. email.initEmailTestPing: "+e)}},fa=function(c){b("email.sendTestEmail");if(X){var f=function(a,c,f){a?0===
a.retCode?(c=$("#dialog-email-test"),c.find("p").html(s("configsys.email.testing")),c.dialog("open"),C(a.data.id,Q.UPDATE_INTERVAL)):a.retCode===Q.RETCODE.NOT_AUTHORIZED?h(Q.DIALOG_ERROR,s("err.notAuthorized")):h(Q.DIALOG_ERROR,v(a.retCode)):b("jqXHR = "+$.stringify(f))},d={path:"/api/conf/email/target/"+c,cmd:"sendTest",access:x()},e=function(){if(!R(d.path,d.cmd,!0))z(e,!0);else if(!d||E(d))Q.CACHE.opBuf={},a(d.path,!0,f,null,d.cmd,null,null)};e()}},Aa=function(){var b=$("<div></div>");b.append($("<div></div>").prop("id",
"dialog-email-test").prop("title",s("configsys.email.test")).append($("<br>")).append($("<p></p>").append($("<b></b>").append($("<i></i>")))));P(b.html(),{autoOpen:!1,resizable:!1,modal:!0,close:function(){V.stopEmailTestPing()},buttons:[{id:"dlg-btn-email-test-ok",text:s("diagAndTable.ok"),click:function(){$("[id^=status-]").html("&nbsp;");$(this).dialog("close")}}]})};return V}(Q.log,Q.JQO.getPageWrapper,Q.JQO.getSection,Q.JQO.getFormGroup,Q.JQO.getFormOptionText,Q.JQO.getFormSubmit,Q.JQO.getFormHelpText,
Q.JQO.getFormOptionList,Q.JQO.getSectionHeaderPlain,Q.getLocalStr,Q.apiCall,Q.dialogAlert,Q.util.getRetCodeMsg,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.util.fieldErrorTextResetAll,Q.util.strToInt,Q.util.strToBool,Q.validate.test,Q.validate.getApiData,Q.JQO.passwordDialog,Q.util.escapeHtml,Q.getTemplate,Q.JQO.getFormTable,Q.util.fixTableRows,Q.localize,Q.rowActionStyleUpdate,Q.createDialog,Q.apiCallDelete,Q.JQO.getDialogOptionText,Q.auth.passwordInputInit,Q.auth.accessControlNormal,Q.auth.passwordInputGet,
Q.auth.passwordInputSet,Q.auth.accessTest,Q.dialogLogin);Q.network=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u,K,D,N,y,G,H,P,O,I,J,x,T,U,R,z,V,Y,X,A,L,f,r,p){var W={},S=0,Z=function(){return Q.CACHE.capability&&Q.CACHE.capability.max&&1===Q.CACHE.capability.max.networkIps?!0:!1},aa=function(){return Q.CACHE.capability&&Q.CACHE.capability.max&&1===Q.CACHE.capability.max.networkRoutes?!0:!1},ja=function(){var b=g(),a=n(""),f=l(""),d=n(""),e=l(""),p=n(""),h=null,r=n(""),C=l(""),A=n(""),L=l("");d.find("blockquote").append(e.find("fieldset").append(k("hostname",
"info.hostname")).append(q("setHostname","diagAndTable.save","hostname")));b.append(c("info.hostname")).append(d);a.find("blockquote").append(f.find("fieldset").append(t("protocol-ipv6-enabled","configsys.network.ipv6",["true","false"],["diagAndTable.enabled","diagAndTable.disabled"])).append(q("setProtocol","diagAndTable.save","protocol")));b.append(c("configsys.network.protocol")).append(a);var a=$("<div></div>").prop("id","interfaceTables"),f=0,m;for(m in Q.CACHE.conf.network)Q.CACHE.conf.network.hasOwnProperty(m)&&
"port"!==Q.CACHE.conf.network[m].type&&(0<f&&a.append($("<br>")),h=l(""),h.find("fieldset").append(za(m,Q.CACHE.conf.network[m])).append(Ja(m,Q.CACHE.conf.network[m].address)),a.append(h),f++);p.find("blockquote").append(a);b.append(c("configsys.network.interfaces")).append(p);da()&&(p=n(""),h=l(""),p.find("blockquote").append(h.find("fieldset").append(ya())),b.append(c("configsys.network.ports")).append(p));r.find("blockquote").append(C.find("fieldset").append(qa()));b.append(c("configsys.network.routes")).append(r);
A.find("blockquote").append(L.find("fieldset").append(Da()));b.append(c("configsys.network.dns")).append(A);da()&&(r=n(""),C=l(""),r.find("blockquote").append(C.find("fieldset").append(t("rstp-enabled","configsys.ldap.enabled",["true","false"],["diagAndTable.enabled","diagAndTable.disabled"])).append(t("rstp-mode","status.cfg.mode",["rstp","stp"],["configsys.network.rstp","configsys.network.stp"])).append(t("rstp-bridgePriority","configsys.network.bridgePriority","0 4096 8192 12288 16384 20480 24576 28672 32768 36864 40960 45056 49152 53248 57344 61440".split(" "),
"0 4096 8192 12288 16384 20480 24576 28672 32768 36864 40960 45056 49152 53248 57344 61440".split(" "),!0)).append(k("rstp-maxHops","configsys.network.maxHops")).append(k("rstp-helloTime","configsys.network.helloTime")).append(k("rstp-maxAge","configsys.network.maxAge")).append(k("rstp-forwardDelay","configsys.network.forwardDelay")).append(q("setRstp","diagAndTable.save","rstp"))),b.append(c("configsys.network.rstp")).append(r));return b},da=function(){var b=!1;if(Q.CACHE.conf.network)for(var a in Q.CACHE.conf.network)if(Q.CACHE.conf.network.hasOwnProperty(a)&&
"bridge"===Q.CACHE.conf.network[a].type){b=!0;break}return b},ba=function(b){var a=b;b&&(Q.CACHE.conf.network&&Q.CACHE.conf.network[b])&&(a=Q.CACHE.conf.network[b].label);return a};W.getPageNetwork=function(){b("network.getPageNetwork...");try{$.when(F("/api/conf/system",!0,null,null,"get",null,null,!0),F("/api/conf/network",!0,null,null,"get",null,null,!0)).then(function(c,f){if(c&&"success"===c[1]&&f&&"success"===f[1]){null===Q.CACHE.conf&&(Q.CACHE.conf={});Q.CACHE.conf.system=c[0].data?c[0].data:
null;Q.CACHE.conf.network=f[0].data?f[0].data:null;$("#loading").replaceWith("");$(".section-header").replaceWith("");$(".section-body").replaceWith("");$("#content-pane").append(ja());b("network.initHostname");var d=Q.CACHE.conf&&Q.CACHE.conf.system?Q.CACHE.conf.system:null;d?(d=d.hostname||"",$("#hostname").val(d)):b("network.initHostname: no data");b("network.initProtocol");(d=Q.CACHE.conf&&Q.CACHE.conf.system?Q.CACHE.conf.system:null)?(d=d.ip6Enabled?"true":"false",$("#protocol-ipv6-enabled").val(d)):
b("network.initProcol: no data");$("#a-newDnsAddr").attr("title",h("diagAndTable.add"));$("[id^=m-dnsAddr-]").attr("title",h("diagAndTable.mod"));$("[id^=d-dnsAddr-]").attr("title",h("diagAndTable.delete"));G("dnsAddrTbl");ra();va();H(Q.USER.lang);b("network.initInterfaces...");$("[id^=m-interface-]").attr("title",h("diagAndTable.mod"));$("[id^=d-interface-]").attr("title",h("diagAndTable.delete"));for(var e in Q.CACHE.conf.network)Q.CACHE.conf.network.hasOwnProperty(e)&&"port"!==Q.CACHE.conf.network[e].type&&
G("interfaceIPTbl-"+e);ob();H(Q.USER.lang);H(Q.USER.lang);b("network.initRoutes...");$("#a-newRoute").attr("title",h("diagAndTable.add"));$("[id^=m-route-]").attr("title",h("diagAndTable.mod"));$("[id^=d-route-]").attr("title",h("diagAndTable.delete"));G("routesTbl");aa()||(ab(),$a());mb();H(Q.USER.lang);b("network.initRSTP...");e=null;Q.CACHE.conf.network&&(Q.CACHE.conf.network.ethernet&&Q.CACHE.conf.network.ethernet.stp)&&(e=Q.CACHE.conf.network.ethernet.stp);e&&($("#rstp-enabled").val(e.enabled?
"true":"false"),$("#rstp-mode").val(e.mode),$("#rstp-bridgePriority").val(e.bridgePriority),$("#rstp-maxHops").val(e.maxHops),$("#rstp-helloTime").val(e.helloTime),$("#rstp-maxAge").val(e.maxAge),$("#rstp-forwardDelay").val(e.forwardDelay));Z()&&aa()&&(a("rstp-mode",!1),a("rstp-bridgePriority",!1),a("rstp-maxHops",!1),a("rstp-helloTime",!1),a("rstp-maxAge",!1),a("rstp-forwardDelay",!1));pa();fa();Ia();kb();Ua();ta();ka();ha()}else b("error. network.getPageNetwork: get on network failed"),v(Q.DIALOG_ERROR,
"/api/conf/system: "+w(c[0].retCode)+"<br>/api/conf/network: "+w(f[0].retCode))})}catch(c){b("error. network.getPageNetwork: "+c)}};var ca=function(){b("network.setRstp...");var a=function(a,c,f){if(a)if(0===a.retCode){a=Q.CACHE.opBuf;c=Q.CACHE.opId;if(a&&(c&&Q.CACHE.conf&&Q.CACHE.conf.network)&&(c=Q.CACHE.conf.network[c]))for(var d in a)a.hasOwnProperty(d)&&c.stp[d]&&(c.stp[d]=a[d]);$("[id^=status-]").html("&nbsp;");$("#status-rstp").removeClass("status-error").addClass("status-success").html(h("success"))}else a.retCode===
Q.RETCODE.NOT_AUTHORIZED?v(Q.DIALOG_ERROR,h("err.notAuthorized")):v(Q.DIALOG_ERROR,w(a.retCode));else v(Q.DIALOG_ERROR,h("err.setFailed")),b("jqXHR = "+$.stringify(f));Q.CACHE.opId=null;Q.CACHE.opBuf=null},c=u(),f={path:"/api/conf/network/"+c+"/stp",cmd:"set",access:X()};Z()&&aa()?f.data={enabled:{value:s($("#rstp-enabled").val()),error:d,reset:m,data:"rstp-enabled"}}:f.data={enabled:{value:s($("#rstp-enabled").val()),error:d,reset:m,data:"rstp-enabled"},bridgePriority:{value:K($("#rstp-bridgePriority").val()),
error:d,reset:m,data:"rstp-bridgePriority"},mode:{value:$("#rstp-mode").val(),error:d,reset:m,data:"rstp-mode"},maxHops:{value:K($("#rstp-maxHops").val()),error:d,reset:m,data:"rstp-maxHops"},helloTime:{value:K($("#rstp-helloTime").val()),error:d,reset:m,data:"rstp-helloTime"},maxAge:{value:K($("#rstp-maxAge").val()),error:d,reset:m,data:"rstp-maxAge"},forwardDelay:{value:K($("#rstp-forwardDelay").val()),error:d,reset:m,data:"rstp-forwardDelay"}};var e=function(){if(!A(f.path,f.cmd,!0))p(e,!0);else if(!f||
M(f)){var b=E(f);Q.CACHE.opBuf=b;Q.CACHE.opId=c;F(f.path,!0,a,null,f.cmd,null,$.stringify(b))}};e()},ka=function(){$("#rstp-enabled").on("change",function(){if(!Z()&&!aa()){var b="true"===$(this).val();a("rstp-mode",b);a("rstp-bridgePriority",b);a("rstp-maxHops",b);a("rstp-helloTime",b);a("rstp-maxAge",b);a("rstp-forwardDelay",b);b&&$("#rstp-mode").trigger("change")}});$("#rstp-mode").on("change",function(){var b=$(this).val();a("rstp-maxHops","rstp"===b)});$("#rstp-enabled").trigger("change");$("#setRstp").on("click",
function(){b("submit rstp");$("[id^=status-]").html("&nbsp;");$(this).blur();ca()})},ga=null,ea=null;W.stopNetworkUpdatePing=function(){try{ga&&(clearInterval(ga),ga=null,ea&&(ea.abort(),ea=null))}catch(a){b("error. network.stopNetworkUpdatePing: "+a)}};var la=function(a,c,f){var d=null,e=null,g=null,p=c=null,r=null,k=null;try{if(Q.PAGE!==Q.PAGES.NETWORK)W.stopNetworkUpdatePing();else if(null!==ga)if(a&&0===a.retCode){if(a.data){e=[];g=[];for(d in Q.CACHE.conf.network)Q.CACHE.conf.network.hasOwnProperty(d)&&
("port"===Q.CACHE.conf.network[d].type?g.push(d):e.push(d));p=[];r=[];for(c in a.data)a.data.hasOwnProperty(c)&&("port"===a.data[c].type?r.push(c):p.push(c));if(e.length!==p.length||g.length!==r.length)b("network.updatePingCallback: interface data changed - refresh page"),D(Q.PAGE);else{for(c in a.data)if(a.data.hasOwnProperty(c)&&(k=a.data[c])){var C=h("configsys.network.linkstate."+k.link.state);if("port"===k.type){var A=h("configsys.network.rstprole."+k.stp.role);$("#r-port-"+c+" :nth-child(4)").text(A);
var L=h("configsys.network.stpstate."+k.stp.state);$("#r-port-"+c+" :nth-child(5)").text(L);$("#r-port-"+c+" :nth-child(6)").text(C);$("#r-port-"+c+" :nth-child(7)").text(k.link.uptime)}else $("#r-interface-"+c+" :nth-child(5)").text(C),$("#r-interface-"+c+" :nth-child(6)").text(k.link.uptime)}for(c in a.data)if(a.data.hasOwnProperty(c)&&(k=a.data[c])&&"port"!==k.type&&k.address){f=0;for(var m in k.address)k.address.hasOwnProperty(m)&&f++;var C=0,l;for(l in Q.CACHE.conf.network[c].address)Q.CACHE.conf.network[c].address.hasOwnProperty(l)&&
Q.CACHE.conf.network[c].address.hasOwnProperty(l)&&C++;f!==C&&(Q.CACHE.conf.network[c].address=k.address,Ka(c))}var S=u();Object.keys(a.data[S].route).length!==Object.keys(Q.CACHE.conf.network[S].route).length&&(Q.CACHE.conf.network[S].route=a.data[S].route,oa());Object.keys(a.data[S].dns).length!==Object.keys(Q.CACHE.conf.network[S].dns).length&&(Q.CACHE.conf.network[S].dns=a.data[S].dns,ua());Q.CACHE.conf.network=a.data}}}else a?b("error /api/conf/network: retCode="+a.data.retCode+", retMsg="+a.data.retMsg):
b("error /api/conf/network: "+$.stringify(f))}catch(n){b("error network.updatePingCallback: "+n)}},ha=function(a){a=a&&"number"===typeof a&&5<a?a:Q.UPDATE_INTERVAL;b("network.initUpdatePing => "+a+" seconds");try{W.stopNetworkUpdatePing(),ga=setInterval(function(){Q.PAGE!==Q.PAGES.NETWORK?W.stopNetworkUpdatePing():ea&&"resolved"!==ea.state()?b("network.initUpdatePing: update overlap..."):ea=F("/api/conf/network",!0,la,null,"get",null,null)},1E3*a)}catch(c){b("error. network.initUpdatePing: "+c)}},
ia=function(){b("network.setHostname");var a=function(a,c,f){a?0===a.retCode?(Q.CACHE.conf.system.hostname=Q.CACHE.opBuf.hostname,$("[id^=status-]").html("&nbsp;"),$("#status-hostname").removeClass("status-error").addClass("status-success").html(h("success"))):a.retCode===Q.RETCODE.NOT_AUTHORIZED?v(Q.DIALOG_ERROR,h("err.notAuthorized")):v(Q.DIALOG_ERROR,w(a.retCode)):b("jqXHR = "+$.stringify(f));Q.CACHE.opBuf=null},c=$("#hostname").val(),f={path:"/api/conf/system",cmd:"set",access:X(),data:{hostname:{value:c,
error:d,reset:m,data:"hostname"}}},e=function(){if(!A(f.path,f.cmd,!0))p(e,!0);else if(!f||M(f)){var b=E(f);Q.CACHE.opBuf=b;F(f.path,!0,a,null,f.cmd,null,$.stringify(b))}};e()},pa=function(){$("#setHostname").on("click",function(){$("[id^=status-]").html("&nbsp;");ia();$(this).blur()})},C=function(){b("network.setProtocol");var a=function(a,c,f){a?0===a.retCode?(Q.CACHE.conf.system.ip6Enabled=Q.CACHE.opBuf.ip6Enabled,$("[id^=status-]").html("&nbsp;"),$("#status-protocol").removeClass("status-error").addClass("status-success").html(h("success"))):
a.retCode===Q.RETCODE.NOT_AUTHORIZED?v(Q.DIALOG_ERROR,h("err.notAuthorized")):v(Q.DIALOG_ERROR,w(a.retCode)):b("jqXHR = "+$.stringify(f));Q.CACHE.opBuf=null},c=$("#protocol-ipv6-enabled").val(),f={path:"/api/conf/system",cmd:"set",access:X(),data:{ip6Enabled:{value:s(c),error:d,reset:m,data:"protocol-ipv6-enabled"}}},e=function(){if(!A(f.path,f.cmd,!0))p(e,!0);else if(!f||M(f)){var b=E(f);Q.CACHE.opBuf=b;F(f.path,!0,a,null,f.cmd,null,$.stringify(b))}};e()},fa=function(){$("#setProtocol").on("click",
function(){$("[id^=status-]").html("&nbsp;");C();$(this).blur()})},Aa=function(a,c){if(!a||"string"!==typeof a||!c||"object"!==typeof c)return b("error. network.getDnsAddrRow: invalid param(s)."),null;var f=c.address||"&nbsp;",d=$("<tr></tr>");d.prop("id","r-dnsAddr-"+a).addClass("light-row").append($("<td></td>"));!0===c.mutable?d.find("td").append($("<span></span>").prop("id","m-dnsAddr-"+a).addClass("ui-icon ui-icon-wrench action triggerIcon actionDnsAddr ui-corner-all")).append($("<span></span>").prop("id",
"d-dnsAddr-"+a).addClass("ui-icon ui-icon-trash action triggerIcon actionDnsAddr ui-corner-all")):d.find("td").append("&nbsp;");d.append($("<td></td>").addClass("alignLeft").append("&nbsp;")).append($("<td></td>").addClass("alignLeft").append(f)).append($("<td></td>").addClass("alignLeft").append("&nbsp;"));return d},Da=function(){var b=Q.CACHE.conf.network[u()];S=0;var a=y("dnsAddrTbl");if(a&&(a.find("thead").append(N("T-dnsAddrTableHeader").find("tr")),b&&(b=b.dns))){var c=[],f;for(f in b)b.hasOwnProperty(f)&&
(c.push(f),!0===b[f].mutable&&S++);c.sort();for(var d in c)c.hasOwnProperty(d)&&(f=c[d],a.find("tbody").append(Aa(f,b[f])))}return a},ua=function(){setTimeout(function(){var a=u();F("/api/conf/network/"+a+"/dns",!1,function(c,f,d){c?0===c.retCode&&(P("conf/network/"+a+"/dns",c.data),$("#dnsAddrTbl-group").replaceWith(Da()),H(Q.USER.lang),G("dnsAddrTbl"),$("#dnsAddrTbl").on("click","span.actionDnsAddr",function(){$("[id^=status-]").html("&nbsp;");Ea(this)}),$("#a-newDnsAddr").attr("title",h("diagAndTable.add")),
$("[id^=m-dnsAddr-]").attr("title",h("diagAndTable.mod")),$("[id^=d-dnsAddr-]").attr("title",h("diagAndTable.delete"))):b("error. network.refreshDnsAddrTable: "+$.stringify(d))},null,"get",null,null)},1E3)},Ia=function(){$("#dnsAddrTbl").on("click","span.actionDnsAddr",function(){$("[id^=status-]").html("&nbsp;");Ea(this)})},Ma=function(){var b=$("<div></div>");b.prop("id","dialog-delete-dnsAddr").prop("title",h("diagAndTable.delete")).append($("<p></p>").append(h("diagAndTable.youSure")));return $("<div></div>").append(b)},
xa=function(a){var c=$(a).data("dnsAddrId")||"",f=function(f,d,e){f?0===f.retCode&&ua():b("error. network.dnsAddrDelete: "+$.stringify(e));x("d-dnsAddr-"+c,!1);$(a).dialog("close")},d=u(),e=function(){A("/api/conf/network/"+d+"/dns/"+c,"delete",!0)?U("/api/conf/network/"+d+"/dns/"+c,f):p(e,!0)};e()},ra=function(){T(Ma().html(),{autoOpen:!1,resizable:!1,width:300,height:150,modal:!0,close:function(){var b=$(this).data("dnsAddrId");x("d-dnsAddr-"+b,!1)},buttons:[{id:"dlg-btn-dnsAddr-del-delete",text:h("diagAndTable.delete"),
click:function(){$("[id^=status-]").html("&nbsp;");xa(this)}},{id:"dlg-btn-dnsAddr-del-cancel",text:h("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]})},Ca=function(){var b=$("<tr></tr>").addClass("pad-row").append($("<td></td>")),a=$("<div></div>");a.prop("id","dialog-edit-dnsAddr").prop("title","").append($("<table></table>").addClass("form-table").append($("<thead></thead>")).append($("<tbody></tbody>").append(b.clone()).append(O("edit-dnsAddr-address","configsys.network.dnsAddr")).append(b.clone()))).append($("<div></div>").prop("id",
"status-editDnsAddr").append("&nbsp;"));return $("<div></div>").append(a)},va=function(){T(Ca().html(),{autoOpen:!1,resizable:!1,width:500,modal:!0,close:function(){var b=$(this).data("dnsAddrOp"),a=$(this).data("dnsAddrId");"mod"===b&&x("m-dnsAddr-"+a,!1)},buttons:[{id:"dlg-btn-dnsAddr-edit-save",text:h("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");var a=$(this).data("dnsAddrOp");"add"===a?Ba(this):"mod"===a?sa(this):b("error. network.dnsAddrAddModify: bad dnsAddrOp")}},
{id:"dlg-btn-dnsAddr-edit-cancel",text:h("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]})},Ga=function(b,a){if("add"===b)$("#edit-dnsAddr-address").val("");else if("mod"===b){var c=Q.CACHE.conf.network[u()];c&&(c=c.dns)&&c[a]&&(c=c[a].address||"",$("#edit-dnsAddr-address").val(c))}B("dialog-edit-dnsAddr")},Ba=function(a){var c=function(c,f,d){c?0===c.retCode?ua():v(Q.DIALOG_ERROR,w(c.retCode)):b("error. network.dnsAddrAdd: "+$.stringify(d));x("a-newDnsAddr",!1);$(a).dialog("close")},
f=u(),e=$("#edit-dnsAddr-address").val();e&&"0.0.0.0"===e&&(e="500.500.500.500");var g={path:"/api/conf/network/"+f+"/dns",cmd:"add",data:{address:{value:e,error:d,reset:m,data:"edit-dnsAddr-address"}}},r=function(){if(!A(g.path,g.cmd,!0))p(r,!0);else if(!g||M(g)){var b=E(g);F(g.path,!0,c,null,g.cmd,null,$.stringify(b))}};r()},sa=function(a){var c=$(a).data("dnsAddrId")||"",f=function(f,d,e){f?0===f.retCode?ua():v(Q.DIALOG_ERROR,w(f.retCode)):b("error. dnsAddrMod: "+$.stringify(e));x("m-dnsAddr-"+
c,!1);$(a).dialog("close")},e=u(),g=$("#edit-dnsAddr-address").val();g&&"0.0.0.0"===g&&(g="500.500.500.500");var r={path:"/api/conf/network/"+e+"/dns/"+c,cmd:"set",data:{address:{value:g,error:d,reset:m,data:"edit-dnsAddr-address"}}},h=function(){if(!A(r.path,r.cmd,!0))p(h,!0);else if(!r||M(r)){var b=E(r);F(r.path,!0,f,null,r.cmd,null,$.stringify(b))}};h()},Ea=function(a){try{var c=$(a).attr("id"),f=c?c.charAt(0):"",d=c?c.replace(f+"-dnsAddr-",""):"";if(f&&d){var e=$("#dialog-edit-dnsAddr");switch(f){case "a":if(S>=
Q.MAX.DNS_SERVERS){var g=h("common.maxAllowed"),g=g.replace("$1",Q.MAX.DNS_SERVERS);v(Q.DIALOG_INFO,g);break}x(c,!0,!1);Ga("add",d);e.data("dnsAddrOp","add").dialog("option","title",h("diagAndTable.add")).dialog("open");break;case "m":x(c,!0);Ga("mod",d);e.data("dnsAddrOp","mod").data("dnsAddrId",d).dialog("option","title",h("diagAndTable.mod")).dialog("open");break;case "d":x(c,!0);$("#dialog-delete-dnsAddr").data("dnsAddrId",d).dialog("open");break;default:b('error. network.eventHandlerDnsAddrAddModDel: invalid action "'+
f+'"')}}}catch(p){b("error. network.eventHandlerDnsAddrAddModDel: "+p)}},ma=function(a,c){try{var f=$("<tr></tr>"),d=!1,e="";a&&void 0!==c&&(e=void 0===a.destination||"::"!==a.destination&&"0.0.0.0"!==a.destination?a.destination:h("configsys.network.default"),void 0!==a.mutable&&!0===a.mutable&&(d=!0),f.prop("id","r-route-"+c).addClass("light-row").append($("<td></td>").addClass("w50")),d?(f.find("td").append($("<span></span>").prop("id","m-route-"+c).addClass("ui-icon ui-icon-wrench action triggerIcon actionRoutes ui-corner-all")),
aa()||f.find("td").append($("<span></span>").prop("id","d-route-"+c).addClass("ui-icon ui-icon-trash action triggerIcon actionRoutes ui-corner-all"))):f.find("td").append("&nbsp;"),f.append($("<td></td>").addClass("alignLeft").append(e)).append($("<td></td>").addClass("alignLeft").append(a.prefix)).append($("<td></td>").addClass("alignLeft").append(a.gateway)).append($("<td></td>").addClass("alignLeft").append(ba(a["interface"]))));return f}catch(g){b("error. network.getRoutesRow: "+g)}},qa=function(){var b=
u(),b=Q.CACHE.conf.network[b].route,a=y("routesTbl");if(b&&a){var c=N("T-routesTableHeader").find("tr");aa()&&c.find("#a-newRoute").replaceWith("&nbsp;");a.find("thead").append(c);for(var f in b)b.hasOwnProperty(f)&&a.find("tbody").append(ma(b[f],f))}return a},oa=function(){b("network.refreshRoutesTable...");F("/api/conf/network",!1,function(a,c,f){a?0===a.retCode&&(Q.CACHE.conf.network=a.data,$("#routesTbl-group").replaceWith(qa()),H(Q.USER.lang),G("routesTbl"),ta(),$("#a-newRoute").attr("title",
h("diagAndTable.add")),$("[id^=m-route-]").attr("title",h("diagAndTable.mod")),$("[id^=d-route-]").attr("title",h("diagAndTable.delete"))):b("error. netwrok.refreshRoutesTable: "+$.stringify(f))},null,"get",null,null)},ta=function(){$("#routesTbl").on("click","span.actionRoutes",function(){$("[id^=status-]").html("&nbsp;");$(this).blur();a:{b("network.eventHandlerRouteAddModDel...");try{var a=$(this).attr("id"),c=a?a.charAt(0):"",f=a?a.replace(c+"-route-",""):"";u();if(c&&f)switch(c){case "a":if(J()>=
Q.MAX.NETWORK_ROUTES){var d=h("common.maxAllowed"),d=d.replace("$1",""+Q.MAX.NETWORK_ROUTES);v(Q.DIALOG_INFO,d);break a}x(a,!0,!1);B("dialog-route-add");$("#routeAdd-destination").val("");$("#routeAdd-prefix").val("");$("#routeAdd-gateway").val("");$("#routeAdd-interface").val("all");$("#dialog-route-add").dialog("open");break;case "m":x(a,!0);Q.CACHE.opId=f;b("network.initDialogRouteModify...");var e=u();e&&($("#routeMod-destination").val(Q.CACHE.conf.network[e].route[f].destination),$("#routeMod-prefix").val(Q.CACHE.conf.network[e].route[f].prefix),
$("#routeMod-gateway").val(Q.CACHE.conf.network[e].route[f].gateway),$("#routeMod-interface").val(Q.CACHE.conf.network[e].route[f]["interface"]));B("dialog-route-modify");$("#dialog-route-modify").dialog("open");break;case "d":x(a,!0),Q.CACHE.opId=f,$("#dialog-route-delete").dialog("open")}}catch(g){b("error. network.eventHandlerRouteAddModDel: "+g)}}})},wa=function(a){if("Add"!==a&&"Mod"!==a)return b("error. htmlDialogAddModRoute: invalid param "+a),"";var c=$("<tr></tr>").addClass("padrow").append($("<td></td>")),
f=$("<div></div>"),d="Add"===a?h("diagAndTable.add"):h("diagAndTable.mod"),e="Mod"===a?"dialog-route-modify":"dialog-route-add",g;g={values:["all"],names:["all"]};var p=null;if(Q.CACHE.conf.network)for(var r in Q.CACHE.conf.network)Q.CACHE.conf.network.hasOwnProperty(r)&&(p=Q.CACHE.conf.network[r],"port"!==p.type&&(g.values.push(r),g.names.push(p.label)));g&&g.values&&g.names||(g={values:[],names:[]});f.prop("id",e).prop("title",d).append($("<table></table>").prop("id","route"+a).addClass("form-table center").prop("cellspacing",
1).prop("cellpadding",1).append($("<thead></thead>")).append($("<tbody></tbody>")));aa()?f.find("tbody").append(c.clone()).append(O("route"+a+"-gateway","configsys.network.gateway")).append(c.clone()):f.find("tbody").append(c.clone()).append(O("route"+a+"-destination","configsys.network.destination")).append(O("route"+a+"-prefix","configsys.network.prefix")).append(O("route"+a+"-gateway","configsys.network.gateway")).append(I("route"+a+"-interface","configsys.network.interface",g.values,g.names,null,
!1)).append(c.clone());f.append($("<div></div>").prop("id","status-route"+a).append("&nbsp;"));return $("<div></div>").append(f)},Za=function(a){b("network.routeAdd...");var c=function(c,f,d){c?0===c.retCode?oa():v(Q.DIALOG_ERROR,w(c.retCode)):b("error. network.routeAdd: "+$.stringify(d));x("a-newRoute",!1);$(a).dialog("close")},f={path:"/api/conf/network/"+u()+"/route",cmd:"add",data:{destination:{value:$("#routeAdd-destination").val(),error:d,reset:m,data:"routeAdd-destination"},prefix:{value:Ha($("#routeAdd-prefix").val()),
error:d,reset:m,data:"routeAdd-prefix"},gateway:{value:$("#routeAdd-gateway").val(),error:d,reset:m,data:"routeAdd-gateway"},"interface":{value:$("#routeAdd-interface").val(),error:d,reset:m,data:"routeAdd-prefix"}}},e=function(){if(!A(f.path,f.cmd,!0))p(e,!0);else if(!f||M(f)){var b=E(f);F(f.path,!0,c,null,f.cmd,null,$.stringify(b))}};e()},$a=function(){T(wa("Add").html(),{autoOpen:!1,resizable:!1,width:500,modal:!0,buttons:[{id:"dlg-btn-route-add-save",text:h("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");
Za(this)}},{id:"dlg-btn-route-add-cancel",text:h("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]})},Xa=function(a){b("network.routeModify...");var c=function(c,f,d){c?0===c.retCode?oa():v(Q.DIALOG_ERROR,w(c.retCode)):b("error. network.routeModify: "+$.stringify(d));x("m-route-"+Q.CACHE.opId,!1);Q.CACHE.opId=null;$(a).dialog("close")},f=u(),e=null,e=aa()?{gateway:{value:$("#routeMod-gateway").val(),error:d,reset:m,data:"routeMod-gateway"}}:{destination:{value:$("#routeMod-destination").val(),
error:d,reset:m,data:"routeMod-destination"},prefix:{value:Ha($("#routeMod-prefix").val()),error:d,reset:m,data:"routeMod-prefix"},gateway:{value:$("#routeMod-gateway").val(),error:d,reset:m,data:"routeMod-gateway"},"interface":{value:$("#routeMod-interface").val(),error:d,reset:m,data:"routeMod-prefix"}},g={path:"/api/conf/network/"+f+"/route/"+Q.CACHE.opId,cmd:"set",data:e},r=function(){if(!A(g.path,g.cmd,!0))p(r,!0);else if(!g||M(g)){var b=E(g);F(g.path,!0,c,null,g.cmd,null,$.stringify(b))}};r()},
mb=function(){T(wa("Mod").html(),{autoOpen:!1,resizable:!1,width:500,modal:!0,close:function(){Q.CACHE.opId&&(x("m-route-"+Q.CACHE.opId,!1),Q.CACHE.opId=null)},buttons:[{id:"dlg-btn-route-mod-save",text:h("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");Xa(this)}},{id:"dlg-btn-route-mod-cancel",text:h("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]})},Oa=function(a){b("network.routeDelete...");var c=function(c,f,d){c?0===c.retCode?(oa(),$(a).dialog("close"),
Q.CACHE.opId=null):v(Q.DIALOG_ERROR,w(c.retCode)):b("error. network.routeDelete: "+$.stringify(d));x("d-route-"+Q.CACHE.opId,!1);Q.CACHE.opId=null;$(a).dialog("close")},f=u(),d=function(){A("/api/conf/network/"+f+"/route/"+Q.CACHE.opId,"delete",!0)?U("/api/conf/network/"+f+"/route/"+Q.CACHE.opId,c):p(d,!0)};d()},ab=function(){var b=h("diagAndTable.youSure"),a=$("<div></div>");a.append($("<div></div>").prop("id","dialog-route-delete").prop("title",h("diagAndTable.delete")).append($("<p></p>").append($("<span></span>").addClass("ui-icon ui-icon-alert").prop("style",
"float:left;margin:0 7px 20px 0;")).append($("<span></span>").prop("id","rusure").append(b))));T(a.html(),{autoOpen:!1,resizable:!1,width:300,height:150,modal:!0,close:function(){Q.CACHE.opId&&(x("d-route-"+Q.CACHE.opId,!1),Q.CACHE.opId=null)},buttons:[{id:"dlg-btn-route-del-delete",text:h("diagAndTable.delete"),click:function(){$("[id^=status-]").html("&nbsp;");Oa(this)}},{id:"dlg-btn-route-del-cancel",text:h("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]})},Ya=function(a,c){try{var f=
$("<tr></tr>");if(c&&void 0!==a){var d=!1,e=c.type,g=c.dhcpOn?"diagAndTable.enabled":"diagAndTable.disabled",p=h("configsys.network.linkstate."+c.link.state);void 0!==c.removable&&!0===c.removable&&(d=!0);f.prop("id","r-interface-"+a).addClass("light-row");var r=$("<td></td>").addClass("w75");r.append($("<span></span>").prop("id","m-interface-"+a).addClass("ui-icon ui-icon-wrench action triggerIcon actionInterface ui-corner-all"));d&&r.append($("<span></span>").prop("id","d-interface-"+a).addClass("ui-icon ui-icon-trash action triggerIcon actionInterface ui-corner-all"));
f.append(r);f.append($("<td></td>").addClass("alignLeft").append(c.label));"wlan"===e?f.append($("<td></td>").addClass("alignLeft").append(c.ssid)):f.append($("<td></td>").addClass("alignLeft").append(c.macAddr));f.append($("<td></td>").addClass("alignLeft").append(h(g))).append($("<td></td>").addClass("alignLeft").append(p)).append($("<td></td>").addClass("alignLeft").append(c.link.uptime))}return f}catch(k){b("error. network.getInterfaceRow: "+k)}},za=function(b,a){if(b&&a){var c=y("interfaceTbl-"+
b),f=N("T-interfaceTableHeader").find("tr");"wlan"===a.type?(f.find("th._ssid").removeClass("_ssid"),f.find("th._mac").replaceWith("")):(f.find("th._mac").removeClass("_mac"),f.find("th._ssid").replaceWith(""));c.find("thead").append(f);c.find("tbody").append(Ya(b,a))}return c},Pa=function(a,c,f){var d=$("<tr></tr>");if(!a||void 0===c||!f||"object"!==typeof f)return b("error. network.getInterfaceIPTableRow: invalid parameter(s)."),d;d.prop("id","r-interfaceIP-"+a+"-"+c).addClass("light-row");f.mutable?
(d.append($("<td></td>").addClass("w75").append($("<span></span>").prop("id","m-interfaceIP-"+a+"-"+c).addClass("ui-icon ui-icon-wrench action triggerIcon actionInterfaceIP ui-corner-all"))),Z()||d.find("td").append($("<span></span>").prop("id","d-interfaceIP-"+a+"-"+c).addClass("ui-icon ui-icon-trash action triggerIcon actionInterfaceIP ui-corner-all"))):d.append($("<td></td>").addClass("w50").append("&nbsp;"));d.append($("<td></td>").addClass("alignLeft").append(f.address?Qa(f.address):"-")).append($("<td></td>").addClass("alignLeft").append(f.prefix?
f.prefix:"-"));return d},Ja=function(a,c,f){if(!a||!c)return b("error. network.getInterfaceIPTable: invalid parameter(s)"),null;var d=null,e=N("T-interfaceIPTableHeader").find("tr");e.find("span").prop("id","a-interfaceIP-"+a);Z()&&e.find("#a-interfaceIP-"+a).replaceWith("&nbsp;");d=f?y("interfaceIPTbl-"+a):$("<blockquote></blockquote>").append($("<blockquote></blockquote>").append(y("interfaceIPTbl-"+a)));d.find("thead").append(e);for(var g in c)c.hasOwnProperty(g)&&d.find("tbody").append(Pa(a,g,
c[g]));return d},kb=function(){b("network.interfacesAddEventHandlers...");$("#interfaceTables").on("click","span.actionInterface",function(a){a.preventDefault();$("[id^=status-]").html("&nbsp;");$(this).blur();b("network.eventHandlerInterfaceModDel...");try{var c=$(this).attr("id"),f=c.split("-");if(f&&3===f.length){var d=f[2];switch(f[0]){case "m":x(c,!0);Q.CACHE.opId=d;Fa();$("#dialog-interface-modify").dialog("open");break;case "d":x(c,!0),Q.CACHE.opId=d,$("#dialog-interface-delete").dialog("open")}}else throw"invalid ele parameter";
}catch(e){b("error. network.eventHandlerInterfaceModDel: "+e)}});$("#interfaceTables").on("click","span.actionInterfaceIP",function(a){a.preventDefault();$("[id^=status-]").html("&nbsp;");$(this).blur();a:{b("network.eventHandlerInterfaceIPAddress...");try{var c=$(this).attr("id"),f=c.split("-");if(f){var d=f[0],e=f[2],g="a"!==d?f[3]:null;switch(d){case "a":a=0;if(Q.CACHE.conf.network[e]&&Q.CACHE.conf.network[e].address){var p=Q.CACHE.conf.network[e].address,r;for(r in p)p.hasOwnProperty(r)&&!0===
p[r].mutable&&a++}if(a>=Q.MAX.NETWORK_IPS){var k=h("common.maxAllowed"),k=k.replace("$1",""+Q.MAX.NETWORK_IPS);v(Q.DIALOG_INFO,k);break a}Q.CACHE.opId={"interface":e,address:null};ib();$("#dialog-interfaceAddress-add").dialog("open");break;case "m":x(c,!0);Q.CACHE.opId={"interface":e,address:g};jb();b("network.initInterfaceAddressModifyDialog...");var C=Q.CACHE.opId["interface"],A=Q.CACHE.opId.address;void 0!==C&&void 0!==A?($("#interfaceAddressMod-address").val(Q.CACHE.conf.network[C].address[A].address),
$("#interfaceAddressMod-prefix").val(Q.CACHE.conf.network[C].address[A].prefix)):($("#interfaceAddressMod-address").val(""),$("#interfaceAddressMod-prefix").val(""));B("dialog-interfaceAddress-modify");$("#dialog-interfaceAddress-modify").dialog("open");break;case "d":x(c,!0),Q.CACHE.opId={"interface":e,address:g},pb(),$("#dialog-interfaceAddress-delete").dialog("open")}}else throw"invalid ele parameter";}catch(L){b("error. network.eventHandlerInterfaceIPAddress: "+L)}}})},bb=function(a){if("Add"!==
a&&"Mod"!==a)return b("error. network.getDialogAddModAddress: invalid param "+a),"";var c=$("<tr></tr>").addClass("padrow").append($("<td></td>")),f=$("<div></div>"),d="Add"===a?h("diagAndTable.add"):h("diagAndTable.mod");f.prop("id","Mod"===a?"dialog-interfaceAddress-modify":"dialog-interfaceAddress-add").prop("title",d).append($("<table></table>").prop("id","interfaceAddress"+a).addClass("form-table center").prop("cellspacing",1).prop("cellpadding",1).append($("<thead></thead>")).append($("<tbody></tbody>")));
f.find("tbody").append(c.clone()).append(O("interfaceAddress"+a+"-address","common.ipAddress")).append(O("interfaceAddress"+a+"-prefix","configsys.network.prefix")).append(c.clone());f.append($("<div></div>").prop("id","status-interfaceAddress"+a).append("&nbsp;"));return $("<div></div>").append(f)},cb=function(){var b=h("diagAndTable.youSure"),a=$("<div></div>");a.append($("<div></div>").prop("id","dialog-interfaceAddress-delete").prop("title",h("diagAndTable.delete")).append($("<p></p>").append($("<span></span>").addClass("ui-icon ui-icon-alert").prop("style",
"float:left;margin:0 7px 20px 0;")).append($("<span></span>").prop("id","rusure").append(b))));return a},Ka=function(a){b("network.refreshInterfaceAddressTable...");var c=function(c,f,d){c?0===c.retCode&&(Q.CACHE.conf.network=c.data,a&&(c=Q.CACHE.conf.network[a]))&&($("#interfaceIPTbl-"+a+"-group").replaceWith(Ja(a,c.address,!0)),H(Q.USER.lang),G("interfaceIPTbl-"+a)):b("error. network.refreshInterfaceAddressTable::cb: "+$.stringify(d))};setTimeout(function(){F("/api/conf/network",!1,c,null,"get",
null,null)},5E3)},Qa=function(b){var a=null,c=location.protocol,f=location.port?":"+location.port:"";b&&(-1===b.search(/^fe80.*/)?(a=c+"//",a=-1!==b.search(":")?a+("["+b+"]"+f):a+(b+f),a="<a href='"+a+"' target='_blank'>"+b+"</a>"):a=b);return a},Ra=function(a,c){b("network.interfaceAddressAddModify..."+a);var f=a;"modify"!==f&&"add"!==f&&(f=null);if(f&&c){var e=function(a,d,e){if(a)if(0===a.retCode){if("add"===f)Ka(Q.CACHE.opId["interface"]);else{a=Q.CACHE.opId["interface"];d=Q.CACHE.opId.address;
e=$("#interfaceAddressMod-address").val();var g=$("#interfaceAddressMod-prefix").val();Q.CACHE.conf.network[a].address[d].address=e;Q.CACHE.conf.network[a].address[d].prefix=g;$("#r-interfaceIP-"+a+"-"+d+" :nth-child(2)").html(Qa(e));$("#r-interfaceIP-"+a+"-"+d+" :nth-child(3)").text(g);x("m-interfaceIP-"+a+"-"+d,!1)}Q.CACHE.opId=null}else v(Q.DIALOG_ERROR,w(a.retCode));else b("error. network.interfaceAddressAddModify: "+$.stringify(e));$(c).dialog("close")},g="/api/conf/network/",g="modify"===f?
g+(Q.CACHE.opId["interface"]+"/address/"+Q.CACHE.opId.address):g+(Q.CACHE.opId["interface"]+"/address"),r="add"===f?"interfaceAddressAdd-":"interfaceAddressMod-",h={path:g,cmd:"add"===f?"add":"set",data:{address:{value:$("#"+r+"address").val(),error:d,reset:m,data:r+"address"},prefix:{value:Ha($("#"+r+"prefix").val()),error:d,reset:m,data:r+"prefix"}}},k=function(){if(!A(h.path,h.cmd,!0))p(k,!0);else if(!h||M(h)){var b=E(h);F(h.path,!0,e,null,h.cmd,null,$.stringify(b))}};k()}else b("error. network.interfaceAddressAddModify: missing or invalid parameter(s)")},
lb=function(a){b("network.interfaceAddressDelete...");var c=function(c,f,d){c?0===c.retCode?$("#r-interfaceIP-"+Q.CACHE.opId["interface"]+"-"+Q.CACHE.opId.address).replaceWith(""):v(Q.DIALOG_ERROR,w(c.retCode)):b("error. network.interfaceAddressDelete: "+$.stringify(d));Q.CACHE.opId=null;$(a).dialog("close")},f=Q.CACHE.opId["interface"],d=Q.CACHE.opId.address,e=function(){A("/api/conf/network/"+f+"/address/"+d,"delete",!0)?U("/api/conf/network/"+f+"/address/"+d,c):p(e,!0)};e()},ib=function(){b("network.createDialogInterfaceAddressAdd...");
$("#dialog-interfaceAddress-add").dialog().dialog("close").dialog("destroy").remove();T(bb("Add").html(),{autoOpen:!1,resizable:!1,width:500,modal:!0,buttons:[{id:"dlg-btn-interfaceAddress-add-save",text:h("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");Ra("add",this);return!1}},{id:"dlg-btn-interfaceAddress-add-cancel",text:h("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]});H(Q.USER.lang)},jb=function(){b("network.createDialogInterfaceAddressModify...");
$("#dialog-interfaceAddress-modify").dialog().dialog("close").dialog("destroy").remove();T(bb("Mod").html(),{autoOpen:!1,resizable:!1,width:500,modal:!0,close:function(){Q.CACHE.opId&&(Q.CACHE.opId["interface"]&&Q.CACHE.opId.address)&&(x("m-interfaceIP-"+Q.CACHE.opId["interface"]+"-"+Q.CACHE.opId.address,!1),Q.CACHE.opId=null)},buttons:[{id:"dlg-btn-interfaceAddress-mod-save",text:h("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");Ra("modify",this);return!1}},{id:"dlg-btn-interfaceAddress-mod-cancel",
text:h("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]});H(Q.USER.lang)},pb=function(){b("network.createDialogInterfaceAddressDelete...");$("#dialog-interfaceAddress-delete").dialog().dialog("close").dialog("destroy").remove();T(cb().html(),{autoOpen:!1,resizable:!1,width:300,height:150,modal:!0,close:function(){Q.CACHE.opId&&(Q.CACHE.opId["interface"]&&Q.CACHE.opId.address)&&(x("d-interfaceIP-"+Q.CACHE.opId["interface"]+"-"+Q.CACHE.opId.address,!1),Q.CACHE.opId=null)},buttons:[{id:"dlg-btn-interfaceAddress-del-delete",
text:h("diagAndTable.delete"),click:function(){$("[id^=status-]").html("&nbsp;");lb(this);return!1}},{id:"dlg-btn-interfaceAddress-del-cancel",text:h("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]});H(Q.USER.lang)},Va=function(a){b("network.interfaceModify...");var c=function(c,f,d){c?0===c.retCode?F("/api/conf/network",!1,function(a,c,f){a?0===a.retCode&&(c=Q.CACHE.opId,Q.CACHE.conf.network=a.data,$("#interfaceTbl-"+c+"-group").replaceWith(za(c,Q.CACHE.conf.network[c])),H(Q.USER.lang),
G("interfaceTbl-"+c),$("[id^=m-interface-]").attr("title",h("diagAndTable.mod"))):b("error. network.interfaceModify::innerCB: "+$.stringify(f))},null,"get",null,null):v(Q.DIALOG_ERROR,w(c.retCode)):b("error. network.interfaceModify: "+$.stringify(d));x("m-interface-"+Q.CACHE.opId,!1);Q.CACHE.opId=null;$(a).dialog("close")},f=Q.CACHE.opId,e={path:"/api/conf/network/"+f,cmd:"set",data:{label:{value:$("#interfaceMod-label").val(),error:d,reset:m,data:"interfaceMod-label"},dhcpOn:{value:s($("#interfaceMod-dhcp").val()),
error:d,reset:m,data:"interfaceMod-dhcp"}}};Z()||aa()||(e.data.enabled={value:s($("#interfaceMod-enabled").val()),error:d,reset:m,data:"interfaceMod-enabled"});"wlan"===Q.CACHE.conf.network[f].type&&(e.data.ssid={value:$("#interfaceMod-ssid").val(),error:d,reset:m,data:"interfaceMod-ssid"},e.data.securityType={value:$("#interfaceMod-securityType").val(),error:d,reset:m,data:"interfaceMod-securityType"},f=$("#interfaceMod-password").val(),f!==h("xxx.passwordSet")&&(e.data.password={value:f,error:d,
reset:m,data:"interfaceMod-password"}));var g=function(){if(!A(e.path,e.cmd,!0))p(g,!0);else if(!e||M(e)){var b=E(e);F(e.path,!0,c,null,e.cmd,null,$.stringify(b))}};g()},hb=function(){var b=$("<div></div>"),a=$("<tr></tr>").addClass("padrow").append($("<td></td>")),c=N("T-dialogTableSpacerRow").find("tr"),f=Q.CACHE.conf.network[Q.CACHE.opId];if(f){var d=h("configsys.network.type."+f.type);b.prop("id","dialog-interface-modify").prop("title",h("diagAndTable.mod")).append($("<table></table>").prop("id",
"interfaceMod").addClass("form-table center").prop("cellspacing",1).prop("cellpadding",1).append($("<thead></thead>")).append($("<tbody></tbody>")));var e=null,e=Z()&&aa()?R(!0===f.enabled?h("diagAndTable.enabled"):h("diagAndTable.disabled"),"configsys.ldap.enabled"):I("interfaceMod-enabled","configsys.ldap.enabled",["true","false"],["diagAndTable.enabled","diagAndTable.disabled"],!0===f.enabled?"true":"false",!0);b.find("tbody").append(a.clone()).append(R(d,"alarms.type")).append(R(f.name,"common.name")).append(O("interfaceMod-label",
"status.cfg.label",!1,f.label)).append(e).append(R(f.macAddr,"common.macAddress")).append(I("interfaceMod-dhcp","configsys.network.dhcp",["true","false"],["diagAndTable.enabled","diagAndTable.disabled"],!0===f.dhcpOn?"true":"false",!0));if("wlan"===f.type){var d=h("configsys.network.securitytype."+f.securityType),e=[""],g;g=[h("configsys.network.undetectedHidden")];if(f&&f.availableSsids)for(var p=0;p<f.availableSsids.length;p++)if(f.availableSsids[p].ssid){e.push(f.availableSsids[p].ssid);var r=
"&nbsp;",k=f.availableSsids[p].signalStrength,k=k.substr(1,2);"30">=k?r+="\u2581\u2583\u2585\u2587":"67">=k?r+="\u2581\u2581\u2583\u2585":"70">=k?r+="\u2581\u2581\u2581\u2583":"80">=k&&(r+="\u2581\u2581\u2581\u2581");r+="&nbsp;";g.push(r+f.availableSsids[p].ssid)}p=!1;-1!==$.inArray(f.ssid,e)&&(p=!0);b.find("tbody").append(c.clone()).append(I("interfaceMod-ssidList","configsys.network.detectedSsids",e,g,p?f.ssid:"",!1)).append(O("interfaceMod-ssid","configsys.network.ssid",!1,f.ssid)).append(O("interfaceMod-securityType",
"configsys.network.securityType",!1,d)).append(z("interfaceMod-password","common.password"))}b.find("tbody").append(a.clone());b.append($("<div></div>").addClass("status-interfaceMod").append("&nbsp;"))}return $("<div></div>").append(b)},Fa=function(){b("network.createDialogInterfaceModify...");$("#dialog-interface-modify").dialog().dialog("close").dialog("destroy").remove();T(hb().html(),{autoOpen:!1,resizable:!1,width:500,modal:!0,close:function(){Q.CACHE.opId&&(x("m-interface-"+Q.CACHE.opId,!1),
Q.CACHE.opId=null)},buttons:[{id:"dlg-btn-interface-mod-save",text:h("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");Va(this)}},{id:"dlg-btn-interface-mod-cancel",text:h("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]});H(Q.USER.lang);nb()},qb=function(){return!0},nb=function(){b("network.initInterfaceModifyDialog...");B("dialog-interface-modify");$("#interfaceMod-ssidList").on("change",function(b){b=$(this).val();var c=Q.CACHE.conf.network[Q.CACHE.opId],
f=""===b;a("interfaceMod-ssid",f);a("interfaceMod-securityType",f);if(f)$("#interfaceMod-ssid").val(c.ssid),$("#interfaceMod-securityType").val(c.securityType);else for(f=0;f<c.availableSsids.length;f++)if(c.availableSsids[f].ssid===b){$("#interfaceMod-ssid").val(c.availableSsids[f].ssid);$("#interfaceMod-securityType").val(c.availableSsids[f].securityType);break}}).trigger("change");Q.CACHE.opId&&Q.CACHE.conf.network[Q.CACHE.opId]&&f("interfaceMod-password",Q.CACHE.conf.network[Q.CACHE.opId].passwordSet);
$("#interfaceMod-password").on("focus",function(){$(this).blur();Y(r("interfaceMod-password"),function(b){f("interfaceMod-password",b)},qb)})},La=function(a){b("network.interfaceDelete...");var c=function(c,f,d){c?0===c.retCode?F("/api/conf/network",!1,function(a,c,f){a?0===a.retCode&&(Q.CACHE.conf.network=a.data,$("#interfaceTbl-"+Q.CACHE.opId+"-group").parent().parent().replaceWith("")):b("error. network.interfaceDelete::innerCB: "+$.stringify(f))},null,"get",null,null):v(Q.DIALOG_ERROR,w(c.retCode)):
b("error. network.interfaceDelete: "+$.stringify(d));x("d-interface-"+Q.CACHE.opId,!1);Q.CACHE.opId=null;$(a).dialog("close")},f=Q.CACHE.opId,d=function(){A("/api/conf/network/"+f,"delete",!0)?U("/api/conf/network/"+f,c):p(d,!0)};d()},ob=function(){var b=h("diagAndTable.youSure"),a=$("<div></div>");a.append($("<div></div>").prop("id","dialog-interface-delete").prop("title",h("diagAndTable.delete")).append($("<p></p>").append($("<span></span>").addClass("ui-icon ui-icon-alert").prop("style","float:left;margin:0 7px 20px 0;")).append($("<span></span>").prop("id",
"rusure").append(b))));T(a.html(),{autoOpen:!1,resizable:!1,width:300,height:150,modal:!0,close:function(){Q.CACHE.opId&&(x("d-interface-"+Q.CACHE.opId,!1),Q.CACHE.opId=null)},buttons:[{id:"dlg-btn-interface-del-delete",text:h("diagAndTable.delete"),click:function(){$("[id^=status-]").html("&nbsp;");La(this)}},{id:"dlg-btn-interface-del-cancel",text:h("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]})},Ha=function(b){var a=-1;if("string"===typeof b){var c=V(b);c?a=parseInt(c,10):
!0===/^\d+$/.test(b)&&(b=parseInt(b,10),0<=b&&128>=b&&(a=b))}return a},Wa=function(b){var a="";b&&(Q.CACHE.conf.network&&Q.CACHE.conf.network[b])&&(a=Q.CACHE.conf.network[b].label);return a},Na=function(b,a){var c=$("<tr></tr>");b&&(a&&a.stp&&a.link)&&c.prop("id","r-port-"+b).addClass("light-row").append($("<td></td>").addClass("w75").append($("<span></span>").prop("id","m-port-"+b).addClass("ui-icon ui-icon-wrench action triggerIcon actionPort ui-corner-all"))).append($("<td></td>").addClass("alignLeft").append(a.label)).append($("<td></td>").addClass("alignLeft").append(Wa(a.bridge))).append($("<td></td>").addClass("alignLeft").append(h("configsys.network.rstprole."+
a.stp.role))).append($("<td></td>").addClass("alignLeft").append(h("configsys.network.stpstate."+a.stp.state))).append($("<td></td>").addClass("alignLeft").append(h("configsys.network.linkstate."+a.link.state))).append($("<td></td>").addClass("alignLeft").append(a.link.uptime)).append($("<td></td>").addClass("alignLeft").append(h(a.enabled?"diagAndTable.enabled":"diagAndTable.disabled")));return c},ya=function(){var b=Q.CACHE.conf.network,a=y("portTbl");if(b&&a){a.find("thead").append(N("T-portTableHeader").find("tr"));
for(var c in b)b.hasOwnProperty(c)&&"port"===b[c].type&&a.find("tbody").append(Na(c,b[c]))}return a},Ua=function(){$("#portTbl").on("click","span.actionPort",function(a){a.preventDefault();$("[id^=status-]").html("&nbsp;");$(this).blur();b("network.eventHandlerPortMod...");try{var c=$(this).attr("id"),f=c.split("-");if(f&&3===f.length){var d=f[2];switch(f[0]){case "m":x(c,!0),Q.CACHE.opId=d,rb(),$("#dialog-port-modify").dialog("open")}}else throw"invalid ele parameter";}catch(e){b("error. network.eventHandlerPortMod: "+
e)}})},db=function(a){b("network.portModify...");var c=function(c,f,d){c?0===c.retCode?F("/api/conf/network",!1,function(a,c,f){a?0===a.retCode&&(Q.CACHE.conf.network=a.data,$("#portTbl-group").replaceWith(ya()),H(Q.USER.lang),G("portTbl"),Ua(),$("[id^=m-port-]").attr("title",h("diagAndTable.mod"))):b("error. network.portModify::innerCB: "+$.stringify(f))},null,"get",null,null):void 0!==c.retCode&&0<c.retCode&&v(Q.DIALOG_ERROR,w(c.retCode)):b("error. network.portModify: "+$.stringify(d));x("m-port-"+
Q.CACHE.opId,!1);Q.CACHE.opId=null;$(a).dialog("close")},f={path:"/api/conf/network/"+Q.CACHE.opId,cmd:"set",data:{label:{value:$("#portMod-label").val(),error:d,reset:m,data:"portMod-label"},enabled:{value:s($("#portMod-enabled").val()),error:d,reset:m,data:"portMod-enabled"}}},e={path:"/api/conf/network/"+Q.CACHE.opId+"/stp",cmd:"set",data:{cost:{value:K($("#portMod-stpCost").val()),error:d,reset:m,data:"portMod-stpCost"}}},g=function(){if(!A(f.path,f.cmd,!0))p(g,!0);else if(!f||M(f)){var b=E(f);
if(!Z()&&!aa()){if(!M(e))return;b.stp=E(e)}F(f.path,!0,c,null,f.cmd,null,$.stringify(b))}};g()},fb=function(){var b=$("<div></div>"),a=$("<tr></tr>").addClass("padrow").append($("<td></td>")),c=Q.CACHE.conf.network[Q.CACHE.opId];if(c&&c.stp){var f=h("configsys.network.type."+c.type),d=h("configsys.network.rstprole."+c.stp.role),e=h("configsys.network.stpstate."+c.stp.state);b.prop("id","dialog-port-modify").prop("title",h("diagAndTable.mod")).append($("<table></table>").prop("id","portMod").addClass("form-table center").prop("cellspacing",
1).prop("cellpadding",1).append($("<thead></thead>")).append($("<tbody></tbody>")));var g=null,g=Z()&&aa()?R(c.stp.cost,"configsys.network.stpCost"):O("portMod-stpCost","configsys.network.stpCost",!1,c.stp.cost);b.find("tbody").append(a.clone()).append(R(f,"alarms.type")).append(R(c.name,"common.name")).append(O("portMod-label","status.cfg.label",!1,c.label)).append(I("portMod-enabled","configsys.ldap.enabled",["true","false"],["diagAndTable.enabled","diagAndTable.disabled"],c.enabled?"true":"false",
!0)).append(R(d,"configsys.network.rstpRole")).append(R(e,"configsys.network.stpState")).append(g).append(a.clone());b.append($("<div></div>").addClass("status-portMod").append("&nbsp;"))}return $("<div></div>").append(b)},rb=function(){b("network.createDialogPortModify...");$("#dialog-port-modify").dialog().dialog("close").dialog("destroy").remove();T(fb().html(),{autoOpen:!1,resizable:!1,width:500,modal:!0,close:function(){Q.CACHE.opId&&(x("m-port-"+Q.CACHE.opId,!1),Q.CACHE.opId=null)},buttons:[{id:"dlg-btn-port-mod-save",
text:h("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");db(this)}},{id:"dlg-btn-port-mod-cancel",text:h("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]});H(Q.USER.lang);B("dialog-port-modify")};return W}(Q.log,Q.JQO.getPageWrapper,Q.JQO.getSection,Q.JQO.getFormGroup,Q.JQO.getFormOptionText,Q.JQO.getFormSubmit,Q.JQO.getSectionHeaderPlain,Q.JQO.getFormOptionLabel,Q.JQO.getFormOptionList,Q.util.strToBool,Q.util.fieldInputState,Q.getLocalStr,Q.dialogAlert,Q.util.getRetCodeMsg,
Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.util.fieldErrorTextResetAll,Q.validate.test,Q.validate.getApiData,Q.apiCall,Q.util.getOrderZeroInterfaceKey,Q.util.strToInt,Q.gotoPage,Q.getTemplate,Q.JQO.getFormTable,Q.util.fixTableRows,Q.localize,Q.util.setCacheValueByPath,Q.JQO.getDialogOptionText,Q.JQO.getDialogOptionList,Q.util.getCountMutableRoutes,Q.rowActionStyleUpdate,Q.createDialog,Q.apiCallDelete,Q.JQO.getDialogOptionLabel,Q.JQO.getDialogOptionPass,Q.util.getCidrFromSubnetMask,Q.JQO.passwordDialog,
Q.auth.accessControlNormal,Q.auth.accessTest,Q.auth.handleInvalidSession,Q.auth.passwordInputSet,Q.auth.passwordInputGet,Q.dialogLogin);Q.webserver=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u,K,D,N,y,G,H,P,O,I,J){var x={},T=function(){var a="",c=window.location.protocol,f=window.location.hostname;Q.CACHE.opBuf?"https:"===c&&Q.CACHE.opBuf.httpEnabled!==Q.CACHE.conf.http.httpEnabled&&Q.CACHE.opBuf.httpPort===Q.CACHE.conf.httpPort&&Q.CACHE.opBuf.httpsPort===Q.CACHE.conf.httpsPort?(Q.ping.stopUpdatePing(),Q.CACHE.conf.http=Q.CACHE.opBuf,Q.CACHE.opBuf=null,setTimeout(Q.ping.initUpdatePing,6E3)):"http:"===c&&!1===Q.CACHE.opBuf.httpEnabled||
"http:"===c&&Q.CACHE.conf.http.httpPort!==Q.CACHE.opBuf.httpPort||"https:"===c&&Q.CACHE.conf.http.httpsPort!==Q.CACHE.opBuf.httpsPort?("http:"===c?Q.CACHE.opBuf.httpEnabled?(a=c+"//"+f,a+=80!==Q.CACHE.opBuf.httpPort?":"+Q.CACHE.opBuf.httpPort:""):(a="https://"+f,a+=443!==Q.CACHE.opBuf.httpsPort?":"+Q.CACHE.opBuf.httpsPort:""):"https:"===c&&(a=c+"//"+f,a+=443!==Q.CACHE.opBuf.httpsPort?":"+Q.CACHE.opBuf.httpsPort:""),a+="/"+window.location.hash,Q.ping.stopUpdatePing(),setTimeout(function(){var b=$("<div></div>");
b.prop("style","text-align:left;").append(d("configsys.redirect")).append($("<p></p>").append("&nbsp;")).append($("<p></p>").append($("<a></a>").prop("href",a).append(a)));l(Q.DIALOG_SUCCESS,$("<div></div>").append(b).html());$(".ui-dialog-buttonpane").replaceWith($("<br>"))},3E3)):(Q.CACHE.conf.http=Q.CACHE.opBuf,Q.CACHE.opBuf=null):b("error. Q.webserver.redirectIfNecessary: Q.CACHE.opBuf is null.")},U=function(){var b=e(""),c=t("");c.find("fieldset").append(s("http-enabled","configsys.http.interface",
["true","false"],["diagAndTable.enabled","diagAndTable.disabled"])).append(a("http-port","configsys.http.httpPort")).append(a("https-port","configsys.http.httpsPort")).append(h("setHttp","diagAndTable.save","http"));b.find("blockquote").append(v("httpHelp","configsys.http.note1")).append(c);return b},R=function(){b("webserver.setHttp");var a=function(a,c,f){a?0===a.retCode?($("[id^=status-]").html("&nbsp;"),$("#status-http").removeClass("status-error").addClass("status-success").html(d("success")),
T()):(a.retCode===Q.RETCODE.NOT_AUTHORIZED?l(Q.DIALOG_ERROR,d("err.notAuthorized")):l(Q.DIALOG_ERROR,k(a.retCode)),Q.CACHE.opBuf=null):(b("jqXHR = "+$.stringify(f)),Q.CACHE.opBuf=null)},c=m($("#http-enabled").val()),f={path:"/api/conf/http",cmd:"set",access:G(),data:{httpsPort:{value:B($("#https-port").val()),error:M,reset:E,data:"https-port"},httpEnabled:{value:c,error:M,reset:E,data:"http-enabled"}}},e={data:{httpPort:{value:B($("#http-port").val()),error:M,reset:E,data:"http-port"}}};c&&$.extend(!0,
f,e);var g=function(){if(!I(f.path,f.cmd,!0))J(g,!0);else if(!f||F(f)){var b=u(f);Q.CACHE.opBuf=b;q(f.path,!0,a,null,f.cmd,null,$.stringify(b))}};g()},z=function(){$("#setHttp").on("click",function(){$("[id^=status-]").html("&nbsp;");R();$(this).blur()});$("#http-enabled").on("change",function(){var b=$(this).val();w("http-port",b)})},V=function(){var b=Q.USER&&Q.USER.authToken?Q.USER.authToken:"",c=e(""),f=t(""),d=K("T-fileUploadForm");d.prop("id","sslcertForm");d.prop("action","transfer/sslcert?token="+
b);D()||c.find("blockquote").append(v("fileNote","configsys.firmware.sslDisabled"));f.find("fieldset").append(N("sslcertfile","configsys.sslcert.file","file")).append(a("sslcertpassword","common.password","password")).append(h("setSslcert","diagAndTable.submit","sslcert"));d.append(f);c.find("blockquote").append(d);return c},Y=function(){b("webserver.sslCertAddEventHandlers");$("#sslcertpassword").on("focus",function(){$(this).blur();y(P("sslcertpassword"),function(b){O("sslcertpassword",b)},function(b,
a){return!0})});$("#sslcertForm").submit(function(a){var c=new FormData($(this)[0]),f=$("#sslcertpassword").val()||"";f===d("xxx.passwordNone")&&(f="");c.append("password",f);a.preventDefault();Q.ping.stopUpdatePing();$.ajax({url:$(this).attr("action"),type:$(this).attr("method"),data:c,processData:!1,contentType:!1,success:function(a,c,f){try{b("webserver.sslcertUploadSuccess...");c=null;try{c=$.parseJSON(a)}catch(e){}if(c&&0===c.retCode)$("#status-sslcert").removeClass("status-error").addClass("status-success").html(d("success"));
else if(c&&c.retCode){var g=d("retCode."+c.retCode);g||(g=d("error"));$("#status-sslcert").removeClass("status-success").addClass("status-error").html(g)}}catch(h){b("error. webserver.sslcertUploadSuccess: "+h)}setTimeout(Q.ping.initUpdatePing,1E4)},error:function(b,a,c){(b=d("configsys.firmware.transferError")||"")&&(b=a&&c?b.replace("$1",a+" - "+c):d("error"));$("#status-sslcert").removeClass("status-success").addClass("status-error").html(b);Q.ping.initUpdatePing()}});return!1});$("#setSslcert").on("click",
function(){$("[id^=status-]").html("&nbsp;");if(D())if(""===$("#sslcertfile").val())b("no file selected"),$("#status-sslcert").removeClass("status-success").addClass("status-error").html(d("configsys.sslcert.nofile"));else{var a=function(){I("/transfer/sslcert","upload",!0)?($("#setSslcert").blur(),$("#sslcertForm").prop("action","transfer/sslcert?token="+Q.USER.authToken).submit()):J(a,!0)};a()}})},X=function(){var b=g();b.append(n("menu.http")).append(U());Q.CACHE.capability.sslcert&&Q.CACHE.capability.sslcert.show&&
b.append(n("configsys.sslcert.sslcert")).append(V());return b};x.getPageWebserver=function(){b("webserver.getPageWebserver...");try{q("/api/conf/http",!0,function(a,f,d){a&&0===a.retCode?(null===Q.CACHE.conf&&(Q.CACHE.conf={}),a.data&&(Q.CACHE.conf.http=a.data),$("#loading").replaceWith(""),$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),$("#content-pane").append(X()),c(Q.USER.lang),b("webserver.initHttp"),(a=Q.CACHE.conf&&Q.CACHE.conf.http?Q.CACHE.conf.http:null)?(f=a.httpEnabled?
"true":"false",$("#http-enabled").val(f),$("#http-port").val(a.httpPort),$("#https-port").val(a.httpsPort),w("http-port",f)):b("webserver.initHttp: no data"),z(),Q.CACHE.capability.sslcert&&Q.CACHE.capability.sslcert.show&&(H("sslcertpassword",""),D()||(w("sslcertfile",!1),w("sslcertpassword",!1),w("setSslcert",!1)),Y())):(b("error. webserver.getPageWebserver: get conf/http failed"),l(Q.DIALOG_ERROR,"/api/conf/http: "+k(a.retCode)))},null,"get",null,null)}catch(a){b("error. webserver.getPageWebserver: "+
a)}};return x}(Q.log,Q.JQO.getPageWrapper,Q.JQO.getSectionHeaderPlain,Q.dialogAlert,Q.util.getRetCodeMsg,Q.apiCall,Q.localize,Q.JQO.getSection,Q.JQO.getFormGroup,Q.JQO.getFormOptionList,Q.JQO.getFormOptionText,Q.JQO.getFormSubmit,Q.JQO.getFormHelpText,Q.util.fieldInputState,Q.getLocalStr,Q.util.strToBool,Q.util.strToInt,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.validate.test,Q.validate.getApiData,Q.getTemplate,Q.util.firmwareCanUpdate,Q.JQO.getFormOptionFile,Q.JQO.passwordDialog,Q.auth.accessControlNormal,
Q.auth.passwordInputInit,Q.auth.passwordInputGet,Q.auth.passwordInputSet,Q.auth.accessTest,Q.dialogLogin);Q.overview=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u,K,D,N,y,G,H,P,O,I,J,x,T,U,R,z,V,Y,X,A,L,f){var r={},p={system:{point:"lowPressAlarm lowPressureSensorFailAlarm highPressAlarm highPressureSensorFailAlarm highWaterLevelAlarm waterUnderFloorAlarm eevCommunicationFailAlarm lpFrequentlyAlarm hpFrequentlyAlarm remoteShutDownAlarm ==break== controllerVersion newAlarmFlag firstOnFlag hmiShutDownFlag coolingFlag remoteShutDownFlag alarmNumbers historyAlarmNumbers commonAlarmOutputState remoteShutdown runState monitorAddress monitorBaudrate lp filterMaintenanceRemind softwareShutDownStatus highWaterLevelInput hpAbnormalRecordCount eevOpened".split(" "),
conf:"commonAlarmOutputDirection remoteShutdownAlarmSetting hpAlarmSetting hpSensorFailAlarmSetting hpFrequentlyAlarmSetting hpAbnormalAlarmSettingValue lpAlarmSetting lpSensorFailAlarmSetting lpFrequentlyAlarmSetting eevCommunicationFailAlarmSetting highWaterLevelAlarmSetting ==break== modelSelect deadBand vacuumState controlMode monitorShutDownFlag remoteShutdownInput firstOnPassword manualRunEnable onOffSwitch lpdt eevShtSettingMin eevShtSettingMax eevMopPressureSetting eevValveCloseShtSetting filterMaintenanceSetting filterMaintenanceRemindSetting filterMaintenanceRemindTime systemTimeYear systemTimeMonth systemTimeDay systemTimeHour systemTimeMin systemTimeSec".split(" ")},
supply0:{point:["lowSupplyTemperatureAlarm","highSupplyTemperatureAlarm","supplyTemperatureSensorFailAlarm"],conf:"supplyLowTemperatureAlarmSetting supplyLowTemperatureAlarmSettingValue supplyHighTemperatureAlarmSetting supplyHighTemperatureAlarmSettingValue supplyTemperatureSensorFailAlarmSetting ==break== supplyTemperatureSetting supplyTemperatureCalibrationValue".split(" ")},return0:{point:["highReturnTemperatureAlarm","returnTemperatureSensorFailAlarm"],conf:"returnHighTemperatureAlarmSetting returnHighTemperatureAlarmSettingValue returnTemperatureSensorFailAlarmSetting ==break== returnOilRunCapacity returnOilRunTime returnOilCycle returnTemperatureSetting returnTemperatureCalibrationValue".split(" ")},
discharge0:{point:["dischargeHighTemperatureAlarm","dischargeHighTemperatureFrequentlyAlarm","dischargeTemperatureSensorFailAlarm"],conf:"dischargeHighTemperatureAlarmSetting dischargeHighTemperatureFrequentlyAlarmSetting dischargeTemperatureSensorFailAlarmSetting ==break== dischargeTemperatureCalibrationValue dischargePressureCalibrationValue".split(" ")},suction0:{point:["suctionTemperatureSensorFailAlarm","==break==","suctionSuperHeatTemperature"],conf:["suctionTemperatureSensorFailAlarmSetting",
"==break==","suctionPressureCalibrationValue"]},power0:{point:["lowVoltagePowerAlarm","highVoltagePowerAlarm","lossOfPowerAlarm","lossOfPhasePowerAlarm","powerFrequencyErrorAlarm"],conf:"lowPowerVoltageAlarmSetting highPowerVoltageAlarmSetting lossOfPowerAlarmSetting powerFrequencyErrorAlarmSetting ==break== powerLowVoltageSettingValue powerHighVoltageSettingValue".split(" ")},compressor0:{point:"compressorFaultLockAlarm compressorDriverCommunicationFailAlarm ==break== compressorStartStopCount compressorRunTimeHours compressorDriverFaultU00 compressorDriverFaultU01 compressorDriverFaultU02 compressorDriverFaultU03 compressorDriverFaultU04 compressorDriverFaultU05 compressorDriverFaultU06 compressorDriverFaultU07 compressorDriverFaultU08 compressorDriverFaultU09 compressorDriverFaultU10 compressorDriverFaultU11 compressorDriverFaultU12 compressorDriverFaultU13 compressorDriverFaultU14 compressorDriverFaultU15".split(" "),
conf:"compressorFaultLockAlarmSetting compressorDriverCommunicationFailAlarmSetting compressorDriverFaultAlarmSetting ==break== compressorOutputStatus compressorOutputDeadBand compressorStartCfc compressorStopCfc compressorMinRunTime compressorMinStopTime compressorCapacityOutputValue compressorStandardCapacity compressorMinCapacity compressorStartCapacity compressorTemperatureD compressorTemperatureI compressorTemperatureP compressorJumpBand1 compressorJumpBand2 compressorJumpBand3 compressorJumpBand4 compressorJumpBand5 compressorJumpFrequency1 compressorJumpFrequency2 compressorJumpFrequency3 compressorJumpFrequency4 compressorJumpFrequency5".split(" ")},
infan0:{point:["infanRunTimeHours","infanStartStopCount"],conf:"infanStandardSpeed infanMinSpeed infanLowSpeedStep infanHighSpeedStep infanReduceSpeedDelayTime infanStopDelayTime infanStartDelayTime infanOutputStatus infanStandardCfc infanMinCfc infanTemperatureD infanTemperatureI infanTemperatureP infanJumpBand1 infanJumpBand2 infanJumpBand3 infanJumpBand4 infanJumpBand5 infanJumpFrequency1 infanJumpFrequency2 infanJumpFrequency3 infanJumpFrequency4 infanJumpFrequency5".split(" ")},outfan0:{point:[],
conf:["fanSpeed","outFanPressureSetting","outFanStartPressure","outFanMinPowerVoltage","outFanMaxPowerVoltage"]}},W=function(b,a){var c="";"string"!==typeof b&&(b="");"object"!==typeof a&&(a={});if(a.relayFailure)c=g("error");else switch(b){case "normal":case "on":case "on2off":case "rebootOff":case "latchedOn":c=g("state.on");break;case "unavailable":case "unplugged":case "off":case "off2on":case "rebootOn":case "latchedOff":c=g("state.off")}return c},S=function(b,a){var c=1===Object.keys(a).length?
"statusHdr w200":"statusHdr",f=b?b.clone():null,d=$.extend({},a);$.each(Q.MEASUREMENT_ORDER,function(b,a){if(a in d){var e=n(a,"name"),g=n(a,"units");f&&e&&(e=e.replace(" ","<br>"),g?(g=g.replace("rms","<sub>RMS</sub>"),f.append($("<th></th>").addClass(c).append(e+"<br>("+g+")"))):f.append($("<th></th>").addClass(c).append(e)));delete d[a]}});f&&$.each(d,function(b,a){f.append($("<th></th>").addClass(c).append(a))});return f},Z=function(b,a,c){var f=$("<tr></tr>");f.addClass("table-header");var d=
function(b){var a=0,c=0;$.each(b,function(b,f){"label"in f.dev?a+=1:c+=1});return a>c},e=function(b){var a=0,c=0;$.each(b,function(b,f){if("5V"===f.dev.type||"10V"===f.dev.type||"binary"===f.dev.type)"mode"in f.dev?a+=1:c+=1});return a>c};b&&a&&(f.append($("<th></th>").addClass("w50 statusHdr").prop("colspan",2).append(g("status.header.state"))),f.append($("<th></th>").addClass("w65 statusHdr").append("&nbsp;")),b=d(c)?"status.header.label":"common.name",f.append($("<th></th>").addClass("alignLeft w200 statusHdr").append(g(b))),
e(c)&&f.append($("<th></th>").addClass("alignLeft statusHdr w250").append(g("status.cfg.mode"))),f=S(f,a),f.append($("<th></th>").append("&nbsp;")));return f},aa=function(b,a,c,f,d,e,g,p,r){a=$("<thead></thead>");(b=Z(b,p,r))&&(p=b.find("th").length)&&3<=p&&a.append(b);return a},ja=function(b,a,c,f,d,e){b=b%2?"dark-row":"light-row";var g="",p="",g=null;a&&(c&&f)&&(g=sa(f.state,{timeToAction:f.timeToAction,relayFailure:f.relayFailure}),p=ma(f.alarm,null,!0),g=-1!==d.search("-analog-")?$a(d,b,c,g,p,
f,a):-1!==d.search("-relay-")?ab(d,b,c,g,p,f,a):-1!==d.search("-outlet-")?kb(d,b,c,g,p,f,a):cb(d,b,c,g,p,f,a,e));return g},da=function(b,a,c){var f=$("<tbody></tbody>");if(b)for(var d=0;d<b.length;d++)f.append(ja(d,c,b[d].level,b[d].dev,b[d].path,a.type));return f},ba={},ca=function(b){var a=$("<span></span>").addClass("ui-icon").addClass("ui-corner-all").addClass("statusspan");b?a.addClass("ui-icon-close white").addClass("action-disabled").css("background-color","#d62407").attr("title",g("alarms.alarm")):
a.addClass("ui-icon-check").attr("title",g("diagAndTable.ok"));return a},ka=function(a,c,f){var d=$("<table></table>");d.prop("id","vrc-"+a+"-"+c+"-pointTable");var e=$("<tr></tr>"),r=$("<td></td>").addClass("w115").append("&nbsp;"),h=$("<td></td>").addClass(" w250 alignLeft"),k=$("<td></td>").addClass("w75 center"),C=$("<td></td>").append("&nbsp;"),A=$("<td></td>").prop("colspan","4").append($("<hr>"));if(f){var m=p[c]&&p[c].point?p[c].point:null;if(!m)return"";var l=0,L=null,S=null,n=null;void 0===
ba[a]&&(ba[a]={});for(var W in m){var x=m[W];if("==break=="===x)null!==L&&(L.append(h.clone()).append(k.clone()).append(C.clone()),d.append(L)),W<m.length&&(L=e.clone().append(r.clone()).append(A.clone()).append(C.clone()),d.append(L),L=null),l=0;else{if(!f[x])return b("error. overview.getVRCPointTable: order key not found in API data: "+x),"";l+=1;S=h.clone().append(g("vrc."+x));-1!==x.search(/^.*Alarm$/)&&"boolean"===typeof f[x].value?(!0===f[x].value&&(ba[a][c]=!0),n=k.clone().append(ca(f[x].value))):
n=k.clone().append(""+f[x].value);n.prop("id","vrc-"+a+"-"+(c?c+"-":"")+x);l%2?L=e.clone().append(r.clone()).append(S).append(n):(L.append(S).append(n).append(C.clone()),d.append(L),L=null)}}null!==L&&(L.append(h.clone()).append(k.clone()).append(C.clone()),d.append(L));l&&d.append(e.clone().append(r.clone()).append(h.clone()).append(k.clone()).append(h.clone()).append(k.clone()).append(C.clone()))}else return b("error. overview.getVRCPointTable: no data"),"";return d},ga=function(b){var a=$("<img></img>");
a.prop("id",b+"-showHide").prop("title",g("common.showHide")).prop("width","18").prop("height","18").addClass("action ui-corner-all").prop("src","images/up.png");return a},ea=function(b,a,c){var f="vrc-"+b+"-entity-"+a,d=$("<tr></tr>"),e=$("<td></td>"),p=oa(c);d.prop("id",f).addClass("level1 light-row devRow").append(e.clone().prop("id",f+"-state").addClass("w25 alignRight").append($("<span></span>").addClass("ui-icon").addClass("statusspan").addClass("ui-icon-check"))).append(e.clone().prop("id",
f+"-alarm").addClass("w25 alignLeft").append(ma(p,null,!0)));"outdoor0"!==a?d.append(e.clone().append($("<span></span>").prop("id",f+"-cfg").prop("title",g("diagAndTable.config")).addClass("ui-icon ui-icon-wrench action actionFloat ui-corner-all"))):d.append(e.clone().append($("<span></span>").append("&nbsp;")));d.append(e.clone().addClass("alignLeft labelCol").append($("<span></span>").prop("id",f+"-label").append(c.label?c.label:c.name)));f=$("<div></div>");p=!0;if(c.measurement&&c.measurement["0"])for(var r in c.measurement){var h=
"",k=c.measurement[r].type,C="",A=c.measurement[r].units,m="",l=c.measurement[r].value,l=$("<span></span>").prop("id","vrc-"+b+"-entity-"+a+"-measurement-"+r).text(l),L=ma(c.measurement[r].alarm,null,!0);L&&(L=$(L),L.hasClass("ui-icon-alert")?l.addClass("alarm"):L.hasClass("ui-icon-notice")&&l.addClass("warning"));Q.CACHE.meastypes[k]&&(C=g(Q.CACHE.meastypes[k].name));Q.CACHE.meastypes[A]&&(m=g(Q.CACHE.meastypes[k].units));p||(h+=", ");h+=C?C:k;h+=" (";h+=m?m:A;h+="): ";f.append(h);f.append(l);p=
!1}d.append(e.clone().addClass("alignLeft").append(f));d.append(e.clone().addClass("center").append(Object.keys(c.point).length?ga("vrc-"+b+"-"+(a?a:"system")):"&nbsp;"));return d},la=function(b,a,c,f){f="vrc-"+b;a=$("<tbody></tbody>");a.append($("<tr></tr>").prop("id",f).addClass("level1 light-row devRow").append($("<td></td>").prop("id",f+"-state").addClass("w25 alignRight").append($("<span></span>").addClass("ui-icon").addClass("statusspan").addClass("ui-icon-check").attr("title",g("diagAndTable.ok")))).append($("<td></td>").prop("id",
f+"-alarm").addClass("w25 alignLeft").append("&nbsp;")).append($("<td></td>").append($("<span></span>").prop("id",f+"-cfg").prop("title",g("diagAndTable.config")).addClass("ui-icon ui-icon-wrench action actionFloat ui-corner-all"))).append($("<td></td>").addClass("alignLeft labelCol").append($("<span></span>").prop("id",f+"-label").append(g("menu.system")))).append($("<td></td>").append("&nbsp;")).append($("<td></td>").addClass("center").append(ga("vrc-"+b+"-system"))));a.append($("<tr></tr>").append($("<td></td>").prop("colspan",
12).append(ka(b,"system",c.point))));f=[];for(var d=0;d<c.layout["0"].length;d++)f.push(c.layout["0"][d].replace("entity/",""));for(d=0;d<f.length;d++)a.append(ea(b,f[d],c.entity[f[d]])),a.append($("<tr></tr>").append($("<td></td>").prop("colspan",12).append(ka(b,f[d],c.entity[f[d]].point))));return a},ha=function(b,a,c,f,d,e,p,r,h,k){if(k&&"vrc"===f)return a=$("<div></div>").addClass("table-wrapper ui-corner-all"),a.append($("<table></table>").prop("id","devStatus-"+b).prop("cellspacing",5).prop("border",
0).prop("bgcolor","#dddddd").append($("<thead></thead>").append($("<tr></tr>").addClass("table-header").append($("<th></th>").addClass("w50 statusHdr").prop("colspan",2).append(g("status.header.state"))).append($("<th></th>").addClass("w65 statusHdr").append("&nbsp;")).append($("<th></th>").addClass("w200 alignLeft statusHdr").append(g("common.name"))).append($("<th></th>").addClass("alignLeft statusHdr").append("&nbsp; ")).append($("<th></th>").addClass("w25 center statusHdr").append("&nbsp;")))).append(la(b,
h,k,r))),a;var C=$("<div></div>").addClass("table-wrapper ui-corner-all");C.append($("<table></table>").prop("id","devStatus-"+b).prop("cellspacing",5).prop("border",0).prop("bgcolor","#dddddd").append(aa(b,a,c,f,d,e,p,r,h)).append(da(h,k,r)));return C},ia=function(b,a,c,f,d,e){c="";f&&f!==a?c=f:a&&(c=a);a=c;f=$("<div></div>");f.prop("id","devHeader-"+b).addClass("section-header");c=$("<div></div>").addClass("section-header-actions");c.append($("<span></span>").prop("id",b+"-cfg").addClass("ui-icon ui-icon-wrench action actionFloat ui-corner-all").prop("title",
g("diagAndTable.config")));Da(b)&&c.append($("<span></span>").prop("id",b+"-opn").addClass("ui-icon ui-icon-gear action actionFloat ui-corner-all").prop("title",g("diagAndTable.oper")));(0<e||null===e)&&c.append($("<span></span>").prop("id",b+"-del").addClass("ui-icon ui-icon-trash action actionFloat ui-corner-all").prop("title",g("diagAndTable.delete")));f.append($("<div></div>").addClass("section-header-tab ui-corner-top").append(c).append($("<div></div>").prop("id",b+"-label").addClass("section-header-title").append(l(a))));
f.append($("<div></div>").prop("id",b+"-statusbar").addClass("section-header-info ui-corner-tr").append($("<span></span>").addClass("ui-icon ui-icon-none white")).append($("<span></span>").addClass("message")).append($("<span></span>").addClass("section-header-serial").append(g("info.deviceId")+" "+b)));return f};r.getDeviceOverviewSection=function(a,c){var f=$("<div></div>"),d=null,e=null,g=null,p=null,r=null,h=null,m=null,A=null,l=d=null,L=null;if(a&&c&&(d=c.layout,$.isEmptyObject(d)&&(d={0:"."}),
d)){g=c.name?c.name:"";p=c.label?c.label:"";m=c.state?c.state:"unavailable";A=c.alarm?c.alarm:null;r=c.type?c.type:null;l=c.order?c.order:null;a:{try{if(!d||!c){b("error. overview.getDeviceByLayout: Invalid or missing parameters.");L=[];break a}var e=[],h=[],S=[],n="",x=null,W,fa;if(!d["0"]||"."===d["0"]){var h=[],q;for(q in c.measurement)c.measurement.hasOwnProperty(q)&&(n=a+"-measurement-"+q,x=c.measurement[q],S.push({level:1,dev:x,path:n}));for(W=0;W<Q.MEASUREMENT_ORDER.length;W++){var I=Q.MEASUREMENT_ORDER[W];
for(fa=0;fa<S.length;fa++)S[fa].dev.type===I&&h.push(S[fa])}e.push(h);L=e;break a}var J=Aa(d),Y;for(Y in J)if(J.hasOwnProperty(Y)){var Z=d[J[Y]],h=[];if(Z&&"[object Array]"===Object.prototype.toString.call(Z))for(W=0;W<Z.length;W++){var z=Z[W].split("/"),x=null;1===z.length?(n=a+"-"+z[0],x=c[z[0]]):2===z.length&&(n=a+"-"+z[0]+"-"+z[1],x=c[z[0]][z[1]]);if(x){h.push({level:1,dev:x,path:n});for(var t in d)if(d.hasOwnProperty(t)&&t===Z[W]){var s=d[t];if(s&&"[object Array]"===Object.prototype.toString.call(s))for(fa=
0;fa<s.length;fa++){var v=s[fa].split("/");q=null;1===v.length?(n=a+"-"+v[0],q=c[v[0]]):2===v.length&&(n=a+"-"+v[0]+"-"+v[1],q=c[v[0]][v[1]]);if(q){h.push({level:2,dev:q,path:n});for(var ta in d)if(d.hasOwnProperty(ta)&&ta===s[fa]){var oa=d[ta];if(oa&&"[object Array]"===Object.prototype.toString.call(oa))for(q=0;q<oa.length;q++){var X=oa[q].split("/"),I=null;1===X.length?(n=a+"-"+X[0],I=c[X[0]]):2===X.length&&(n=a+"-"+X[0]+"-"+X[1],I=c[X[0]][X[1]]);I&&h.push({level:3,dev:I,path:n})}}}}}}}e.push(h)}L=
e;break a}catch(w){b("error. overview.getDeviceByLayout: "+w)}L=void 0}f.append(ia(a,g,r,p,A,l));d=k("");d.prop("id","devBody-"+a);W=!0;for(var u in L)L.hasOwnProperty(u)&&(e=L[u],h=C(e),W||d.find("blockquote").append($("<div></div>").addClass("tableSpacer")),d.find("blockquote").append(ha(a,g,p,r,m,A,l,h,e,c)),W=!1);f.append(d)}return f};var pa=function(a){var c={},f;a&&"object"===typeof a&&$.each(a,function(a,d){(f=d.type)&&Q.CACHE.meastypes[f]?c[f]=Q.CACHE.meastypes[f].units:b('error. overview:getMeasTypesFromMeasurements: type "'+
f+'" not in meastypes')});return c},C=function(b){var a,c,f,d={};$.each(b,function(b,e){c="string"===typeof e.path&&e.path||"";q(c)?f={value:g("status.value")}:-1!==c.search("relay")?f={}:(a=e.dev&&e.dev.measurement||{},f=pa(a));f&&$.extend(d,f)});return d},fa=function(b){var a=[],c=$.extend({},b);$.each(Q.MEASUREMENT_ORDER,function(b,f){f in c&&(a.push(f),delete c[f])});$.each(c,function(b){a.push(b)});return a},Aa=function(b){var a=[],c;for(c in b)b.hasOwnProperty(c)&&$.isNumeric(c)&&a.push(c);
a.sort(function(b,a){return b-a});return a},Da=function(b){var a=!1;b=Ab(b);$.each(b,function(b,c){if(!0===c)return a=!0,!1});return a},ua=function(){var b=Q.CACHE.dev||null;if(b)for(var a in b)if(b.hasOwnProperty(a)){var f=b[a];if(f){var d=$.extend({},f.alarm),f=c(f.state);Ea(a+"-statusbar",d,f)}}},Ia=function(b,a,c,f,d,e){if(b&&a){var g=b+"-"+(e||"measurement")+"-"+a;b="r-"+g;a=g+"-state";e=g+"-alarm";qa(c)&&$("#"+g).text(c);d&&(c=wa(d),$("#"+b).removeClass("alarm warning strong").addClass(c),$("#"+
a).empty().append(sa(f)),$("#"+e).empty().append(ma(d,null,!0)))}},Ma=function(){try{var c=e(),f=Q.CACHE.dev?Q.CACHE.dev:null,d=t();if(f&&d)for(var g=0;g<d.length;g++){var p=d[g],h=r.getDeviceOverviewSection(p,f[p]);c.append(h.find(".section-header"));c.append(h.find(".section-body"))}$("#loading").replaceWith("");$(".section-header").replaceWith("");$(".section-body").replaceWith("");$("#content-pane").append(c);s(Q.USER.lang);ua();va(Q.UPDATE_INTERVAL);nb();Ob();La();var k=$("blockquote");k.on("click",
'td[id$="-alarm"]',function(b){b.stopPropagation();b=$(this).find("span");!b||(!b.hasClass("ui-icon")||b.hasClass("ui-icon")&&b.hasClass("ui-icon-none"))||a(Q.PAGES.ALARMS)});k.on("click","span.action",function(b){var a=null;b.stopPropagation();-1!==$(this).attr("id").search("-cfg")?(a=$(this).attr("id")||"",a=a.replace("-cfg",""),a.replace(/-/g,"/"),pb(this)):-1!==$(this).attr("id").search("-opn")?(a=$(this).attr("id")||"",a=a.replace("-opn",""),a.replace(/-/g,"/"),Mb(this)):-1!==$(this).attr("id").search("-del")&&
(a=$(this).attr("id")||"",a=a.replace("-del",""),Q.CACHE.opId=a,$("#dialog-dev-del").dialog("open"),s(Q.USER.lang))});k.on("click",'img[id$="-showHide"]',function(b){b.stopPropagation();b=$(this).attr("id");var a=$(this).prop("src");b=b.replace("showHide","pointTable");a&&-1!==a.search("up")?($("#"+b).hide(),$(this).attr("src","images/down.png")):($("#"+b).show(),$(this).attr("src","images/up.png"))});$("img[id$=showHide]").click();for(var C in ba)for(var A in ba[C])ba[C][A]&&("system"===A?$("#vrc-"+
C+"-state").find("span").replaceWith(ca(!0)):$("#vrc-"+C+"-entity-"+A+"-state").find("span").replaceWith(ca(!0)),$("#vrc-"+C+"-"+A+"-showHide").click(),$.each($("[id$=-pointTable]"),function(b,a){$.each($(a).find("span.ui-icon-close"),function(b,a){-1===$(a).parent().prop("id").search(/^.*-state$/)&&$(a).parent().prev().addClass("vrcTextAlarmed")})}))}catch(m){b("error. overview.initPageOverview: "+m)}};r.getPageOverview=function(){b("overview.getPageOverview...");try{null===Q.CACHE.dev&&d(""),m("/api/dev",
!0,function(a,c,f){a&&0===a.retCode?a.data&&(Q.CACHE.dev=a.data,h(),Ma()):a?v(Q.DIALOG_ERROR,w(a.retCode)):(a.retCode===Q.RETCODE.SESSION_EXPIRED&&A(),b("/api/dev get: textStatus="+c+", jqXHR="+$.stringify(f)))},null,"get",null,null)}catch(a){b("error. overview.getPageOverview: "+a)}};var xa=null,ra=null;r.stopDevUpdatePing=function(){try{xa&&(clearInterval(xa),xa=null,ra&&(ra.abort(),ra=null))}catch(a){b("error. overview.stopDevUpdatePing: "+a)}};var Ca=function(a,f,d){var e=f="",g="";try{if(Q.PAGE!==
Q.PAGES.OVERVIEW)r.stopDevUpdatePing();else if(null!==xa)if(a&&0===a.retCode){if(a.data){Q.CACHE.dev=a.data;h();a.data=Q.CACHE.dev;for(var p in a.data)if(a.data.hasOwnProperty(p)&&(void 0===$("#devBody-"+p).val()&&(Q.CACHE.opBuf=p,m("/api/dev/"+p,!1,function(a,c,f){if(a&&0===a.retCode){c=null;f=Q.CACHE.opBuf;a.data&&(Q.CACHE.dev[f]=a.data,h(),c=Q.CACHE.dev[f]);var d=t();a=void 0;if(c&&d)for(var e=0;e<d.length;e++){var g=d[e],p=$("#devBody-"+d[e]);void 0!==p.val()&&(a=p);if(g===f){c=r.getDeviceOverviewSection(g,
c);void 0===a?$("#content-pane").find("> blockquote").prepend(c.find(".section-header"),c.find(".section-body")):(c.find(".section-body").insertAfter(a),c.find(".section-header").insertAfter(a));break}}}else a?b("error. overview.devUpdatePingCallback: retCode "+a.retCode):b("/api/dev get: textStatus="+c+", jqXHR="+$.stringify(f));Q.CACHE.opBuf=null},null,"get",null,null)),a.data[p])){var k=d=null;a.data[p].state&&(d=c(a.data[p].state));a.data[p].alarm&&(k=a.data[p].alarm);Ea(p+"-statusbar",k,d);if(a.data[p].measurement)for(var C in a.data[p].measurement)a.data[p].measurement.hasOwnProperty(C)&&
(f=a.data[p].measurement[C].value,e=a.data[p].measurement[C].state,g=$.extend({},a.data[p].measurement[C].alarm),qa(f)&&(Q.CACHE.dev[p].measurement[C].value=f),e&&(Q.CACHE.dev[p].measurement[C].state=e),g&&(Q.CACHE.dev[p].measurement[C].alarm=g),Ia(p,C,f,e,g));lb(p,a.data[p].entity);bb(p,a.data[p].outlet);Pa(p,a.data[p].relay);mb(p,a.data[p].analog);"vrc"===a.data[p].type&&Xa(p,a.data[p])}}}else a?b("error /api/dev: retCode="+a.data.retCode+", retMsg="+a.data.retMsg):b("error /api/dev: "+$.stringify(d))}catch(A){b("error. overivew.devUpdatePingCallback:"+
A)}},va=function(a){a=a&&"number"===typeof a&&5<a?a:Q.UPDATE_INTERVAL;b("overview.initDevUpdatePing => "+a+" seconds");try{r.stopDevUpdatePing(),xa=setInterval(function(){Q.PAGE!==Q.PAGES.OVERVIEW?r.stopDevUpdatePing():ra&&"resolved"!==ra.state()?b("overview: update overlap..."):ra=m("/api/dev",!0,Ca,null,"get",null,null)},1E3*a)}catch(c){b("error. overview.initDevUpdatePing: "+c)}},Ga=function(b,a){var c=["voltageMax","voltageMin","currentMax","currentMin"];a=a||{};b=b||{};$.each(b,function(b,f){var d=
f.type,e=Q.CACHE.meastypes,e=e&&e[d]&&e[d].units;"energy"!==d||"kWh"!==e&&"meas.units.kwHr"!==e?-1<$.inArray(d,c)&&(a.minmax=!0):a.energy=!0;if(a.minmax&&a.energy)return!1})},Ba=function(a){a=a.replace(/-...$/,"");for(var c=a.split("-"),f=Q.CACHE.dev,d=!1,e={energy:!1,minmax:!1},g=0;g<c.length;g++)if(f[c[g]])f=f[c[g]];else{d=!0;b("error. overview.hasMeasurementOps, id="+a);break}!d&&(f&&f.measurement)&&Ga(f.measurement,e);return e},sa=function(b,a){var c=null;"string"!==typeof b&&(b="");"object"!==
typeof a&&(a={});if(a.relayFailure)c=B(Q.STATE_ICON.off).prop("title",g("error")).addClass("ui-corner-all").css("background-color","orange").css("margin-bottom","2px");else switch(b){case "on":c=B(Q.STATE_ICON.on).prop("title",g("state."+b));break;case "off":c=B(Q.STATE_ICON.off).prop("title",g("state."+b));break;case "latchedOn":c=B(Q.STATE_ICON.latchedOn).prop("title",g("state."+b));break;case "latchedOff":c=B(Q.STATE_ICON.latchedOff).prop("title",g("state."+b));break;case "on2off":case "off2on":case "rebootOn":case "rebootOff":var c=
a.timeToAction||0,f=g("state."+b),f=f.replace("$1",c),c=B(Q.STATE_ICON.pending).prop("title",f);break;case "unavailable":case "unplugged":c=B(Q.STATE_ICON.error).prop("title",g("state."+b));break;default:c=B(Q.STATE_ICON.none)}return c},Ea=function(b,a,c){b&&("object"===typeof a&&($("#"+b+" .ui-icon").replaceWith(ma(a,"white").css("margin-top","0px")),M(b,a)),"string"===typeof c&&$("#"+b+" .message").html(c))},ma=function(a,c,f){var d=null,e=null,p=null,h;try{switch(h=a&&a.state||"none",h){case "tripped":"alarm"===
a.severity?(p="alarms.alarm",e="ui-icon-alert"):"warning"===a.severity&&(p="alarms.warning",e="ui-icon-notice");break;case "latched":"alarm"===a.severity?(p="status.alarmState.alarmLatched",e="ui-icon-alert"):"warning"===a.severity&&(p="status.alarmState.warnLatched",e="ui-icon-notice");break;case "acked":"alarm"===a.severity?(p="status.alarmState.alarmAck",e="ui-icon-check"):"warning"===a.severity&&(p="status.alarmState.warnAck",e="ui-icon-check");break;case "clear":p="alarms.clear";e=f?"ui-icon-radio-on":
"ui-icon-none";break;case "none":p="state.none";e="ui-icon-none";break;default:b("error. overview.getAlarmStateIcon: bad alarmState - "+a.state)}}catch(r){b("error. overview.getAlarmStateIcon: bad alarmState - "+r)}e&&(a="",p=g(p),a=a+"ui-icon"+(" "+e),"string"===typeof c&&(a+=" "+c),d=$("<span></span>"),d.addClass(a),d.prop("title",p));return d},qa=function(b){return"string"===typeof b||"number"===typeof b},oa=function(b){var a=-1,c={state:"none",severity:""},f=function(b){if(b){var f=0;"clear"===
b.state?f=1:"acked"===b.state?f="warning"===b.severity?2:3:"latched"===b.state?f="warning"===b.severity?4:6:"tripped"===b.state&&(f="warning"===b.severity?5:7);f>a&&(a=f,c.state=b.state,c.severity=b.severity)}};b&&(f(b.alarm),$.each(b.measurement||{},function(b,a){f(a.alarm)}));return c},ta=function(b){var a="";b.hasClass("ui-icon-alert")?a="alarm":b.hasClass("ui-icon-notice")&&(a="warning");return a},wa=function(a){var c="";a?"tripped"===a.state||"latched"===a.state?"alarm"===a.severity?c="alarm":
"warning"===a.severity?c="warning":b("error. overview.getAlarmStateTextStyle: bad severity - "+a.severity):"acked"===a.state?c="strong":"clear"===a.state||"none"===a.state?c="":b("error. overview.getAlarmStateTextStyle: bad state - "+a.state):b("error. overview.getAlarmStateTextStyle: missing alarm");return c},Za=function(a,c){try{var f=oa(c),d=ma(f,null,!0),e=ta(d);$("#"+a+"-alarm").html($("<div></div>").append(d).html());$("#"+a+"-label").removeClass().addClass(e)}catch(g){b("error. overview.subDevUpdateAlarmStateIcon: "+
g)}},$a=function(a,b,c,f,d,e,p){var h=$("<tr></tr>"),r=g("diagAndTable.config"),k=wa(e&&e.alarm||{});h.prop("id","r-"+a).addClass(b+" level"+c+" devRow "+k);h.append($("<td></td>").prop("id",a+"-state").addClass("w25 alignRight").append(f));h.append($("<td></td>").prop("id",a+"-alarm").addClass("w25 alignLeft").append(d));h.append($("<td></td>").append($("<span></span>").prop("id",a+"-cfg").prop("title",r).addClass("ui-icon ui-icon-wrench action actionFloat ui-corner-all")));b=V(e);h.append($("<td></td>").addClass("alignLeft labelCol").append(3===
c?"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;":2===c?"&nbsp;&nbsp;&nbsp;":"").append($("<span></span>").prop("id",a+"-label").append(l(b))));h.append($("<td></td>").addClass("alignLeft labelCol").append($("<span></span>").prop("id",a+"-mode").append(g("mode.analog."+e.mode))));c=fa(p);$.each(c,function(b,c){if("value"===c){var f=a.replace("analog","analog-value"),d=a.replace("analog","analog-units");h.append($("<td></td>").prop("id",a).append($("<span></span>").prop("id",f).addClass(!1===e.datalogEnabled?
"_logDisabled":"").append(E(e))).append("&nbsp;").append($("<span></span>").prop("id",d).append(F(e))))}else h.append($("<td></td>").append("&nbsp;"))});h.append($("<td></td>").append("&nbsp;"));return h},Xa=function(a,b){if(a&&b){var c=b.alarm;$("#vrc-"+a+"-alarm").empty().append("&nbsp;");for(var f in b.entity)if(c=oa(b.entity[f]),$("#vrc-"+a+"-entity-"+f+"-alarm").empty().append(ma(c,null,!0)),b.entity[f].measurement&&Object.keys(b.entity[f].measurement).length){var c=b.entity[f].measurement,d;
for(d in c){var e=$("#vrc-"+a+"-entity-"+f+"-measurement-"+d);if(e){e.text(""+c[d].value);var g=ma(c[d].alarm,null,!0);g&&(g=$(g),g.hasClass("ui-icon-alert")?e.addClass("alarm"):g.hasClass("ui-icon-notice")?e.addClass("warning"):(e.removeClass("alarm"),e.removeClass("warning")))}}}$("#devBody-"+a).find("td").removeClass("vrcTextAlarmed");f=0;d=b.point;for(var p in d)-1!==p.search(/^.*Alarm$/)&&"boolean"===typeof d[p].value?(c=null,!0===d[p].value?(f++,c=ca(!0),$("#vrc-"+a+"-system-"+p).prev().addClass("vrcTextAlarmed")):
c=ca(!1),$("#vrc-"+a+"-system-"+p).find("span").replaceWith(c)):$("#vrc-"+a+"-system-"+p).text(""+d[p].value);f?($("#vrc-"+a+"-state").find("span").replaceWith(ca(!0)),$("#vrc-"+a+"-system-pointTable").is(":visible")||$("#vrc-"+a+"-system-showHide").click()):$("#vrc-"+a+"-state").find("span").replaceWith(ca(!1));for(var h in b.entity){f=0;for(var r in b.entity[h].point)-1!==r.search(/^.*Alarm$/)&&"boolean"===typeof b.entity[h].point[r].value?(c=ca(b.entity[h].point[r].value),!0===b.entity[h].point[r].value&&
(f++,$("#vrc-"+a+"-"+h+"-"+r).prev().addClass("vrcTextAlarmed")),$("#vrc-"+a+"-"+h+"-"+r).find("span").replaceWith(c)):$("#vrc-"+a+"-"+h+"-"+r).text(""+b.entity[h].point[r].value);f?($("#vrc-"+a+"-entity-"+h+"-state").find("span").replaceWith(ca(!0)),$("#vrc-"+a+"-"+h+"-pointTable").is(":visible")||$("#vrc-"+a+"-"+h+"-showHide").click()):$("#vrc-"+a+"-entity-"+h+"-state").find("span").replaceWith(ca(!1))}}},mb=function(a,b){if(a&&b)for(var c in b)if(b.hasOwnProperty(c)){var f=b[c];if(f){var d=f.value,
e=f.state,p=$.extend({},f.alarm),f=f.mode,h=Q.CACHE.dev[a].analog[c];qa(d)&&(h.value=d);e&&(h.state=e);p&&(h.alarm=p);f&&(h.mode=f);var d=E(h),r=f;if(a&&c){var k=a+"-analog-value-"+c,f="r-"+a+"-analog-"+c,h=a+"-analog-"+c+"-state",C=a+"-analog-"+c+"-alarm",A=a+"-analog-"+c+"-mode";qa(d)&&$("#"+k).text(d);$("#"+A).text(g("mode.analog."+r));p&&(d=wa(p),$("#"+f).removeClass("alarm warning strong").addClass(d),$("#"+h).empty().append(sa(e)),$("#"+C).empty().append(ma(p,null,!0)))}}}},Oa=function(a){var c=
null,f;a&&(f=a.state,"on"===f?(a=za(a),c=B(Q.STATE_ICON.on),c.prop("title",a)):"off"===f?(a=za(a),c=B(Q.STATE_ICON.off),c.prop("title",a)):b("error. overview.getRelayStatusIcon: invalid state - "+f));return c},ab=function(a,b,c,f,d,e,p){var h=$("<tr></tr>");f=g("diagAndTable.config");var r=g("diagAndTable.oper"),k=e&&"alarm"===e.mode?"action-disabled":"action";h.prop("id","r-"+a).addClass(b+" level"+c+" devRow");h.append($("<td></td>").prop("id",a+"-state").addClass("w25 alignRight").append(Oa(e)));
h.append($("<td></td>").prop("id",a+"-alarm").addClass("w25 alignLeft").append(d));h.append($("<td></td>").append($("<span></span>").prop("id",a+"-cfg").prop("title",f).addClass("ui-icon ui-icon-wrench action actionFloat ui-corner-all")).append($("<span></span>").prop("id",a+"-opn").prop("title",r).addClass("ui-icon ui-icon-gear "+k+" actionFloat ui-corner-all")));b=ta($(d));e=Ya(e);h.append($("<td></td>").addClass("alignLeft labelCol").append(3===c?"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;":2===c?"&nbsp;&nbsp;&nbsp;":
"").append($("<span></span>").addClass(b).prop("id",a+"-label").append(l(e))));$.each(p,function(){h.append($("<td></td>").append("&nbsp;"))});h.append($("<td></td>").append("&nbsp;"));return h},Ya=function(a){var b="&nbsp;";a&&(a.label&&"string"===typeof a.label?b=a.label:a.name&&"string"===typeof a.name&&(b=a.name));return b},za=function(a){var c="";if(a){var f=a.state;"on"===f?c=a.onLabel||"Energized":"off"===f?c=a.offLabel||"Deenergized":b("error. overview.relayGetStateLabel: bad state - "+f)}else b("error. overview.relayGetStateLabel: bad relay");
return c},Pa=function(a,b){if(a&&b)for(var c in b)if(b.hasOwnProperty(c)){var f=b[c];if(f){var f=f.state,d=Q.CACHE.dev[a].relay[c];f&&(d.state=f,$("#"+a+"-relay-"+c+"-state").empty().append(Oa(d)))}}},Ja=function(a,b){var c="";-1!==$("#"+a+"-label").html().search("&nbsp;&nbsp;&nbsp;")&&(c="&nbsp;&nbsp;&nbsp;");$("#"+a+"-label").html(c+(b.label?b.label:b.name));$("#"+a+"-state").empty().append(Oa(b));b&&"alarm"===b.mode?$("#"+a+"-opn").removeClass("action").addClass("action-disabled"):$("#"+a+"-opn").removeClass("action-disabled").addClass("action")},
kb=function(a,b,c,f,d,e,p){var h=$("<tr></tr>"),r=g("diagAndTable.config"),k=g("diagAndTable.oper");d=ma(oa(e),null,!0);h.prop("id",a).addClass(b+" level"+c+" devRow");h.append($("<td></td>").prop("id",a+"-state").addClass("w25 alignRight").append(f));h.append($("<td></td>").prop("id",a+"-alarm").addClass("w25 alignLeft").append(d));b=e&&e.mode;f=ub(a,e);var C="action";if("alarmOn"===b||"alarmOff"===b)if("outletsat"===Ta(a)||!f.energy&&!f.minimax)C="action-disabled";h.append($("<td></td>").append($("<span></span>").prop("id",
a+"-cfg").prop("title",r).addClass("ui-icon ui-icon-wrench action actionFloat ui-corner-all")).append($("<span></span>").prop("id",a+"-opn").prop("title",k).addClass("ui-icon ui-icon-gear "+C+" actionFloat ui-corner-all")));d=ta(d);h.append($("<td></td>").addClass("alignLeft labelCol").append($("<span></span>").prop("id",a+"-label").addClass(d).append(3===c?"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;":2===c?"&nbsp;&nbsp;&nbsp;":"").append(l(Y(e)))));c=fa(p);$.each(c,function(b,c){var f=null,d=null,g=!0,
p=null;$.each(e.measurement||{},function(b,h){if(h.type===c)return p=a+"-measurement-"+b,f=e.measurement[b].value,d=e.measurement[b].alarm,g=e.measurement[b].datalogEnabled,!1});if(qa(f)){var r=wa(d);!1===g&&(r+=" _logDisabled");h.append($("<td></td>").prop("id",p).addClass(r).append(f))}else h.append($("<td></td>").append("&nbsp;"))});h.append($("<td></td>").append("&nbsp;"));return h},bb=function(a,b){if(a&&b)for(var c in b)if(b.hasOwnProperty(c)){var f=b[c];if(f){if(f.state){var d=f.state,e=f.timeToAction,
g=f.relayFailure;Q.CACHE.dev[a].outlet[c].state=d;Q.CACHE.dev[a].outlet[c].timeToAction=e;Q.CACHE.dev[a].outlet[c].relayFailure=g;d=sa(d,{timeToAction:e,relayFailure:g});$("#"+a+"-outlet-"+c+"-state").empty().append(d)}Za(a+"-outlet-"+c,f);if(f.measurement)for(var p in f.measurement)f.measurement.hasOwnProperty(p)&&(e=f.measurement[p])&&(d=$("#"+a+"-outlet-"+c+"-measurement-"+p),g=e.value,qa(g)&&(Q.CACHE.dev[a].outlet[c].measurement[p].value=g,d.text(g)),e=$.extend({},e.alarm),"object"===typeof e&&
(Q.CACHE.dev[a].outlet[c].measurement[p].alarm=e,d.removeClass("alarm warning strong").addClass(wa(e))))}}},cb=function(a,b,c,f,d,e,p,h){var r=$("<tr></tr>"),k=g("diagAndTable.config"),C=g("diagAndTable.oper"),A,m,L,S,x;d=ma(oa(e),null,!0);f=sa(Ka(e));r.prop("id",a).addClass(b+" level"+c+" devRow");r.append($("<td></td>").prop("id",a+"-state").addClass("w25 alignRight").append(f));r.append($("<td></td>").prop("id",a+"-alarm").addClass("w25 alignLeft").append(d));b=$("<td></td>");Qa(e,h)?b.append($("<span></span>").prop("id",
a+"-cfg").prop("title",k).addClass("ui-icon ui-icon-wrench action actionFloat ui-corner-all")):b.append($("<span></span>").addClass("ui-icon actionFloat no-icon"));Ra(a)&&b.append($("<span></span>").prop("id",a+"-opn").prop("title",C).addClass("ui-icon ui-icon-gear action actionFloat ui-corner-all"));r.append(b);d=ta(d);r.append($("<td></td>").addClass("alignLeft labelCol").append(3===c?"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;":2===c?"&nbsp;&nbsp;&nbsp;":"").append($("<span></span>").addClass(d).prop("id",
a+"-label").append(l(Y(e)))));c=fa(p);$.each(c,function(b,c){m=A=null;L=!0;S=null;x="";$.each(e.measurement||{},function(b,f){if(f.type===c){S=a+"-measurement-"+b;A=e.measurement[b].value;m=e.measurement[b].alarm;L=e.measurement[b].datalogEnabled;var d="",g;"ccat"===h&&(g=n(e.measurement[b].type,"note"))&&(d=g);x=d;return!1}});if(qa(A)){var f=wa(m);!1===L&&(f+=" _logDisabled");r.append($("<td></td>").prop("id",S).addClass(f).prop("title",x).append(A))}else r.append($("<td></td>").append("&nbsp;"))});
r.append($("<td></td>").append("&nbsp;"));return r},Ka=function(a){var b="normal";$.each(a&&a.measurement||{},function(a,c){if("unavailable"===c.state)return b=c.state,!1});return b},Qa=function(a,b){var c=!1;a&&"string"===typeof a.label&&(c=!0);return c},Ra=function(a){var b=!1;a=Ba(a);if(a.energy||a.minmax)b=!0;return b},lb=function(a,c){if(a&&c)for(var f in c)if(c.hasOwnProperty(f)){var d=c[f];if(d){var e=a+"-entity-"+f;try{var g=Ka(d),p=sa(g);$("#"+e+"-state").empty().append(p)}catch(h){b("error. overview.updateStateIcon: "+
h)}Za(a+"-entity-"+f,d);if(d.measurement){var d=d.measurement,r;for(r in d)if(d.hasOwnProperty(r)){var e=$("#"+a+"-entity-"+f+"-measurement-"+r),k=d[r].value;qa(k)&&(Q.CACHE.dev[a].entity[f].measurement[r].value=k,e.text(k));k=$.extend({},d[r].alarm);"object"===typeof k&&(Q.CACHE.dev[a].entity[f].measurement[r].alarm=k,e.removeClass("alarm warning strong").addClass(wa(k)))}}}}},ib=function(a,b,c){var f=D("T-dialogTable");c=c?c:b.name||"";b="string"===typeof b.label?b.label:null;f.find("tbody").append(u(c,
"common.name"));null!==b&&void 0!==b&&f.find("tbody").append(K(a+"-cfg-label","status.cfg.label",!1,b));return f},jb=function(a){var b="";if(a)try{var c=a.split("-"),b="conf"===c[1]?g("menu.system"):Q.CACHE.dev[c[0]][c[1]][c[2]].name||""}catch(f){b=""}return b},pb=function(a){var b=$("<div></div>"),c=D("T-dialogTable"),f=D("T-dialogTablePadRow").find("tr"),d=null;if(a){var e=!1;a=$(a).attr("id").replace("-cfg","");-1!==a.search("vrc-")&&(e=!0,a=a.replace("vrc-",""),a+="-conf");var d="dev/"+a.replace(/-/g,
"/"),g=N(d);e&&delete g.label;c.prop("id",a);c.find("tbody").append(f.clone());g&&((d=ib(a,g,e?jb(a):null))&&$.each(d.find("tr"),function(a,b){c.find("tbody").append(b)}),gb(a)?(d=Hb(a,g))&&$.each(d.find("tr"),function(a,b){c.find("tbody").append(b)}):Sa(a)?(d=Cb(a,g))&&$.each(d.find("tr"),function(a,b){c.find("tbody").append(b)}):q(a)?(d=sb(a,g))&&$.each(d.find("tr"),function(a,b){c.find("tbody").append(b)}):xb(a)?(d=Jb(a,g))&&$.each(d.find("tr"),function(a,b){c.find("tbody").append(b)}):e&&(d=Ua(a,
g))&&$.each(d.find("tr"),function(a,b){c.find("tbody").append(b)}));c.find("tbody").append(f.clone());b.append(c).append($("<div></div>").prop("id","status-deviceConfig").append("&nbsp;"));f=$("#dialog-dev-cfg");f.html(b.html());g&&q(a)&&na(a,g);Q.CACHE.opId=null;Q.CACHE.opBuf=null;s(Q.USER.lang);$("#dialog-dev-cfg").css("max-height","500px");f.dialog("open");$("#dialog-dev-cfg").css("max-height","500px");g=null}},Va=function(a){var b=null,c={prefix:"",url:""};(a=$(a).find("table").attr("id")||"")&&
"string"===typeof a&&(a=a.replace("-tbl",""),c.prefix=a,a=a.replace(/-/g,"/"),c.url="/api/dev/"+a,b=c);return b},hb=function(a,b){var c=$("#"+b.prefix+"-cfg-label");0<c.length&&$.extend(!0,a,{data:{label:{value:c.val(),error:y,reset:G,data:b.prefix+"-cfg-label"}}})},Fa=function(a,b){b=b||{};$.each(b,function(a){b[a].error=y;b[a].reset=G});$.extend(!0,a,{data:b})},qb=function(a){b("overview.saveStatusConfig...");if(!Q.CACHE.opId&&!Q.CACHE.opBuf){var c=function(a,c,f){a&&0===a.retCode?(a="/api/dev/"+
Q.CACHE.opId.replace(/-/g,"/"),m(a,!0,function(a,c,f){if(a&&0===a.retCode){c=Q.CACHE.opId.split("-");switch(c.length){case 1:Q.CACHE.dev[c[0]]=a.data;break;case 2:Q.CACHE.dev[c[0]][c[1]]=a.data;break;case 3:Q.CACHE.dev[c[0]][c[1]][c[2]]=a.data;break;case 4:Q.CACHE.dev[c[0]][c[1]][c[2]][c[3]]=a.data;break;case 5:Q.CACHE.dev[c[0]][c[1]][c[2]][c[3]][c[4]]=a.data;break;default:b("error: overview.saveStatusConfig.internalCB")}Q.CACHE.opBuf=a.data;q(Q.CACHE.opId)?(a=Q.CACHE.opId,c=Q.CACHE.opBuf,f="",-1!==
$("#"+a+"-label").html().search("&nbsp;&nbsp;&nbsp;")&&(f="&nbsp;&nbsp;&nbsp;"),$("#"+a+"-label").html(f+(c.label?c.label:c.name)),$("#"+a.replace("analog","analog-value")).html(E(c)),$("#"+a.replace("analog","analog-units")).html(F(c))):Sa(Q.CACHE.opId)?Ja(Q.CACHE.opId,Q.CACHE.opBuf):gb(Q.CACHE.opId)?(a=Q.CACHE.opId,c=Q.CACHE.opBuf,f="",-1!==$("#"+a+"-label").html().search("&nbsp;&nbsp;&nbsp;")&&(f="&nbsp;&nbsp;&nbsp;"),$("#"+a+"-label").html(f+(c.label?c.label:c.name)),f=c&&c.mode||"",c=ub(a,c),
"alarmOn"===f||"alarmOff"===f?"outletsat"!==Ta(a)&&(c.energy||c.minimax)||$("#"+a+"-opn").removeClass("action").addClass("action-disabled"):$("#"+a+"-opn").removeClass("action-disabled").addClass("action")):(a=Q.CACHE.opBuf,$("#"+Q.CACHE.opId+"-label").text(a.label?a.label:a.name));Q.CACHE.opId=null;Q.CACHE.opBuf=null;$("#dialog-dev-cfg").dialog("close")}else b(c+", "+$.stringify(a)+", "+$.stringify(f))},null,"get",null,null)):a?(v(Q.DIALOG_ERROR,w(a.retCode)),Q.CACHE.opId=null,Q.CACHE.opBuf=null,
$("#dialog-dev-cfg").dialog("close")):b("error. overview.saveStatusConfig: "+$.stringify(f))},d=Va(a);if(d){var e={path:d.url,cmd:"set",access:L(),data:{}};hb(e,d);gb(d.prefix)?Fa(e,Ib()):Sa(d.prefix)?Fa(e,Db()):q(d.prefix)?Fa(e,Bb()):xb(d.prefix)?Fa(e,Kb()):(d.prefix&&-1!==d.prefix.search("vrc-")||d.prefix.search("-conf"))&&Fa(e,db(d.prefix));var g=function(){if(!X(e.path,e.cmd,!0))f(g,!0);else if(!e||H(e)){var a=P(e);Q.CACHE.opBuf=a;Q.CACHE.opId=d.prefix;m(e.path,!0,c,null,e.cmd,null,$.stringify(a))}};
g()}}},nb=function(){var a=$("<div></div>");a.append($("<div></div>").prop("id","dialog-dev-cfg").prop("title",g("diagAndTable.config")));O(a.html(),{autoOpen:!1,resizable:!1,width:550,modal:!0,close:function(){Q.CACHE.opId=null;Q.CACHE.opBuf=null},buttons:[{id:"dlg-btn-dev-cfg-save",text:g("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");qb(this)}},{id:"dlg-btn-dev-cfg-cancel",text:g("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]})},La=function(){var a=
g("diagAndTable.youSure")+"<br>"+g("status.devDeleted"),b=$("<div></div>");b.append($("<div></div>").prop("id","dialog-dev-del").prop("title",g("diagAndTable.delete")).append($("<p></p>").append($("<span></span>").addClass("ui-icon ui-icon-alert").prop("style","float:left;margin:0 7px 20px 0;")).append($("<span></span>").prop("id","rusure").append(a))));O(b.html(),{autoOpen:!1,resizable:!1,width:300,height:180,modal:!0,close:function(){Q.CACHE.opId=null},buttons:[{id:"dlg-btn-dev-del-delete",text:g("diagAndTable.delete"),
click:function(){$("[id^=status-]").html("&nbsp;");ob(this)}},{id:"dlg-btn-dev-del-cancel",text:g("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]})},ob=function(a){var c=function(c,f,d){c?0===c.retCode?($("#devHeader-"+Q.CACHE.opId).remove(),$("#devBody-"+Q.CACHE.opId).remove(),Q.CACHE.opId=null,$(a).dialog("close")):v(Q.DIALOG_ERROR,w(c.retCode)):b("error. overview.deleteStatusDev: "+$.stringify(d))},d=function(){X("/api/dev/"+Q.CACHE.opId,"delete",!0)?I("/api/dev/"+Q.CACHE.opId,
c):f(d,!0)};d()},Ha=function(a,b){var c=!1;if(Q.CACHE.dev&&Q.CACHE.dev[a]){var f=Q.CACHE.dev[a];f.outlet&&f.outlet[b]&&void 0!==f.outlet[b].state&&(c=!0)}return c},Wa=function(a){var b="";switch(a){case "on2off":case "rebootOff":b=g("state.off");break;case "off2on":case "rebootOn":b=g("state.on");break;default:b=g("state.none")}return b},Na=null,ya={openClose:["close","open","suspend"],openSuspend:["open","suspend"],vrcModel:[],vrcControlMode:["supply","return"]},Ua=function(a,c){if(0===ya.vrcModel.length){var f=
[];Q.CACHE&&Q.CACHE.rules&&Q.CACHE.rules.vrcModel&&Q.CACHE.rules.vrcModel.value&&Q.CACHE.rules.vrcModel.value.length?f=Q.CACHE.rules.vrcModel.value:b("error. overview.getVRCModels: no data");ya.vrcModel=f}f=D("T-dialogTableSpacerRow").find("tr");D("T-dialogTablePadRow").find("tr");var d=D("T-dialogTable");d.find("tbody").append(f.clone());var e;if(Na)e=Na;else{var h=[],r=Q.CACHE.commands.api.dev["%default%"];if(r&&r.conf){var k=r.conf._set.data;if(k)for(var C in k)h[C]=k[C]}if(r&&(r.entity&&r.entity["%default%"]&&
r.entity["%default%"].conf)&&(C=r.entity["%default%"].conf._set.data))for(e in C)h[e]=C[e];e=Na=h}C=null;C=-1===a.search("-entity-")?"system":a.split("-")[2];if(h=p[C]&&p[C].conf?p[C].conf:null){for(var A in h)if(C=h[A],"name"!==C&&"label"!==C)if("==break=="===C)d.find("tbody").append(f.clone());else if(r=e[C])switch(r){case "openClose":d.find("tbody").append(J("devCfg-vrc-"+a+"-"+C,"vrc."+C,ya[r],[g("state.closed"),g("state.open"),g("state.suspend")],c[C],!1));break;case "openSuspend":d.find("tbody").append(J("devCfg-vrc-"+
a+"-"+C,"vrc."+C,ya[r],[g("state.open"),g("state.suspend")],c[C],!1));break;case "vrcModel":case "vrcControlMode":d.find("tbody").append(J("devCfg-vrc-"+a+"-"+C,"vrc."+C,ya[r],ya[r],c[C],!1));break;case "enabled":d.find("tbody").append(J("devCfg-vrc-"+a+"-"+C,"vrc."+C,["true","false"],[g("diagAndTable.enabled"),g("diagAndTable.disabled")],!0===c[C]?"true":"false"));break;default:d.find("tbody").append(K("devCfg-vrc-"+a+"-"+C,"vrc."+C,!1,c[C]))}return d}b("error. overview.getVrcCfgRows: order not found for "+
C)},db=function(a){var b={},c=null,f=null,d=f=null;if(a&&(-1!==a.search("-entity-")?(f=a.split("-"))&&4===f.length&&(c=Q.CACHE.commands.api.dev["%default%"].entity["%default%"].conf._set.data,f="dev/"+a.replace(/-/g,"/"),d=N(f)):(c=Q.CACHE.commands.api.dev["%default%"].conf._set.data,f="dev/"+a.replace(/-/g,"/"),d=N(f)),c&&d))for(var e in d)if("name"!==e&&"label"!==e&&(f=c[e])){var d=$("#devCfg-vrc-"+a+"-"+e).val(),g=null,g=-1!==f.search("flt_")?R(d):-1!==f.search("int_")?U(d):"true"===d?!0:"false"===
d?!1:d;b[e]={value:g,data:"devCfg-vrc-"+a+"-"+e}}return b},fb=function(){var a={},b=$("#dialog-dev-cfg").data("analogData");$.isPlainObject(b)&&(a=b);return a},rb=function(a){var b={},c=a&&a.type;"string"===typeof c&&(c=c.toUpperCase(),$.each(Q.CACHE.analogModes||{},function(a,f){0<=$.inArray(c,f.owners||[])&&(b[a]=f)}));return b},sb=function(a,b){var c=b&&b.mode||"",f=D("T-dialogTableSpacerRow").find("tr"),d=D("T-dialogTablePadRow").find("tr"),e=D("T-dialogTable");e.find("tbody").append(f.clone());
for(var f={keys:[],values:[]},g=rb(b),p=Q.CACHE.analogModes._order_,h=0;h<p.length;h++)void 0!==g[p[h]]&&(f.values.push(p[h]),f.keys.push(g[p[h]].name));1<f.keys.length&&(e.find("tbody").append(J("devCfg-analog-mode","status.cfg.mode",f.values,f.keys,c,!0)).append(d.clone()),e.find("tbody").append(K("devCfg-analog-highLabel","status.cfg.highLabel",!1)).append(K("devCfg-analog-lowLabel","status.cfg.lowLabel",!1)),e.find("tbody").append(K("devCfg-analog-min","",!1,"",!1)).append(K("devCfg-analog-max",
"",!1,"",!1)).append(K("devCfg-analog-units","status.cfg.units",!1)));return e},eb=function(a,b,c,f){var d=$("#devCfg-analog-"+a);if(b){if(d.parent().parent().show(),d.prop("disabled",c),d.val(f),"min"===a||"max"===a)b=fb().type.toUpperCase(),b="customCurrent"===$("#devCfg-analog-mode").val()?"min"===a?"4mA":"20mA":"min"===a?"0V":b,b=g("status.cfg."+a+b),$("#devCfg-analog-"+a).parent().siblings().text(b)}else d.parent().parent().hide()},tb=function(a){$.each(["highLabel","lowLabel","min","max","units"],
function(b,c){c in a?eb(c,!0,a.preset,a[c]):eb(c,!1)})},na=function(a,b){$("#dialog-dev-cfg").data("analogData",b);$("#devCfg-analog-mode").on("change",function(){var a=$(this).val(),b=$.extend({},Q.CACHE.analogModes[a]);if(b.preset)"analog"===b.type?b.units=g(b.units):(b.highLabel=g(b.highLabel),b.lowLabel=g(b.lowLabel));else{var c=fb();a&&c.mode===a&&("analog"===b.type?(b.units=c.units,b.min="number"===typeof c.min?c.min:b.min,b.max="number"===typeof c.max?c.max:b.max):(b.highLabel="string"===typeof c.highLabel?
c.highLabel:b.highLabel,b.lowLabel="string"===typeof c.lowLabel?c.lowLabel:b.lowLabel))}tb(b)}).trigger("change")},Bb=function(){var a={},b=null,c=["min","max"];$.each(["mode","highLabel","lowLabel","units"].concat(c),function(f,d){b=$("#devCfg-analog-"+d);if(b.is(":visible:enabled")){var e=b.val();-1!==$.inArray(d,c)&&(e=R(e));a[d]={value:e,data:"devCfg-analog-"+d}}});return a},Sa=function(a){return-1!==a.search("-relay-")},Cb=function(a,b){var c=D("T-dialogTableSpacerRow").find("tr"),f=D("T-dialogTable"),
d=b.onLabel||"Energized",e=b.offLabel||"Deenergized",p=b.mode||"";f.find("tbody").append(c.clone()).append(J("devCfg-relay-mode","status.cfg.mode",["manual","alarm"],[g("diagAndTable.action.manualCtrl"),g("diagAndTable.action.alarmCtrl")],p,!1)).append(c.clone()).append(K("devCfg-relay-onLabel","status.cfg.energizedLabel",!1,d)).append(K("devCfg-relay-offLabel","status.cfg.deenergizedLabel",!1,e));return f},Db=function(){var a={};$.each(["mode","onLabel","offLabel"],function(b,c){a[c]={value:$("#devCfg-relay-"+
c).val(),data:"devCfg-relay-"+c}});return a},gb=function(a){return-1!==a.search("-outlet-")},Ta=function(a){var c=null;if(a&&"string"===typeof a){a=a.replace(/-outlet-[0-9]+/,"");var f=N("dev/"+a+"/type");if("outletsat"===f)c=f;else if(Q.CACHE.dev&&Q.CACHE.dev[a]&&Q.CACHE.dev[a].outlet)for(var d in Q.CACHE.dev[a].outlet)if(void 0!==Q.CACHE.dev[a].outlet[d].mode){c="outletmode";break}}else b('error. overview.getOutletMode: invalid parameter "id"');return c},Eb=function(a,b,c){a=null;var f=D("T-dialogTableSpacerRow").find("tr");
if(void 0!==b.state){var d=W(b.state||"on"),e=Wa(b.state||"on");b=b.timeToAction||0;a=D("T-dialogTable");a.find("tbody").append(f.clone());c||a.find("tbody").append(u(d,"status.cfg.state"));a.find("tbody").append(u(e,"status.cfg.pendingState")).append(u(b,"status.cfg.timeToAction"))}return a},Fb=function(a,b){var c=null;if(void 0!==b.state){var f=b.onDelay||0,d=b.offDelay||0,e=b.rebootDelay||0,g=b.rebootHoldDelay||0,p=b.poaAction||"last",h=b.poaDelay||0,r=x("/api/dev/default/outlet/default","set",
"poaAction")||[],k=$.map(r,function(a){return"diagAndTable.action."+a}),c=D("T-dialogTable");c.find("tbody").append(K("devCfg-outlet-onDelay","status.cfg.onDelay",!1,f)).append(K("devCfg-outlet-offDelay","status.cfg.offDelay",!1,d)).append(K("devCfg-outlet-rebootDelay","status.cfg.rebootDelay",!1,e)).append(K("devCfg-outlet-rebootHoldDelay","status.cfg.rebootHoldDelay",!1,g)).append(J("devCfg-outlet-poaAction","status.cfg.poaAction",r,k,p,!0)).append(K("devCfg-outlet-poaDelay","status.cfg.poaDelay",
!1,h))}return c},Gb=function(a,b){var c=D("T-dialogTable"),f=D("T-dialogTableSpacerRow").find("tr"),d=W(b.state||"on"),e=b.mode||"";c.find("tbody").append(f.clone()).append(u(d,"status.cfg.state")).append(f.clone()).append(J("devCfg-outlet-mode","status.cfg.mode",["manual","alarmOn","alarmOff"],[g("diagAndTable.action.manualCtrl"),g("diagAndTable.action.alarmCtrl")+" "+g("diagAndTable.action.alarmOnDesc"),g("diagAndTable.action.alarmCtrl")+" "+g("diagAndTable.action.alarmOffDesc")],e,!1));return c},
Hb=function(a,b){var c=D("T-dialogTable"),f=D("T-dialogTableSpacerRow").find("tr"),d=null,e=Ta(a);null!==e&&(d=Gb(a,b))&&$.each(d.find("tr"),function(a,b){c.find("tbody").append(b)});"outletsat"!==e&&((d=Eb(a,b,"outletmode"===e))&&$.each(d.find("tr"),function(a,b){c.find("tbody").append(b)}),c.find("tbody").append(f.clone()),f=$("<tr></tr>"),f.addClass("form-row"),f.append($("<td></td>").prop("colspan",2).append($("<h6></h6>").prop("id","dialog-outlet-cfg-delayUnits").addClass("help-text ui-corner-all").prop("style",
"display:block;width:90%").append(g("delayUnits.help")))),c.find("tbody").append(f),(d=Fb(a,b))&&$.each(d.find("tr"),function(a,b){c.find("tbody").append(b)}));return c},Ib=function(){var a={},b,c,f=["onDelay","offDelay","rebootDelay","rebootHoldDelay"],d=["poaDelay"],e=["poaAction","mode"].concat(f).concat(d);$.each(e,function(e,g){b=$("#devCfg-outlet-"+g);b.length&&(c=b.val(),0<=$.inArray(g,f)&&(c=U(c,10)),0<=$.inArray(g,d)&&(c=R(c)),a[g]={value:c,data:"devCfg-outlet-"+g})});return a},xb=function(a){return a&&
"string"===typeof a&&-1!==a.search(/^[A-F0-9]{16}$/)?!0:!1},Nb=function(){var a=g("status.cfg.temperatureOffset"),b;a&&(b="metric"===T()?g("meas.units.degC"):g("meas.units.degF"))&&(a+=" ("+b+")");return a},Jb=function(a,b){var c=D("T-dialogTableSpacerRow").find("tr"),f=null,d=!1;b&&"object"===typeof b&&"temperatureOffset"in b&&(d=!0);d&&(f=D("T-dialogTable"),f.find("tbody").append(c.clone()).append(K("devCfg-device-temperatureOffset",Nb(),!1,b.temperatureOffset,!1)));return f},Kb=function(){var a=
{},b=$("#devCfg-device-temperatureOffset");b.length&&(a.temperatureOffset={value:R(b.val()),data:"devCfg-device-temperatureOffset"});return a},yb=function(a,b){var c=D("T-dialogTable"),f=b.name?b.name:"",d="string"===typeof b.label?b.label:null;c.find("tbody").append(u(f,"common.name"));null!==d&&c.find("tbody").append(u(d,"status.cfg.label"));return c},zb=function(a,b){var c=D("T-dialogTable"),f=[],d=[];b.switchable&&(f=f.concat(["on","off","reboot","cancel"]),d=d.concat(["diagAndTable.action.on",
"diagAndTable.action.off","diagAndTable.action.reboot","diagAndTable.cancel"]));b.energy&&(f.push("resetEnergy"),d.push("diagAndTable.action.resetEnergy"));b.minmax&&(f.push("resetMinmax"),d.push("diagAndTable.action.resetMinmax"));b.defaults&&(f.push("resetDefaults"),d.push("menu.reset"));b.reset_historyAlarmNumbers&&(f.push("resetHistoryAlarmNumbers"),d.push("diagAndTable.action.resetHistoryAlarmNumbers"));b.reset_newAlarmFlag&&(f.push("resetNewAlarmFlag"),d.push("diagAndTable.action.resetNewAlarmFlag"));
b.reset_startStopCount&&(f.push("resetStartStopCount"),d.push("diagAndTable.action.resetStartStopCount"));c.find("tbody").append(J(a+"-oper-control","diagAndTable.oper",f,d,"0",!0));return c},Lb=function(a){if(!Q.CACHE.opId&&!Q.CACHE.opBuf){var c=function(a,c,f){a&&0===a.retCode?(a="/api/dev/"+Q.CACHE.opId.replace(/-/g,"/"),m(a,!0,function(a,c,f){if(a&&0===a.retCode){c=Q.CACHE.opId.split("-");switch(c.length){case 1:Q.CACHE.dev[c[0]]=a.data;break;case 2:Q.CACHE.dev[c[0]][c[1]]=a.data;break;case 3:Q.CACHE.dev[c[0]][c[1]][c[2]]=
a.data;break;case 4:Q.CACHE.dev[c[0]][c[1]][c[2]][c[3]]=a.data;break;case 5:Q.CACHE.dev[c[0]][c[1]][c[2]][c[3]][c[4]]=a.data;break;default:b("error: overview.saveStatusOper.internalCB")}Q.CACHE.opBuf=a.data;Sa(Q.CACHE.opId)?Ja(Q.CACHE.opId,Q.CACHE.opBuf):(a=sa(Q.CACHE.opBuf.state,{timeToAction:Q.CACHE.opBuf.timeToAction,relayFailure:Q.CACHE.opBuf.relayFailure}),$("#"+Q.CACHE.opId+"-state").empty().append(a));Q.CACHE.opId=null;Q.CACHE.opBuf=null;v(Q.DIALOG_SUCCESS,g("retCode.0"));$("#dialog-dev-oper").dialog("close")}else b(c+
", "+$.stringify(a)+", "+$.stringify(f))},null,"get",null,null)):(a?v(Q.DIALOG_ERROR,w(a.retCode)):b("error. overview.saveStatusOper: "+$.stringify(f)),Q.CACHE.opId=null,Q.CACHE.opBuf=null,$("#dialog-dev-oper").dialog("close"))},d=Va(a);if(d){var e={path:d.url,cmd:"",access:L()};if(Sa(d.prefix))$.extend(!0,e,{cmd:"control",data:{action:{value:$("#"+vb+"control").val(),error:y,reset:G,data:vb+"control"}}});else if(gb(d.prefix))$.extend(!0,e,Pb(d.prefix));else{var p=$("#"+d.prefix+"-oper-control");
a=$("#"+d.prefix+"-oper-delay");if(p=p?p.val():"")if(-1!==p.search("resetEnergy"))$.extend(!0,e,{cmd:"reset",data:{target:{value:"energy",error:y,reset:G,data:d.prefix+"-oper-control"}}});else if(-1!==p.search("resetMinmax"))$.extend(!0,e,{cmd:"reset",data:{target:{value:"minmax",error:y,reset:G,data:d.prefix+"-oper-control"}}});else if(-1!==p.search("resetDefaults"))$.extend(!0,e,{cmd:"reset",data:{target:{value:"defaults",error:y,reset:G,data:d.prefix+"-oper-control"}}});else if(-1!==p.search("resetHistoryAlarmNumbers")||
-1!==p.search("resetNewAlarmFlag")||-1!==p.search("resetStartStopCount"))a=p.replace("reset",""),a=a.charAt(0).toLowerCase()+a.substring(1),$.extend(!0,e,{cmd:"reset",data:{target:{value:a,error:y,reset:G,data:d.prefix+"-oper-control"}}});else if(-1!==p.search("cancel"))$.extend(!0,e,{cmd:"control",data:{action:{value:p,error:y,reset:G,data:d.prefix+"-oper-control"}}}),a.length&&$.extend(!0,e,{data:{delay:{value:!1,error:y,reset:G,data:d.prefix+"-oper-delay"}}});else{if(-1!==p.search("on")||-1!==
p.search("off")||-1!==p.search("reboot"))$.extend(!0,e,{cmd:"control",data:{action:{value:p,error:y,reset:G,data:d.prefix+"-oper-control"}}}),a.length&&$.extend(!0,e,{data:{delay:{value:z(a.val()),error:y,reset:G,data:d.prefix+"-oper-delay"}}})}else{b("error. saveStatusOper id="+id);return}}var h=function(){if(!X(e.path,e.cmd,!0))f(h,!0);else if(!e||H(e)){var a=P(e);Q.CACHE.opBuf=null;Q.CACHE.opId=d.prefix;m(e.path,!0,c,null,e.cmd,null,$.stringify(a))}};h()}}},Mb=function(a){var b=$("<div></div>"),
c=D("T-dialogTable"),f=D("T-dialogTablePadRow").find("tr"),d=D("T-dialogTableSpacer").find("tr"),e=null;if(a){a=$(a).attr("id").replace("-opn","");var e=a.split("-"),p=Q.CACHE.dev,h=!1;if(1<e.length){for(var r=0;r<e.length;r++)if(p[e[r]])p=p[e[r]];else{h=!0;break}p&&!h&&(c.prop("id",a),c.find("tbody").append(f.clone()),(e=yb(a,p))&&$.each(e.find("tr"),function(a,b){c.find("tbody").append(b)}),e=Ba(a),-1!==a.search("-entity-")&&(e.energy||e.minmax)?c.find("tbody").append(d.clone()).append(zb(a,e).find("tr")):
gb(a)?(e=Qb(a,p))&&$.each(e.find("tr"),function(a,b){c.find("tbody").append(b)}):Sa(a)&&(e=Rb(a,p))&&$.each(e.find("tr"),function(a,b){c.find("tbody").append(b)}),c.find("tbody").append(f.clone()))}else c.prop("id",a),c.append(f.clone()),(e=yb(a,p[a]||{}))&&$.each(e.find("tr"),function(a,b){c.find("tbody").append(b)}),c.find("tbody").append(d.clone()).append($("<tr></tr>").addClass("form-row").append($("<td></td>").prop("colspan",4).append($("<h6></h6>").addClass("help-text ui-corner-all").prop("style",
"width:440px;").append(g("xxx.cautionResetAll"))))),d=Ab(a),c.find("tbody").append(zb(a,d).find("tr")),"outletsat"!==(p&&p[a]&&p[a].type||"")&&c.find("tbody").append(J(a+"-oper-delay","status.cfg.opDelay",["false","true"],["diagAndTable.false","diagAndTable.true"],"0",!0)),c.find("tbody").append(f.clone());b.append(c).append($("<div></div>").prop("id","status-deviceOperate").append("&nbsp;"));$("#dialog-dev-oper").html(b.html()).dialog("open");s(Q.USER.lang);$("#"+a+"-oper-control, #devOper-outlet-control").on("change",
function(){var a=($(this).prop("id")||"").replace("-control","-delay"),a=$("#"+a).parent().parent();0<=$.inArray($(this).val(),"resetEnergy resetMinmax cancel resetDefaults resetHistoryAlarmNumbers resetNewAlarmFlag resetStartStopCount".split(" "))?a.hide():a.show()}).change();p=null}},Ab=function(a){var b=function(a){var b=[];a&&(a.measurement&&b.push(a),$.each([a.entity,a.outlet,a.relay],function(a,c){$.each(c||{},function(a,c){c&&c.measurement&&b.push(c.measurement)})}));return b},c={energy:!1,
minmax:!1,defaults:!0,switchable:!1},f=a&&Q.CACHE.dev&&Q.CACHE.dev[a];f&&(b=b(f),$.each(b,function(a,b){Ga(b,c);if(c.energy&&c.minmax)return!1}),Ha(a,0)&&(c.switchable=!0));f&&"vrc"===f.type&&(c.reset_historyAlarmNumbers=!0,c.reset_startStopCount=!0,c.reset_newAlarmFlag=!0);return c},Ob=function(){var a=$("<div></div>");a.append($("<div></div>").prop("id","dialog-dev-oper").prop("title",g("diagAndTable.oper")));O(a.html(),{autoOpen:!1,resizable:!1,width:500,modal:!0,buttons:[{id:"dlg-btn-dev-oper-submit",
text:g("diagAndTable.submit"),click:function(){$("[id^=status-]").html("&nbsp;");Lb(this)}},{id:"dlg-btn-dev-oper-cancel",text:g("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]})},vb="devOper-relay-",Rb=function(a,b){var c=D("T-dialogTableSpacerRow").find("tr"),f=D("T-dialogTable");f.find("tbody").append(c.clone()).append(u(za(b),"status.cfg.state")).append(c.clone()).append(J(vb+"control","diagAndTable.oper",["on","off"],["diagAndTable.action.on","diagAndTable.action.off"],null,
!0));return f},ub=function(a,b){var c={},f=Ba(a),d=!1;b&&"object"===typeof b&&void 0!==b.state&&(d=!0);$.extend(c,f,{switchable:d});return c},Sb=function(a,b){var c=D("T-dialogTable"),f=b.state||"on",d=b.timeToAction||"0";c.find("tbody").append(u(W(f),"status.cfg.state"));"outletsat"!==Ta(a)&&c.find("tbody").append(u(Wa(f),"status.cfg.pendingState")).append(u(d,"status.cfg.timeToAction"));return c},Tb=function(a,b){var c=D("T-dialogTable"),f=[],d=[],e=ub(a,b);"alarmOn"!==b.mode&&"alarmOff"!==b.mode&&
e.switchable&&(f=f.concat(["on","off","reboot","cancel"]),d=d.concat(["diagAndTable.action.on","diagAndTable.action.off","diagAndTable.action.reboot","diagAndTable.cancel"]));e.energy&&(f.push("resetEnergy"),d.push("diagAndTable.action.resetEnergy"));e.minmax&&(f.push("resetMinmax"),d.push("diagAndTable.action.resetMinmax"));c.find("tbody").append(J("devOper-outlet-control","diagAndTable.oper",f,d,"0",!0));return c},Ub=function(a,b){var c=D("T-dialogTable"),f;f=Tb(a,b);$.each(f.find("tr"),function(a,
b){c.find("tbody").append(b)});"outletsat"!==Ta(a)&&c.find("tbody").append(J("devOper-outlet-delay","status.cfg.opDelay",["false","true"],["diagAndTable.false","diagAndTable.true"],"0",!0));return c},Qb=function(a,b){var c=D("T-dialogTable"),f=D("T-dialogTableSpacerRow").find("tr"),d=null;c.find("tbody").append(f.clone());if(d=Sb(a,b))$.each(d.find("tr"),function(a,b){c.find("tbody").append(b)}),d=null;c.find("tbody").append(f.clone());if(d=Ub(a,b))$.each(d.find("tr"),function(a,b){c.find("tbody").append(b)}),
d=null;return c},wb=function(a,b,c){var f={data:{}};f.data[a]={value:b,error:y,reset:G,data:"devOper-outlet-"+c};return f},Pb=function(a){var c={},f=$("#devOper-outlet-control").val(),d=z($("#devOper-outlet-delay").val());0<=$.inArray(f,["on","off","reboot","cancel"])?(c.cmd="control",$.extend(c,wb("action",f,"control")),"outletsat"!==Ta(a)&&("cancel"===f&&(d=!1),$.extend(!0,c,wb("delay",d,"delay")))):0<=$.inArray(f,["resetEnergy","resetMinmax"])?(c.cmd="reset",$.extend(c,wb("target","resetEnergy"===
f?"energy":"minmax","control"))):b("error. overview.getOutletOperCmd: bad control - "+f);return c};return r}(Q.log,Q.getLocalStr,Q.util.getMeasAttrByType,Q.util.escapeHtml,Q.JQO.getSection,Q.cacheHelper.analog.isAnalogPath,Q.util.stateStatusText,Q.JQO.getPageWrapper,Q.util.devGetSortedDevIds,Q.localize,Q.gotoPage,Q.cacheHelper.formatEnergyMeasurements,Q.dialogAlert,Q.util.getRetCodeMsg,Q.util.menuUpdate,Q.apiCall,Q.JQO.getIconSpan,Q.util.statusBarColorUpdate,Q.cacheHelper.analog.getValue,Q.cacheHelper.analog.getUnits,
Q.JQO.getDialogOptionLabel,Q.JQO.getDialogOptionText,Q.getTemplate,Q.util.getCacheValueByPath,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.validate.test,Q.validate.getApiData,Q.createDialog,Q.apiCallDelete,Q.JQO.getDialogOptionList,Q.validate.getEnumValues,Q.util.getTempUnits,Q.util.strToInt,Q.util.strToFloat,Q.util.strToBool,Q.cacheHelper.analog.getLabel,Q.util.getDeviceNameLabel,Q.auth.accessTest,Q.auth.handleInvalidSession,Q.auth.accessControlNormal,Q.dialogLogin);Q.logging=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u,K,D,N,y,G,H,P,O){var I={},J=function(){b("logging.eventHandlerSetIntervalSupbmit...");try{var f=function(a,f,d){a?0===a.retCode?($("[id^=status-]").html("&nbsp;"),$("#status-logInterval").removeClass("status-error").addClass("status-success").html(q("success"))):a.retCode===Q.RETCODE.NOT_AUTHORIZED?c(Q.DIALOG_ERROR,q("err.notAuthorized")):$("#status-logInterval").removeClass("status-success").addClass("status-error").html(e(a.retCode)||
q("error")):b("jqXHR = "+$.stringify(d))},d={path:"/api/conf/datalog",cmd:"set",access:H(),data:{interval:{value:t($("#logInterval-interval").val()),error:s,reset:a,data:"logInterval-interval"}}},g=function(){if(!P(d.path,d.cmd,!0))O(g,!0);else if(!d||h(d)){var a=v(d);Q.CACHE.opBuf=a;w(d.path,!0,f,null,d.cmd,null,$.stringify(a))}};g()}catch(k){b("error. logging.eventHandlerSetIntervalSubmit: "+k)}},x=function(){b("logging.eventHandlerConfigSubmit...");try{if($("#status-loggingConfig").empty(),$.isEmptyObject(Q.CACHE.logging))b("logging.eventHandlerConfigSubmit: no changes to submit");
else{var a={},g;for(g in Q.CACHE.logging){var p=(-1!==g.search(/^vrc-.*$/)?g.replace("vrc-",""):g).split("-"),h=p[0];a[h]||(a[h]={});var k=p[1];a[h][k]||(a[h][k]={});var A=p[2];a[h][k][A]||(a[h][k][A]={});if("analog"===k)a[h][k][A].datalogEnabled=Q.CACHE.logging[g];else{a[h][k][A].measurement||"measurement"!==p[3]||(a[h][k][A].measurement={});var m=p[4];a[h][k][A].measurement[m]||(a[h][k][A].measurement[m]={});a[h][k][A].measurement[m].datalogEnabled=Q.CACHE.logging[g]}}var L=function(a,f,g){a?0===
a.retCode?($("[id^=status-]").html("&nbsp;"),$("#status-loggingConfig").removeClass("status-error").addClass("status-success").html(q("success")),d(),Q.CACHE.logging={}):a.retCode===Q.RETCODE.NOT_AUTHORIZED?c(Q.DIALOG_ERROR,q("err.notAuthorized")):$("#status-loggingConfig").removeClass("status-success").addClass("status-error").html(e(a.retCode)||q("error")):b("jqXHR = "+$.stringify(g))},l=function(){P("/api/dev/xx","set",!0)?w("/api/dev",!0,L,null,"set",null,$.stringify(a)):O(l,!0)};l()}}catch(n){b("error. logging.eventHandlerConfigSubmit: "+
n)}},T=function(){$("#goSetLogInterval").on("click",function(){$("[id^=status-]").html("&nbsp;");$(this).blur();J()});$("#goLogClear").on("click",function(){$("[id^=status-]").html("&nbsp;");$(this).blur();$("#dialog-logging-clear").dialog("open")});$("tbody").on("click","td",function(){var a=$(this),b=a.prop("id");!b||-1===b.search("-measurement-")&&-1===b.search("-analog-")||(a.hasClass("lcdSelected")?(a.removeClass("lcdSelected"),Q.CACHE.logging[b]=!1):(a.addClass("lcdSelected"),Q.CACHE.logging[b]=
!0),a.blur())});$("tbody").on("click","span",function(){var a=$(this),b=a.prop("id");b&&-1!==b.search("-measurement-")&&(a.hasClass("lcdSelected")?(a.removeClass("lcdSelected"),Q.CACHE.logging[b]=!1):(a.addClass("lcdSelected"),Q.CACHE.logging[b]=!0),a.blur())});$('span[id*="allOrNone"]').on("click",function(a){m(a)});$("#setLoggingConfig").on("click",function(){$("[id^=status-]").html("&nbsp;");x()})},U=function(){try{var a=Q.CACHE.dev,c="",d=null,e=null,g=null,h;for(h in a)if(a.hasOwnProperty(h)){if(void 0!==
a[h].outlet&&!$.isEmptyObject(a[h].outlet)){var k=a[h].outlet;for(e in k)if(k.hasOwnProperty(e)&&(c=h+"-outlet-"+e+"-measurement-",void 0!==k[e].measurement&&!$.isEmptyObject(k[e].measurement)))for(g in d=k[e].measurement,d)d.hasOwnProperty(g)&&d[g].datalogEnabled&&$("#"+c+g).addClass("lcdSelected")}if(void 0!==a[h].entity&&!$.isEmptyObject(a[h].entity)){var A=a[h].entity;for(e in A)if(A.hasOwnProperty(e)&&(c="vrc"===Q.CACHE.dev[h].type?"vrc-"+h+"-entity-"+e+"-measurement-":h+"-entity-"+e+"-measurement-",
void 0!==A[e].measurement&&!$.isEmptyObject(A[e].measurement)))for(g in d=A[e].measurement,d)d.hasOwnProperty(g)&&d[g].datalogEnabled&&$("#"+c+g).addClass("lcdSelected")}if(void 0!==a[h].analog&&!$.isEmptyObject(a[h].analog)){var m=a[h].analog;for(e in m)m.hasOwnProperty(e)&&m[e].datalogEnabled&&(c=h+"-analog-"+e,$("#"+c).addClass("lcdSelected"))}}}catch(L){b("error. logging.configSetSelected: "+L)}finally{}},R=function(){$("#content-pane").find(".ui-icon").each(function(){var a=$(this);(a.hasClass("ui-icon-wrench")||
a.hasClass("ui-icon-gear")||a.hasClass("ui-icon-trash"))&&a.hide()});$("#content-pane").find("[id$=showHide]").each(function(){$(this).hide()});$("#content-pane").find("[id$=pointTable]").each(function(){$(this).hide()});$("#logInterval-interval").val(Q.CACHE.logInterval);Q.CACHE.logging={};U();L();B(Q.USER.lang);T()};I.getPageLogging=function(){b("logging.getPageLogging...");try{var a=function(a,f,d){if(a&&0===a.retCode){Q.CACHE.dev=a.data;a=M();f=E("logging.log");d=$("<div></div>");d.append($("<div></div>").prop("id",
"logDownload").addClass("fm-group").append($("<fieldset></fieldset>").addClass("ui-corner-all").append(g("logging.download","transfer/log.json","JSON")).append(g("logging.download","transfer/log.csv","CSV"))));var h=!1;Q.CACHE.capability&&(Q.CACHE.capability.logging&&!0===Q.CACHE.capability.logging.setInterval)&&(h=!0);h&&d.append($("<div></div>").prop("id","logInterval").append(n("intervalHelp","logging.intervalWarning")).append($("<fieldset></fieldset>").addClass("ui-corner-all").append(l("logInterval-interval",
"logging.logInterval")).append(k("goSetLogInterval","diagAndTable.save","logInterval"))).append($("<hr>").addClass("spacer")));d.append($("<div></div>").prop("id","logClear").append($("<fieldset></fieldset>").addClass("ui-corner-all").append(k("goLogClear","logging.clear","clear"))));f.find("blockquote").append(d.find("#logDownload")).append(d.find("#logInterval")||"").append(d.find("#logClear"));a.append(f);f=!1;Q.CACHE.capability&&(Q.CACHE.capability.logging&&!0===Q.CACHE.capability.logging.setInterval)&&
(f=!0);if(f){f=E("menu.logging");d=F("");var h=Q.CACHE.dev,r=u(),A=$("<blockquote></blockquote>");if(h&&r)for(var m=0;m<r.length;m++){var L=r[m],x=K(L,h[L]);A.append(D(L));A.append(x.find(".section-header"));A.append(x.find(".section-body"))}f.find("blockquote").append(d.find("fieldset").append($("<h6></h6>").addClass("help-text ui-corner-all").append(q("lcddisplay.helpText"))).append(k("setLoggingConfig","diagAndTable.save","loggingConfig")).append(A));a.append(f)}$("#loading").replaceWith("");$(".section-header").replaceWith("");
$(".section-body").replaceWith("");$("#content-pane").append(a);R()}else b("/api/dev get: textStatus="+f+", jqXHR="+$.stringify(d)),c(Q.DIALOG_ERROR,e(a.retCode))};Q.CACHE.capability&&Q.CACHE.capability.logging&&!0===Q.CACHE.capability.logging.setInterval?w("/api/conf/datalog",!0,function(c,d,e){c&&0===c.retCode?Q.CACHE.logInterval=c.data.interval||"":(Q.CACHE.logInterval="",b("logging.getPageLogging, inner callback: failed to get interval."));w("/api/dev",!0,a,null,"get",null,null)},null,"get",null,
null):w("/api/dev",!0,a,null,"get",null,null)}catch(d){b("error. logging.getPageLogging: "+d)}};var z={RANGE:{7:15,6:60,5:120,4:480,3:1440,2:2880,1:10080,0:40320},COLORS:"#030132 #0000ff #00cccc #379998 #9b9aff #9a359d #9d0034 #ff0000 #f86808 #008000 #ff00ff #00ff00".split(" "),OBJ:null,DATA:null,DATA_START:null,RNG:0,RANGE_ADJ:!1,STATUS:"",STATUS_OK:"ok",STATUS_INSUFFICIENT_DATA:"insufficient data",STATUS_CLOCK_NOT_SET:"clock not set",CHART:null,getDateObject:function(a){try{var c=null,d,e,g;a&&
(a=z.trimDateString(a),d=a.split(" "),2<=d.length&&(e=d[0].split("-"),g=d[1].split(":"),3===e.length&&2<=g.length&&(c=new Date(e[0],Number(e[1])-1,e[2],g[0],g[1]))));return c}catch(h){b("error. getDateObject: "+h)}},trimDateString:function(a){var b="",c=null,d=null;if(a&&16===a.length)return a;a&&"string"===typeof a&&(c=a.split(" "))&&(d=c[1].split(":"))&&(b=c[0]+" "+d[0]+":"+d[1]);return b},getDateString:function(a,c){try{var d="",e=0;c||(c="yyyy-mm-dd hh:mm");if(a)switch(c){case "yyyy-mm-dd hh:mm":d+=
a.getFullYear()+"-";e=a.getMonth()+1;d+=10>e?"0":"";d+=e+"-";e=a.getDate();d+=10>e?"0":"";d+=e+" ";e=a.getHours();d+=10>e?"0":"";d+=e+":";e=a.getMinutes();d+=10>e?"0":"";d+=e;break;case "mm-dd":e=a.getMonth()+1;d+=10>e?"0":"";d+=e+"-";e=a.getDate();d+=10>e?"0":"";d+=e+" ";break;case "hh:mm":e=a.getHours(),d+=10>e?"0":"",d+=e+":",e=a.getMinutes(),d+=10>e?"0":"",d+=e}return d}catch(g){b("error. logging.Chart.getDateString: "+g)}},adjustData:function(a){var b=[],c,d,e,g,h;for(c=0;c<a.length;c++){e=a[c];
h=[];for(d=0;d<e.length;d++)g=e[d],g instanceof Array?h.push(g[0]):h.push(g);b.push(h)}return b},showChart:function(){try{var a="transfer/log.json";z.setDisplayButton(!1);var c=$("#range").val();if(c){z.RNG=parseInt(c);var a=a+("?start-time="+(0-60*z.RNG)),a=a+"&end-time=0",a=a+"&data-points=480",a=a+"&pad=true",c=function(a){if(a)switch(z.STATUS=a.status?a.status:"",z.DATA_START=a.dataStart?a.dataStart:null,b("showChart.cb:  range      = "+z.RNG),b("showChart.cb:  status     = "+z.STATUS),b("showChart.cb:  data start = "+
z.DATA_START),z.STATUS){case z.STATUS_CLOCK_NOT_SET:z.DATA=null;z.createChart(z.RNG);break;case z.STATUS_INSUFFICIENT_DATA:a=0;var c=Math.abs(z.DATA_START),f;for(f in"01234567".split(""))if(c>=60*z.RANGE[f]&&60*z.RNG>z.RANGE[f]){a=z.RANGE[f];$("#range").val(""+a);z.RANGE_ADJ=!0;z.showChart();return}0===a&&(z.DATA=null,z.RNG=0,z.createChart(z.RNG));break;case z.STATUS_OK:a.data=z.adjustData(a.data);z.DATA=a;z.createChart(z.RNG);break;default:b("error. logging.Chart.showChart.callback: invalid status")}else throw"cb: invalid response";
},d=Q.CACHE.logchart;!d||$.isEmptyObject(d)?(z.setChartMessage(q("logging.noMeasurementSelected"),!1),$("#chartLegend").empty(),z.setDisplayButton(!0),z.showCanvas(!1)):$.getJSON(a,c)}else b("logging.Chart.showChart: range undefined")}catch(e){b("logging.Chart.showChart: "+e),z.setDisplayButton(!0)}},setChartMessage:function(a,b){var c=$("#status-chart");c&&(c.html(a),b?c.removeClass("status-error").addClass("status-success"):c.removeClass("status-succes").addClass("status-error"))},showCanvas:function(a){var b=
$("#chart-div");b&&(!0===a?b.show():b.hide())},createLegend:function(a){var b=$("<table></table>");b.prop("cellpadding",0).prop("cellspacing",0).prop("border",0).append("<thead></thead>").append("<tbody></tbody>");for(var c=0;c<a.length;c++){for(var d=a[c],e=z.COLORS[c%z.COLORS.length],g=z.DATA.labels[d].id,d=z.DATA.labels[d].measurement,h="",k=0;k<z.DATA.devices.length;k++)if(g===z.DATA.devices[k].id){h=z.DATA.devices[k].name;break}b.find("tbody").append($("<tr></tr>").append($("<td></td>").prop("width",
"100px;").append("&nbsp;")).append($("<td></td>").prop("style","text-align:left ! important").append($("<span></span>").addClass("ui-corner-all").prop("style","display:inline-block; width: 10px; height 10px; background-color: "+e+"; border: #333 1px solid;").append("&nbsp;")).append("&nbsp;&nbsp;"+h+" "+d)))}$("#chartLegend").empty().append(b)},createChart:function(a){try{if(null===a||void 0===a)throw"Invalid parameter.";z.clearChart();z.setChartMessage("&nbsp;",!0);if(z.STATUS===z.STATUS_CLOCK_NOT_SET)b("createChart: error. clock not set"),
z.setChartMessage(q("logging.clockNotSet"),!1),z.setDisplayButton(!0);else{z.RANGE_ADJ&&(b("createChart: data range auto-adjusted"),c(Q.DIALOG_INFO,q("logging.rangeAdjusted")),z.RANGE_ADJ=!1);var d=z.DATA&&z.DATA.data?z.DATA.data:null;if(d)if(0===a)z.setChartMessage(q("logging.insufficientData"),!1),z.setDisplayButton(!0);else{var e=z.getSelectedCategories();if(!e||1>e.length)z.setChartMessage(q("logging.noMeasurementSelected"),!1),$("#chartLegent").empty(),z.setDisplayButton(!0);else{z.createLegend(e);
z.showCanvas(!0);var g,h,k=new Bluff.Line("blufflinechart","750x250");if(k){var A="",A=z.DATA.data[0][0],A=z.trimDateString(A),m=z.DATA.data[z.DATA.data.length-1][0],m=z.trimDateString(m),L=z.DATA.data[z.DATA.data.length-1];g=1;for(h=0;g<L.length;g++)h+=L[g];if(0===h)for(g=1;g<L.length;g++)z.DATA.data[z.DATA.data.length-1][g]=z.DATA.data[z.DATA.data.length-2][g];var l=q("logging.graphTitle"),l=l.replace("$1",A),l=l.replace("$2",m);k.title=l;k.tooltips=!1;k.hide_dots=!0;k.hide_legend=!0;k.title_font_size=
18;k.marker_font_size=12;k.theme_pastel();for(g=0;g<e.length;g++){var n=e[g],x=z.DATA.labels[n].measurement,I=z.getDataByIndex(n,d),J=I.length-1-a;0>J&&(J=0);I=I.slice(J);k.data(x,I,z.COLORS[g%z.COLORS.length])}k.line_width=1;k.labels=z.getChartLabels(a,A);k.left_margin=150;k.right_margin=150;k.draw();z.setDisplayButton(!0);z.CHART&&(z.CHART=null);z.CHART=k}else throw"Failed to instantiate chart object.";}}else b("createChart: error. no data"),z.setChartMessage(q("logging.noData"),!1),z.setDisplayButton(!0)}}catch(Y){b("logging.Chart.createChart: "+
Y),z.setDisplayButton(!0)}finally{}},getDataByIndex:function(a,b){for(var c=[],d,e=0;e<b.length;e++)a<b[e].length&&(d=b[e][a],c.push(d));return c},getChartLabels:function(a,c){try{var d={},e;if(a)if(c){var g=z.DATA.data.length,h=0,k=1,A="hh:mm";if(a===z.RANGE["0"]||a===z.RANGE["1"])A="mm-dd";switch(a){case z.RANGE["7"]:case z.RANGE["1"]:k=9;break;case z.RANGE["6"]:case z.RANGE["3"]:case z.RANGE["2"]:k=8;break;case z.RANGE["5"]:case z.RANGE["4"]:k=10;break;case z.RANGE["0"]:k=6}var m=Math.round(g/
k);1>m&&(m=1);for(e=0;e<k;e++){var L=z.getDateObject(z.DATA.data[h][0]);d[h]=z.getDateString(L,A);h+=m;h>g-1&&(h=g-1)}}else throw"Invalid from parameter";else throw"Invalid range parameter.";return d}catch(l){b("logging.Chart.getChartLabels: "+l),z.setDisplayButton(!0)}},getSelectedCategories:function(){var a=[],b,c,d,e=z.DATA&&z.DATA.labels?z.DATA.labels:null;if(e)for(c=0;c<e.length;c++)if(d=e[c].path)for(b in Q.CACHE.logchart)if(b===e[c].path.replace(/\//g,"-")){a.push(c);break}return a},clearChart:function(){try{z.CHART&&
(z.CHART.clear(),z.CHART=null)}catch(a){b("logging.Chart.clearChart: "+a)}},setDisplayButton:function(a){try{var c="",d=$("#goLogChart");0<d.length?a?(d.removeAttr("disabled"),c=q("logging.display"),d.html(c),$(document.body).css("cursor","default")):(d.attr("disabled","disabled"),c=q("logging.loading"),d.html(c),$(document.body).css("cursor","wait")):a?$(document.body).css("cursor","default"):$(document.body).css("cursor","wait")}catch(e){b("logging.Chart.setDisplayButton: "+e)}}},V=function(){$("tbody").on("click",
"td",function(){var a=$(this),b=a.prop("id");a.hasClass("_logDisabled")||(!b||-1===b.search("-measurement-")&&-1===b.search("-analog-"))||(a.hasClass("lcdSelected")?(a.removeClass("lcdSelected"),delete Q.CACHE.logchart[b]):(a.addClass("lcdSelected"),Q.CACHE.logchart[b]=!0));a.blur()});$('span[id*="allOrNone"]').on("click",function(a){m(a)});$("#goLogChart").on("click",function(){$("[id^=status-]").html("&nbsp;");$(this).blur();z.showChart()})},Y=function(){var a=$("<div></div>");a.append(N("T-chartCanvas")).append($("<div></div>").prop("id",
"options")).append($("<div></div>").prop("id","chartLegend")).append($("<div></div>").prop("id","logChart").append($("<fieldset></fieldset>").addClass("ui-corner-all").append(y("range","logging.range","40320 10080 2880 1440 480 120 60 15".split(" "),"timeSel.30d timeSel.7d timeSel.2d timeSel.24h timeSel.8h timeSel.2h timeSel.1h timeSel.15m".split(" "))).append(k("goLogChart","logging.display","chart"))));return a},X=function(){$("#content-pane").find(".ui-icon").each(function(){var a=$(this);(a.hasClass("ui-icon-wrench")||
a.hasClass("ui-icon-gear")||a.hasClass("ui-icon-trash"))&&a.hide()});Q.CACHE.logchart={};B(Q.USER.lang);V()};I.getPageLogChart=function(){b("logging.getPageLogChart...");try{Q.CACHE.logchart={},w("/api/dev",!0,function(a,f,d){if(a&&0===a.retCode){Q.CACHE.dev=a.data;a=M();f=E("logging.graph");f.find("blockquote").append(Y());a.append(f);a.append($("<blockquote></blockquote>").append($("<h6></h6>").addClass("help-text ui-corner-all").append(q("lcddisplay.helpText"))));f=Q.CACHE.dev;d=u();var g=$("<blockquote></blockquote>");
if(f&&d){for(var h=0;h<d.length;h++){var k=d[h],A=K(k,f[k]);g.append(D(k));g.append(A.find(".section-header"));g.append(A.find(".section-body"))}a.append(g)}$("#loading").replaceWith("");$(".section-header").replaceWith("");$(".section-body").replaceWith("");$("#content-pane").append(a);$("td._logDisabled").css("background","silver");X()}else b("/api/dev get: textStatus="+f+", jqXHR="+$.stringify(d)),c(Q.DIALOG_ERROR,e(a.retCode))},null,"get",null,null)}catch(a){b("error. logging.getPageLogChart: "+
a)}};var A=function(){b("logging.loggingClear...");var a=function(a,f,d){a?0===a.retCode?c(Q.DIALOG_SUCCESS,q("retCode.0")):a.retCode===Q.RETCODE.NOT_AUTHORIZED?c(Q.DIALOG_ERROR,q("err.notAuthorized")):c(Q.DIALOG_ERROR,e(a.retCode)):b("error. logging.loggingClear cb: "+$.stringify(d))},d={path:"/api/conf/datalog",cmd:"reset",access:H(),data:{target:{value:"logs"}}},g=function(){if(!P(d.path,d.cmd,!0))O(g,!0);else if(!d||h(d)){var b=v(d);w(d.path,!0,a,null,d.cmd,null,$.stringify(b))}};g()},L=function(){var a=
q("diagAndTable.youSure")+"<br>"+q("logging.logDeleted"),b=$("<div></div>");b.append($("<div></div>").prop("id","dialog-logging-clear").prop("title",q("diagAndTable.ack")).append($("<p></p>").append($("<span></span>").addClass("ui-icon ui-icon-alert").prop("style","float:left;margin:0 7px 20px 0;")).append($("<span></span>").prop("id","rusure").append(a))));G(b.html(),{autoOpen:!1,resizable:!1,width:300,height:150,modal:!0,buttons:[{id:"dlg-btn-datalog-clear-ok",text:q("diagAndTable.ok"),click:function(){$("[id^=status-]").html("&nbsp;");
A();$(this).dialog("close")}},{id:"dlg-btn-datalog-clear-cancel",text:q("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]})};return I}(Q.log,Q.JQO.getFormOptionLink,Q.JQO.getFormHelpText,Q.JQO.getFormOptionText,Q.JQO.getFormSubmit,Q.getLocalStr,Q.dialogAlert,Q.util.getRetCodeMsg,Q.util.strToInt,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.validate.test,Q.validate.getApiData,Q.apiCall,Q.cacheDeviceData,Q.JQO.eventHandler_selectAllOrNone,Q.localize,Q.JQO.getPageWrapper,Q.JQO.getSectionWrapperPlain,
Q.JQO.getFormGroup,Q.util.devGetSortedDevIds,Q.overview.getDeviceOverviewSection,Q.JQO.getSelectAllOrNone,Q.getTemplate,Q.JQO.getFormOptionList,Q.createDialog,Q.auth.accessControlNormal,Q.auth.accessTest,Q.dialogLogin);Q.reports=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u){var K={},D=function(a){var b=n("reports");if(b){b.find("thead").append(g("T-reportsTableHeader").find("tr"));for(var c in a)a.hasOwnProperty(c)&&b.find("tbody").append(N(c,a[c]))}return b},N=function(a,b){var c=0;b.targets&&b.targets instanceof Array&&(c=b.targets.length);var d=$("<tr></tr>");d.addClass("light-row").append($("<td></td>").addClass("alignLeft").append($("<span></span>").prop("id","m-report-"+a).addClass("ui-icon ui-icon-wrench action triggerIcon reportMod ui-corner-all").attr("index",
a)).append($("<span></span>").prop("id","d-report-"+a).addClass("ui-icon ui-icon-trash action triggerIcon reportDel ui-corner-all").attr("index",a))).append($("<td></td>").addClass("alignLeft").append(b.days)).append($("<td></td>").addClass("alignLeft").append(b.start)).append($("<td></td>").addClass("alignLeft").append(b.interval)).append($("<td></td>").addClass("alignLeft").append("["+c+"]"));return d},y=function(a){var b=l(),c=k("");c.find("blockquote").append(D(a));b.append(q("menu.reports")).append(c);
return b};K.getPageReports=function(){b("reports.getPageReports...");try{var g=function(k,l,n){k&&0===k.retCode?k.data?(Q.CACHE.reports=k.data,$("#loading").replaceWith(""),$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),$("#content-pane").append(y(Q.CACHE.reports)),c("reports"),e($("<div></div>").append($("<div></div>").prop("id","dialog-report")).html(),{autoOpen:!1,resizable:!1,width:500,modal:!0,open:function(){var a=$(this).dialog("option","index"),b=$(this).dialog("option",
"cmd");G("#dialog-report",Q.CACHE.reports[a],b)},buttons:[{id:"dlg-btn-report-ok",text:t("diagAndTable.ok"),click:function(){$("[id^=status-]").html("&nbsp;");var a="",b=[],c=$("#report-start-hour").val()+":"+$("#report-start-min").val(),d=Number($("#report-start-interval").val());$.each($("#report-days").find("input"),function(b,c){a+=$(c).is(":checked")?$(c).val():"-"});$.each($("div[id^='report-target-']").find("input:checked"),function(a,c){b.push($(c).val())});var e="/api/conf/report",h=$(this).dialog("option",
"cmd"),k=$(this).dialog("option","index");if("set"===h||"delete"===h)e+="/"+k;var l={path:e,cmd:h,data:{start:{value:c,error:E,reset:F,data:"report-start"},days:{value:a,error:E,reset:F,data:"report-days"},targets:{value:b,error:E,reset:F,data:"report-targets"},interval:{value:d,error:E,reset:F,data:"report-interval"}}};"delete"===h&&(l.data={});var A=function(){if(!M(l.path,l.cmd,!0))u(A,!0);else if(!l||m(l)){var a=B(l);Q.CACHE.opBuf=a;Q.CACHE.opId=k;s(l.path,!0,g,null,l.cmd,null,$.stringify(a));
$("#dialog-report").dialog("close");K.getPageReports()}};A()}},{id:"dlg-btn-report-cancel",text:t("diagAndTable.cancel"),click:function(){a(Q.CACHE.opId,!1);Q.CACHE.opId=null;$(this).dialog("close")}}]}),d(Q.USER.lang),$("#a-newReport").on("click",function(){var a=0;if(Q.CACHE.reports)for(var b in Q.CACHE.reports)a++;a>=Q.MAX.REPORTS?(a=t("common.maxAllowed"),a=a.replace("$1",""+Q.MAX.REPORTS),h(Q.DIALOG_INFO,a)):($("#dialog-report").dialog({title:t("diagAndTable.add"),cmd:"add"}).dialog("open"),
$("#dlg-btn-report-cancel").focus())}),$(".reportMod").on("click",function(b){Q.CACHE.opId=$(b.target).prop("id");a(Q.CACHE.opId,!0);b=$(b.target).attr("index");$("#dialog-report").dialog({title:t("diagAndTable.mod"),index:b,cmd:"set"}).dialog("open");$("#dlg-btn-report-cancel").focus()}),$(".reportDel").on("click",function(b){Q.CACHE.opId=$(b.target).prop("id");a(Q.CACHE.opId,!0);b=$(b.target).attr("index");$("#dialog-report").dialog({title:t("diagAndTable.delete"),index:b,cmd:"delete"}).dialog("open");
$("#dlg-btn-report-cancel").focus()})):K.getPageReports():(h(Q.DIALOG_ERROR,v(k.retCode)),b("/api/conf/report get: textStatus="+l+", jqXHR="+$.stringify(n)))};s("/api/alarm/target",!0,function(a,c,d){a&&0===a.retCode?(null===Q.CACHE.alarm&&(Q.CACHE.alarm={}),Q.CACHE.alarm.target=a.data,s("/api/conf/report",!0,g,null,"get",null,null)):b("error. reports.getPageReports:alarmCB: failed to get alarm targets: "+c)},null,"get",null,null)}catch(k){b("error. reports.getPageReports: "+k)}};var G=function(a,
b,c){$(a).empty();if("delete"===c)$(a).append($("<p></p>").append($("<span></span>").addClass("ui-icon ui-icon-alert").css({"float":"left",margin:"0 7px 20px 0"})).append($("<span></span>").html(t("diagAndTable.youSure"))));else{var d="00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23".split(" "),e=["00","15","30","45"],g=[1,2,3,4,6,8,12,24],h=[t("alarms.monday"),t("alarms.tuesday"),t("alarms.wednesday"),t("alarms.thursday"),t("alarms.friday"),t("alarms.saturday"),t("alarms.sunday")],
k=$("<div></div>").prop("id","report-days"),m=$("<div></div>"),l=$("<select></select>").addClass("ui-corner-all").prop("id","report-start-hour").css("width","75px"),n=$("<select></select>").addClass("ui-corner-all").prop("id","report-start-min").css("width","75px"),q=$("<select></select>").addClass("ui-corner-all").prop("id","report-start-interval").css("width","75px"),s=Q.CACHE.alarm&&Q.CACHE.alarm.target?Q.CACHE.alarm.target:{},A=0;$.each(h,function(a,b){k.append($("<input>").prop("type","checkbox").prop("id",
"report-day-"+a).val(b)).append($("<label></label>").attr("for","report-day-"+a).html(b))});for(h=0;h<d.length;h++)l.append($("<option></option>").html(d[h]));for(d=0;d<e.length;d++)n.append($("<option></option>").html(e[d]));for(e=0;e<g.length;e++)q.append($("<option></option>").html(g[e]));for(var L in s)s.hasOwnProperty(L)&&("email"===s[L].group&&m.append($("<div></div>").prop("id","report-target-"+L).append($("<input>").prop("type","checkbox").prop("id","report-target-"+A).val(L)).append($("<label></label>").attr("for",
"report-target-"+A).html(w(s[L].name)))),A++);g=$("<table></table>").addClass("form-table").append($("<thead></thead>")).append($("<tbody></tbody>"));g.find("tbody").empty().append($("<tr></tr>").addClass("pad-row").append($("<td></td>"))).append($("<tr></tr>").addClass("form-row").append($("<td></td>").addClass("reportLeft").html(t("alarms.days"))).append($("<td></td>").addClass("reportRight").append(k))).append($("<tr></tr>").addClass("form-row").append($("<td></td>").addClass("reportLeft").html(t("configsys.reports.start"))).append($("<td></td>").addClass("reportRight").append(l).append(n))).append($("<tr></tr>").addClass("form-row").append($("<td></td>").addClass("reportLeft").html(t("configsys.reports.interval"))).append($("<td></td>").addClass("reportRight").append(q))).append($("<tr></tr>").addClass("form-row").append($("<td></td>").addClass("reportLeft").html(t("configsys.reports.header.targets"))).append($("<td></td>").addClass("reportRight").append(m)));
$(a).append(g);if("set"===c){var f=b.days.split("");a=b.start.split(":");$("#report-start-hour").val(a[0]);$("#report-start-min").val(a[1]);$("#report-start-interval").val(b.interval);$.each($("#report-days").find("input"),function(a,b){"-"!==f[a]&&$(b).prop("checked",!0)});$.each($("div[id^='report-target-']").find("input"),function(a,c){0<=$.inArray($(c).val(),b.targets)&&$(c).prop("checked",!0)})}}};return K}(Q.log,Q.getTemplate,Q.JQO.getFormTable,Q.JQO.getPageWrapper,Q.JQO.getSection,Q.JQO.getSectionHeaderPlain,
Q.util.fixTableRows,Q.createDialog,Q.getLocalStr,Q.apiCall,Q.rowActionStyleUpdate,Q.dialogAlert,Q.util.getRetCodeMsg,Q.util.escapeHtml,Q.localize,Q.validate.test,Q.validate.getApiData,Q.auth.accessTest,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.dialogLogin);Q.snmp=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u,K,D,N,y,G,H,P,O,I,J,x,T,U,R,z,V,Y,X,A,L,f,r,p){var W={},S=0,Z=function(a){var b=l(),f=k(""),d=k(""),h=k(""),p=g(""),C="/mib.zip";Q.CACHE.capability&&(Q.CACHE.capability.snmp&&Q.CACHE.capability.snmp.mibLink)&&(C=Q.CACHE.capability.snmp.mibLink);p.prop("id","mibDownload");p.find("fieldset").append(n("configsys.snmp.downloadMIB",C,"ZIP"));C=g("");C.find("fieldset").append(c("snmp-v1v2cEnabled","configsys.snmp.v1v2cService",["true","false"],["diagAndTable.enabled",
"diagAndTable.disabled"])).append(c("snmp-v3Enabled","configsys.snmp.v3Service",["true","false"],["diagAndTable.enabled","diagAndTable.disabled"])).append(e("snmp-port","configsys.snmp.port")).append(t("setSnmpMain","diagAndTable.save","snmp-main"));f.find("blockquote").append(p).append(C);d.find("blockquote").append(pa());h.find("blockquote").append(ca(a));b.append(q("menu.snmp")).append(f).append(q("configsys.snmp.users")).append(d).append(q("configsys.snmp.traps")).append(h);return b},aa=function(c){b("snmp.initSnmp");
if(c){var f=c.v1v2cEnabled;"boolean"!==typeof f&&(f=s(f));$("#snmp-v1v2cEnabled").val(""+f);f=c.v3Enabled;"boolean"!==typeof f&&(f=s(f));$("#snmp-v3Enabled").val(""+f);$("#snmp-port").val(c.port?c.port:"161");Aa()}else b("snmp.initSnmp: no data");Ga();ua("add");Ma();ua("modify");a(Q.USER.lang)},ja=function(){b("snmp.setSnmpMain");var a=function(a,c,f){a?0===a.retCode?(Q.CACHE.conf.snmp=Q.CACHE.opBuf,$("[id^=status-]").html("&nbsp;"),$("#status-snmp-main").removeClass("status-error").addClass("status-success").html(h("success"))):
a.retCode===Q.RETCODE.NOT_AUTHORIZED?v(Q.DIALOG_ERROR,h("err.notAuthorized")):v(Q.DIALOG_ERROR,w(a.retCode)):b("jqXHR = "+$.stringify(f));Q.CACHE.opBuf=null},c=s($("#snmp-v1v2cEnabled").val()),f=s($("#snmp-v3Enabled").val()),e={path:"/api/conf/snmp",cmd:"set",access:X(),data:{v1v2cEnabled:{value:c,error:d,reset:m,data:"snmp-v1v2cEnabled"},v3Enabled:{value:f,error:d,reset:m,data:"snmp-v3Enabled"}}},c={data:{port:{value:M($("#snmp-port").val()),error:d,reset:m,data:"snmp-port"}}};$.extend(!0,e,c);var g=
function(){if(!A(e.path,e.cmd,!0))p(g,!0);else if(!e||E(e)){var b=F(e);Q.CACHE.opBuf=b;u(e.path,!0,a,null,e.cmd,null,$.stringify(b))}};g()};W.getPageSnmp=function(){b("snmp.getPageSnmp...");try{u("/api/conf/snmp",!0,function(a,c,f){a&&0===a.retCode?(null===Q.CACHE.conf&&(Q.CACHE.conf={}),Q.CACHE.conf.snmp=a.data?a.data:null,a=Q.CACHE.conf.snmp,$("#loading").replaceWith(""),$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),$("#content-pane").append(Z(a)),aa(a),$("#a-newTrap").attr("title",
h("diagAndTable.add")),$("[id^=d-snmp-trap-]").attr("title",h("diagAndTable.delete")),$("[id^=m-snmp-trap-]").attr("title",h("diagAndTable.mod")),$("[id^=t-snmp-trap-]").attr("title",h("configsys.snmp.test")),K("snmp-traps"),$("[id^=m-snmp-user-]").attr("title",h("diagAndTable.mod")),K("snmp-users"),$(".actionUserMod").on("click",function(){$("[id^=status-]").html("&nbsp;");b("snmp.eventHandlerUserMod...");var a=($(this).attr("id")||"").replace("m-snmp-user-","");D("m-snmp-user-"+a,!0);$("#dialog-snmp-user").data("userId",
a).dialog("open")}),$(".actionTrapAdd").on("click",function(){$("[id^=status-]").html("&nbsp;");if(S>=Q.MAX.SNMP_TRAPS){var a=h("common.maxAllowed"),a=a.replace("$1",Q.MAX.SNMP_TRAPS);v(Q.DIALOG_INFO,a)}else $("#snmp-trap-add-target").val(""),$("#snmp-trap-add-version").val("2c"),$("#snmp-trap-add-port").val("162"),$("#status-snmp-trap-add").html("&nbsp;"),B("dialog-snmp-trap-add"),$("#dialog-snmp-trap-add").dialog("open")}),$("#snmp-traps").on("click",".actionTrapDel",function(){$("[id^=status-]").html("&nbsp;");
var a=$(this).attr("index");$("#dialog-snmp-trap-delete").attr("index",a).dialog("open");D("d-snmp-trap-"+a,!0,!0)}),$("#snmp-traps").on("click",".actionTrapMod",function(){$("[id^=status-]").html("&nbsp;");var a=$(this).attr("index"),b=$(this).parent().siblings(),c=$(b[0]).text(),f=$(b[1]).text(),b=$(b[2]).text();$("#snmp-trap-modify-target").val("--"===c?"":c);$("#snmp-trap-modify-port").val(f);$("#snmp-trap-modify-version").val(b);$("#status-snmp-trap-modify").html("&nbsp;");B("dialog-snmp-trap-modify");
$("#dialog-snmp-trap-modify").attr("index",a).dialog("open");D("m-snmp-trap-"+a,!0,!0)}),$("#snmp-traps").on("click",".actionTrapTest",function(){la($(this).attr("index"))}),$("#setSnmpMain").on("click",function(){$("[id^=status-]").html("&nbsp;");ja();$(this).blur()})):(b("/api/conf/snmp get: textStatus="+c+", jqXHR="+$.stringify(f)),v(Q.DIALOG_ERROR,w(a.retCode)))},null,"get",null,null)}catch(a){b("error. snmp.getPageSnmp: "+a)}};var da=function(){var a=N()?"common.ipAddress":"common.host",b=y("T-snmpTrapTableHeader");
b.find("th._namelabel").attr("data-localize",a);return b.find("tr")},ba=function(a,b,c,f){b=G(b);var d=$("<tr></tr>");d.prop("id","r-trap-"+a).addClass("light-row").append($("<td></td>").addClass("w50").append($("<span></span>").prop("id","m-snmp-trap-"+a).attr("index",a).addClass("ui-icon ui-icon-wrench action triggerIcon actionTrapMod ui-corner-all")).append($("<span></span>").prop("id","d-snmp-trap-"+a).attr("index",a).addClass("ui-icon ui-icon-trash action triggerIcon actionTrapDel ui-corner-all")).append($("<span></span>").prop("id",
"t-snmp-trap-"+a).attr("index",a).addClass("ui-icon ui-icon-gear action triggerIcon actionTrapTest ui-corner-all"))).append($("<td></td>").addClass("trapName alignLeft").append(b?b:"--")).append($("<td></td>").addClass("trapPort alignCenter").append(c?c:"--")).append($("<td></td>").addClass("trapVersion alignLeft").append(f));return d},ca=function(a){var c=H("snmp-traps");if(c)if(c.find("thead").append(da()),a&&a.target){a=a.target;S=0;for(var f in a)a.hasOwnProperty(f)&&(c.find("tbody").append(ba(f,
a[f].name,a[f].port,a[f].trapVersion)),S++)}else b("error. snmp.getTrapTable: no snmp trap targets"),S=0;return c},ka=function(a,c,f){a&&0===a.retCode?(Q.CACHE.conf.snmp.target=a.data,$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),W.getPageSnmp()):(b("/api/conf/snmp/target get: textStatus="+c+", jqXHR="+$.stringify(f)),v(Q.DIALOG_ERROR,"Error. RetCode="+a.retCode+"<br>"+h("retCode."+a.retCode)))},ga=function(a){b("snmp.deleteTrap:"+a);var c=function(a,b,c){a&&0===a.retCode?
($("[id^=status-]").html(""),$("#status-snmp-trap-delete").removeClass("status-error").addClass("status-success").html(h("success")),u("/api/conf/snmp/target",!1,ka,null,"get",null,null)):v(Q.DIALOG_ERROR,w(a.retCode))},f=function(){A("/api/conf/snmp/target/"+a,"delete",!0)?P("/api/conf/snmp/target/"+a,c):p(f,!0)};f();return!0},ea=function(a,c,f,e,g){b("addModifyTrap: "+a);var k=function(c,f,d){c?0===c.retCode?($("[id^=status-]").html(""),$("#status-snmp-trap-"+a).removeClass("status-error").addClass("status-success").html(h("success")),
u("/api/conf/snmp/target",!1,ka,null,"get",null,null)):c.retCode===Q.RETCODE.NOT_AUTHORIZED?v(Q.DIALOG_ERROR,h("err.notAuthorized")):v(Q.DIALOG_ERROR,w(c.retCode)):b("jqXHR = "+$.stringify(d));Q.CACHE.opBuf=null};"--"===f&&(f="");var C="/api/conf/snmp/target";"modify"===a&&(C+="/"+c);var r={path:C,cmd:"add"===a?"add":"set",access:X(),data:{name:{value:f,error:d,reset:m,data:"snmp-trap-"+a+"-target"},port:{value:M(e),error:d,reset:m,data:"snmp-trap-"+a+"-port"},trapVersion:{value:g,error:d,reset:m,
data:"snmp-trap-"+a+"-version"}}},l=function(){if(!A(r.path,r.cmd,!0))p(l,!0);else if(!r||E(r)){var a=F(r);Q.CACHE.opBuf=a;u(r.path,!0,k,null,r.cmd,null,$.stringify(a));return!0}};l()},la=function(a){b("sendTestTrap");var c=function(a,c,f){a?0===a.retCode?v(Q.DIALOG_SUCCESS,h("success")):a.retCode===Q.RETCODE.NOT_AUTHORIZED?v(Q.DIALOG_ERROR,h("err.notAuthorized")):v(Q.DIALOG_ERROR,w(a.retCode)):b("jqXHR = "+$.stringify(f));Q.CACHE.opBuf=null},f={path:"/api/conf/snmp/target/"+a,cmd:"sendTest",access:X()},
d=function(){if(!A(f.path,f.cmd,!0))p(d,!0);else if(!f||E(f)){var a=F(f);Q.CACHE.opBuf=a;u(f.path,!0,c,null,f.cmd,null,$.stringify(a))}};d()},ha=function(a,b){var c=$("<div></div>"),f=O("/api/conf/snmp/user/0","set",b)||[];c.append($("<select></select>").addClass("ui-corner-all").prop("id",a).append($("<option></option>").prop("value","none").attr("data-localize","state.none").append("&nbsp;")));$.each(f,function(a,b){"none"!==b&&c.find("select").append($("<option></option>").prop("value",b).append(b.toUpperCase()))});
return c.html()},ia=function(a,b){var c=$("<tr></tr>");c.prop("id","r-snmp-user-"+a).addClass("light-row").append($("<td></td>").append($("<span></span>").prop("id","m-snmp-user-"+a).addClass("ui-icon ui-icon-wrench action triggerIcon actionUserMod ui-corner-all"))).append($("<td></td>").attr("data-localize",b).addClass("alignLeft").append("&nbsp;")).append($("<td></td>").prop("id","snmp-user-name-"+a).addClass("alignLeft").append("&nbsp;")).append($("<td></td>").prop("id","snmp-user-auth-"+a).addClass("alignLeft").append("&mdash;")).append($("<td></td>").prop("id",
"snmp-user-priv-"+a).addClass("alignLeft").append("&mdash;"));return c},pa=function(){var a=H("snmp-users");a&&(a.find("thead").append(y("T-snmpUserTableHeader").find("tr")),$.each("configsys.snmp.v1read configsys.snmp.v1write configsys.snmp.v1trap configsys.snmp.v3read configsys.snmp.v3write configsys.snmp.v3trap".split(" "),function(b,c){a.find("tbody").append(ia(b,c))}));return a},C=function(a,c){if("object"===typeof c&&"number"===typeof a){$("#snmp-user-name-"+a).html(G(c.username)||"");var f=
h("state.none"),d=f;"none"!==c.privType&&(d=c.privType.toUpperCase());"none"!==c.authType&&(f=c.authType.toUpperCase(),"SHA"===f&&(f="SHA1"));$("#snmp-user-priv-"+a).html(d);$("#snmp-user-auth-"+a).html(f)}else b("error. snmp.initUser: bad userId or userData")},fa=function(){u("/api/conf/snmp",!0,function(a,c,f){a?0===a.retCode&&(Q.CACHE.conf.snmp=a.data,Aa()):b("error. snmp.syncUserTable: "+$.stringify(f))},null,"get",null,null)},Aa=function(){var a=Q.CACHE.conf&&Q.CACHE.conf.snmp;a&&($("#snmp-user-name-0").html(G(a.readCommunity)||
""),$("#snmp-user-name-1").html(G(a.writeCommunity)||""),$("#snmp-user-name-2").html(G(a.trapCommunity)||""),a=a.user)&&(C(3,a["0"]),C(4,a["1"]),C(5,a["2"]))},Da=function(a){a=a&&"add"===a?"add":"modify";var b=O("/api/conf/snmp/target/0","set","trapVersion")||[],c=$.map(b,function(a){return"configsys.snmp.v"+a}),f="add"===a?h("diagAndTable.add"):h("diagAndTable.mod"),d=N()?"common.ipAddress":"common.host",e=y("T-dialogTablePadRow").find("tr"),g=$("<div></div>");g.prop("id","dialog-snmp-trap-"+a).prop("title",
f).append($("<table></table>").addClass("form-table").append(e.clone()).append(I("snmp-trap-"+a+"-target",d)).append(I("snmp-trap-"+a+"-port","common.port")).append(J("snmp-trap-"+a+"-version","info.version",b,c,null,!0)).append(e.clone())).append($("<div></div>").prop("id","status-snmp-trap-"+a).append("&nbsp;"));return $("<div></div>").append(g)},ua=function(a){var b=a&&"add"===a?"add":"modify";x(Da(b).html(),{autoOpen:!1,resizable:!1,width:550,modal:!0,close:function(){D("m-snmp-trap-"+$(this).attr("index"),
!1,!0)},buttons:[{id:"dlg-btn-snmp-trap-"+b+"-save",text:h("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");"modify"===b?ea(b,$(this).attr("index"),$("#snmp-trap-modify-target").val(),$("#snmp-trap-modify-port").val(),$("#snmp-trap-modify-version").val())&&(D("m-snmp-trap-"+$(this).attr("index"),!1,!0),$(this).dialog("close")):"add"===b&&ea(b,null,$("#snmp-trap-add-target").val(),$("#snmp-trap-add-port").val(),$("#snmp-trap-add-version").val())&&$(this).dialog("close")}},{id:"dlg-btn-snmp-trap-"+
b+"-cancel",text:h("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]})},Ia=function(){var a=h("diagAndTable.youSure"),b=$("<div></div>");b.prop("id","dialog-snmp-trap-delete").prop("title",h("diagAndTable.delete")).append($("<p></p>").append($("<span></span>").addClass("ui-icon ui-icon-alert").prop("style","float:left;margin:0 7px 20px 0;")).append($("<span></span>").prop("id","rusure").append(a)));return $("<div></div>").append(b)},Ma=function(){x(Ia().html(),{autoOpen:!1,resizable:!1,
width:300,height:150,modal:!0,close:function(){D("d-snmp-trap-"+$(this).attr("index"),!1,!0)},buttons:[{id:"dlg-btn-snmp-trap-delete-delete",text:h("diagAndTable.delete"),click:function(){$("[id^=status-]").html("&nbsp;");ga($(this).attr("index"))&&(D("d-snmp-trap-"+$(this).attr("index"),!1,!0),$(this).dialog("close"))}},{id:"dlg-btn-snmp-trap-delete-cancel",text:h("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]})},xa=function(){var a=y("T-dialogTablePadRow").find("tr"),b=$("<div></div>");
b.prop("id","dialog-snmp-user").prop("title",h("diagAndTable.mod")).append($("<table></table>").addClass("form-table").append(a.clone()).append(I("snmp-user-name","common.name")).append(a.clone()).append(T()).append(U("configsys.snmp.auth",null,!0)).append(R(ha("snmp-user-authType","authType"),"configsys.snmp.type")).append(z("snmp-user-authPass","configsys.snmp.password")).append(T()).append(U("configsys.snmp.privacy",null,!0)).append(R(ha("snmp-user-privType","privType"),"configsys.snmp.type")).append(z("snmp-user-privPass",
"configsys.snmp.password")).append(a.clone())).append($("<div></div>").prop("id","status-snmp-user-mod").append("&nbsp;"));return $("<div></div>").append(b)},ra=function(a,c,f){a?0===a.retCode?fa():v(Q.DIALOG_ERROR,w(a.retCode)):b("error. snmp.userModifyCB: "+$.stringify(f));$("#snmp-user-privType").data("prev",null);$("#snmp-user-privPass").data("prev",null);$("#snmp-user-authPass").data("prev",null);D("m-snmp-user-"+$("#dialog-snmp-user").data("userId"),!1,!0);$("#dialog-snmp-user").dialog("close")},
Ca=function(a){var b=Ea(["readCommunity","writeCommunity","trapCommunity"][a]),c=function(){if(!A("/api/conf/snmp","set",!0))p(c,!0);else if(!b||E(b)){var a=F(b);u("/api/conf/snmp",!0,ra,null,"set",null,$.stringify(a))}};c()},va=function(a){var b=a-3,c=ma(b);if(c&&qa(b,c.data.username)){var f=function(){if(!A("/api/conf/snmp/user/"+b,"set",!0))p(f,!0);else if(!c||E(c)){var a=F(c);u("/api/conf/snmp/user/"+b,!0,ra,null,"set",null,$.stringify(a))}};f()}},Ga=function(){x(xa().html(),{autoOpen:!1,resizable:!1,
width:500,modal:!0,close:function(){D("m-snmp-user-"+$("#dialog-snmp-user").data("userId"),!1,!0)},open:function(){b("snmp.userOpen...");var a=$(this).data("userId")||-1;B("dialog-snmp-user");if(0<=a&&2>=a){var c=Q.CACHE.conf&&Q.CACHE.conf.snmp||{},a=[c.readCommunity,c.writeCommunity,c.trapCommunity][a]||"";$("#snmp-user-name").val(a);$("#dialog-snmp-user").find("tr:gt(2)").hide()}else if(3<=a&&5>=a){var a=(c=Q.CACHE.conf&&Q.CACHE.conf.snmp&&Q.CACHE.conf.snmp.user)&&c[a-3]||{},c=$("#snmp-user-authType"),
d=$("#snmp-user-privType");$("#snmp-user-name").val(a.username||"");var e=a.authType;"sha"===e&&(e="sha1");c.val(e||"none");d.val(a.privType||"none");L("snmp-user-authPass",a.authPasswordSet);L("snmp-user-privPass",a.privPasswordSet);d.data("prev",d.val());$("#snmp-user-privPass").data("prev",f("snmp-user-privPass"));$("#snmp-user-authPass").data("prev",f("snmp-user-authPass"));d.trigger("change");c.trigger("change");$("#dialog-snmp-user").find("tr:gt(2)").show()}},buttons:[{id:"dlg-btn-snmp-user-save",
text:h("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");B("dialog-snmp-user");b("snmp.userModify...");var a=$(this).data("userId")||-1;0<=a&&2>=a?Ca(a):3<=a&&5>=a?va(a):(D("m-snmp-user-"+a,!1,!0),$(this).dialog("close"))}},{id:"dlg-btn-snmp-user-cancel",text:h("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]});Ba("snmp-user-authPass");Ba("snmp-user-privPass");var a=$("#snmp-user-privType");a.on("change",function(){$("#snmp-user-privPass").trigger("privTypeMod",
$(this).val())});a.on("authTypeMod",function(a,b){var c=$(this);"none"===b?(c.data("prev",c.val()).val("none").trigger("change"),V("snmp-user-privType",!1)):(V("snmp-user-privType",!0),c.val(c.data("prev")||"none").trigger("change"))});$("#snmp-user-privPass").on("privTypeMod",function(a,b){var c="";"none"===b?(c=f("snmp-user-privPass"),$(this).data("prev",c),V("snmp-user-privPass",!1),r("snmp-user-privPass",!1)):(c=$(this).data("prev")||!1,V("snmp-user-privPass",!0),r("snmp-user-privPass",c))});
$("#snmp-user-authPass").on("authTypeMod",function(a,b){var c="";"none"===b?(c=f("snmp-user-authPass"),$(this).data("prev",c),V("snmp-user-authPass",!1),r("snmp-user-authPass",!1)):(c=$(this).data("prev")||!1,V("snmp-user-authPass",!0),r("snmp-user-authPass",c))});$("#snmp-user-authType").on("change",function(){$("#snmp-user-authPass").trigger("authTypeMod",$(this).val());$("#snmp-user-privType").trigger("authTypeMod",$(this).val())})},Ba=function(a){$("#"+a).off().on("focus",function(){$("#dlg-btn-snmp-user-cancel").focus();
Y(f(a),function(b){r(a,b)},sa)})},sa=function(a,b){var c=!0;E({path:"/api/conf/snmp/user/0",cmd:"set",data:{privPassword:{value:a,error:b}}})||(c=!1);return c},Ea=function(a){var b={path:"/api/conf/snmp",cmd:"set",access:X(),data:{}};b.data[a]={value:$("#snmp-user-name").val(),error:d,reset:m,data:"snmp-user-name"};return b},ma=function(a){var b=null,c=!0,e=$("#snmp-user-authType").val(),g=f("snmp-user-authPass"),h=$("#snmp-user-privType").val(),k=f("snmp-user-privPass");a={path:"/api/conf/snmp/user/"+
a,cmd:"set",access:X(),data:{username:{value:$("#snmp-user-name").val(),error:d,reset:m,data:"snmp-user-name"},authType:{value:e,error:d,reset:m,data:"snmp-user-authType"},privType:{value:h,error:d,reset:m,data:"snmp-user-privType"}}};var p={data:{authPassword:{value:g,error:d,reset:m,data:"snmp-user-authPass"}}},C={data:{privPassword:{value:k,error:d,reset:m,data:"snmp-user-privPass"}}};"none"!==e&&("string"===typeof g?$.extend(!0,a,p):!1===g&&(d(null,{key:"configsys.snmp.missingPassword"},"snmp-user-authPass"),
c=!1));"none"!==h&&("string"===typeof k?$.extend(!0,a,C):!1===k&&(d(null,{key:"configsys.snmp.missingPassword"},"snmp-user-privPass"),c=!1));c&&(b=a);return b},qa=function(a,b){var c=!0,f={key:"configsys.snmp.namesUnique"};$.each(Q.CACHE.conf&&Q.CACHE.conf.snmp&&Q.CACHE.conf.snmp.user||{},function(f,d){if(f!==a.toString()&&d.username&&d.username===b)return c=!1});c||d(null,f,"snmp-user-name");return c};return W}(Q.log,Q.JQO.getFormGroup,Q.JQO.getFormOptionLink,Q.JQO.getPageWrapper,Q.JQO.getSection,
Q.JQO.getSectionHeaderPlain,Q.JQO.getFormOptionList,Q.JQO.getFormOptionText,Q.JQO.getFormSubmit,Q.util.strToBool,Q.localize,Q.getLocalStr,Q.dialogAlert,Q.util.getRetCodeMsg,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.util.fieldErrorTextResetAll,Q.util.strToInt,Q.validate.test,Q.validate.getApiData,Q.apiCall,Q.util.fixTableRows,Q.rowActionStyleUpdate,Q.util.ipOnly,Q.getTemplate,Q.util.escapeHtml,Q.JQO.getFormTable,Q.apiCallDelete,Q.validate.getEnumValues,Q.JQO.getDialogOptionText,Q.JQO.getDialogOptionList,
Q.createDialog,Q.JQO.getDialogOptionHR,Q.JQO.getDialogOptionLabel,Q.JQO.getDialogOptionHtml,Q.JQO.getDialogOptionPass,Q.util.fieldInputState,Q.JQO.passwordDialog,Q.auth.accessControlNormal,Q.auth.accessTest,Q.auth.passwordInputInit,Q.auth.passwordInputGet,Q.auth.passwordInputSet,Q.dialogLogin);Q.ssh=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u,K,D){var N={},y=function(){var a=g(""),b=n("");b.find("fieldset").append(l("ssh-enabled","configsys.ssh.enabled",["true","false"],["diagAndTable.enabled","diagAndTable.disabled"])).append(k("ssh-port","common.port")).append(q("setSsh","diagAndTable.save","ssh"));a.find("blockquote").append(b);return a},G=function(){b("ssh.initSSH...");var a=Q.CACHE.conf&&Q.CACHE.conf.ssh?Q.CACHE.conf.ssh:null;a?($("#ssh-enabled").val(a.enabled?"true":"false").change(),
$("#ssh-port").val(a.port)):b("ssh.initSSH: no data");a=null;$("#setSsh").on("click",function(){$("[id^=status-]").html("&nbsp;");H();$(this).blur()});$("#ssh-enabled").on("change",function(){var a=$(this).val();c("ssh-port",a)}).change()},H=function(){b("ssh.setSSH...");var c=function(a,c,d){if(a)if(0===a.retCode){if($("[id^=status-]").html("&nbsp;"),$("#status-ssh").removeClass("status-error").addClass("status-success").html(e("success")),a=Q.CACHE.opBuf)"boolean"!==typeof a.enabled||a.enabled?
Q.CACHE.conf.ssh=a:Q.CACHE.conf.ssh.enabled=a.enabled}else a.retCode===Q.RETCODE.NOT_AUTHORIZED?t(Q.DIALOG_ERROR,e("err.notAuthorized")):t(Q.DIALOG_ERROR,s(a.retCode));else b("jqXHR = "+$.stringify(d));Q.CACHE.opBuf=null},g=a($("#ssh-enabled").val()),k={path:"/api/conf/ssh",cmd:"set",access:u(),data:{enabled:{value:g,error:h,reset:v,data:"ssh-enabled"}}},l={data:{port:{value:w($("#ssh-port").val()),error:h,reset:v,data:"ssh-port"}}};g&&$.extend(!0,k,l);var n=function(){if(!K(k.path,k.cmd,!0))D(n,
!0);else if(!k||d(k)){var a=m(k);Q.CACHE.opBuf=a;B(k.path,!0,c,null,k.cmd,null,$.stringify(a))}};n()};N.getPageSSH=function(){b("ssh.getPageSSH...");try{B("/api/conf/ssh",!0,function(a,c,d){a&&0===a.retCode?(null===Q.CACHE.conf&&(Q.CACHE.conf={}),Q.CACHE.conf.ssh=a.data?a.data:null,a=M(""),a.append(E("menu.ssh")).append(y()),$("#loading").replaceWith(""),$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),$("#content-pane").append(a),F(Q.USER.lang),G()):(b("/api/conf/ssh get: textStatus="+
c+", jqXHR="+$.stringify(d)),t(Q.DIALOG_ERROR,s(a.retCode)))},null,"get",null,null)}catch(a){b("error. ssh.getPageSSH: "+a)}};return N}(Q.log,Q.JQO.getSection,Q.JQO.getFormGroup,Q.JQO.getFormOptionList,Q.JQO.getFormOptionText,Q.JQO.getFormSubmit,Q.util.fieldInputState,Q.getLocalStr,Q.dialogAlert,Q.util.getRetCodeMsg,Q.util.strToBool,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.util.strToInt,Q.validate.test,Q.validate.getApiData,Q.apiCall,Q.JQO.getPageWrapper,Q.JQO.getSectionHeaderPlain,Q.localize,
Q.auth.accessControlNormal,Q.auth.accessTest,Q.dialogLogin);Q.usb=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u,K,D){var N={},y=null,G=null,H={},P=!1,O=function(){var a=g(""),b=n(""),d=l(""),e=l("");d.find("fieldset").append(k("usb-enabled","menu.usb",["true","false"],["diagAndTable.enabled","diagAndTable.disabled"])).append(q("setUsb","diagAndTable.save","usb"));e.find("fieldset").prop("id","usbDevList").append(J());if(!1===P&&Q.CACHE.conf.usb&&Q.CACHE.conf.usb.enabled&&Q.CACHE.conf.usb.dev){var h=Q.CACHE.conf.usb.dev,f;for(f in h)h.hasOwnProperty(f)&&
e.find("tbody").append(I(h[f]))}b.find("blockquote").append(d).append(e);a.append(c("menu.usb")).append(b);return a},I=function(a){if(!a)return"";var b=$("<tr></tr>"),c=a.manufacturer?a.manufacturer+" "+a.product:a.product,d=!0===a.conf.selfPowered?e("diagAndTable.true"):e("diagAndTable.false");b.append($("<td></td>").append("&nbsp;")).append($("<td></td>").addClass("alignLeft").append(c)).append($("<td></td>").append(a.serial||"&mdash;")).append($("<td></td>").append(a.conf.maxPower||"&mdash;")).append($("<td></td>").append(d));
return b},J=function(){var a=t("usbTbl"),b=s("T-usbTableHeader").find("tr");a.find("thead").append(b);return a},x=function(){var a=Q.CACHE.conf&&Q.CACHE.conf.usb?Q.CACHE.conf.usb:null;a&&$("#usb-enabled").val(a.enabled?"true":"false");a=null;U();$("#setUsb").on("click",function(){$("[id^=status-]").html("&nbsp;");T();$(this).blur()})},T=function(){var c=function(c,f,d){c?0===c.retCode?($("[id^=status-]").html("&nbsp;"),$("#status-usb").removeClass("status-error").addClass("status-success").html(e("success")),
(c=Q.CACHE.opBuf)&&"boolean"===typeof c.enabled&&(Q.CACHE.conf.usb.enabled=c.enabled,!1===c.enabled?($("#usbTbl").find("tr:gt(0)").remove(),N.stopUsbUpdatePing(),H={}):U())):c.retCode===Q.RETCODE.NOT_AUTHORIZED?a(Q.DIALOG_ERROR,e("err.notAuthorized")):a(Q.DIALOG_ERROR,h(c.retCode)):b("jqXHR = "+$.stringify(d));Q.CACHE.opBuf=null},g=v($("#usb-enabled").val()),k={path:"/api/conf/usb",cmd:"set",access:u(),data:{enabled:{value:g,error:w,reset:d,data:"enabled"}}},A=function(){if(!K(k.path,k.cmd,!0))D(A,
!0);else if(!k||m(k)){var a=B(k);Q.CACHE.opBuf=a;M(k.path,!0,c,null,k.cmd,null,$.stringify(a))}};A()};N.stopUsbUpdatePing=function(){try{y&&(clearInterval(y),y=null,G&&(G.abort(),G=null))}catch(a){b("error. usb.stopUsbUpdatePing: "+a)}};var U=function(a){a=a&&"number"===typeof a&&5<a?a:Q.UPDATE_INTERVAL;b("usb.initUsbUpdatePing: "+a+" seconds");try{N.stopUsbUpdatePing(),y=setInterval(function(){Q.PAGE!==Q.PAGES.USB?N.stopUsbUpdatePing():G&&"resolved"!==G.state()?b("usb.initUsbUpdatePing: update overlap..."):
G=M("/api/conf/usb",!0,R,null,"get",null,null)},1E3*a)}catch(c){b("error. usb.initUsbUpdatePing: "+c)}},R=function(a,c,d){try{if(Q.PAGE!==Q.PAGES.USB)N.stopUsbUpdatePing();else if(a&&0===a.retCode)if(Q.CACHE.conf.usb=a.data,Q.CACHE.conf.usb.enabled){$("#usb-enabled").val("true");c=!1;Object.keys(H).length!==Object.keys(Q.CACHE.conf.usb.dev).length&&(c=!0);if(!c){var e=a.data.dev;if(e)for(var g in e)if(e.hasOwnProperty(g)){if(!H[g]){c=!0;break}var f=e[g].manufacturer+e[g].product+e[g].serial;d=!1;
for(var h in H)if(f===H[h]){d=!0;break}if(!d){c=!0;break}}}if(c){z(a.data);var k=$("#usbTbl");k.find("tr:gt(0)").remove();for(var m in a.data.dev)k.find("tbody").append(I(a.data.dev[m]));E("usbTbl")}}else $("#usb-enabled").val("false"),$("#usbTbl").find("tr:gt(0)").remove();else a?b("error /api/conf/usb: retCode="+a.data.retCode+", retMsg="+a.data.retMsg):b("error /api/conf/usb: "+$.stringify(d))}catch(l){b("error /api/conf/usb: "+l)}},z=function(a){H={};if(a.enabled&&a.dev)for(var b in a.dev)a.dev.hasOwnProperty(b)&&
(H[b]=a.dev[b].manufacturer+a.dev[b].product+a.dev[b].serial)};N.getPageUSB=function(){b("usb.getPageUSB...");try{M("/api/conf/usb",!0,function(c,d,e){c&&0===c.retCode?(null===Q.CACHE.conf&&(Q.CACHE.conf={}),Q.CACHE.conf.usb=c.data?c.data:null,z(c.data),$("#loading").replaceWith(""),$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),$("#content-pane").append(O()),E("usbTbl"),F(Q.USER.lang),x()):c&&3001===c.retCode?(P=!0,$("#loading").replaceWith(""),$(".section-header").replaceWith(""),
$(".section-body").replaceWith(""),$("#content-pane").append(O()),F(Q.USER.lang),$("#usb-enabled").val("false").attr("disabled","disabled"),$("#usbDevList").hide(),$("#setUsb").hide()):(b("/api/conf/usb get: textStatus="+d+", jqXHR="+$.stringify(e)),a(Q.DIALOG_ERROR,h(c.retCode)))},null,"get",null,null)}catch(c){b("error. usb.getPageUSB: "+c)}};return N}(Q.log,Q.JQO.getPageWrapper,Q.JQO.getSection,Q.JQO.getFormGroup,Q.JQO.getFormOptionList,Q.JQO.getFormSubmit,Q.JQO.getSectionHeaderPlain,Q.getLocalStr,
Q.JQO.getFormTable,Q.getTemplate,Q.dialogAlert,Q.util.getRetCodeMsg,Q.util.strToBool,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.validate.test,Q.validate.getApiData,Q.apiCall,Q.util.fixTableRows,Q.localize,Q.auth.accessControlNormal,Q.auth.accessTest,Q.dialogLogin);Q.serial=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u,K,D,N,y,G){g={};var H=!1,P=function(){b("serial.setSerial...");var c=function(a,c,e){a?0===a.retCode?($("[id^=status-]").html("&nbsp;"),$("#status-serial").removeClass("status-error").addClass("status-success").html(B("success"))):a.retCode===Q.RETCODE.NOT_AUTHORIZED?d(Q.DIALOG_ERROR,B("err.notAuthorized")):d(Q.DIALOG_ERROR,M(a.retCode)):b("jqXHR = "+$.stringify(e));Q.CACHE.opBuf=null},e={path:"/api/conf/serial",cmd:"set",access:N(),data:{enabled:{value:a($("#serial-enabled").val()),
error:v,reset:w,data:"serial-enabled"},baudRate:{value:D($("#serial-baudRate").val()),error:v,reset:w,data:"serial-baudRate"}}},g=function(){if(!y(e.path,e.cmd,!0))G(g,!0);else if(!e||u(e)){var a=K(e);Q.CACHE.opBuf=a;m(e.path,!0,c,null,e.cmd,null,$.stringify(a))}};g()},O=function(){var a=n(""),b=l(""),d=k(""),g=0,h=0,m="";Q.CACHE&&(Q.CACHE.conf&&Q.CACHE.conf.serial&&Q.CACHE.conf.serial)&&(g=Q.CACHE.conf.serial.dataBits,h=Q.CACHE.conf.serial.stopBits,m=Q.CACHE.conf.serial.parity);a.append(q("menu.serial"));
d.find("fieldset").append(c("serial-enabled","menu.serial",["true","false"],["diagAndTable.enabled","diagAndTable.disabled"]));!1===H&&d.find("fieldset").append(c("serial-baudRate","serial.baudRate",[1200,2400,4800,9600,19200,38400,57600,115200],[1200,2400,4800,9600,19200,38400,57600,115200],!0)).append(e("serial.dataBits","&nbsp;"+g,"")).append(e("serial.stopBits","&nbsp;"+h,"")).append(e("serial.parity","&nbsp;"+m,"")).append(t("setSerial","diagAndTable.save","serial"));b.find("blockquote").append(d);
a.append(b);return a};g.getPageSerial=function(){b("serial.getPageSerial...");try{m("/api/conf/serial",!0,function(a,c,e){a&&0===a.retCode?(null===Q.CACHE.conf&&(Q.CACHE.conf={}),a.data&&(Q.CACHE.conf.serial=a.data),$("#loading").replaceWith(""),$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),$("#content-pane").append(O()),E(Q.USER.lang),$("#serial-enabled").val(Q.CACHE.conf.serial.enabled?"true":"false"),$("#serial-baudRate").val(Q.CACHE.conf.serial.baudRate),$("#setSerial").on("click",
function(){$("#status-serial").removeClass("status-error").removeClass("status-success").html("&nbsp;");P()})):a&&3001===a.retCode?(H=!0,$("#loading").replaceWith(""),$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),$("#content-pane").append(O()),E(Q.USER.lang),$("#serial-enabled").val("false").attr("disabled","disabled")):(b("/api/conf/serial get: textStatus="+c+", jqXHR="+$.stringify(e)),d(Q.DIALOG_ERROR,M(a.retCode)))},null,"get",null,null)}catch(a){b("error. serial.getPageSerial: "+
a)}};return g}(Q.log,Q.validate.getEnumValues,Q.JQO.getPageWrapper,Q.JQO.getSection,Q.JQO.getFormGroup,Q.JQO.getSectionHeaderPlain,Q.JQO.getFormOptionList,Q.JQO.getNameValue,Q.JQO.getFormSubmit,Q.getTemplate,Q.util.strToBool,Q.util.fieldInputState,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.dialogAlert,Q.apiCall,Q.getLocalStr,Q.util.getRetCodeMsg,Q.localize,Q.util.sanitizeBool,Q.validate.test,Q.validate.getApiData,Q.util.strToInt,Q.auth.accessControlNormal,Q.auth.accessTest,Q.dialogLogin);Q.users=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u,K,D,N,y,G,H,P,O,I,J,x,T){var U={},R=0,z=function(a){var b=!0,c=Q.CACHE.users;c&&"object"===typeof c[a]?b=!1:"guest"===a&&(b=!1);return b},V=function(a,c){if(!a||"string"!==typeof a||!c||"object"!==typeof c)return b("error. users.getUserRow: invalid param(s)."),"";c.language||(c=c[a]);var f=$("<span></span>").addClass("ui-icon ui-icon-check icon-center"),d=void 0!==c.source&&"local"!==c.source,e=$("<tr></tr>").prop("id","r-"+a).addClass("light-row");
e.append($("<td></td>").append($("<span></span>").prop("id","m-"+a).addClass("ui-icon ui-icon-wrench").addClass(d?"action-disabled remoteAuth":"action").addClass("triggerIcon ui-icon ui-corner-all")).append($("<span></span>").prop("id","d-"+a).addClass("triggerIcon ui-icon ui-icon-trash ui-corner-all").addClass("guest"===a?"action-disabled":d?"action-disabled remoteAuth":"action"))).append($("<td></td>").addClass("alignLeft").append(a)).append($("<td></td>").addClass("center").append(c.admin?f.clone():
"&nbsp;")).append($("<td></td>").addClass("center").append(c.control?f.clone():"&nbsp;")).append($("<td></td>").addClass("center").append(c.enabled?f.clone():"&nbsp;"));return e},Y=function(){var a=n("users");if(a){a.find("thead").append(g("T-userTableHeader").find("tr"));var b=Q.CACHE.users;if(b){var c=[],f=!1;R=0;for(var d in b)b.hasOwnProperty(d)&&(R++,"guest"===d?f=!0:c.push(d));c.sort();f&&a.find("tbody").append(V("guest",b.guest));for(var e in c)c.hasOwnProperty(e)&&(f=c[e],a.find("tbody").append(V(f,
b[f])))}}return a},X=function(){var a=l(),b=k("");b.find("blockquote").append(Y());a.append(q("menu.users")).append(b);return a},A=function(){$("#users").on("click","span.action",function(){$("[id^=status-]").html("&nbsp;");ha(this)});$("#userAdd-admin").on("change",function(){la(this)});$("#userMod-admin").on("change",function(){la(this)})};U.getPageUsers=function(){b("users.getPageUsers...");try{h("/api/auth",!0,function(d,g,h){d&&0===d.retCode?(Q.CACHE.users=d.data,$("#loading").replaceWith(""),
$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),$("#content-pane").append(X()),$("#a-newUser").attr("title",c("diagAndTable.add")),$("[id^=m-]").attr("title",c("diagAndTable.mod")),$("[id^=d-]").attr("title",c("diagAndTable.delete")),$("#d-guest").attr("title",c("users.header.guestDel")),$(".remoteAuth").attr("title",c("menu.remoteAuth")),e("users"),W(),f(),ka(),t(Q.USER.lang),A()):(s(Q.DIALOG_ERROR,a(d.retCode)),b("/api/auth get: textStatus="+g+", jqXHR="+$.stringify(h)))},
null,"get",null,null)}catch(d){b("error. users.getPageUsers: "+d)}};var L=function(){var a=g("T-dialogTableSpacerRow").find("tr"),b=g("T-dialogTablePadRow").find("tr"),f=g("T-dialogTable"),e=$("<div></div>");f.prop("id","userAdd");f.find("tbody").append(b.clone()).append(w("userAdd-userid","common.username")).append(a.clone()).append(d("userAdd-admin","users.permissions.admin",["1","0"],["diagAndTable.true","diagAndTable.false"],"0",!0)).append(d("userAdd-control","users.permissions.control",["1",
"0"],["diagAndTable.true","diagAndTable.false"],"0",!0)).append(a.clone()).append(m("userAdd-newPass","users.newPass")).append(a.clone()).append(d("userAdd-status","users.status",["1","0"],["diagAndTable.enabled","diagAndTable.disabled"],"1",!0)).append(b.clone());e.prop("id","dialog-user-add").prop("title",c("diagAndTable.add")).append(f).append($("<div></div>").prop("id","status-addUser").append("&nbsp;"));return $("<div></div>").append(e)},f=function(){B(L().html(),{autoOpen:!1,resizable:!1,width:550,
modal:!0,close:function(){Q.CACHE.opId=null;Q.CACHE.opBuf=null},buttons:[{id:"dlg-btn-user-add-save",text:c("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");var f=this,d=function(d,g,h){d&&0===d.retCode?(R++,$("table#users").append(V(Q.CACHE.opId,Q.CACHE.opBuf)),t(Q.USER.lang),e("users"),$("#a-newUser").attr("title",c("diagAndTable.add")),$("[id^=m-]").attr("title",c("diagAndTable.mod")),$("[id^=d-]").attr("title",c("diagAndTable.delete")),$("#d-guest").attr("title",c("users.header.guestDel")),
$("span.action").on("click",function(){$("[id^=status-]").html("&nbsp;");ha(this)}),Q.CACHE.users[Q.CACHE.opId]=Q.CACHE.opBuf):(s(Q.DIALOG_ERROR,a(d.retCode)),b(g+", "+$.stringify(d)+", "+$.stringify(h)));M("a-newUser",!1,!1);Q.CACHE.opId=null;Q.CACHE.opBuf=null;$(f).dialog("close");U.getPageUsers()},g=!0,k=$("#userAdd-userid").val(),p=$("#userAdd-newPass").val(),r=E($("#userAdd-admin").val(),"1","0"),m=E($("#userAdd-control").val(),"1","0");r&&(m=!0);var A={path:"/api/auth",cmd:"add",data:{username:{value:k,
error:F,reset:u,data:"userAdd-userid"},password:{value:p,error:function(a,b){F(null,b,"userAdd-newPass")},reset:function(){u(null,"userAdd-newPass")},data:"userAdd-newPass"},admin:{value:r,error:F,reset:u,data:"userAdd-admin"},control:{value:m,error:F,reset:u,data:"userAdd-control"},enabled:{value:E($("#userAdd-status").val(),"1","0"),error:F,reset:u,data:"userAdd-status"},language:{value:Q.LANG_SYS_DEFAULT,error:function(){b("error. userAdd: bad lang - "+Q.LANG_SYS_DEFAULT)}}}};D(A)||(g=!1);z(k)||
(F(null,{key:"users.duplicateUsername"},"userAdd-userid"),g=!1);if(g)if(g=$("#userAdd-newPass"),"password"!==g.prop("type")||"password"===g.prop("type")&&!g.val())F(null,{key:"configsys.snmp.missingPassword"},"userAdd-newPass");else{u(null,"userAdd-newPass");var l=function(){if(!x(A.path,A.cmd,!0))T(l,!0);else if(!A||D(A)){var a=N(A);Q.CACHE.opBuf=a;Q.CACHE.opId=k;h(A.path,!0,d,null,A.cmd,null,$.stringify(a))}};l()}}},{id:"dlg-btn-user-add-cancel",text:c("diagAndTable.cancel"),click:function(){M("a-newUser",
!1,!1);$(this).dialog("close");U.getPageUsers()}}]})},r=function(){var a=!0,b=$("#edit-password-entry1").val(),c=$("#edit-password-entry2").val();if(""===b)return F(null,{key:"retCode.4000"},"edit-password-entry1"),!1;if(b!==c)return F(null,{key:"useroptions.error.verifyNomatch"},"edit-password-entry2"),!1;D({path:"/api/auth",cmd:"add",data:{password:{value:b,error:function(a,b){F(null,b,"edit-password-entry1")},reset:function(){u(null,"edit-password-entry1")},data:"userAdd-newPass"}}})||(a=!1);return a},
p=function(){try{$("#userAdd-userid").val(""),$("#userAdd-admin").val("0"),$("#userAdd-control").val("0"),$("#userAdd-newPass").val(""),$("#userAdd-status").val("1"),K("dialog-user-add"),O("userAdd-newPass",!1),$("#userAdd-admin").trigger("change"),$("#userAdd-newPass").on("focus",function(){$("#dlg-btn-user-add-cancel").focus();H(I("userAdd-newPass"),function(a){O("userAdd-newPass",a)},r)})}catch(a){b("users.initAddDialog"+a)}},W=function(){var f=c("diagAndTable.youSure")+"<br>"+c("users.userDeleted"),
d=$("<div></div>");d.append($("<div></div>").prop("id","dialog-user-delete-confirm").prop("title",c("diagAndTable.delete")).append($("<p></p>").append($("<span></span>").addClass("ui-icon ui-icon-alert").prop("style","float:left;margin:0 7px 20px 0;")).append($("<span></span>").prop("id","rusure").append(f))));B(d.html(),{autoOpen:!1,resizable:!1,width:300,height:150,modal:!0,close:function(){M("d-"+Q.CACHE.opId,!1);Q.CACHE.opId=null},buttons:[{id:"dlg-btn-user-del-delete",text:c("diagAndTable.delete"),
click:function(){$("[id^=status-]").html("&nbsp;");var c=this,f=function(f,d,g){if(f)if(0===f.retCode){R--;if(Q.USER.name===Q.CACHE.opId){try{$(c).dialog("close")}catch(k){}J();return}f=Q.CACHE.opId;$("#r-"+f).remove();e("users");Q.CACHE.users&&Q.CACHE.users[f]&&delete Q.CACHE.users[f];h("/api/auth",!1,function(c,f,d){c?0===c.retCode?Q.CACHE.users=c.data:s(Q.DIALOG_ERROR,a(c.retCode)):b("error. users.createDialogDelete inner cb: "+$.stringify(d))},null,"get",null,null)}else s(Q.DIALOG_ERROR,a(f.retCode));
else b("error. users.createDialogDelete delete cb: "+$.stringify(g));M("d-"+Q.CACHE.opId,!1);Q.CACHE.opId=null;$(c).dialog("close")},d=function(){x("/api/auth/"+Q.CACHE.opId,"delete",!0)?v("/api/auth/"+Q.CACHE.opId,f):T(d,!0)};d()}},{id:"dlg-btn-user-del-cancel",text:c("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]})},S=function(){h("/api/auth/"+Q.CACHE.opId,!0,function(c,f,d){if(c&&0===c.retCode){Q.CACHE.users[Q.CACHE.opId]=c.data;if(f=$("#userMod-publicKeys")){f.find("tbody").empty();
c=c.data.publicKey;for(var g in c)f.find("tbody").append(aa(g,c))}e("userMod-publicKeys")}else s(Q.DIALOG_ERROR,a(c.retCode)),b(f+", "+$.stringify(c)+", "+$.stringify(d))},null,"get",null,null)},Z=function(a){var b=$("<div></div>");b.addClass("fm-table ui-corner-all").prop("id",a+"-publicKeys-group").append($("<table></table>").addClass("form-table").prop("style","table-layout:fixed;").prop("id",a+"-publicKeys").append($("<thead></thead>").append($("<th></th>").addClass("w75").append($("<span></span>").prop("id",
a+"-publicKeysAdd").addClass("ui-icon ui-icon-circle-plus action addIcon ui-corner-all").prop("title",c("diagAndTable.add")))).append($("<th></th>").addClass("w150").append(c("status.header.label"))).append($("<th></th>").append(c("users.publicKey")))).append($("<tbody></tbody>").prop("id",a+"-publicKeys-body")));a=Q.CACHE.users[Q.CACHE.opId].publicKey||{};for(var f in a)b.find("tbody").append(aa(f,a));return b},aa=function(a,b){var f=$("<tr></tr>");f&&(null!==a&&void 0!==a&&b)&&f.prop("id","publicKey-"+
a).addClass("light-row").append($("<td></td>").prop("style","position: relative;").append($("<span></span>").prop("id","userMod-publicKeyMod-"+a).addClass("ui-icon ui-icon-wrench action triggerIcon ui-corner-all").prop("title",c("diagAndTable.mod"))).append($("<span></span>").prop("id","userMod-publicKeyDel-"+a).addClass("ui-icon ui-icon-trash action triggerIcon ui-corner-all").prop("title",c("diagAndTable.delete")))).append($("<td></td>").prop("id","userMod-publicKeyLabel-"+a).append(b[a].label)).append($("<td></td>").append($("<textarea></textarea>").prop("rows",
"2").prop("cols","29").prop("style","resize:none; font-size:smaller;").prop("readonly",!0).append(b[a].key)));return f},ja=function(a){var b=$("<div></div>"),f=g("T-dialogTablePadRow").find("tr"),d=g("T-dialogPublicKeyAddModify"),e="Add"===a?c("diagAndTable.add"):c("diagAndTable.mod");d.prop("id","dialog-publicKey"+a).prop("title",e);d.find("table").prop("id","publicKey"+a+"Dlg");d.find("tbody").append(f.clone()).append(w("publicKey"+a+"-label","status.header.label")).append(G(3,29,"publicKey"+a+
"-key","users.publicKey",!1)).append(f.clone());b.append(d);return b},da=function(f,d){var e="Mod"===f?"Mod":"Add";"Mod"===e&&void 0===d?b("error. users.publicKeyCreateDialogAddMod: invalid parameters"):($("#dialog-publicKey"+e).dialog().dialog("close").dialog("destroy").remove(),B(ja(e).html(),{autoOpen:!1,resizeable:!1,width:550,modal:!0,close:function(){"Mod"===e&&M("userMod-publicKeyMod-"+d,!1)},buttons:[{id:"dlg-btn-publicKey"+e+"-save",text:c("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");
var c=this,f=$("#publicKey"+e+"-label").val()||"",g=$("#publicKey"+e+"-key").val()||"",k="/api/auth/"+Q.CACHE.opId+"/publicKey";"Mod"===e&&(k+="/"+d);f={path:k,cmd:"Add"===e?"add":"set",data:{label:{value:f,error:F,reset:u,data:"publicKey"+e+"-label"},key:{value:g,error:F,reset:u,data:"publicKey"+e+"-key"}}};g=N(f);Q.CACHE.opBuf=g;h(f.path,!0,function(f,d,e){f&&0===f.retCode?(S(),$(c).dialog("close")):(s(Q.DIALOG_ERROR,a(f.retCode)),b(d+", "+$.stringify(f)+", "+$.stringify(e)));Q.CACHE.opBuf=null;
$(c).dialog("close")},null,f.cmd,null,$.stringify(g))}},{id:"dlg-btn-publicKey"+e+"-cancel",text:c("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]}),"Mod"===e&&($("#publicKeyMod-label").val(Q.CACHE.users[Q.CACHE.opId].publicKey[d].label),$("#publicKeyMod-key").val(Q.CACHE.users[Q.CACHE.opId].publicKey[d].key)),t(Q.USER.lang),$("#dialog-publicKey"+e).dialog("open"))},ba=function(f){var d=$("<div></div>");d.append($("<div></div>").prop("id","dialog-user-publicKey-delete-confirm").prop("title",
c("diagAndTable.delete")).append($("<p></p>").append($("<span></span>").addClass("ui-icon ui-icon-alert").attr("style","float:left;margin:0 7px 20px 0;")).append($("<span></span>").prop("id","rusure").append(c("diagAndTable.youSure")))));$("#dialog-user-publicKey-delete-confirm").dialog().dialog("close").dialog("destroy").remove();B(d.html(),{autoOpen:!1,resizable:!1,width:300,height:150,modal:!0,close:function(){M("userMod-publicKeyDel-"+f,!1)},buttons:[{id:"dlg-btn-user-publicKey-del-delete",text:c("diagAndTable.delete"),
click:function(){$("[id^=status-]").html("&nbsp;");var c=this;v("/api/auth/"+Q.CACHE.opId+"/publicKey/"+f,function(d,e,g){d?0===d.retCode?S():s(Q.DIALOG_ERROR,a(d.retCode)):b("error. users.publicKeyCreateDialogDelete delete cb: "+$.stringify(g));M("userMod-publicKeyDel-"+f,!1);$(c).dialog("close")},!0)}},{id:"dlg-btn-user-publicKey-del-cancel",text:c("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]});t(Q.USER.lang);$("#dialog-user-publicKey-delete-confirm").dialog("open")},ca=function(){var a=
g("T-dialogTableSpacerRow").find("tr"),b=g("T-dialogTablePadRow").find("tr"),f=g("T-dialogTable"),e=$("<div></div>");f.prop("id","userMod");f.find("tbody").append(b.clone()).append(w("userMod-userid","common.username",!0)).append(y("userMod-language","useroptions.languagePreference",Q.CACHE.languages,!0)).append(a.clone()).append(d("userMod-admin","users.permissions.admin",["1","0"],["diagAndTable.true","diagAndTable.false"],"0",!0)).append(d("userMod-control","users.permissions.control",["1","0"],
["diagAndTable.true","diagAndTable.false"],"0",!0)).append(a.clone()).append(m("userMod-newPass","users.newPass")).append(a.clone()).append(d("userMod-status","users.status",["1","0"],["diagAndTable.enabled","diagAndTable.disabled"],"0",!0));Q.CACHE.capability.userPublicKeys&&Q.CACHE.capability.userPublicKeys.show&&f.find("tbody").append(a.clone()).append($("<tr></tr>").prop("id","publicKeysRow").addClass("form-row").append($("<td></td>").prop("id","publicKeysTableContainer").prop("colspan","2")));
f.find("tbody").append(b.clone());e.prop("id","dialog-user-modify").prop("title",c("diagAndTable.mod")).append(f).append($("<div></div>").prop("id","status-modUser").append("&nbsp;"));return $("<div></div>").append(e)},ka=function(){B(ca().html(),{autoOpen:!1,resizable:!1,width:550,modal:!0,open:function(){$("#dlg-btn-user-mod-cancel").focus()},close:function(){M("m-"+Q.CACHE.opId,!1);Q.CACHE.opId=null;Q.CACHE.opBuf=null},buttons:[{id:"dlg-btn-user-mod-save",text:c("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");
if(Q.USER.name&&"guest"!==Q.USER.name){var c=this,f=function(f,d,e){if(f&&0===f.retCode){f=Q.CACHE.opId;d=$("<span></span>").addClass("ui-icon ui-icon-check icon-center");try{var g=Q.CACHE.opBuf;if(f===Q.USER.name&&void 0!==g.enabled&&!1===g.enabled)J();else{g&&Q.CACHE.users[f]&&(f===Q.USER.name&&Q.CACHE.users[f].language!==g.language&&($.cookies.test()&&$.cookies.set("r-lang",g.language),location.reload()),Q.CACHE.users[f].language=g.language,Q.CACHE.users[f].enabled=g.enabled,Q.CACHE.users[f].control=
g.control,Q.CACHE.users[f].admin=g.admin);var h=$("#r-"+f).children();h&&0<h.length&&($(h[4]).empty().append(g.enabled?d.clone():"&nbsp;"),$(h[3]).empty().append(g.control?d.clone():"&nbsp;"),$(h[2]).empty().append(g.admin?d.clone():"&nbsp;"))}}catch(k){b("error. users.updateModifiedUser: "+k)}}else s(Q.DIALOG_ERROR,a(f.retCode)),b(d+", "+$.stringify(f)+", "+$.stringify(e));"guest"===Q.CACHE.opId&&(Q.GUEST_USER_ENABLED=Q.CACHE.opBuf.enabled);M("m-"+Q.CACHE.opId,!1);Q.CACHE.opId=null;Q.CACHE.opBuf=
null;$(c).dialog("close");U.getPageUsers()},d=!0,e=$("#userMod-userid").val(),g=$("#userMod-language").val(),k=$("#userMod-newPass"),k="password"===k.prop("type")?k.val():"",p=E($("#userMod-admin").val(),"1","0"),r=E($("#userMod-control").val(),"1","0"),A=E($("#userMod-status").val(),"1","0");p&&(r=!0);var m={path:"/api/auth/"+e,cmd:"set",data:{language:{value:g,error:F,reset:u,data:"userMod-language"}}},g={data:{admin:{value:p,error:F,reset:u,data:"userMod-admin"},control:{value:r,error:F,reset:u,
data:"userMod-control"},enabled:{value:A,error:F,reset:u,data:"userMod-status"}}};Q.USER.access.admin&&$.extend(!0,m,g);g={data:{password:{value:k,error:function(a,b){F(null,b,"userMod-newPass")},reset:function(){u(null,"userMod-newPass")},data:"userMod-newPass"}}};k&&$.extend(!0,m,g);ea(e)&&(A||(F(null,{key:"users.enabledAdminRequired"},"userMod-status"),d=!1),p||(F(null,{key:"users.enabledAdminRequired"},"userMod-admin"),d=!1));if(d){var l=function(){if(!x(m.path,m.cmd,!0))T(l,!0);else if(!m||D(m)){var a=
N(m);Q.CACHE.opBuf=a;Q.CACHE.opId=e;h(m.path,!0,f,null,m.cmd,null,$.stringify(a))}};l()}}}},{id:"dlg-btn-user-mod-cancel",text:c("diagAndTable.cancel"),click:function(){$(this).dialog("close");U.getPageUsers()}}]})},ga=function(a){try{var f=Q.CACHE.users[a];if(f){var d=$("#userMod-admin"),g=$("#userMod-control"),h=$("#userMod-newPass"),k=$("#userMod-status");"guest"!==a&&(O("userMod-newPass",!0),h.on("focus",function(){"guest"!==a&&($("#dlg-btn-user-mod-cancel").focus(),H(I("userMod-newPass"),function(a){O("userMod-newPass",
a)},r))}));$("#userMod-userid").val(a).removeAttr("disabled").prop("readonly",!0).addClass("disabled");$("#userMod-language").val(f.language);d.val(!0===f.admin?"1":"0");g.val(!0===f.control?"1":"0");k.val(!0===f.enabled?"1":"0");Q.CACHE.capability.userPublicKeys&&Q.CACHE.capability.userPublicKeys.show&&($("#publicKeysTableContainer").empty().append(Z("userMod")),e("userMod-publicKeys"),$("#userMod-publicKeysAdd").on("click",function(){var a=Q.CACHE.capability.max.userPublicKeys,b=0,f;for(f in Q.CACHE.users[Q.CACHE.opId].publicKey)b++;
b>=a?(b=c("common.maxAllowed"),b=b.replace("$1",a),s(Q.DIALOG_INFO,b)):da()}),$("#userMod-publicKeys").on("click","span.action",function(){var a=$(this).attr("id").split("-");3===a.length&&("publicKeyMod"===a[1]?(M("userMod-publicKeyMod-"+a[2],!0),da("Mod",a[2])):"publicKeyDel"===a[1]?(M("userMod-publicKeyDel-"+a[2],!0),ba(a[2])):b("error. invalid identifier in event-handler"))}));"guest"===a?(d.val("0"),g.val("0"),h.val(""),P("userMod-language",!1),P("userMod-admin",!1),P("userMod-control",!1),P("userMod-newPass",
!1),P("userMod-status",!0),$("#publicKeysRow").hide()):(P("userMod-language",!0),P("userMod-admin",!0),P("userMod-control",!0),P("userMod-newPass",!0),ea(a)?(P("userMod-admin",!1),P("userMod-status",!1)):(P("userMod-admin",!0),P("userMod-status",!0)),$("#publicKeysRow").show());K("dialog-user-modify")}"guest"!==a&&$("#userMod-admin").trigger("change")}catch(p){b("error. users.initModifyDialog: "+p)}},ea=function(a){var b=!1,c=$.map(Q.CACHE.users||{},function(a,b){return!0===a.admin&&!0===a.enabled?
b:null});1===c.length&&a===c[0]&&(b=!0);return b},la=function(a){try{var c=$(a),f=c.attr("id").replace("admin","control"),d=c.attr("id").replace("admin","userid");"1"===c.val()||"guest"===$("#"+d).val()?$("#"+f).val("1").prop("disabled",!0).addClass("disabled"):$("#"+f).prop("disabled",!1).removeClass("disabled")}catch(e){b("error. users.eventHandlerAddModAdminChange: "+e)}},ha=function(a){try{var f=$(a).attr("id"),d=f?f.charAt(0):"",e=f?f.substr(2):"";if(d&&e)if("d"===d&&ea(e))b("error. users.eventHandlerUserAddModDel: Delete not permitted on last enabled admin."),
s(Q.DIALOG_INFO,c("users.enabledAdminRequired"));else switch(M(f,!0,"a"!==d),$("[id^=status-]").html("&nbsp;"),d){case "a":if(R>=Q.MAX.USERS){var g=c("common.maxAllowed"),g=g.replace("$1",Q.MAX.USERS);s(Q.DIALOG_INFO,g);break}p();$("#dialog-user-add").dialog("open");$("table#userAdd").show();break;case "m":Q.CACHE.opId=e;ga(e);$("#dialog-user-modify").dialog("open");$("table#userMod").show();$("#userMod-userid").blur();!1===Q.USER.access.admin&&($("#userMod-admin").attr("disabled","disabled").addClass("disabled"),
$("#userMod-control").attr("disabled","disabled").addClass("disabled"),$("#userMod-status").attr("disabled","disabled").addClass("disabled"));break;case "d":Q.CACHE.opId=e;$("#dialog-user-delete-confirm").dialog("open");break;default:b('error. users.eventHandlerUserAddModDel: invalid action "'+d+'"')}}catch(h){b("error. users.eventHandlerUserAddModDel: "+h)}};return U}(Q.log,Q.getTemplate,Q.JQO.getFormTable,Q.JQO.getPageWrapper,Q.JQO.getSection,Q.JQO.getSectionHeaderPlain,Q.getLocalStr,Q.util.fixTableRows,
Q.localize,Q.dialogAlert,Q.util.getRetCodeMsg,Q.apiCall,Q.apiCallDelete,Q.JQO.getDialogOptionText,Q.JQO.getDialogOptionList,Q.JQO.getDialogOptionPass,Q.createDialog,Q.rowActionStyleUpdate,Q.util.strToBool,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.util.fieldErrorTextResetAll,Q.validate.test,Q.validate.getApiData,Q.JQO.getFormOptionListLanguages,Q.JQO.getDialogOptionTextArea,Q.JQO.passwordDialog,Q.util.fieldInputState,Q.auth.passwordInputSet,Q.auth.passwordInputGet,Q.auth.userLogout,Q.auth.accessTest,
Q.dialogLogin);Q.time=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u,K,D,N,y,G,H,P){var O={},I=function(a){var b=$("<div></div>");b.addClass("fm-opt");b.append($("<label></label>").addClass("formLabel").attr("data-localize","configsys.time.dst."+a));b.append(h("T-timeDSTWeek").prop("id","time-dst-"+a+"W"));b.append(h("T-timeDSTDay").prop("id","time-dst-"+a+"D"));b.append($("<span></span>").addClass("dst-text").attr("data-localize","configsys.time.dst.in"));b.append(h("T-timeDSTMonth").prop("id","time-dst-"+
a+"M"));b.append($("<span></span>").addClass("dst-text").attr("data-localize","configsys.time.dst.at"));b.append(h("T-timeDSTHour").prop("id","time-dst-"+a+"H"));return b},J=function(){var b=q("");b.find("fieldset").append(e("time-dst-enabled","configsys.time.dst.enabled",["true","false"],["diagAndTable.enabled","diagAndTable.disabled"])).append(I("start")).append(I("end")).append(a("setDST","diagAndTable.save","dst"));return b},x=function(a){b("time.initDST");if(a){var c=K(a.enabled,!1),f=$("#time-dst-enabled");
f.val(c.toString());c&&($("#time-dst-startW").val(a.startW||"1"),$("#time-dst-startD").val(a.startD||"------S"),$("#time-dst-startM").val(a.startM||"1"),$("#time-dst-startH").val(a.startH||"0"),$("#time-dst-endW").val(a.endW||"1"),$("#time-dst-endD").val(a.endD||"------S"),$("#time-dst-endM").val(a.endM||"1"),$("#time-dst-endH").val(a.endH||"0"));$("#setDST").on("click",function(){$("[id^=status-]").html("&nbsp;");U();$(this).blur()});f.on("change",function(){var a=v($("#time-dst-enabled").val());
$.each(["W","D","M","H"],function(b,c){w("time-dst-start"+c,a);w("time-dst-end"+c,a)})}).change();a=null}else b("time.initDST: no data")},T=function(a,b){var c={data:{}},e,g,h;$.each(["W","D","M","H"],function(a,k){e="time-dst-"+b+k;g=$("#"+e).val();h="D"!==k?parseInt(g,10):g;c.data[b+k]={value:h,error:d,reset:m,data:e}});$.extend(!0,a,c)},U=function(){b("time.setDST...");var a=function(a,c,f){a?0===a.retCode?($("[id^=status-]").html("&nbsp;"),$("#status-dst").removeClass("status-error").addClass("status-success").html(E("success")),
Q.CACHE.conf.time.dst=Q.CACHE.opBuf):a.retCode===Q.RETCODE.NOT_AUTHORIZED?B(Q.DIALOG_ERROR,E("err.notAuthorized")):B(Q.DIALOG_ERROR,F(a.retCode)):b("jqXHR = "+$.stringify(f));Q.CACHE.opBuf=null},c=v($("#time-dst-enabled").val()),f={path:"/api/conf/time/dst",cmd:"set",access:G(),data:{enabled:{value:c,error:d,reset:m,data:"time-dst-enabled"}}};c&&(T(f,"start"),T(f,"end"));var e=function(){if(!H(f.path,f.cmd,!0))P(e,!0);else if(!f||D(f)){var b=N(f);Q.CACHE.opBuf=b;M(f.path,!0,a,null,f.cmd,null,$.stringify(b))}};
e()},R=function(){var b=g("/api/conf/time","set","zone")||[],d=g("/api/conf/time","set","mode")||[],f=$.map(d,function(a){return"configsys.time."+a}),h=n(),p=l(""),m=k(""),x=q("");p.append(c("menu.time"));x.find("fieldset").append(e("time-mode","configsys.time.mode",d,f));"blackbird"===h&&x.find("fieldset").append(t("time-offset","configsys.time.offset"));x.find("fieldset").append(t("time-datetime","configsys.time.datetime"));"blackbird"!==h&&x.find("fieldset").append(s("time-zone","configsys.time.zone",
b));x.find("fieldset").append(t("time-ntpServer1","configsys.time.ntpServer")).append(t("time-ntpServer2","configsys.time.ntpServerAlt"));"blackbird"===h&&x.find("fieldset").append(t("time-ntpSyncPeriod","configsys.time.ntpSyncPeriod"));x.find("fieldset").append(a("setTime","diagAndTable.save","time"));m.find("blockquote").append(x);"blackbird"===h&&m.find("blockquote").append(J());p.append(m);return p},z=function(){b("time.initTime");var a=Q.CACHE.conf&&Q.CACHE.conf.time?Q.CACHE.conf.time:null,c=
n();a?($("#time-mode").val(a.mode),$("#time-datetime").val(a.datetime),$("#time-ntpServer1").val(a.ntpServer1||""),$("#time-ntpServer2").val(a.ntpServer2||""),"blackbird"===c?($("#time-offset").val(a.offset),$("#time-ntpSyncPeriod").val(a.ntpSyncPeriod),x(a.dst)):$("#time-zone").val(a.zone)):b("time.initTime: no data")},V=function(a){var b=$("#time-mode").val(),c=n(),e={data:{offset:{value:$("#time-offset").val(),error:d,reset:m,data:"time-offset"}}},g={data:{ntpSyncPeriod:{value:y($("#time-ntpSyncPeriod").val()),
error:d,reset:m,data:"time-ntpSyncPeriod"}}},h={data:{zone:{value:$("#time-zone").val(),error:d,reset:m,data:"time-zone"}}};"blackbird"===c?($.extend(!0,a,e),"ntp"===b&&$.extend(!0,a,g)):$.extend(!0,a,h)},Y=function(a){var b=$("#time-mode").val();n();var c={data:{ntpServer1:{value:$("#time-ntpServer1").val(),error:d,reset:m,data:"time-ntpServer1"}}},e={data:{ntpServer2:{value:$("#time-ntpServer2").val(),error:d,reset:m,data:"time-ntpServer2"}}};"ntp"===b&&($.extend(!0,a,c),$.extend(!0,a,e))},X=function(){b("time.setTime...");
var a=function(a,c,f){a?0===a.retCode?($("[id^=status-]").html("&nbsp;"),$("#status-time").removeClass("status-error").addClass("status-success").html(E("success")),$.extend(!0,Q.CACHE.conf.time,Q.CACHE.opBuf)):a.retCode===Q.RETCODE.NOT_AUTHORIZED?B(Q.DIALOG_ERROR,E("err.notAuthorized")):$("#status-time").removeClass("status-success").addClass("status-error").html(F(a.retCode)||E("error")):b("jqXHR = "+$.stringify(f));Q.CACHE.opBuf=null},c=$("#time-mode").val(),f={path:"/api/conf/time",cmd:"set",
access:G(),data:{mode:{value:c,error:d,reset:m,data:"time-mode"}}},e={data:{datetime:{value:$("#time-datetime").val(),error:d,reset:m,data:"time-datetime"}}};"manual"===c&&$.extend(!0,f,e);V(f);Y(f);var g=function(){if(!H(f.path,f.cmd,!0))P(g,!0);else if(!f||D(f)){var b=!0,c={key:"configsys.time.missingServer"},e=n(),h=$("#time-mode").val(),k=$("#time-ntpServer1").val(),r=$("#time-ntpServer2").val();"ntp"===h&&("blackbird"===e?""===k&&(d(null,c,"time-ntpServer1"),b=!1):""===k&&""===r&&(d(null,c,"time-ntpServer1"),
d(null,c,"time-ntpServer2"),b=!1));b&&(b=N(f),Q.CACHE.opBuf=b,M(f.path,!0,a,null,f.cmd,null,$.stringify(b)))}};g()};O.getPageTime=function(){b("time.getPageTime...");try{M("/api/conf/time",!0,function(a,c,d){a&&0===a.retCode?(null===Q.CACHE.conf&&(Q.CACHE.conf={}),Q.CACHE.conf.time=a.data?a.data:null,$("#loading").replaceWith(""),$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),$("#content-pane").append(R()),u(Q.USER.lang),z(),$("#setTime").on("click",function(){$("[id^=status-]").html("&nbsp;");
X();$(this).blur()}),$("#time-mode").on("change",function(){var a="ntp"===$("#time-mode").val();w("time-ntpServer1",a);w("time-ntpServer2",a);w("time-ntpSyncPeriod",a);w("time-datetime",!a)}).change()):(b("/api/conf/time get: textStatus="+c+", jqXHR="+$.stringify(d)),B(Q.DIALOG_ERROR,F(a.retCode)))},null,"get",null,null)}catch(a){b("error. time.getPageTime: "+a)}};return O}(Q.log,Q.validate.getEnumValues,Q.util.getTimeStyle,Q.JQO.getPageWrapper,Q.JQO.getSection,Q.JQO.getFormGroup,Q.JQO.getSectionHeaderPlain,
Q.JQO.getFormOptionList,Q.JQO.getFormOptionText,Q.JQO.getFormOptionTimezoneList,Q.JQO.getFormSubmit,Q.getTemplate,Q.util.strToBool,Q.util.fieldInputState,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.dialogAlert,Q.apiCall,Q.getLocalStr,Q.util.getRetCodeMsg,Q.localize,Q.util.sanitizeBool,Q.validate.test,Q.validate.getApiData,Q.util.strToInt,Q.auth.accessControlNormal,Q.auth.accessTest,Q.dialogLogin);Q.display=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u,K,D,N){var y=function(){var a=function(a,c,d){a?0===a.retCode?(Q.CACHE.conf.display=$.extend(Q.CACHE.conf.display,Q.CACHE.opBuf),$("[id^=status-]").html("&nbsp;"),$("#status-mode").removeClass("status-error").addClass("status-success").html(g("success"))):a.retCode===Q.RETCODE.NOT_AUTHORIZED?n(Q.DIALOG_ERROR,g("err.notAuthorized")):n(Q.DIALOG_ERROR,l(a.retCode)):b("jqXHR = "+$.stringify(d));Q.CACHE.opBuf=null},d={path:"/api/conf/display/gmsd",
cmd:"set",access:K(),data:{mode:{value:$("#display-mode").val(),error:k,reset:q,data:"display-mode"}}},h=function(){if(!D(d.path,d.cmd,!0))N(h,!0);else if(!d||c(d)){var b=e(d);Q.CACHE.opBuf=b;t(d.path,!0,a,null,d.cmd,null,$.stringify(b))}};h()},G=function(){$("#setMode").on("click",function(){$("[id^=status-]").html("&nbsp;");y();$(this).blur()})},H=function(){var b=s("configsys.display.mode"),c=a(""),d=["current","totalPower"],e=["meas.name.current","configsys.display.totalPower"];Q.CACHE&&(Q.CACHE.capability&&
Q.CACHE.capability.display&&!0===Q.CACHE.capability.display.currentAndPower)&&(d.push("currentAndTotalPower"),e.push("configsys.display.currentAndTotalPower"));c.find("fieldset").append(h("display-mode","configsys.display.mode",d,e)).append(v("setMode","diagAndTable.save","mode"));b.find("blockquote").append(c);return b},P=function(){try{t("/api/conf/display/gmsd",!1,function(a,c,e){a&&0===a.retCode?(null===Q.CACHE.conf&&(Q.CACHE.conf={}),Q.CACHE.conf.display=a.data?a.data:null,a=w(),a.append(H()),
$("#loading").replaceWith(""),$("#content-pane").append(a),(a=Q.CACHE.conf&&Q.CACHE.conf.display?Q.CACHE.conf.display:null)?(a=a.mode,$("#display-mode").val(a)):b("display.initMode: no data"),G(),d(Q.USER.lang)):(b("/api/conf/display/gmsd get: textStatus="+c+", jqXHR="+$.stringify(e)),n(Q.DIALOG_ERROR,l(a.retCode)))},null,"get",null,null)}catch(a){b("error. display.getModePanel: "+a)}},O=function(){b("display.setVLC...");var a=function(a,c,d){a?0===a.retCode?(Q.CACHE.conf.display.vlc=$.extend(Q.CACHE.conf.display.vlc,
Q.CACHE.opBuf),$("[id^=status-]").html("&nbsp;"),$("#status-vlc").removeClass("status-error").addClass("status-success").html(g("success"))):a.retCode===Q.RETCODE.NOT_AUTHORIZED?n(Q.DIALOG_ERROR,g("err.notAuthorized")):n(Q.DIALOG_ERROR,l(a.retCode)):b("jqXHR = "+$.stringify(d));Q.CACHE.opBuf=null},d={path:"/api/conf/display/gmsd/vlc",cmd:"set",access:K(),data:{enabled:{value:m($("#vlc-enabled").val()),error:k,reset:q,data:"vlc-enabled"}}},h=function(){if(!D(d.path,d.cmd,!0))N(h,!0);else if(!d||c(d)){var b=
e(d);Q.CACHE.opBuf=b;t(d.path,!0,a,null,d.cmd,null,$.stringify(b))}};h()},I=function(){$("#setVLC").on("click",function(){$("[id^=status-]").html("&nbsp;");O();$(this).blur()})},J=function(){var b=s("menu.vlc"),c=a("");c.find("fieldset").append(h("vlc-enabled","configsys.vlc.vlcEnabled",["true","false"],["diagAndTable.enabled","diagAndTable.disabled"])).append(v("setVLC","diagAndTable.save","vlc"));b.find("blockquote").append(c);return b},x=function(){b("display.getVLCPanel...");try{t("/api/conf/display/gmsd/vlc",
!1,function(a,c,e){a&&0===a.retCode?(null===Q.CACHE.conf&&(Q.CACHE.conf={}),Q.CACHE.conf.vlc=a.data?a.data:null,a=w(),a.append(J()),$("#loading").replaceWith(""),$("#content-pane").append(a),b("display.initVLC"),(a=Q.CACHE.conf&&Q.CACHE.conf.display&&Q.CACHE.conf.display.vlc?Q.CACHE.conf.display.vlc:null)?(a=a.enabled?"true":"false",$("#vlc-enabled").val(a)):b("display.initVLC: no data"),I(),d(Q.USER.lang)):(b("/api/conf/display/gmsd/vlc get: textStatus="+c+", jqXHR="+$.stringify(e)),n(Q.DIALOG_ERROR,
l(a.retCode)))},null,"get",null,null)}catch(a){b("error. display.getVLCPanel: "+a)}},T=function(){b("display.eventHandlerLcdSubmit...");try{if($("#status-lcd").empty(),$.isEmptyObject(Q.CACHE.lcd))b("display.eventHandlerLcdSubmit: no changes to submit");else{var a={},c;for(c in Q.CACHE.lcd){var d=c.split("-"),e=d[0];a[e]||(a[e]={});var f=d[1];a[e][f]||(a[e][f]={});var h=d[2];a[e][f][h]||(a[e][f][h]={});if("analog"===f)a[e][f][h].displayEnabled=Q.CACHE.lcd[c];else{a[e][f][h].measurement||"measurement"!==
d[3]||(a[e][f][h].measurement={});var k=d[4];a[e][f][h].measurement[k]||(a[e][f][h].measurement[k]={});a[e][f][h].measurement[k].displayEnabled=Q.CACHE.lcd[c]}}var m=function(a,c,f){a?0===a.retCode?($("[id^=status-]").html("&nbsp;"),$("#status-lcd").removeClass("status-error").addClass("status-success").html(g("success")),B(),Q.CACHE.lcd={}):a.retCode===Q.RETCODE.NOT_AUTHORIZED?n(Q.DIALOG_ERROR,g("err.notAuthorized")):$("#status-lcd").removeClass("status-success").addClass("status-error").html(l(a.retCode)||
g("error")):b("jqXHR = "+$.stringify(f))},x=function(){D("/api/dev/xxx","set",!0)?t("/api/dev",!0,m,null,"set",null,$.stringify(a)):N(x,!0)};x()}}catch(q){b("error. display.eventHandlerLcdSubmit: "+q)}},U=function(){$("tbody").on("click","td",function(){$("[id^=status-]").html("&nbsp;");var a=$(this),b=a.prop("id");!b||-1===b.search("-measurement-")&&-1===b.search("-analog-")||(a.hasClass("lcdSelected")?(a.removeClass("lcdSelected"),Q.CACHE.lcd[b]=!1):(a.addClass("lcdSelected"),Q.CACHE.lcd[b]=!0),
a.blur())});$('span[id*="allOrNone"]').on("click",function(a){M(a)});$("#setLcdDisplay").on("click",function(){$("[id^=status-]").html("&nbsp;");T()})},R=function(){b("display.setLCDSelected...");try{var a=Q.CACHE.dev,c="",d=null,e=null,f=null,g;for(g in a)if(a.hasOwnProperty(g)){if(void 0!==a[g].outlet&&!$.isEmptyObject(a[g].outlet)){var h=a[g].outlet;for(e in h)if(h.hasOwnProperty(e)&&(c=g+"-outlet-"+e+"-measurement-",void 0!==h[e].measurement&&!$.isEmptyObject(h[e].measurement)))for(f in d=h[e].measurement,
d)d.hasOwnProperty(f)&&d[f].displayEnabled&&$("#"+c+f).addClass("lcdSelected")}if(void 0!==a[g].entity&&!$.isEmptyObject(a[g].entity)){var k=a[g].entity;for(e in k)if(k.hasOwnProperty(e)&&(c=g+"-entity-"+e+"-measurement-",void 0!==k[e].measurement&&!$.isEmptyObject(k[e].measurement)))for(f in d=k[e].measurement,d)d.hasOwnProperty(f)&&d[f].displayEnabled&&$("#"+c+f).addClass("lcdSelected")}if(void 0!==a[g].analog&&!$.isEmptyObject(a[g].analog)){var m=a[g].analog;for(e in m)m.hasOwnProperty(e)&&m[e].displayEnabled&&
(c=g+"-analog-"+e,$("#"+c).addClass("lcdSelected"))}}}catch(l){b("error. display.setLCDSelected: "+l)}finally{}},z=function(){$("#content-pane").find(".ui-icon").each(function(){var a=$(this);(a.hasClass("ui-icon-wrench")||a.hasClass("ui-icon-gear")||a.hasClass("ui-icon-trash"))&&a.hide()});Q.CACHE.lcd={};R();d(Q.USER.lang);U()},V=function(){b("display.getLCDPanel...");try{t("/api/dev",!0,function(c,d,e){if(c&&0===c.retCode){Q.CACHE.dev=c.data;c=w();d=s("lcddisplay.config");e=a("");var f=Q.CACHE.dev,
h=E(),k=$("<blockquote></blockquote>");if(f&&h)for(var m=0;m<h.length;m++){var x=h[m],q=F(x,f[x]);k.append(u(x));k.append(q.find(".section-header"));k.append(q.find(".section-body"))}d.find("blockquote").append(e.find("fieldset").append($("<h6></h6>").addClass("help-text ui-corner-all").append(g("lcddisplay.helpText"))).append(v("setLcdDisplay","diagAndTable.save","lcd")).append(k));c.append(d);$("#loading").replaceWith("");$("#content-pane").append(c);z()}else b("/api/dev get: textStatus="+d+", jqXHR="+
$.stringify(e)),n(Q.DIALOG_ERROR,l(c.retCode))},null,"get",null,null)}catch(c){b("error. display.getLCDPanel: "+c)}};return{getPageDisplay:function(){b("display.getPageDisplay...");try{$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),Q.CACHE.capability&&(Q.CACHE.capability.display&&!0===Q.CACHE.capability.display.show)&&(!0===Q.CACHE.capability.display.showLCD?V():(!0===Q.CACHE.capability.display.showMode&&P(),!0===Q.CACHE.capability.display.showVLC&&x()))}catch(a){b("error. display.getPageDisplay: "+
a)}}}}(Q.log,Q.getLocalStr,Q.dialogAlert,Q.util.getRetCodeMsg,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.validate.test,Q.validate.getApiData,Q.apiCall,Q.JQO.getSectionWrapperPlain,Q.JQO.getFormGroup,Q.JQO.getFormOptionList,Q.JQO.getFormSubmit,Q.JQO.getPageWrapper,Q.localize,Q.util.strToBool,Q.cacheDeviceData,Q.JQO.eventHandler_selectAllOrNone,Q.util.devGetSortedDevIds,Q.overview.getDeviceOverviewSection,Q.JQO.getSelectAllOrNone,Q.auth.accessControlNormal,Q.auth.accessTest,Q.dialogLogin);Q.oneviewSummary=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F){var u={},K=null,D=null,N=null;u.stopOneviewUpdatePing=function(){try{D&&(clearInterval(D),D=null,N&&(N.abort(),N=null))}catch(a){b("error. oneviewSummary.stopOneviewUpdatePing: "+a)}};var y=function(a,c,f){try{if(Q.PAGE!==Q.PAGES.ONEVIEW_SUMMARY)u.stopOneviewUpdatePing();else if(null!==D&&a&&0===a.retCode&&a.data){var e=a.data.group.total.entity,g=Q.CACHE.oneview.group.total.entity;e.hasOwnProperty("pduTotal")===g.hasOwnProperty("pduTotal")&&
e.hasOwnProperty("pduPhase")===g.hasOwnProperty("pduPhase")&&e.hasOwnProperty("ups")===g.hasOwnProperty("ups")&&e.hasOwnProperty("cooling")===g.hasOwnProperty("cooling")&&e.hasOwnProperty("environmental")===g.hasOwnProperty("environmental")||Q.gotoPage(Q.PAGE.ONEVIEW_SUMMARY);var k=g=f=c=null,l;for(l in e)if("pduTotal"===l)for(c in e[l]["0"].measurement)"energy"===e[l]["0"].measurement[c].type?$("#"+l+"-"+c+"-sumValue").html(m(e[l]["0"].measurement[c].sumValue)):"realPower"===e[l]["0"].measurement[c].type&&
($("#"+l+"-"+c+"-sumValue").html(e[l]["0"].measurement[c].sumValue),$("#"+l+"-"+c+"-minValue").html(e[l]["0"].measurement[c].minValue),$("#"+l+"-"+c+"-maxValue").html(e[l]["0"].measurement[c].maxValue),$("#"+l+"-"+c+"-avgValue").html(e[l]["0"].measurement[c].avgValue));else if("pduPhase"===l)for(f in e[l])for(g in e[l][f].measurement)"energy"===e[l][f].measurement[g].type?$("#"+l+"-"+f+"-"+g+"-sumValue").html(m(e[l][f].measurement[g].sumValue)):"realPower"===e[l][f].measurement[g].type&&($("#"+l+
"-"+f+"-"+g+"-sumValue").html(e[l][f].measurement[g].sumValue),$("#"+l+"-"+f+"-"+g+"-minValue").html(e[l][f].measurement[g].minValue),$("#"+l+"-"+f+"-"+g+"-maxValue").html(e[l][f].measurement[g].maxValue),$("#"+l+"-"+f+"-"+g+"-avgValue").html(e[l][f].measurement[g].avgValue));else if("ups"===l)for(g in e[l]["0"].measurement)if(k=e[l]["0"].measurement[g].type||"","realPower"==k)$("#"+l+"-"+g+"-maxValue").html(e[l]["0"].measurement[g].maxValue),$("#"+l+"-"+g+"-avgValue").html(e[l]["0"].measurement[g].avgValue);
else{if("timeRemaining"===k||"charge"===k)$("#"+l+"-"+g+"-minValue").html(e[l]["0"].measurement[g].minValue),$("#"+l+"-"+g+"-avgValue").html(e[l]["0"].measurement[g].avgValue)}else if("cooling"===l)for(g in e[l]["0"].measurement){if(k=e[l]["0"].measurement[g].type||"","fanSpeed"===k||"temperature"===k||"capacity"===k)$("#"+l+"-"+g+"-minValue").html(e[l]["0"].measurement[g].minValue),$("#"+l+"-"+g+"-maxValue").html(e[l]["0"].measurement[g].maxValue),$("#"+l+"-"+g+"-avgValue").html(e[l]["0"].measurement[g].avgValue)}else if("environmental"===
l)for(g in e[l]["0"].measurement)if(k=e[l]["0"].measurement[g].type||"","temperature"===k||"humidity"===k)$("#"+l+"-"+g+"-minValue").html(e[l]["0"].measurement[g].minValue),$("#"+l+"-"+g+"-maxValue").html(e[l]["0"].measurement[g].maxValue),$("#"+l+"-"+g+"-avgValue").html(e[l]["0"].measurement[g].avgValue);e=a.data.host;$("#notificationsTbl-group").replaceWith(V(e));h(Q.USER.lang);d("notificationsTbl");Q.CACHE.oneview=a.data}}catch(n){b("error. oneviewSummary.updatePingCallback: "+n)}},G=function(a){a=
a&&"number"===typeof a&&5<a?a:Q.UPDATE_INTERVAL;b("oneviewSummary.initOneviewUpdatePing => "+a+" seconds");try{u.stopOneviewUpdatePing(),D=setInterval(function(){Q.PAGE!==Q.PAGES.ONEVIEW_SUMMARY?u.stopOneviewUpdatePing():N&&"resolved"!==N.state()?b("oneview: update overlap..."):N=n("/oneview",!0,y,null,"get",null,null)},1E3*a)}catch(c){b("error. oneviewSummary.initOneviewUpdatePing: "+c)}},H=function(a,b){var c=null,d=$("<tr></tr>"),e=$("<td></td>"),g=null;if(a&&b){d.append(e.clone().prop("id",a+
"-state").append("&nbsp;"));var h=b.label||b.name;"Total"===h&&(h="PDU "+h);d.append(e.clone().addClass("alignLeft").prop("id",a+"-name").append(h));h=null;for(c in b.measurement)"energy"===b.measurement[c].type&&d.append(e.clone().prop("id",a+"-"+c+"-sumValue").append(m(b.measurement[c].sumValue))),"realPower"===b.measurement[c].type&&(g=b.measurement[c],h=c);g&&(d.append(e.clone().prop("id",a+"-"+h+"-sumValue").append(g.sumValue)),d.append(e.clone().prop("id",a+"-"+h+"-minValue").append(g.minValue)),
d.append(e.clone().prop("id",a+"-"+h+"-maxValue").append(g.maxValue)),d.append(e.clone().prop("id",a+"-"+h+"-avgValue").append(g.avgValue)))}return d};u.getTableHeaderPDU=function(){var b=a("meas.units.kwHr"),c=a("meas.units.watts"),d=$("<table></table>"),e=$("<thead></thead>");e.append($("<tr></tr>").addClass("table-header").append($("<th></th>").addClass("w10 statusHdr hdrBorder").prop("rowspan",2).append("&nbsp;")).append($("<th></th>").addClass("alignLeft statusHdr hdrBorder").prop("rowspan",
2).append(a("common.name"))).append($("<th></th>").addClass("w100 statusHdr hdrBorder").prop("rowspan",2).append(a("meas.name.energy")+" ("+b+")")).append($("<th></th>").addClass("statusHdr hdrBorder").prop("colspan",4).css("width","400px").append(a("meas.name.power")+" ("+c+")")));e.append($("<tr></tr>").addClass("table-header").append($("<th></th>").addClass("statusHdr w100 hdrBorder").append(a("meas.sum"))).append($("<th></th>").addClass("statusHdr w100 hdrBorder").append(a("meas.min"))).append($("<th></th>").addClass("statusHdr w100 hdrBorder").append(a("meas.max"))).append($("<th></th>").addClass("statusHdr w100 hdrBorder").append(a("meas.avg"))));
d.append(e);return d};var P=function(){var a=Q.CACHE.oneview&&Q.CACHE.oneview.group&&Q.CACHE.oneview.group.total&&Q.CACHE.oneview.group.total.entity?Q.CACHE.oneview.group.total.entity:null,b=w("pduTbl"),c=u.getTableHeaderPDU();b.find("thead").replaceWith(c.find("thead"));a&&a.pduTotal&&b.find("tbody").append(H("pduTotal",a.pduTotal["0"]));if(a&&a.pduPhase)for(var d in a.pduPhase)b.find("tbody").append(H("pduPhase-"+d,a.pduPhase[d]));b.removeClass("fm-table");return b},O=function(a,b){var c=null,d=
$("<tr></tr>"),e=$("<td></td>");if(a&&b)for(c in d.append(e.clone().prop("id",a+"-state").append("&nbsp;")),d.append(e.clone().addClass("alignLeft").prop("id",a+"-name").append(b.label||b.name)),b.measurement)"realPower"===b.measurement[c].type&&(d.append(e.clone().prop("id",a+"-"+c+"-maxValue").append(b.measurement[c].maxValue)),d.append(e.clone().prop("id",a+"-"+c+"-avgValue").append(b.measurement[c].avgValue))),"timeRemaining"===b.measurement[c].type&&(d.append(e.clone().prop("id",a+"-"+c+"-minValue").append(b.measurement[c].minValue)),
d.append(e.clone().prop("id",a+"-"+c+"-avgValue").append(b.measurement[c].avgValue))),"charge"===b.measurement[c].type&&(d.append(e.clone().prop("id",a+"-"+c+"-minValue").append(b.measurement[c].minValue)),d.append(e.clone().prop("id",a+"-"+c+"-avgValue").append(b.measurement[c].avgValue)));return d};u.getTableHeaderUPS=function(){var b=a("meas.units.watts"),c=a("meas.units.minutes"),d=a("meas.units.percent"),e=$("<table></table>"),g=$("<thead></thead>");g.append($("<tr></tr>").addClass("table-header").append($("<th></th>").addClass("w10 statusHdr hdrBorder").prop("rowspan",
2).append("&nbsp;")).append($("<th></th>").addClass("alignLeft statusHdr hdrBorder").prop("rowspan",2).append(a("common.name"))).append($("<th></th>").addClass("statusHdr hdrBorder").prop("colspan",2).css("width","200px").append(a("meas.name.power")+" ("+b+")")).append($("<th></th>").addClass("statusHdr hdrBorder").prop("colspan",2).css("width","200px").append(a("meas.name.batteryAutonomy")+" ("+c+")")).append($("<th></th>").addClass("statusHdr hdrBorder").prop("colspan",2).css("width","200px").append(a("meas.name.batteryCharge")+
" ("+d+")")));g.append($("<tr></tr>").addClass("table-header").append($("<th></th>").addClass("statusHdr w100 hdrBorder").append(a("meas.max"))).append($("<th></th>").addClass("statusHdr w100 hdrBorder").append(a("meas.avg"))).append($("<th></th>").addClass("statusHdr w100 hdrBorder").append(a("meas.min"))).append($("<th></th>").addClass("statusHdr w100 hdrBorder").append(a("meas.avg"))).append($("<th></th>").addClass("statusHdr w100 hdrBorder").append(a("meas.min"))).append($("<th></th>").addClass("statusHdr w100 hdrBorder").append(a("meas.avg"))));
e.append(g);return e};var I=function(){var a=Q.CACHE.oneview&&Q.CACHE.oneview.group&&Q.CACHE.oneview.group.total&&Q.CACHE.oneview.group.total.entity?Q.CACHE.oneview.group.total.entity:null,b=w("upsTbl"),c=u.getTableHeaderUPS();b.find("thead").replaceWith(c.find("thead"));a&&a.ups&&b.find("tbody").append(O("ups",a.ups["0"]));b.removeClass("fm-table");return b},J=function(a,b){var c=null,d=$("<tr></tr>"),e=$("<td></td>");if(a&&b){d.append(e.clone().prop("id",a+"-state").append("&nbsp;"));d.append(e.clone().addClass("alignLeft").prop("id",
a+"-name").append(b.label||b.name));var g={};for(c in b.measurement)"temperature"===b.measurement[c].type?g.temperature=c:"fanSpeed"===b.measurement[c].type?g.fanSpeed=c:"capacity"===b.measurement[c].type&&(g.capacity=c);c=g.fanSpeed;d.append(e.clone().prop("id",a+"-"+c+"-minValue").append(b.measurement[c].minValue));d.append(e.clone().prop("id",a+"-"+c+"-maxValue").append(b.measurement[c].maxValue));d.append(e.clone().prop("id",a+"-"+c+"-avgValue").append(b.measurement[c].avgValue));c=g.temperature;
d.append(e.clone().prop("id",a+"-"+c+"-minValue").append(b.measurement[c].minValue));d.append(e.clone().prop("id",a+"-"+c+"-maxValue").append(b.measurement[c].maxValue));d.append(e.clone().prop("id",a+"-"+c+"-avgValue").append(b.measurement[c].avgValue));c=g.capacity;d.append(e.clone().prop("id",a+"-"+c+"-minValue").append(b.measurement[c].minValue));d.append(e.clone().prop("id",a+"-"+c+"-maxValue").append(b.measurement[c].maxValue));d.append(e.clone().prop("id",a+"-"+c+"-avgValue").append(b.measurement[c].avgValue))}return d};
u.getTableHeaderCooling=function(){var b=a("meas.units.percent"),c=u.getTempUnits(),d=$("<table></table>"),e=$("<thead></thead>");e.append($("<tr></tr>").addClass("table-header").append($("<th></th>").addClass("w10 statusHdr hdrBorder").prop("rowspan",2).append("&nbsp;")).append($("<th></th>").addClass("alignLeft statusHdr hdrBorder").prop("rowspan",2).append(a("common.name"))).append($("<th></th>").addClass("statusHdr hdrBorder").prop("colspan",3).css("width","200px").append(a("meas.name.fanSpeed")+
" ("+b+")")).append($("<th></th>").addClass("statusHdr hdrBorder").prop("colspan",3).css("width","200px").append(a("meas.name.temperature")+" ("+c+")")).append($("<th></th>").addClass("statusHdr hdrBorder").prop("colspan",3).css("width","200px").append(a("meas.name.capacity")+" ("+b+")")));e.append($("<tr></tr>").addClass("table-header").append($("<th></th>").addClass("statusHdr w65 hdrBorder").append(a("meas.min"))).append($("<th></th>").addClass("statusHdr w65 hdrBorder").append(a("meas.max"))).append($("<th></th>").addClass("statusHdr w65 hdrBorder").append(a("meas.avg"))).append($("<th></th>").addClass("statusHdr w65 hdrBorder").append(a("meas.min"))).append($("<th></th>").addClass("statusHdr w65 hdrBorder").append(a("meas.max"))).append($("<th></th>").addClass("statusHdr w65 hdrBorder").append(a("meas.avg"))).append($("<th></th>").addClass("statusHdr w65 hdrBorder").append(a("meas.min"))).append($("<th></th>").addClass("statusHdr w65 hdrBorder").append(a("meas.max"))).append($("<th></th>").addClass("statusHdr w65 hdrBorder").append(a("meas.avg"))));
d.append(e);return d};u.getTableCooling=function(a){var b=Q.CACHE.oneview&&Q.CACHE.oneview.group&&Q.CACHE.oneview.group.total&&Q.CACHE.oneview.group.total.entity?Q.CACHE.oneview.group.total.entity:null,c=w(a?"coolingTbl-group":"coolingTbl"),d=u.getTableHeaderCooling();c.find("thead").replaceWith(d.find("thead"));b&&b.cooling&&(a=a?a+"-cooling":"cooling",c.find("tbody").append(J(a,b.cooling["0"])));c.removeClass("fm-table");return c};var x=function(a,b){var c=null,d=$("<tr></tr>"),e=$("<td></td>");
if(a&&b)for(c in d.append(e.clone().prop("id",a+"-state").append("&nbsp;")),d.append(e.clone().addClass("alignLeft").prop("id",a+"-name").append(b.label||b.name)),b.measurement)"temperature"===b.measurement[c].type&&(d.append(e.clone().prop("id",a+"-"+c+"-minValue").append(b.measurement[c].minValue)),d.append(e.clone().prop("id",a+"-"+c+"-maxValue").append(b.measurement[c].maxValue)),d.append(e.clone().prop("id",a+"-"+c+"-avgValue").append(b.measurement[c].avgValue))),"humidity"===b.measurement[c].type&&
(d.append(e.clone().prop("id",a+"-"+c+"-minValue").append(b.measurement[c].minValue)),d.append(e.clone().prop("id",a+"-"+c+"-maxValue").append(b.measurement[c].maxValue)),d.append(e.clone().prop("id",a+"-"+c+"-avgValue").append(b.measurement[c].avgValue)));return d};u.getTempUnits=function(){var a=Q.CACHE.oneview.group;if(a)for(var b in a)for(var c in a[b].entity)if("environmental"===c||"cooling"===c)for(var d in a[b].entity[c]){var e=a[b].entity[c][d].measurement,g;for(g in e)if("temperature"===
e[g].type)return e[g].units}return""};u.getTableHeaderENV=function(){var b=u.getTempUnits(),c=a("meas.units.percent"),d=$("<table></table>"),e=$("<thead></thead>");e.append($("<tr></tr>").addClass("table-header").append($("<th></th>").addClass("w10 statusHdr hdrBorder").prop("rowspan",2).append("&nbsp;")).append($("<th></th>").addClass("alignLeft statusHdr hdrBorder").prop("rowspan",2).append(a("common.name"))).append($("<th></th>").addClass("statusHdr hdrBorder").prop("colspan",3).css("width","300px").append(a("meas.name.temperature")+
" ("+b+")")).append($("<th></th>").addClass("statusHdr hdrBorder").prop("colspan",3).css("width","300px").append(a("meas.name.humidity")+" ("+c+")")));e.append($("<tr></tr>").addClass("table-header").append($("<th></th>").addClass("statusHdr w100 hdrBorder").append(a("meas.min"))).append($("<th></th>").addClass("statusHdr w100 hdrBorder").append(a("meas.max"))).append($("<th></th>").addClass("statusHdr w100 hdrBorder").append(a("meas.avg"))).append($("<th></th>").addClass("statusHdr w100 hdrBorder").append(a("meas.min"))).append($("<th></th>").addClass("statusHdr w100 hdrBorder").append(a("meas.max"))).append($("<th></th>").addClass("statusHdr w100 hdrBorder").append(a("meas.avg"))));
d.append(e);return d};var T=function(a){a=Q.CACHE.oneview&&Q.CACHE.oneview.group&&Q.CACHE.oneview.group.total&&Q.CACHE.oneview.group.total.entity?Q.CACHE.oneview.group.total.entity:null;var b=w("envTbl"),c=u.getTableHeaderENV();b.find("thead").replaceWith(c.find("thead"));a&&a.environmental&&b.find("tbody").append(x("environmental",a.environmental["0"]));b.removeClass("fm-table");return b};u.ENTITY={PDU_PHASE:"pduPhase",PDU_TOTAL:"pduTotal",ENV:"environmental",UPS:"ups",COOLING:"cooling"};u.groupHasEntity=
function(a,b){var c=!1;a&&(b&&Q.CACHE.oneview&&Q.CACHE.oneview.group&&Q.CACHE.oneview.group[a]&&Q.CACHE.oneview.group[a].entity&&Q.CACHE.oneview.group[a].entity[b])&&(c=!0);return c};var U=function(){var a=$("<div></div>"),b=0;if(u.groupHasEntity("total",u.ENTITY.PDU_TOTAL)){var c=$("<div></div>").addClass("table-wrapper ui-corner-all").append(P());a.append(c);b++}u.groupHasEntity("total",u.ENTITY.UPS)&&(c=$("<div></div>").addClass("table-wrapper ui-corner-all").append(I()),b&&a.append($("<br>")),
a.append(c),b++);u.groupHasEntity("total",u.ENTITY.COOLING)&&(c=$("<div></div>").addClass("table-wrapper ui-corner-all").append(u.getTableCooling()),b&&a.append($("<br>")),a.append(c),b++);u.groupHasEntity("total",u.ENTITY.ENV)&&(c=$("<div></div>").addClass("table-wrapper ui-corner-all").append(T()),b&&a.append($("<br>")),a.append(c));return a},R=function(b){var c=[],d=[];if(b)for(var e in b)if("unresponsive"===b[e].state||"partiallyUnavailable"===b[e].state){var g=a("common.macAddress")+" "+e,h=
a("state.relayFailure")+" / "+a("state.unavailable");c.push({host:e,port:null,deviceLabel:g,severity:"alarm",path:null,type:null,threshold:null,message:h})}else if("pdu"===b[e].type){var g=b[e].webPort,h="",k=b[e].cache&&b[e].cache.alarm&&b[e].cache.alarm.trigger?b[e].cache.alarm.trigger:null;if(k)for(var l in k)if("tripped"===k[l].state){var m="",n=k[l].path.split("/"),x=b[e].cache.dev[n[0]],h=x.label;if(x){for(var m=a("alarms."+k[l].severity)+": ",q=!1,s=1;s<n.length;s++){if(x)x=x[n[s]];else break;
x&&x.label&&(q&&(m+=", "),m+=x.label,q=!0)}x&&(m+=" "+(x.type?x.type:""))}d.push({host:e,port:g,deviceLabel:h,severity:k[l].severity,path:k[l].path,type:k[l].type,threshold:k[l].threshold,message:m})}}return c.concat(d)},z=function(b){var c=$("<tr></tr>");K&&K.attr("data-mac")===b.host&&c.css("background-color","#ffde05");var d=$("<td></td>").addClass("alignLeft"),e=$("<span></span>").addClass("ui-icon statusspan");if(b){"alarm"===b.severity?e.addClass("ui-icon-alert"):e.addClass("ui-icon-notice");
if(null!==b.port&&null!==b.path){var g="http://"+window.location.host;b.port&&(g+=":"+b.port);g+="/#alarms";e=$("<a></a>").prop("href",g).prop("target","_blank").append(e)}c.append(d.clone().removeClass("alignLeft").append(e));c.append(d.clone().append(b.deviceLabel));null!==b.port&&null!==b.path?c.append(d.clone().append(b.message)):c.append(d.clone().append(b.message+"&nbsp;&nbsp;").append($("<span></span>").addClass("ui-icon ui-icon-trash action ui-corner-all").prop("title",a("diagAndTable.delete")).attr("data-mac",
b.host)))}return c},V=function(a){a=a?R(a):R(Q.CACHE.oneview.host);var b=w("notificationsTbl"),c;c=v("T-ovNotificationsTableHeader").find("tr");b.find("thead").append(c);if(a&&a instanceof Array)for(c=0;c<a.length;c++)b.find("tbody").append(z(a[c]));b.removeClass("fm-table");return b},Y=function(){var a=$("<div></div>"),b=$("<div></div>").addClass("table-wrapper ui-corner-all").append(V());a.append(b);return a};u.deleteHost=function(a){b("oneviewSummary.deleteHost: "+a);var c=function(a,c,d){a?0===
a.retCode?($("#dialog-host-del").dialog("close"),Q.gotoPage(Q.PAGE)):(K=null,e(Q.DIALOG_ERROR,t(a.retCode))):b("error. deleteHost cb: "+$.stringify(d))},d=function(){E("/oneview/host/"+a,"delete",!0)?B("/oneview/host/"+a,c,!0):F(d,!0)};d()};var X=function(b){if(b){var c=a("diagAndTable.youSure")+"<br>"+a("status.hostDelete"),d=$("<div></div>");d.append($("<div></div>").prop("id","dialog-host-del").prop("title",a("diagAndTable.delete")).append($("<p></p>").append($("<span></span>").addClass("ui-icon ui-icon-alert").prop("style",
"float:left;margin:0 7px 20px 0;")).append($("<span></span>").prop("id","rusure").append(c))));M(d.html(),{autoOpen:!1,resizable:!1,width:300,height:180,modal:!0,close:function(){K&&($("#notificationsTbl").find("tr").removeAttr("style"),K=null)},buttons:[{id:"dlg-btn-host-del-delete",text:a("diagAndTable.delete"),click:function(){$("[id^=status-]").html("&nbsp;");u.deleteHost(b);K=null}},{id:"dlg-btn-host-del-cancel",text:a("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]});K&&K.parent().parent().css("background-color",
"#ffde05");$("#dialog-host-del").dialog("open")}};u.getPageOneviewSummary=function(){b("oneviewSummary.getPageOneviewSummary...");n("/oneview",!0,function(a,g,f){a&&0===a.retCode?a.data&&(Q.CACHE.oneview=a.data,a=k(""),a.append(q("menu.oneviewSummary")).append(c(U())).append(q("ov.notifications")).append(c(Y())),$("#loading").replaceWith(""),$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),$("#content-pane").append(a),d("pduTbl"),d("upsTbl"),d("envTbl"),d("coolingTbl"),d("notificationsTbl"),
$("div.section-body").prop("style","background:#ccc;"),h(Q.USER.lang),G(Q.UPDATE_INTERVAL),$("#notificationsTbl-group").closest('div[class^="section-"]').on("click",".ui-icon-trash",function(a){K=$(this);X($(this).attr("data-mac"))})):a?e(Q.DIALOG_ERROR,t(a.retCode)):(a.retCode===Q.RETCODE.SESSION_EXPIRED&&s(),b("/api/dev get: textStatus="+g+", jqXHR="+$.stringify(f)))},null,"get",null,null)};return u}(Q.log,Q.gotoPage,Q.apiCall,Q.JQO.getFormGroup,Q.JQO.getPageWrapper,Q.JQO.getSectionHeaderPlain,
Q.JQO.getSection,Q.dialogAlert,Q.util.getRetCodeMsg,Q.auth.handleInvalidSession,Q.getLocalStr,Q.localize,Q.getTemplate,Q.JQO.getFormTable,Q.util.fixTableRows,Q.cacheHelper.formatEnergyString,Q.apiCallDelete,Q.createDialog,Q.auth.accessTest,Q.dialogLogin);Q.oneviewDevices=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M){var E={},F=null,u=null,K=null,D=null,N=0,y=0,G=0,H=0,P=0,O=function(a){var c="normal",d=0;if(!a instanceof Array)throw b("oneviewDevices.getMeasurmentRollupState: invalid input, not an Array"),"Invalid input";for(var f=0;f<a.length;f++)"normal"===a[f]&&d++;0===d?c="unavailable":d<a.length&&(c="partiallyUnavailable");return c},I=function(b,c,d){var f=$("<span></span>").addClass("ui-icon statusspan");"unresponsive"===b||"unavailable"===
c||"unavailable"===d?(f.addClass("ui-icon-alert"),"unresponsive"===b?f.prop("title",a("state.relayFailure")):f.prop("title",a("state.unavailable"))):"discovered"===b?f.addClass("ui-icon-none").prop("title",a("state.none")):"partiallyUnavailable"===b||"partiallyUnavailable"===c||"partiallyUnavailable"===d?f.addClass("ui-icon-notice").prop("title",a("state.degraded")):f.addClass("ui-icon-check").prop("title",a("state.normal"));return f};E.stopOneviewUpdatePing=function(){try{u&&(clearInterval(u),u=
null,K&&(K.abort(),K=null))}catch(a){b("error. oneviewDevices.stopOneviewUpdatePing: "+a)}};var J=function(c,d,f){try{if(Q.PAGE!==Q.PAGES.ONEVIEW_DEVICES)E.stopOneviewUpdatePing();else if(null!==u&&c&&0===c.retCode&&c.data)if(Object.keys(c.data).length!==Object.keys(Q.CACHE.oneview.host).length||z("unknown",c.data).length!==z("unknown",Q.CACHE.oneview.host).length||U(c.data).length!==U(Q.CACHE.oneview.host).length||R(c.data).length!==R(Q.CACHE.oneview.host).length)x(c.data);else{f=d=null;var e=["energy",
"power"],g=Y(c.data);if(g)for(d=0;d<g.length;d++)for($("#"+g[d].id+"-state").find("span").replaceWith(I(g[d].stateHost,g[d].stateDevice,O(g[d].stateMeasurements))),f=0;f<e.length;f++)"energy"===e[f]?$("#"+g[d].id+"-"+e[f]).html(m(g[d][e[f]])):$("#"+g[d].id+"-"+e[f]).html(g[d][e[f]]);e=["inputVoltage","outputSource","batteryStatus","timeRemaining","charge"];if(g=X(c.data))for(d=0;d<g.length;d++)for($("#"+g[d].id+"-state").find("span").replaceWith(I(g[d].stateHost,g[d].stateDevice,O(g[d].stateMeasurements))),
f=0;f<e.length;f++){var h="",h="outputSource"===e[f]?a("outputSource."+g[d][e[f]]):"batteryStatus"===e[f]?a("batteryStatus."+g[d][e[f]]):g[d][e[f]];$("#"+g[d].id+"-"+e[f]).html(h)}e=["temperature","fanSpeed","capacity"];if(g=ba(c.data))for(d=0;d<g.length;d++)for($("#"+g[d].id+"-state").find("span").replaceWith(I(g[d].stateHost,g[d].stateDevice,O(g[d].stateMeasurements))),f=0;f<e.length;f++)$("#"+g[d].id+"-"+e[f]).html(g[d][e[f]]);e=["temperature","humidity"];if(g=L(c.data))for(d=0;d<g.length;d++)for($("#"+
g[d].id+"-state").find("span").replaceWith(I(g[d].stateHost,g[d].stateDevice,O(g[d].stateMeasurements))),f=0;f<e.length;f++)$("#"+g[d].id+"-"+e[f]).html(g[d][e[f]])}}catch(k){b("error. oneviewDevices.updatePingCallback: "+k)}},x=function(a){b("oneviewDevices.refreshTables...");$("#pduTbl").replaceWith(r(a));$("#upsTbl").replaceWith(S(a));$("#coolingTbl").replaceWith(ka(a));$("#envTbl").replaceWith(ja(a));$("#unknownTbl").replaceWith(la(a));pa();$("table").each(function(a,b){d($(b).prop("id"))});Q.CACHE.oneview.host=
a},T=function(a){a=a&&"number"===typeof a&&5<a?a:Q.UPDATE_INTERVAL;b("oneviewDevices.initOneviewUpdatePing => "+a+" seconds");try{E.stopOneviewUpdatePing(),u=setInterval(function(){Q.PAGE!==Q.PAGES.ONEVIEW_DEVICES?E.stopOneviewUpdatePing():K&&"resolved"!==K.state()?b("oneview: update overlap..."):K=n("/oneview/host",!0,J,null,"get",null,null)},1E3*a)}catch(c){b("error. oneviewDevices.initOneviewUpdatePing: "+c)}},U=function(a){var b=[];if(a)for(var c in a)if("pdu"===a[c].type){var d=a[c].cache.dev;
if(d)for(var f in d)-1!==$.inArray(d[f].type,Q.SUPPORTED_ENV_TYPES)&&b.push(c+"|"+f)}return b},R=function(a){var b=[];if(a)for(var c in a)if("pdu"===a[c].type){var d=a[c].cache.dev;if(d)for(var f in d)-1!==d[f].type.search("vrc")&&b.push(c+"|"+f)}return b},z=function(a,b){var c=[],d=null;if("unknown"===a){for(d in b)Q.oneviewGroupConfig.isHostTypeUnknown(b[d])&&c.push(d);N=c.length}if("pdu"===a||"ups"===a){for(d in b)b[d].type===a&&c.push(d);"pdu"===a?y=c.length:"ups"===a&&(G=c.length)}else"environmental"===
a?(c=U(b),H=c.length):"cooling"===a&&(c=R(b),P=c.length);return c},V=function(){var a={},b=Q.CACHE.oneview.group,c;for(c in b)a[c]=b[c].label;return a},Y=function(a){try{var c=[],d=z("pdu",a),f=null,e=null,g=null,h=null,k=null,l=null,m=null;if(a&&d)for(var p=0;p<d.length;p++){var n=null,x=null,r=[],q=d[p],s=a[q];if(s){var n=s.state||"&mdash;",e=s.snmpPort||"&mdash;",g=s.webPort||"",k=s.group||"&mdash;",t;for(t in s.cache.dev){var v=s.cache.dev[t].type;if("i03"===v||"rs"===v||"I-02"===v){var f=t,h=
s.cache.dev[t].label,x=s.cache.dev[t].state,I=null;if(I="i03"===v||"rs"===v?s.cache.dev[t].entity.total0.measurement:s.cache.dev[t].entity["0"].measurement){var l=m=null,J;for(J in I)"realPower"===I[J].type&&(m=I[J].value,r.push(I[J].state)),"energy"===I[J].type&&(l=I[J].value,r.push(I[J].state))}c.push({mac:q,id:f,stateHost:n,stateDevice:x,stateMeasurements:r,snmpPort:e,webPort:g,name:h,group:k,energy:l,power:m})}}}}return c}catch(w){b("error. oneviewDevices.gatherPduData: "+w)}},X=function(a){try{var c=
[],d=z("ups",a),f=null,e=null,g=null,h=null,k=null,l=null,m=null,p=null,n=null,x=null;if(a&&d)for(var r=0;r<d.length;r++){var q=null,s=null,t=[],v=d[r],I=a[v];if(I){var q=I.state||"&mdash;",e=I.snmpPort||"&mdash;",g=I.webPort||"",h=I.cache.sys.name,k=I.group||"&mdash;",J;for(J in I.cache.dev)if("lups"===I.cache.dev[J].type){var f=J,s=I.cache.dev[J].state,w=I.cache.dev[J].entity;if(w){var u=w.input0.measurement,y=null;for(y in u)if("voltage"===u[y].type){m=u[y].value;t.push(u[y].state);break}p=w.output0.source;
l=w.battery0.status;u=w.battery0.measurement;for(y in u)"timeRemaining"===u[y].type&&(n=u[y].value,t.push(u[y].state)),"charge"===u[y].type&&(x=u[y].value,t.push(u[y].state))}c.push({mac:v,id:f,stateHost:q,stateDevice:s,stateMeasurements:t,snmpPort:e,webPort:g,name:h,group:k,batteryStatus:l,inputVoltage:m,outputSource:p,timeRemaining:n,charge:x})}}}return c}catch(A){b("error. oneviewDevices.gatherUpsData: "+A)}},A=function(a){var b="";if(a)for(var c in a.cache.dev){var d=a.cache.dev[c];if("i03"===
d.type||"I-02"===d.type||"rs"===d.type){b=d.label;break}}return b},L=function(a){try{var c=[],d=z("environmental",a),f=null,e=null,g=null,h=null,k=null,l=null,m=null,p=null;if(a&&d)for(var n=0;n<d.length;n++){var x=null,r=null,q=[],s=d[n].split("|");if(2!==s.length)b("oneviewDevices.gatherEnvData: invalid hostKey: "+d[n]);else{var t=s[0],I=s[1],v=a[t],x=a[t].state,e=a[t].snmpPort,g=a[t].webPort||"";if(v){var l=$("<div></div>").append(A(v)).append("&nbsp;").append($("<span></span>").css("font-size",
"small").append("("+t+")")),k=v.group||"&mdash;",J=v.cache.dev[I];if(J){var f=I,r=J.state,h=J.label,w=v.cache.dev[I].entity["0"].measurement;if(w)for(var u in w)"temperature"===w[u].type&&(m=w[u].value,q.push(w[u].state)),"humidity"===w[u].type&&(p=w[u].value,q.push(w[u].state));if(null===p||void 0===p||""===p)p="&mdash;";if(null===m||void 0===m||""===m)m="&mdash;";c.push({mac:t,id:f,stateHost:x,stateDevice:r,stateMeasurements:q,snmpPort:e,webPort:g,name:h,group:k,device:l,temperature:m,humidity:p})}}}}return c}catch(y){b("error. oneviewDevices.gatherEnvData: "+
y)}},f=function(b){var c=$("<tr></tr>"),d=$("<td></td>"),f=V();if(b){c.append(d.clone().prop("id",b.id+"-state").append(I(b.stateHost,b.stateDevice,O(b.stateMeasurements))));c.append(d.clone().prop("id",b.id+"-pdu-delete").attr("data-mac",b.mac).append($("<span></span>").addClass("ui-icon ui-icon-trash action actionFloat ui-corner-all").prop("title",a("diagAndTable.delete"))));if(void 0!==b.webPort){var e="http://"+window.location.host+":"+b.webPort,g=e+"\n(SNMP Port "+b.snmpPort+")";""===b.webPort&&
(e="http://"+window.location.host+"/#overview",g="http://"+window.location.host);c.append(d.clone().addClass("alignLeft").prop("id",b.id+"-name").prop("title",g).append($("<a></a>").prop("href",e).prop("target","_blank").append(b.name)).append("&nbsp;").append($("<span></span>").css("font-size","small").append("("+b.mac+")")))}else c.append(d.clone().addClass("alignLeft").prop("id",b.id+"-name").append(b.name));c.append(d.clone().addClass("alignLeft").prop("id",b.id+"-group").append(f[b.group]));
c.append(d.clone().prop("id",b.id+"-energy").append(m(b.energy)));c.append(d.clone().prop("id",b.id+"-power").append(b.power))}return c},r=function(b){var c=v("pduTbl"),d=a("meas.units.kwHr"),e=a("meas.units.watts"),g=$("<table></table>"),h=$("<thead></thead>");h.append($("<tr></tr>").addClass("table-header").append($("<th></th>").addClass("w75 statusHdr hdrBorder").append(a("status.cfg.state"))).append($("<th></th>").addClass("w25 statusHdr hdrBorder").append("&nbsp;")).append($("<th></th>").addClass("w300 alignLeft statusHdr hdrBorder").append(a("common.name"))).append($("<th></th>").addClass("w100 alignLeft statusHdr hdrBorder").append(a("ov.group"))).append($("<th></th>").addClass("statusHdr hdrBorder").append(a("meas.name.energy")+
" ("+d+")")).append($("<th></th>").addClass("statusHdr hdrBorder").append(a("meas.name.power")+" ("+e+")")));g.append(h);c.find("thead").replaceWith(g.find("thead"));if(b&&(b=Y(b)))for(d=0;d<b.length;d++)c.find("tbody").append(f(b[d]));return c},p=function(a){var b=$("<div></div>");b.addClass("table-wrapper ui-corner-all").append(r(a));return b},W=function(b){var c=$("<tr></tr>"),d=$("<td></td>"),f=V();if(b){c.append(d.clone().prop("id",b.id+"-state").append(I(b.stateHost,b.stateDevice,O(b.stateMeasurements))));
c.append(d.clone().prop("id",b.id+"-ups-delete").attr("data-mac",b.mac).append($("<span></span>").addClass("ui-icon ui-icon-trash action actionFloat ui-corner-all").prop("title",a("diagAndTable.delete"))));if(b.webPort){var e="http://"+window.location.host+":"+b.webPort;c.append(d.clone().addClass("alignLeft").prop("id",b.id+"-name").prop("title",e+"\n(SNMP Port "+b.snmpPort+")").append($("<a></a>").prop("href",e).prop("target","_blank").append(b.name)))}else c.append(d.clone().addClass("alignLeft").prop("id",
b.id+"-name").append(b.name));c.append(d.clone().addClass("alignLeft").prop("id",b.id+"-group").append(f[b.group]));c.append(d.clone().prop("id",b.id+"-inputVoltage").append(b.inputVoltage));c.append(d.clone().prop("id",b.id+"-outputSource").append(b.outputSource));c.append(d.clone().prop("id",b.id+"-batteryStatus").append(b.batteryStatus));c.append(d.clone().prop("id",b.id+"-timeRemaining").append(b.timeRemaining));c.append(d.clone().prop("id",b.id+"-charge").append(b.charge))}return c},S=function(b){var c=
v("upsTbl"),d=a("meas.units.vac"),f=a("meas.units.minutes"),e=a("meas.units.percent"),g=$("<table></table>"),h=$("<thead></thead>");h.append($("<tr></tr>").addClass("table-header").append($("<th></th>").addClass("w75 statusHdr hdrBorder").prop("rowspan",2).append(a("status.cfg.state"))).append($("<th></th>").addClass("w25 statusHdr hdrBorder").prop("rowspan",2).append("&nbsp;")).append($("<th></th>").addClass("w200 statusHdr hdrBorder alignLeft").prop("rowspan",2).append(a("common.name"))).append($("<th></th>").addClass("w100 statusHdr hdrBorder alignLeft").prop("rowspan",
2).append(a("ov.group"))).append($("<th></th>").addClass("statusHdr hdrBorder").append(a("ov.input"))).append($("<th></th>").addClass("statusHdr hdrBorder").append(a("ov.output"))).append($("<th></th>").addClass("statusHdr hdrBorder").prop("colspan",3).append(a("outputSource.battery"))));h.append($("<tr></tr>").addClass("table-header").append($("<th></th>").addClass("statusHdr hdrBorder").append(a("meas.name.voltage")+" ("+d+")")).append($("<th></th>").addClass("statusHdr hdrBorder").append(a("ov.source"))).append($("<th></th>").addClass("statusHdr hdrBorder").append(a("menu.status"))).append($("<th></th>").addClass("statusHdr hdrBorder").append(a("ov.autonomy")+
" ("+f+")")).append($("<th></th>").addClass("statusHdr hdrBorder").append(a("ov.charge")+" ("+e+")")));g.append(h);c.find("thead").replaceWith(g.find("thead"));if(b&&(b=X(b)))for(d=0;d<b.length;d++)c.find("tbody").append(W(b[d]));return c},Z=function(a){var b=$("<div></div>");b.addClass("table-wrapper ui-corner-all").append(S(a));return b},aa=function(b){var c=$("<tr></tr>"),d=$("<td></td>"),f=V();if(b){c.append(d.clone().prop("id",b.id+"-state").append(I(b.stateHost,b.stateDevice,O(b.stateMeasurements))));
c.append(d.clone().prop("id",b.id+"-env-delete").attr("data-mac",b.mac).append($("<span></span>").addClass("ui-icon ui-icon-trash action actionFloat ui-corner-all").prop("title",a("diagAndTable.delete"))));if(void 0!==b.webPort){var e="http://"+window.location.host+":"+b.webPort,g=e+"\n(SNMP Port "+b.snmpPort+")";""===b.webPort&&(e="http://"+window.location.host+"/#overview",g="http://"+window.location.host);c.append(d.clone().addClass("alignLeft").prop("id",b.id+"-name").prop("title",g).append($("<a></a>").prop("href",
e).prop("target","_blank").append(b.name)))}else c.append(d.clone().addClass("alignLeft").prop("id",b.id+"-name").append(b.name));c.append(d.clone().addClass("alignLeft").prop("id",b.id+"-group").append(f[b.group]));c.append(d.clone().addClass("alignLeft").prop("id",b.id+"-device").append(b.device));c.append(d.clone().prop("id",b.id+"-temperature").append(b.temperature));c.append(d.clone().prop("id",b.id+"-humidity").append(b.humidity))}return c},ja=function(b){var c=v("envTbl"),d=Q.oneviewSummary.getTempUnits()||
F,f=a("meas.units.percent"),e=$("<table></table>"),g=$("<thead></thead>");g.append($("<tr></tr>").addClass("table-header").append($("<th></th>").addClass("w75 statusHdr hdrBorder").append(a("status.cfg.state"))).append($("<th></th>").addClass("w25 statusHdr hdrBorder").append("&nbsp;")).append($("<th></th>").addClass("w200 alignLeft statusHdr hdrBorder").append(a("common.name"))).append($("<th></th>").addClass("w100 alignLeft statusHdr hdrBorder").append(a("ov.group"))).append($("<th></th>").addClass("alignLeft statusHdr hdrBorder").append(a("common.device"))).append($("<th></th>").addClass("statusHdr hdrBorder").append(a("meas.name.temperature")+
" ("+d+")")).append($("<th></th>").addClass("statusHdr hdrBorder").append(a("meas.name.humidity")+" ("+f+")")));e.append(g);c.find("thead").replaceWith(e.find("thead"));if(b&&(b=L(b)))for(d=0;d<b.length;d++)c.find("tbody").append(aa(b[d]));return c},da=function(a){var b=$("<div></div>");b.addClass("table-wrapper ui-corner-all").append(ja(a));return b},ba=function(a){try{var c=[],d=z("cooling",a),f=null,e=null,g=null,h=null,k=null,l=null,m=null,p=null,n=null;if(a&&d)for(var x=0;x<d.length;x++){var r=
null,q=null,s=[],t=d[x].split("|");if(2!==t.length)b("oneviewDevices.gatherCoolingData: invalid hostKey: "+d[x]);else{var I=t[0],v=t[1],J=a[I],r=a[I].state,e=a[I].snmpPort||"",g=a[I].webPort||"";if(J){var l=$("<div></div>").append(A(J)).append("&nbsp;").append($("<span></span>").css("font-size","small").append("("+I+")")),k=J.group||"&mdash;",w=J.cache.dev[v];if(w){var f=v,q=w.state,h=w.label,u=w.entity.outfan0.measurement;if(u)for(var y in u)if("fanSpeed"===u[y].type){m=u[y].value;s.push(u[y].state);
break}if(null===m||void 0===m||""===m)m="&mdash;";if(u=w.entity.return0.measurement)for(y in u)if("temperature"===u[y].type){p=u[y].value;s.push(u[y].state);break}if(null===p||void 0===p||""===p)p="&mdash;";if(u=w.entity.compressor0.measurement)for(y in u)"capacity"===u[y].type&&(n=u[y].value,s.push(u[y].state));if(null===n||void 0===n||""===n)n="&mdash;";c.push({mac:I,id:f,stateHost:r,stateDevice:q,stateMeasurements:s,snmpPort:e,webPort:g,name:h,group:k,device:l,temperature:p,fanSpeed:m,capacity:n})}}}}return c}catch(B){b("error. oneviewDevices.gatherCoolingData: "+
B)}},ca=function(b){var c=$("<tr></tr>"),d=$("<td></td>"),f=V();if(b){c.append(d.clone().prop("id",b.id+"-state").append(I(b.stateHost,b.stateDevice,O(b.stateMeasurements))));c.append(d.clone().prop("id",b.id+"-env-delete").attr("data-mac",b.mac).append($("<span></span>").addClass("ui-icon ui-icon-trash action actionFloat ui-corner-all").prop("title",a("diagAndTable.delete"))));if(void 0!==b.webPort){var e="http://"+window.location.host+":"+b.webPort,g=e+"\n(SNMP Port "+b.snmpPort+")";""===b.webPort&&
(e="http://"+window.location.host+"/#overview",g="http://"+window.location.host);c.append(d.clone().addClass("alignLeft").prop("id",b.id+"-name").prop("title",g).append($("<a></a>").prop("href",e).prop("target","_blank").append(b.name)))}else c.append(d.clone().addClass("alignLeft").prop("id",b.id+"-name").append(b.name));c.append(d.clone().addClass("alignLeft").prop("id",b.id+"-group").append(f[b.group]));c.append(d.clone().addClass("alignLeft").prop("id",b.id+"-device").append(b.device));c.append(d.clone().prop("id",
b.id+"-fanSpeed").append(b.fanSpeed));c.append(d.clone().prop("id",b.id+"-temperature").append(b.temperature));c.append(d.clone().prop("id",b.id+"-capacity").append(b.capacity))}return c},ka=function(b){var c=v("coolingTbl"),d=Q.oneviewSummary.getTempUnits()||F,f=a("meas.units.percent"),e=$("<table></table>"),g=$("<thead></thead>");g.append($("<tr></tr>").addClass("table-header").append($("<th></th>").addClass("w75 statusHdr hdrBorder").append(a("status.cfg.state"))).append($("<th></th>").addClass("w25 statusHdr hdrBorder").append("&nbsp;")).append($("<th></th>").addClass("w200 alignLeft statusHdr hdrBorder").append(a("common.name"))).append($("<th></th>").addClass("w100 alignLeft statusHdr hdrBorder").append(a("ov.group"))).append($("<th></th>").addClass("alignLeft statusHdr hdrBorder").append(a("common.device"))).append($("<th></th>").addClass("statusHdr hdrBorder").append(a("meas.name.fanSpeed")+
" ("+f+")")).append($("<th></th>").addClass("statusHdr hdrBorder").append(a("meas.name.temperature")+" ("+d+")")).append($("<th></th>").addClass("statusHdr hdrBorder").append(a("meas.name.capacity")+" ("+f+")")));e.append(g);c.find("thead").replaceWith(e.find("thead"));if(b&&(b=ba(b)))for(d=0;d<b.length;d++)c.find("tbody").append(ca(b[d]));return c},ga=function(a){var b=$("<div></div>");b.addClass("table-wrapper ui-corner-all").append(ka(a));return b},ea=function(b){var c=$("<tr></tr>"),d=$("<td></td>"),
f=V();if(b){c.append(d.clone().prop("id",b.mac+"-state").addClass("w75").append($("<span></span>").addClass("ui-icon statusspan").addClass("ui-icon-none").prop("title",a("batteryStatus.unknown"))));c.append(d.clone().prop("id",b.mac+"-unknown-delete").attr("data-mac",b.mac).addClass("w25").append($("<span></span>").addClass("ui-icon ui-icon-trash action actionFloat ui-corner-all").prop("title",a("diagAndTable.delete"))));if(void 0!==b.webPort){var e="http://"+window.location.host+":"+b.webPort,g=
e;""===b.webPort&&(e="http://"+window.location.host+"/#overview",g="http://"+window.location.host);c.append(d.clone().addClass("alignLeft").addClass("w200").prop("id",b.mac+"-mac").prop("title",g).append($("<a></a>").prop("href",e).prop("target","_blank").append(b.mac)))}else c.append(d.clone().addClass("alignLeft").prop("id",b.mac+"-mac").append(b.mac));c.append(d.clone().addClass("alignLeft").addClass("w100").prop("id",b.mac+"-group").append(f[b.group]));c.append(d.clone())}return c},la=function(c){var d=
v("unknownTbl"),f=$("<table></table>"),e=$("<thead></thead>");e.append($("<tr></tr>").addClass("table-header").append($("<th></th>").addClass("w75 statusHdr hdrBorder").append(a("status.cfg.state"))).append($("<th></th>").addClass("w25 statusHdr hdrBorder").append("&nbsp;")).append($("<th></th>").addClass("w200 alignLeft statusHdr hdrBorder").append(a("common.macAddress"))).append($("<th></th>").addClass("w100 alignLeft statusHdr hdrBorder").append(a("ov.group"))).append($("<th></th>")));f.append(e);
d.find("thead").replaceWith(f.find("thead"));if(c){var g;a:{try{var f=[],h=z("unknown",c),k=e=null,l=null;if(c&&h)for(var m=0;m<h.length;m++)e=h[m],k=c[e].webPort||"",l=c[e].group||"",f.push({mac:e,group:l,webPort:k});g=f;break a}catch(p){b("error. oneviewDevices.gatherUnknownHostsData: "+p)}g=void 0}if(g)for(c=0;c<g.length;c++)d.find("tbody").append(ea(g[c]))}return d},ha=function(a){var b=$("<div></div>");b.addClass("table-wrapper ui-corner-all").append(la(a));return b},ia=function(){$("#content-pane").on("click",
'td[id$="-delete"]',function(b){b=$(this).prop("id");var c=$(this).attr("data-mac");if(c){var d=a("diagAndTable.youSure")+"<br>"+a("status.hostDelete"),f=$("<div></div>");f.append($("<div></div>").prop("id","dialog-host-del").prop("title",a("diagAndTable.delete")).append($("<p></p>").append($("<span></span>").addClass("ui-icon ui-icon-alert").prop("style","float:left;margin:0 7px 20px 0;")).append($("<span></span>").prop("id","rusure").append(d))));B(f.html(),{autoOpen:!1,resizable:!1,width:300,height:180,
modal:!0,close:function(){$("#"+D).parent().removeAttr("style");D=null},buttons:[{id:"dlg-btn-host-del-delete",text:a("diagAndTable.delete"),click:function(){$("[id^=status-]").html("&nbsp;");M(c)}},{id:"dlg-btn-host-del-cancel",text:a("diagAndTable.cancel"),click:function(){$(this).dialog("close")}}]});D=b;$("#"+D).parent().css("background-color","#ffde05");$("#dialog-host-del").dialog("open")}})},pa=function(){0===N?$("#unknownSection").hide():$("#unknownSection").show();0===y?$("#pduSection").hide():
$("#pduSection").show();0===G?$("#upsSection").hide():$("#upsSection").show();0===P?$("#coolingSection").hide():$("#coolingSection").show();0===H?$("#envSection").hide():$("#envSection").show()};E.getPageOneviewDevices=function(){n("/oneview",!0,function(a,f,g){a&&0===a.retCode?a.data&&(Q.CACHE.oneview=a.data,f=k(""),f.append($("<div></div>").prop("id","pduSection").append(q("ov.pdu")).append(c(p(a.data.host)))).append($("<div></div>").prop("id","upsSection").append(q("ov.ups")).append(c(Z(a.data.host)))).append($("<div></div>").prop("id",
"coolingSection").append(q("ov.cooling")).append(c(ga(a.data.host)))).append($("<div></div>").prop("id","envSection").append(q("ov.env")).append(c(da(a.data.host)))).append($("<div></div>").prop("id","unknownSection").append(q("batteryStatus.unknown")).append(c(ha(a.data.host)))),$("#loading").replaceWith(""),$(".section-header").replaceWith(""),$(".section-body").replaceWith(""),$("#content-pane").append(f),$(".fm-table").removeClass("fm-table"),$("div.section-body").prop("style","background:#ccc;"),
pa(),h(Q.USER.lang),$("table").each(function(a,b){d($(b).prop("id"))}),T(Q.UPDATE_INTERVAL),ia(),F=Q.oneviewSummary.getTempUnits()):a?e(Q.DIALOG_ERROR,t(a.retCode)):(a.retCode===Q.RETCODE.SESSION_EXPIRED&&s(),b("/oneview get: textStatus="+f+", jqXHR="+$.stringify(g)))},null,"get",null,null)};return E}(Q.log,Q.gotoPage,Q.apiCall,Q.JQO.getFormGroup,Q.JQO.getPageWrapper,Q.JQO.getSectionHeaderPlain,Q.JQO.getSection,Q.dialogAlert,Q.util.getRetCodeMsg,Q.auth.handleInvalidSession,Q.getLocalStr,Q.localize,
Q.JQO.getFormTable,Q.getTemplate,Q.util.fixTableRows,Q.cacheHelper.formatEnergyString,Q.createDialog,Q.oneviewSummary.deleteHost);Q.oneviewGroups=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m){var B={},M=null,E=null;B.stopOneviewUpdatePing=function(){try{M&&(clearInterval(M),M=null,E&&(E.abort(),E=null))}catch(a){b("error. oneviewGroups.stopOneviewUpdatePing: "+a)}};var F=function(a,c,d){try{if(Q.PAGE!==Q.PAGES.ONEVIEW_GROUPS)B.stopOneviewUpdatePing();else if(null!==M&&a&&0===a.retCode&&a.data){var e=O(a.data);e.push("unassigned");for(c=0;c<e.length;c++){var g=e[c],h=a.data[g]&&a.data[g].entity?a.data[g].entity:null,k=Q.CACHE.oneview.group[g]&&
Q.CACHE.oneview.group[g].entity?Q.CACHE.oneview.group[g].entity:null;if(h&&k){d=!1;if(h.hasOwnProperty("pduTotal")!==k.hasOwnProperty("pduTotal")||h.hasOwnProperty("pduPhase")!==k.hasOwnProperty("pduPhase"))d=!0;h.pduPhase&&k.pduPhase&&Object.keys(h.pduPhase).length!==Object.keys(k.pduPhase).length&&(d=!0);if(h.hasOwnProperty("ups")!==k.hasOwnProperty("ups")||h.hasOwnProperty("cooling")!==k.hasOwnProperty("cooling")||h.hasOwnProperty("environmental")!==k.hasOwnProperty("environmental"))d=!0;d&&Q.gotoPage(Q.PAGE.ONEVIEW_GROUPS)}var l=
d=null,n;for(n in h)if("pduTotal"===n)for(d in h[n]["0"].measurement)"energy"===h[n]["0"].measurement[d].type?$("#"+g+"-"+n+"-"+d+"-sumValue").html(m(h[n]["0"].measurement[d].sumValue)):"realPower"===h[n]["0"].measurement[d].type&&($("#"+g+"-"+n+"-"+d+"-sumValue").html(h[n]["0"].measurement[d].sumValue),$("#"+g+"-"+n+"-"+d+"-minValue").html(h[n]["0"].measurement[d].minValue),$("#"+g+"-"+n+"-"+d+"-maxValue").html(h[n]["0"].measurement[d].maxValue),$("#"+g+"-"+n+"-"+d+"-avgValue").html(h[n]["0"].measurement[d].avgValue));
else if("pduPhase"===n)for(var q in h[n])for(d in h[n][q].measurement)"energy"===h[n][q].measurement[d].type?$("#"+g+"-"+n+"-"+q+"-"+d+"-sumValue").html(m(h[n][q].measurement[d].sumValue)):"realPower"===h[n][q].measurement[d].type&&($("#"+g+"-"+n+"-"+q+"-"+d+"-sumValue").html(h[n][q].measurement[d].sumValue),$("#"+g+"-"+n+"-"+q+"-"+d+"-minValue").html(h[n][q].measurement[d].minValue),$("#"+g+"-"+n+"-"+q+"-"+d+"-maxValue").html(h[n][q].measurement[d].maxValue),$("#"+g+"-"+n+"-"+q+"-"+d+"-avgValue").html(h[n][q].measurement[d].avgValue));
else if("ups"===n)for(d in h[n]["0"].measurement)if(l=h[n]["0"].measurement[d].type||"","realPower"===l)$("#"+g+"-"+n+"-"+d+"-maxValue").html(h[n]["0"].measurement[d].maxValue),$("#"+g+"-"+n+"-"+d+"-avgValue").html(h[n]["0"].measurement[d].avgValue);else{if("timeRemaining"===l||"charge"===l)$("#"+g+"-"+n+"-"+d+"-minValue").html(h[n]["0"].measurement[d].minValue),$("#"+g+"-"+n+"-"+d+"-avgValue").html(h[n]["0"].measurement[d].avgValue)}else if("environmental"===n)for(d in h[n]["0"].measurement){if(l=
h[n]["0"].measurement[d].type||"","temperature"===l||"humidity"===l)$("#"+g+"-"+n+"-"+d+"-minValue").html(h[n]["0"].measurement[d].minValue),$("#"+g+"-"+n+"-"+d+"-maxValue").html(h[n]["0"].measurement[d].maxValue),$("#"+g+"-"+n+"-"+d+"-avgValue").html(h[n]["0"].measurement[d].avgValue)}else if("cooling"===n)for(d in h[n]["0"].measurement)if(l=h[n]["0"].measurement[d].type||"","temperature"===l||"fanSpeed"===l||"capacity"===l)$("#"+g+"-"+n+"-"+d+"-minValue").html(h[n]["0"].measurement[d].minValue),
$("#"+g+"-"+n+"-"+d+"-maxValue").html(h[n]["0"].measurement[d].maxValue),$("#"+g+"-"+n+"-"+d+"-avgValue").html(h[n]["0"].measurement[d].avgValue)}}}catch(s){b("error. oneviewGroups.updatePingCallback: "+s)}},u=function(a){a=a&&"number"===typeof a&&5<a?a:Q.UPDATE_INTERVAL;b("oneviewGroups.initOneviewUpdatePing => "+a+" seconds");try{B.stopOneviewUpdatePing(),M=setInterval(function(){Q.PAGE!==Q.PAGES.ONEVIEW_GROUPS?B.stopOneviewUpdatePing():E&&"resolved"!==E.state()?b("oneview: update overlap..."):
E=n("/oneview/group",!0,F,null,"get",null,null)},1E3*a)}catch(c){b("error. oneviewGroups.initOneviewUpdatePing: "+c)}},K=function(a,b){var c=null,d=$("<tr></tr>"),e=$("<td></td>"),g=null;if(a&&b){d.append(e.clone().prop("id",a+"-state").append("&nbsp;"));var h=b.label||b.name;"Total"===h&&(h="PDU "+h);d.append(e.clone().addClass("alignLeft").prop("id",a+"-name").append(h));h=null;for(c in b.measurement)"energy"===b.measurement[c].type&&d.append(e.clone().prop("id",a+"-"+c+"-sumValue").append(m(b.measurement[c].sumValue))),
"realPower"===b.measurement[c].type&&(g=b.measurement[c],h=c);g&&(d.append(e.clone().prop("id",a+"-"+h+"-sumValue").append(g.sumValue)),d.append(e.clone().prop("id",a+"-"+h+"-minValue").append(g.minValue)),d.append(e.clone().prop("id",a+"-"+h+"-maxValue").append(g.maxValue)),d.append(e.clone().prop("id",a+"-"+h+"-avgValue").append(g.avgValue)))}return d},D=function(a,b){var c=w(a+"-pduTbl"),d=Q.oneviewSummary.getTableHeaderPDU();c.find("thead").replaceWith(d.find("thead"));b&&b.pduTotal&&c.find("tbody").append(K(a+
"-pduTotal",b.pduTotal["0"]));if(b&&b.pduPhase)for(var e in b.pduPhase)c.find("tbody").append(K(a+"-pduPhase-"+e,b.pduPhase[e]));return c},N=function(a,b){var c=null,d=$("<tr></tr>"),e=$("<td></td>");if(a&&b)for(c in d.append(e.clone().prop("id",a+"-state").append("&nbsp;")),d.append(e.clone().addClass("alignLeft").prop("id",a+"-name").append(b.label||b.name)),b.measurement)"realPower"===b.measurement[c].type&&(d.append(e.clone().prop("id",a+"-"+c+"-maxValue").append(b.measurement[c].maxValue)),d.append(e.clone().prop("id",
a+"-"+c+"-avgValue").append(b.measurement[c].avgValue))),"timeRemaining"===b.measurement[c].type&&(d.append(e.clone().prop("id",a+"-"+c+"-minValue").append(b.measurement[c].minValue)),d.append(e.clone().prop("id",a+"-"+c+"-avgValue").append(b.measurement[c].avgValue))),"charge"===b.measurement[c].type&&(d.append(e.clone().prop("id",a+"-"+c+"-minValue").append(b.measurement[c].minValue)),d.append(e.clone().prop("id",a+"-"+c+"-avgValue").append(b.measurement[c].avgValue)));return d},y=function(a,b){var c=
w("upsTbl"),d=Q.oneviewSummary.getTableHeaderUPS();c.find("thead").replaceWith(d.find("thead"));b&&b.ups&&c.find("tbody").append(N(a+"-ups",b.ups["0"]));return c},G=function(a,b){var c=null,d=$("<tr></tr>"),e=$("<td></td>");if(a&&b)for(c in d.append(e.clone().prop("id",a+"-state").append("&nbsp;")),d.append(e.clone().addClass("alignLeft").prop("id",a+"-name").append(b.label||b.name)),b.measurement)"temperature"===b.measurement[c].type&&(d.append(e.clone().prop("id",a+"-"+c+"-minValue").append(b.measurement[c].minValue)),
d.append(e.clone().prop("id",a+"-"+c+"-maxValue").append(b.measurement[c].maxValue)),d.append(e.clone().prop("id",a+"-"+c+"-avgValue").append(b.measurement[c].avgValue))),"humidity"===b.measurement[c].type&&(d.append(e.clone().prop("id",a+"-"+c+"-minValue").append(b.measurement[c].minValue)),d.append(e.clone().prop("id",a+"-"+c+"-maxValue").append(b.measurement[c].maxValue)),d.append(e.clone().prop("id",a+"-"+c+"-avgValue").append(b.measurement[c].avgValue)));return d},H=function(a,b){var c=w("envTbl"),
d=Q.oneviewSummary.getTableHeaderENV();c.find("thead").replaceWith(d.find("thead"));b&&b.environmental&&c.find("tbody").append(G(a+"-environmental",b.environmental["0"]));return c},P=function(a,b){var c=$("<div></div>"),d=0;if(Q.oneviewSummary.groupHasEntity(a,Q.oneviewSummary.ENTITY.PDU_TOTAL)){var e=$("<div></div>").addClass("table-wrapper ui-corner-all").append(D(a,b.entity));e.find("#"+a+"-pduTbl-group").removeClass("fm-table");c.append(e);d++}Q.oneviewSummary.groupHasEntity(a,Q.oneviewSummary.ENTITY.UPS)&&
(e=$("<div></div>").addClass("table-wrapper ui-corner-all").append(y(a,b.entity)),e.find("#upsTbl-group").removeClass("fm-table"),d&&c.append($("<br>")),c.append(e),d++);Q.oneviewSummary.groupHasEntity(a,Q.oneviewSummary.ENTITY.COOLING)&&(e=$("<div></div>").addClass("table-wrapper ui-corner-all").append(Q.oneviewSummary.getTableCooling(a)),e.find("#coolingTbl-group").removeClass("fm-table"),d&&c.append($("<br>")),c.append(e));Q.oneviewSummary.groupHasEntity(a,Q.oneviewSummary.ENTITY.ENV)&&(e=$("<div></div>").addClass("table-wrapper ui-corner-all").append(H(a,
b.entity)),e.find("#envTbl-group").removeClass("fm-table"),d&&c.append($("<br>")),c.append(e));return c},O=function(a){var b=[],c=[],d;for(d in a)"total"!==d&&"unassigned"!==d&&b.push({key:d,order:a[d].order});b=b.sort(function(a,b){return a.order<b.order?-1:a.order>b.order?1:0});for(a=0;a<b.length;a++)c.push(b[a].key);return c};B.getPageOneviewGroups=function(){b("oneviewGroups.getPageOneviewGroups...");n("/oneview",!0,function(a,g,l){if(a&&0===a.retCode){if(a.data){Q.CACHE.oneview=a.data;a=k("");
g=O(Q.CACHE.oneview.group);g.push("unassigned");for(l=0;l<g.length;l++){var m=Q.CACHE.oneview.group[g[l]];m&&a.append(q(m.label||m.name,!0)).append(c(P(g[l],m)))}$("#loading").replaceWith("");$(".section-header").replaceWith("");$(".section-body").replaceWith("");$("#content-pane").append(a);$("table").each(function(a,b){d($(b).prop("id"))});$("div.section-body").prop("style","background:#ccc;");h(Q.USER.lang);u(Q.UPDATE_INTERVAL)}}else a?e(Q.DIALOG_ERROR,t(a.retCode)):(a.retCode===Q.RETCODE.SESSION_EXPIRED&&
s(),b("/api/dev get: textStatus="+g+", jqXHR="+$.stringify(l)))},null,"get",null,null)};return B}(Q.log,Q.gotoPage,Q.apiCall,Q.JQO.getFormGroup,Q.JQO.getPageWrapper,Q.JQO.getSectionHeaderPlain,Q.JQO.getSection,Q.dialogAlert,Q.util.getRetCodeMsg,Q.auth.handleInvalidSession,Q.getLocalStr,Q.localize,Q.getTemplate,Q.JQO.getFormTable,Q.util.fixTableRows,Q.cacheHelper.formatEnergyString);Q.oneviewGroupConfig=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m,B,M,E,F,u,K,D){var N={},y=null,G=null,H=[],P=[];N.isHostTypeUnknown=function(a){if(a&&a.cache&&!$.isEmptyObject(a.cache)&&a.cache.dev){var b=0,c=0,d;for(d in a.cache.dev)b++,"unknown"===a.cache.dev[d].type&&c++;if(0!==b&&b!==c)return!1}return!0};var O=function(a){var b=null,c=null,d=null,e=null,g=null,k=$("<div></div>");k.addClass("ui-corner-all").css("margin","5").css("padding","5").css("height","72px").css("max-width","278px").css("background",
"#c0c0c0c0;").css("border","1px solid black");if(a){k.prop("id","dev-"+a.hostMAC);a.typeUnknown?(b=$("<span></span>"),b.css("height","24px").css("width","24px").css("display","inline-block").css("vertical-align","middle").css("position","relative").css("background-image",'url("images/unknown.png")').css("background-repeat","no-repeat").css("background-size","24px 24px").prop("title",h("batteryStatus.unknown"))):(a.hasPDU&&(c=$("<span></span>"),c.css("height","24px").css("width","24px").css("display",
"inline-block").css("vertical-align","middle").css("position","relative").css("background-image",'url("images/pdu.png")').css("background-repeat","no-repeat").css("background-size","24px 24px").prop("title",h("ov.pdu"))),a.hasUPS&&(d=$("<span></span>"),d.css("height","24px").css("width","24px").css("display","inline-block").css("vertical-align","middle").css("position","relative").css("background-image",'url("images/ups.png")').css("background-repeat","no-repeat").css("background-size","24px 24px").prop("title",
h("ov.ups"))),a.hasCooling&&(e=$("<span></span>"),e.css("height","24px").css("width","24px").css("display","inline-block").css("vertical-align","middle").css("position","relative").css("background-image",'url("images/ac.png")').css("background-repeat","no-repeat").css("background-size","24px 24px").prop("title",h("ov.cooling"))),a.hasENV&&(g=$("<span></span>"),g.css("height","24px").css("width","24px").css("display","inline-block").css("vertical-align","middle").css("position","relative").css("background-image",
'url("images/env.png")').css("background-repeat","no-repeat").css("background-size","24px 24px").prop("title",h("menu.sensors"))));var l=$("<span></span>").css("padding","0").css("font-size","small").css("margin-left","20px").append(a.label+", SN: "+a.hostSerNo),m=$("<span></span>").css("padding","0").css("font-size","x-small").css("margin-left","20px").append("MAC: "+a.hostMAC);a=$("<span></span>").css("padding","0").css("font-size","x-small").css("margin-left","20px").append("ID: "+a.deviceID);
var n=!1,q=$("<div></div>").css("float","left").css("min-height","48px").css("width","24px");null!==b?q.append(b):(null!==c&&(q.append(c),n=!0),null!==d&&(n&&q.append($("<br>")),q.append(d),n=!0),null!==e&&(n&&q.append($("<br>")),q.append(e),n=!0),null!==g&&(n&&q.append($("<br>")),q.append(g)));k.append(q);null!==b?k.append(m):k.append($("<div></div>").append(l).append($("<br>")).append(m).append($("<br>")).append(a))}return k},I=function(){var a=$("<div></div>");if(y){var b=y.unassigned.members;
if(b)for(var c=0;c<b.length;c++)a.append(O(b[c]))}return a},J=function(a){var b=$("<div></div>");if(a){b.prop("id","grp-"+a.id).addClass("ui-corner-all").css("margin","5").css("padding","5").css("min-height","25px").css("background","#c0c0c0c0;").css("border","1px solid black").append($("<div></div>").prop("id","grp-hdr-"+a.id).css("padding",3).append($("<span></span>").prop("id","grpModify-"+a.id).css("background-color","silver").addClass("ui-icon ui-icon-wrench ui-corner-all action").prop("title",
h("diagAndTable.mod"))).append("&nbsp;").append($("<span></span>").prop("id","grpDelete-"+a.id).css("background-color","silver").addClass("ui-icon ui-icon-trash ui-corner-all action").prop("title",h("diagAndTable.delete"))).append("&nbsp;&nbsp;").append(a.label)).append($("<hr>"));for(var c=0;c<a.members.length;c++)b.append(O(a.members[c]))}return b},x=function(){var a=$("<div></div>");if(y){var b=[],c;for(c in y)if("unassigned"!==c){var d=y[c];d.id=c;b.push(d)}b=b.sort(function(a,b){return a.order-
b.order});for(c=0;c<b.length;c++)a.append(J(b[c]))}return a},T=function(){y&&(I(),x());var a=$("<div></div>").css("overflow","hidden"),b=$("<br>");a.append($("<div></div>").css("float","left").addClass("ui-corner-all").css("background","white").css("min-height","500px").css("min-width","330px").append($("<div></div>").addClass("ui-corner-all").css("color","white").css("background","#3c3c3e").css("padding","5px").append($("<span></span>").prop("id","grpAdd").css("background-color","silver").addClass("ui-icon ui-icon-circle-plus ui-corner-all action").prop("title",
h("ov.addGroup"))).append("&nbsp;"+h("menu.oneviewGroups"))).append($("<div></div>").prop("id","groupContainer").css("max-height","460px").css("margin","2px").css("overflow-y","scroll").append(x()))).append($("<div></div>").css("float","left").css("background","rgb(204, 204, 204)").css("min-height","500px").css("min-width","100px").append(b.clone()).append(b.clone()).append(b.clone()).append($("<span></span>").prop("id","moveUp").prop("title",h("ov.moveGroupUp")).addClass("ui-corner-all").css("border",
"1px solid black").css("font-weight","bolder").css("display","table").css("background","white").css("padding","5px").css("margin","0 auto").append("&nbsp;&uarr;&nbsp;")).append(b.clone()).append($("<span></span>").prop("id","moveDown").prop("title",h("ov.moveGroupDown")).addClass("ui-corner-all").css("border","1px solid black").css("font-weight","bolder").css("display","table").css("background","white").css("padding","5px").css("margin","0 auto").append("&nbsp;&darr;&nbsp;")).append(b.clone()).append(b.clone()).append(b.clone()).append($("<span></span>").prop("id",
"moveLeft").prop("title",h("ov.moveToGroup")).addClass("ui-corner-all").css("border","1px solid black").css("font-weight","bolder").css("display","table").css("background","white").css("padding","5px").css("margin","0 auto").append("&larr;")).append(b.clone()).append($("<span></span>").prop("id","moveRight").prop("title",h("ov.removeFromGroup")).addClass("ui-corner-all").css("border","1px solid black").css("font-weight","bolder").css("display","table").css("background","white").css("padding","5px").css("margin",
"0 auto").append("&rarr;"))).append($("<div></div>").css("float","left").addClass("ui-corner-all").css("background","white").css("min-height","500px").css("min-width","330px").append($("<div></div>").addClass("ui-corner-all").css("color","white").css("background","#3c3c3e").css("padding","5px").append("&nbsp;"+h("ov.unassigned"))).append($("<div></div>").prop("id","unassignedContainer").css("max-height","460px").css("margin","5px").css("overflow-y","scroll").append(I())));return a},U=function(c){b("apiDeleteGroup, group ID: "+
c);var d=function(c,d,e){if(c&&0===c.retCode){for(c=0;c<y[Q.CACHE.opBuf].members.length;c++)y.unassigned.members.push(y[Q.CACHE.opBuf].members[c]);delete y[Q.CACHE.opBuf];Q.CACHE.opBuf=null;$("#groupContainer").empty().append(x());$("#unassignedContainer").empty().append(I())}else c?t(Q.DIALOG_ERROR,s(c.retCode)):(c.retCode===Q.RETCODE.SESSION_EXPIRED&&a(),b("/oneview/group delete: textStatus="+d+", jqXHR="+$.stringify(e)))};Q.CACHE.opBuf=c;var e=function(){K("/oneview/group/"+c,"delete",!0)?l("/oneview/group/"+
c,d,!0):D(e,!0)};e()},R=function(){b("apiAddGroup...");var c=function(c,d,e){c&&0===c.retCode?(c=c.data||null,null!==c&&void 0!==c&&(Q.CACHE.opId=c,n("/oneview/group/"+c,!0,function(a,c,d){a&&0===a.retCode&&a.data?(y[Q.CACHE.opId]={name:a.data.name,label:a.data.label,order:a.data.order,members:[]},$("#groupContainer").empty().append(x()),Q.CACHE.opId=null):b("error. apiAddGroup: failed to get group order.")},null,"get",null,null))):c?t(Q.DIALOG_ERROR,s(c.retCode)):(c.retCode===Q.RETCODE.SESSION_EXPIRED&&
a(),b("/oneview/group add: textStatus="+d+", jqXHR="+$.stringify(e)))},d=function(){K("/oneview/group","add",!0)?n("/oneview/group",!0,c,null,"add",null,$.stringify({})):D(d,!0)};d()},z=function(c){b("apiUpdateGroupOrder...");var d=function(c,d,e){if(c&&0===c.retCode){for(var f in Q.CACHE.opBuf)y[f].order=Q.CACHE.opBuf[f].order;Q.CACHE.opBuf=null;$("#groupContainer").empty().append(x());$("#"+G).addClass("selected")}else c?t(Q.DIALOG_ERROR,s(c.retCode)):(c.retCode===Q.RETCODE.SESSION_EXPIRED&&a(),
b("/oneview/group set: textStatus="+d+", jqXHR="+$.stringify(e)))},e=null,g=null,h=null,k=h=null,e=G.replace("grp-hdr-",""),g=y[e].order;if("up"===c){h=$("#grp-"+e).prev();if(!h||!h.prop("id"))return;h=h.prop("id").replace("grp-","")}else if("down"===c){h=$("#grp-"+e).next();if(!h||!h.prop("id"))return;h=h.prop("id").replace("grp-","")}var k=y[h].order,l={};l[e]={};l[e].order=k;l[h]={};l[h].order=g;var m=function(){K("/oneview/group/[ID]","set",!0)?(Q.CACHE.opBuf=l,n("/oneview/group",!0,d,null,"set",
null,$.stringify(l))):D(m,!0)};m()},V=function(){b("apiAddDevicesToGroup...");for(var c=function(c,d,e){if(c&&0===c.retCode){var f=null;for(f in Q.CACHE.opBuf)for(c=0;c<y.unassigned.members.length;c++)y.unassigned.members[c].hostMAC===f&&y[Q.CACHE.opBuf[f].group].members.push(y.unassigned.members[c]);for(f in Q.CACHE.opBuf)y.unassigned.members=$.grep(y.unassigned.members,function(a){return a.hostMAC!==f});$("#groupContainer").empty().append(x());$("#unassignedContainer").empty().append(I());G=null;
P=[];Q.CACHE.opBuf=null}else c?t(Q.DIALOG_ERROR,s(c.retCode)):(c.retCode===Q.RETCODE.SESSION_EXPIRED&&a(),b("/oneview/host set: textStatus="+d+", jqXHR="+$.stringify(e)))},d=G.replace("grp-hdr-",""),e={},g=0;g<P.length;g++){var h=P[g].replace("dev-","");e[h]={};e[h].group=d}var k=function(){K("/oneview/host/[ID]","set",!0)?(Q.CACHE.opBuf=e,n("/oneview/host",!0,c,null,"set",null,$.stringify(e))):D(k,!0)};k()},Y=function(){b("apiRemoveDevicesFromGroups...");for(var c=function(c,d,e){if(c&&0===c.retCode){c=
null;for(c in Q.CACHE.opBuf)for(var f in y)if("unassigned"!==f){d=[];for(e=0;e<y[f].members.length;e++)y[f].members[e].hostMAC===c?y.unassigned.members.push(y[f].members[e]):d.push(y[f].members[e]);y[f].members=d}$("#groupContainer").empty().append(x());$("#unassignedContainer").empty().append(I());G=null;P=[];Q.CACHE.opBuf=null}else c?t(Q.DIALOG_ERROR,s(c.retCode)):(c.retCode===Q.RETCODE.SESSION_EXPIRED&&a(),b("/oneview/host set: textStatus="+d+", jqXHR="+$.stringify(e)))},d={},e=0;e<H.length;e++){var g=
H[e].replace("dev-","");d[g]={};d[g].group="unassigned"}var h=function(){K("/oneview/host/[ID]","set",!0)?(Q.CACHE.opBuf=d,n("/oneview/host",!0,c,null,"set",null,$.stringify(d))):D(h,!0)};h()},X=function(){var a=d("T-dialogTablePadRow").find("tr"),b=d("T-dialogTable"),c=$("<div></div>");b.prop("id","groupMod");b.find("tbody").append(a.clone()).append(m("groupMod-label","status.cfg.label")).append(a.clone());c.prop("id","dialog-group-modify").prop("title",h("diagAndTable.mod")).append(b).append($("<div></div>").prop("id",
"status-modGroup").append("&nbsp;"));return $("<div></div>").append(c)},A=function(){w(X().html(),{autoOpen:!1,resizable:!1,width:500,modal:!0,open:function(){$("#dlg-btn-group-mod-cancel").focus()},close:function(){Q.CACHE.opId=null;Q.CACHE.opBuf=null},buttons:[{id:"dlg-btn-group-mod-save",text:h("diagAndTable.save"),click:function(){$("[id^=status-]").html("&nbsp;");var a=this,c=function(c,d,e){c&&0===c.retCode?(y[Q.CACHE.opId]&&(Q.CACHE.opBuf&&Q.CACHE.opBuf.label)&&(y[Q.CACHE.opId].label=Q.CACHE.opBuf.label),
$("#groupContainer").empty().append(x())):(t(Q.DIALOG_ERROR,s(c.retCode)),b(d+", "+$.stringify(c)+", "+$.stringify(e)));$(a).dialog("close")},d={path:"/oneview/group/"+Q.CACHE.opId,cmd:"set",access:B(),data:{label:{value:$("#groupMod-label").val(),error:F,reset:u,data:"groupMod-label"}}},e=function(){if(!K(d.path,d.cmd,!0))D(e,!0);else if(!d||M(d)){var a=E(d);Q.CACHE.opBuf=a;n(d.path,!0,c,null,d.cmd,null,$.stringify(a))}};e()}},{id:"dlg-btn-group-mod-cancel",text:h("diagAndTable.cancel"),click:function(){$(this).dialog("close");
$("#status-modGroup").empty()}}]})},L=function(){$("#groupContainer").on("click",'[id^="grp-hdr-"]',function(){var a=$(this);a.hasClass("selected")?(a.removeClass("selected"),G=null):(G&&$("#"+G).removeClass("selected"),a.addClass("selected"),G=a.prop("id"));0!==H.length&&($("#groupContainer").find('div[id^="dev-"]').removeClass("selected"),H=[])});$("#groupContainer").on("click",'[id^="dev-"]',function(){var a=$(this);a.hasClass("selected")?(a.removeClass("selected"),H=$.grep(H,function(b){return b!==
a.prop("id")})):(a.addClass("selected"),H.push(a.prop("id")));G&&($("#"+G).removeClass("selected"),G=null);$("#unassignedContainer").find('div[id^="dev-"]').removeClass("selected");P=[];a=null});$("#unassignedContainer").on("click",'[id^="dev-"]',function(){var a=$(this);a.hasClass("selected")?(a.removeClass("selected"),P=$.grep(P,function(b){return b!==a.prop("id")})):(a.addClass("selected"),P.push(a.prop("id")));0!==H.length&&($("#groupContainer").find('div[id^="dev-"]').removeClass("selected"),
H=[]);a=null});$('span[id^="move"]').on({click:function(){switch($(this).prop("id").replace("move","").toUpperCase()){case "UP":G?2<Object.keys(y).length&&z("up"):t(Q.DIALOG_INFO,h("ov.noGroupSelected"));break;case "DOWN":G?2<Object.keys(y).length&&z("down"):t(Q.DIALOG_INFO,h("ov.noGroupSelected"));break;case "LEFT":G&&P.length?V():t(Q.DIALOG_INFO,h("ov.selectGroupAndUnassigned"));break;case "RIGHT":H.length?Y():t(Q.DIALOG_INFO,h("ov.selectGroupMember"))}},mouseenter:function(){$(this).css("cursor",
"pointer")},mouseleave:function(){$(this).css("cursor","default")}});$("#grpAdd").on("click",function(){R()});$("#groupContainer").on("click",'[id^="grpModify"]',function(a){a.stopPropagation();a=$(this).prop("id").replace("grpModify-","");Q.CACHE.opId=a;$("#dialog-group-modify").dialog("open");$("#groupMod-label").val(y[a].label).focus()});$("#groupContainer").on("click",'[id^="grpDelete"]',function(a){a.stopPropagation();a=$(this).prop("id").replace("grpDelete-","");U(a)});A()};N.getPageOneviewGroupConfig=
function(){b("getPageOneviewGroupConfig...");n("/oneview",!0,function(d,g,h){if(d&&0===d.retCode){if(d.data){Q.CACHE.oneview=d.data;a:{d=d.data;try{if(d){var k={},l=Object.keys(d.group);for(g=0;g<l.length;g++)"total"!==l[g]&&(h={},h.name=d.group[l[g]].name,h.label=d.group[l[g]].label,h.order=d.group[l[g]].order,h.members=[],k[l[g]]=h);d=d.host;for(var m in d){l={};l.hostMAC=m;l.typeUnknown=N.isHostTypeUnknown(d[m]);g=l;var n=d[m];h=!1;if(n&&n.cache&&n.cache.dev){var u=void 0;for(u in n.cache.dev){var w=
n.cache.dev[u].type;if("rs"===w||"I-02"===w||"i03"===w){h=!0;break}}}g.hasPDU=h;g=l;var x=d[m];h=!1;if(x&&x.cache&&x.cache.dev)for(u in u=void 0,x.cache.dev)if("lups"===x.cache.dev[u].type){h=!0;break}g.hasUPS=h;g=l;var z=d[m];h=!1;if(z&&z.cache&&z.cache.dev)for(u in u=void 0,z.cache.dev)if("vrc"===z.cache.dev[u].type){h=!0;break}g.hasCooling=h;g=l;var A=d[m];h=!1;if(A&&A.cache&&A.cache.dev)for(u in u=void 0,A.cache.dev)if(-1!==$.inArray(A.cache.dev[u].type,Q.SUPPORTED_ENV_TYPES)){h=!0;break}g.hasENV=
h;h="&mdash;";g="";d[m].cache&&(d[m].cache.sys&&d[m].cache.sys.serialNumber)&&(h=d[m].cache.sys.serialNumber);l.hostSerNo=h;h=l;var B=d[m],u="&mdash;",E=null;if(B){var I=null,D=null;for(E in B.cache.dev)null===I?(I=B.cache.dev[E].order,D=E):B.cache.dev[E].order<I&&(I=B.cache.dev[E].order,D=E);D&&(u=D)}h.deviceID=u;l.deviceID&&"&mdash;"!==l.deviceID&&(g=d[m].cache.dev[l.deviceID].label?d[m].cache.dev[l.deviceID].label:d[m].type.toUpperCase());l.label=g;d[m].group&&k[d[m].group]?k[d[m].group].members.push(l):
b("error. oneviewGroupConfig.getDeviceGroupData: data mismatch, hosts and groups")}}y=k;break a}catch(J){b("error. oneviewGroupConfig.getDeviceGroupData: "+J)}y=void 0}k=q("");k.append(c("menu.oneviewGroupConfig")).append(e(T()));$("#loading").replaceWith("");$(".section-header").replaceWith("");$(".section-body").replaceWith("");$("#content-pane").append(k);$("div.section-body").prop("style","background:#ccc;");L();v(Q.USER.lang)}}else d?t(Q.DIALOG_ERROR,s(d.retCode)):(d.retCode===Q.RETCODE.SESSION_EXPIRED&&
a(),b("/oneview get: textStatus="+g+", jqXHR="+$.stringify(h)))},null,"get",null,null)};return N}(Q.log,Q.gotoPage,Q.apiCall,Q.apiCallDelete,Q.JQO.getFormGroup,Q.JQO.getPageWrapper,Q.JQO.getSectionHeaderPlain,Q.JQO.getSection,Q.dialogAlert,Q.util.getRetCodeMsg,Q.auth.handleInvalidSession,Q.getLocalStr,Q.localize,Q.createDialog,Q.getTemplate,Q.JQO.getDialogOptionText,Q.auth.accessControlNormal,Q.validate.test,Q.validate.getApiData,Q.util.fieldErrorText,Q.util.fieldErrorTextReset,Q.auth.accessTest,
Q.dialogLogin);Q.themeSelect=function(b,g){var n={},l={power:["^Pow-","^I-","^RC[MUOX]"],climate:["^Clim-","^BB-"],cooling:["^Fan-"]},k=function(g){var c="";b.each(l,function(e,k){b.each(k,function(b,a){if(!0===RegExp(a).test(g))return c=e,!1});if(c)return!1});return c};n.init=function(g){g&&"string"===typeof g&&b("body").removeClass().addClass(k(g))};return n}(jQuery,Q.log);Q.ping=function(b,g,n,l,k,q,c,e,t){var s={},a=null,h=null,v=0,w=function(a,b,c){"object"===typeof a&&n("status",a);if("number"===typeof b&&"number"===typeof c){$("#alarm-count").text(""+b);$("#warning-count").text(""+c);a="";if(void 0!==b&&void 0!==c){var d=g("sysState.message"),d=d.replace("$1",b),d=d.replace("$2",c);a+=d}b=a;$("#status").attr("title",b)}};s.stopUpdatePing=function(){try{a&&(clearInterval(a),a=null,h&&(h.abort(),h=null))}catch(c){b("error. ping.stopUpdatePing: "+c)}};var d=function(a,
c,d){try{if(a&&0===a.retCode)if(a.data&&!0!==a.data.adminExists)e(),q(Q.USER.lang);else{var g=a.data.alarm?a.data.alarm:void 0,h=a.data.warnCount&&"number"===typeof a.data.warnCount?a.data.warnCount:0,n=a.data.alarmCount&&"number"===typeof a.data.alarmCount?a.data.alarmCount:0;a.data.systemTime&&"number"===typeof a.data.systemTime&&(Q.SYS_TIME=a.data.systemTime);Q.LOCAL_TIME=a.data.localTime||"";k(a.data.component);l();"object"===typeof g&&(w(g,n,h),g.state!==Q.SYSTEM_ALARM.state||g.severity!==Q.SYSTEM_ALARM.severity)&&
(Q.SYSTEM_ALARM.state=g.state,Q.SYSTEM_ALARM.severity=g.severity);$.cookies.test()&&($.cookies.del("q-token",null),$.cookies.del("q-name",null),$.cookies.del("q-level",null),$.cookies.del("q-lang",null))}else a?a.retCode===Q.RETCODE.SESSION_EXPIRED?t():a.retCode===Q.RETCODE.NO_ADMIN?(e(),q(Q.USER.lang)):b("error. ping retCode="+a.data.retCode+", retMsg="+a.data.retMsg):b("error. ping: "+$.stringify(d)),a={state:"none",severity:""},Q.SYSTEM_ALARM.state=a.state,Q.SYSTEM_ALARM.severity=a.severity,w(a,
"&mdash;","&mdash;")}catch(s){b("error /api/sys/state: "+s)}finally{}};s.initUpdatePing=function(e){e=e&&"number"===typeof e&&5<e?e:Q.UPDATE_INTERVAL;b("ping.initUpdatePing: interval = "+e+" seconds");try{s.stopUpdatePing(),e*=1E3,v=0,h=c("/api/sys/state",!0,d,null,"get",null,null),a=setInterval(function(){h&&"resolved"!==h.state()?3>v?(b("ping.initalUpdatePing: update overlap..."),v++):s.initUpdatePing():(v=0,h=c("/api/sys/state",!0,d,null,"get",null,null))},e)}catch(g){b("error. ping.initUpdatePing: "+
g)}};return s}(Q.log,Q.getLocalStr,Q.util.statusBarColorUpdate,Q.util.checkClockSet,Q.util.checkSlaveBoardUpdate,Q.localize,Q.apiCall,Q.auth.dialogInitializeAdminUser,Q.auth.handleInvalidSession);Q.init=function(b,g,n,l,k,q,c,e,t,s,a,h,v,w,d,m){var B=function(){try{$("#header-loginout").on("click",function(){s(null,null,"header")}).show();$("#header-userprefs").on("click",function(){window.location.hash="users";Q.CACHE.userprefPing&&clearInterval(Q.CACHE.userprefPing);Q.CACHE.userprefPing=null;Q.CACHE.userprefPingCount=0;Q.CACHE.userprefPing=setInterval(function(){var a=$("#m-"+Q.USER.name);a&&!0===a.is(":visible")?(clearInterval(Q.CACHE.userprefPing),Q.CACHE.userprefPing=null,Q.CACHE.userprefPingCount=
0,a.click()):Q.CACHE.userprefPingCount++;10<Q.CACHE.userprefPingCount&&Q.CACHE.userprefPing&&(clearInterval(Q.CACHE.userprefPing),Q.CACHE.userprefPing=null)},2E3)}).show();var a=$("#status"),c=Q.CACHE.sys.label?Q.CACHE.sys.label:Q.CACHE.sys.name?Q.CACHE.sys.name:"";c&&($("#product-name").text(c),Q.USER.lang&&(c+=" ("+Q.USER.lang+")"),document.title=c);Q.USER.name||($("#header-userprefs").empty(),Q.GUEST_USER_ENABLED?(Q.USER.name="guest",d("en1"),Q.USER.authToken=""):(Q.USER.name="",d("en0"),Q.USER.authToken=
"",$("#menu").hide(),a.hide()));Q.USER.name&&g();a.on("click",function(){k(Q.PAGES.ALARMS)})}catch(e){b("error. init.initHeader: "+e)}};return{init:function(){b("init.init: document.ready...");try{var d=3,g=!1,F=!1,u=function(){b("initAppFinish...");Q.ADMIN=Q.CACHE.sys.state.adminExists;Q.LANG_SYS_DEFAULT=Q.CACHE.sys.locale.defaultLang;Q.USER.lang=Q.USER.lang?Q.USER.lang:Q.LANG_SYS_DEFAULT;Q.GUEST_USER_ENABLED=Q.CACHE.sys.state.guestEnabled;Q.UNITS=Q.CACHE.sys.locale.units;Q.DIRTY=Q.CACHE.sys.state.dirty;
n(Q.USER.lang,!0);B();m();b("init.cookieSupportCheck...");$.cookies.test()||(b("Cookies are required for this application."),$("#no-cookies").show());$(window).trigger("hashchange");h();$("#alertDialog").on("dialogclose",l);$(window).bind("hashchange",function(){var a=Q.ONEVIEW&&Q.ONEVIEW_ENABLED?"#oneviewSummary":"#overview",a=""===Q.USER.name?"#login":window.location.hash||a;void 0!==a&&k(a.replace("#",""))});$("li:has(a)").on("click",function(a){$(this).find(":first-child").prop("id").replace("nav-page-",
"")===Q.PAGE&&k(Q.PAGE)});n(Q.USER.lang);Q.APP_INITIALIZED=!0;$(window).trigger("hashchange")},K=function(a,c,e,h){b("initAppJSON_Callback...");var k=!0;c&&c[0]?a&&a[0]?e?k=!1:b('error. initAppJSON_Callback: request for "/api/conf/system" failed'):b('error. initAppJSON_Callback: request for "msgStatic" failed'):b('error. initAppJSON_Callback: request for "appCfg" failed');k?D():(Q.CACHE.meastypes=c[0].meastypes,b("appCfg.json::meastypes >> Q.CACHE.meastypes"),Q.CACHE.capability=c[0].capability,b("appCfg.json::capability >> Q.CACHE.capability"),
Q.CACHE.capability.logging&&Q.CACHE.capability.logging.showConfig&&Q.SENSORPAGES.push(Q.PAGES.LOGGING),Q.CACHE.capability.logging&&Q.CACHE.capability.logging.showCharts&&Q.SENSORPAGES.push(Q.PAGES.LOGCHART),e=0,Q.CACHE.capability.reports&&Q.CACHE.capability.reports.showConfig&&(Q.SYSTEMPAGES.splice(3,0,Q.PAGES.REPORTS),e++),Q.CACHE.capability.ldap&&Q.CACHE.capability.ldap.showConfig&&(Q.SYSTEMPAGES.splice(3+e,0,Q.PAGES.REMOTE_AUTH),e++),Q.CACHE.capability.display&&Q.CACHE.capability.display.show&&
(Q.SYSTEMPAGES.splice(3+e,0,Q.PAGES.DISPLAY),e++),Q.CACHE.capability.time&&Q.CACHE.capability.time.show&&(Q.SYSTEMPAGES.splice(3+e,0,Q.PAGES.TIME),e++),Q.CACHE.capability.ssh&&Q.CACHE.capability.ssh.show&&(Q.SYSTEMPAGES.splice(3+e,0,Q.PAGES.SSH),e++),Q.CACHE.capability.usb&&Q.CACHE.capability.usb.show&&(Q.SYSTEMPAGES.splice(3+e,0,Q.PAGES.USB),e++),Q.CACHE.capability.serial&&Q.CACHE.capability.serial.show&&Q.SYSTEMPAGES.splice(3+e,0,Q.PAGES.SERIAL),Q.CACHE.capability.oneview&&Q.CACHE.capability.oneview.show&&
(Q.ONEVIEW=!0),Q.ONEVIEW&&(h&&h[0]&&h[0].data&&h[0].data.enabled)&&(Q.ONEVIEW_ENABLED=!0),Q.CACHE.capability.max&&(Q.CACHE.capability.max.alarms&&(Q.MAX.ALARMS=Q.CACHE.capability.max.alarms),Q.CACHE.capability.max.alarmActions&&(Q.MAX.ALARM_ACTIONS=Q.CACHE.capability.max.alarmActions),Q.CACHE.capability.max.alarmTimes&&(Q.MAX.ALARM_TIMES=Q.CACHE.capability.max.alarmTimes),Q.CACHE.capability.max.dnsServers&&(Q.MAX.DNS_SERVERS=Q.CACHE.capability.max.dnsServers),Q.CACHE.capability.max.emailTargets&&
(Q.MAX.EMAIL_TARGETS=Q.CACHE.capability.max.emailTargets),Q.CACHE.capability.max.networkIps&&(Q.MAX.NETWORK_IPS=Q.CACHE.capability.max.networkIps),Q.CACHE.capability.max.networkRoutes&&(Q.MAX.NETWORK_ROUTES=Q.CACHE.capability.max.networkRoutes),Q.CACHE.capability.max.reports&&(Q.MAX.REPORTS=Q.CACHE.capability.max.reports),Q.CACHE.capability.max.snmpTraps&&(Q.MAX.SNMP_TRAPS=Q.CACHE.capability.max.snmpTraps),Q.CACHE.capability.max.users&&(Q.MAX.USERS=Q.CACHE.capability.max.users)),Q.ACTIVEPAGES=Q.SENSORPAGES.concat(Q.SYSTEMPAGES,
Q.HELPPAGES,Q.LONELYPAGES),Q.ONEVIEW&&(Q.ACTIVEPAGES.push(Q.PAGES.ONEVIEW_SUMMARY),Q.ACTIVEPAGES.push(Q.PAGES.ONEVIEW_GROUPS),Q.ACTIVEPAGES.push(Q.PAGES.ONEVIEW_DEVICES),Q.ACTIVEPAGES.push(Q.PAGES.ONEVIEW_GROUP_CONFIG)),Q.CACHE.languages=c[0].languages,b("appCfg.json::languages >> Q.CACHE.languages"),Q.CACHE.timezones=c[0].timezones,b("appCfg.json::timezones >> Q.CACHE.timezones"),$.extend(Q.CACHE.analogModes,c[0]["analog-modes"]),b("appCfg.json::analog-modes >> Q.CACHE.analogModes"),Q.CACHE.commands=
c[0].commands,Q.CACHE.rules=c[0].rules,Q.CACHE.msgStatic=a[0],b("msgStatic.json >> Q.CACHE.msgStatic"),g=!0,d=12,G())},D=function(){b("initAppJSON_ErrorHandler...");--d?(b("initAppJSON_ErrorHandler: Retrying - "+d+" remaining ..."),G()):(b("error. Unable to init application."),n(Q.USER.lang||Q.LANG_SYS_DEFAULT),c(Q.DIALOG_ERROR,e("err.initError")))},N=function(c,e,g){b("initAppSys_Callback...");c&&0===c.retCode&&c.data?c.data?(Q.CACHE.sys=c.data,F=!0,t(Q.CACHE.sys.model)):b('error. initAppSys_Callback: request for "api/sys" failed'):
c&&(e&&g)&&b("error. initAppSys_Callback. response="+$.stringify(c)+", statusText="+e+", jqXHR="+$.stringify(g));if(F){var h=y;q({rules:Q.CACHE.rules,files:{"/misc/languages.json":Q.CACHE.languages,"/misc/timezones.json":Q.CACHE.timezones,"/misc/analog-modes.json":Q.CACHE.analogModes},commands:Q.CACHE.commands});b("init.initAppSys_Callback: validation module initialized");if(Q.CACHE.sys.state.adminExists)if(Q.CACHE.sys.state.guestEnabled||Q.USER.authToken)$("body").css("cursor","default"),d=3,G();
else{b("init.initAppSys_Callback: guest disabled and no user logged in...");var k=function(){Q.CACHE.sys.state.guestEnabled||Q.USER.authToken?h():s(k,!1,null,k)};k()}else b("init.initAppSys_Callback: no admin user exists..."),$.cookies.test()&&($.cookies.del("r-token",null),$.cookies.del("r-name",null),$.cookies.del("r-level",null),$.cookies.del("r-lang",null)),a(h),n(Q.USER.lang||Q.LANG_SYS_DEFAULT)}else y()},y=function(){b("initAppSys_ErrorHandler...");d--?(b("initAppSys_ErrorHandler: Retrying - "+
d+" remaining ..."),G()):(b("initAppSys_ErrorHandler: Unable to init application."),n(Q.USER.lang||Q.LANG_SYS_DEFAULT),c(Q.DIALOG_ERROR,e("err.initError")),$("body").css("cursor","default"))},G=function(){b("initApp...");try{if(g)if(F)u();else{$("body").css("cursor","progress");var a=$.getJSON("api/sys");a.done(N);a.fail(y)}else $.when($.getJSON("misc/msgStatic-oem.json"),$.getJSON("misc/appCfg.json"),$.getJSON("api/conf/system"),$.getJSON("api/conf/oneview")).then(K,D)}catch(c){b("error. initApp: "+
c)}};v();n(Q.USER.lang||Q.LANG_SYS_DEFAULT,!0);$(document).ajaxSuccess(function(a,d,e){try{c(Q.DIALOG_COMM_OK,null);a=null;try{a=$.parseJSON(d.responseText)}catch(g){}a&&a.retCode===Q.RETCODE.SESSION_EXPIRED&&(b("init.apiCallSuccessMonitor: SESSION EXPIRED"),w())}catch(h){b("error. init.apiCallSuccessMonitor: "+h)}});$(document).ajaxError(function(a,c,d,e){try{c&&"abort"!==c.statusText?b("init.apiCallErrorMonitor: abort"):(b("error. init.apiCallErrorMonitor: xhr = "+$.stringify(c)),d&&(d.url&&d.type)&&
(b("error. init.apiCallErrorMonitor: url = "+d.url),b("error. init.apiCallErrorMonitor: type = "+d.type)),b("error. init.apiCallErrorMonitor: exception = "+$.stringify(e)))}catch(g){b("error. init.apiCallErrorMonitor: "+g)}});$.get("misc/templates.html",function(a){Q.CACHE.templates=$(a);G()})}catch(H){b("error. init.init: "+H)}}}}(Q.log,Q.ping.initUpdatePing,Q.localize,Q.dialogAlertClose,Q.gotoPage,Q.validate.init,Q.dialogAlert,Q.getLocalStr,Q.themeSelect.init,Q.dialogLogin,Q.auth.dialogInitializeAdminUser,
Q.auth.updateLoginout,Q.auth.initialCookieCheck,Q.auth.handleInvalidSession,Q.auth.setAuthFromStr,Q.util.getMenu);$(document).on("ready",Q.init.init());